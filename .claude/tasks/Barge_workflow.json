{
  "formName": "frmBargeSearch and frmBargeDetail",
  "formType": "Search and Detail",
  "primaryWorkflows": [
    {
      "name": "SearchAndEdit",
      "description": "User searches for barges and edits one",
      "steps": [
        {
          "step": 1,
          "action": "EnterSearchCriteria",
          "controls": [
            "txtBargeNum",
            "cboHullType",
            "cboOperatorID",
            "cboCustomerID",
            "txtTicketID",
            "cboLoadStatus",
            "cboStatus",
            "chkOpenTicketsOnly",
            "cboEquipmentType",
            "cboCoverType"
          ],
          "advancedSearchControls": [
            "cboBoatSearchType",
            "cboBoatLocationID",
            "cboFacilitySearchType",
            "cboFacilityLocationID",
            "cboShipSearchType",
            "cboShipLocationID",
            "chkActiveOnly",
            "txtCoastGuardNum",
            "cboSizeCategory",
            "cboRiver",
            "txtStartMile",
            "txtEndMile",
            "txtContractNumber",
            "cboCommodityID"
          ],
          "userExperience": {
            "defaultFocus": "txtBargeNum",
            "advancedSearchToggle": "grpMoreSearchOptions (expandable group)"
          }
        },
        {
          "step": 2,
          "action": "ClickSearch",
          "button": "btnFind",
          "result": "Results displayed in grdBargeSearch",
          "gridFeatures": [
            "Multi-row selection enabled (Extended)",
            "Custom sorting comparers for numeric columns",
            "Row colorization for cross-chartered barges (CTC/RTD)",
            "Damage level color coding",
            "User-customizable column settings (saved to database)"
          ]
        },
        {
          "step": 3,
          "action": "SelectRow",
          "control": "grdBargeSearch",
          "trigger": "Single click to select, double-click handled by main form"
        },
        {
          "step": 4,
          "action": "OpenDetailForm",
          "method": "ItemModify (called by main form)",
          "navigation": "Opens frmBargeDetail as modal dialog",
          "mode": "Edit",
          "dataLoading": "Barge.GetBarge(BargeID, FleetID)"
        }
      ],
      "statePersistence": {
        "gridSettings": "Saved/restored via MyAppSettingHelper",
        "searchCriteria": "Not persisted between sessions",
        "fleetSelection": "Maintained in _SelectedFleetID, cleared on fleet change"
      }
    },
    {
      "name": "CreateNewBarge",
      "description": "User creates a new barge record",
      "steps": [
        {
          "step": 1,
          "action": "ClickNewButton",
          "method": "ItemAdd (called by main form)",
          "navigation": "Opens frmBargeDetail as modal dialog",
          "mode": "New",
          "dataLoading": "Barge.NewBarge(FleetID)"
        },
        {
          "step": 2,
          "action": "EnterBargeDetails",
          "requiredFields": [
            "txtBargeNum (editable for new, readonly for existing)"
          ],
          "conditionallyRequiredFields": [
            "cboSizeCategory (required if not Fleet-owned or Terminal active)",
            "cboCustomerID (required if not Fleet-owned or Terminal active)",
            "cboCoverType (required if GlobalSetting.RequireBargeCoverType or commodity requires cover)",
            "cboCoverSubTypeID (required if commodity requires cover)",
            "cboCoverConfig (required if Cover Type not null/OT and EnableCoverTypeSpecialLogic)"
          ],
          "autoCalculatedFields": [
            "cboSizeCategory (auto-set from ExternalLength/ExternalWidth)",
            "txtStatus (auto-updated when Location changes)",
            "txtDraftCalculatedFeet/Inches (calculated from corner drafts)"
          ]
        },
        {
          "step": 3,
          "action": "HandleEquipmentTypeChange",
          "trigger": "cboEquipmentType.Validated",
          "conditionalLogic": {
            "if_FleetOwned": {
              "autoSet": "cboFleetID = _SelectedFleetID",
              "disabled": [
                "grpStatus (most fields)",
                "grpDamageRepair",
                "grpTicketDetails"
              ],
              "cleared": [
                "CoverConfig",
                "CommodityID",
                "CleanStatus",
                "RepairStatus",
                "IsCargoDamaged",
                "DamageLevel",
                "IsLeaker",
                "DamageNote",
                "IsDryDocked",
                "IsRepairScheduled"
              ]
            },
            "if_CustomerOwned": {
              "enabled": [
                "cboColorPairID"
              ]
            },
            "if_Other": {
              "cleared": [
                "FleetID",
                "ColorPairID"
              ]
            }
          }
        },
        {
          "step": 4,
          "action": "HandleBargeSeries",
          "trigger": "cboBargeSeriesID.Validated",
          "behavior": "When BargeSeriesID changes, auto-populate: OwnerID, CustomerID, HullType, ExternalDepth, ExternalLength, ExternalWidth, SizeCategory, CoverType",
          "userNotification": "MessageBox confirms which fields were updated"
        },
        {
          "step": 5,
          "action": "HandleCoverTypeLogic",
          "triggers": [
            "cboCoverType.ValueChanged",
            "cboCommodityID.Validated",
            "cboCustomerID.Validated"
          ],
          "stateDependencies": {
            "cboCoverConfig": {
              "enabledIf": "IsCompanyOperatedBargeCoverTypeSpecialLogic AND CoverType not null/OT",
              "requiredIf": "Same as enabled condition",
              "clearedIf": "Disabled AND EnableCoverTypeSpecialLogic=true"
            },
            "cboCoverSubTypeID": {
              "enabledIf": "CoverType not null/OT OR commodity requires cover",
              "requiredIf": "Commodity requires cover",
              "listRepopulatedOn": "CoverType change"
            }
          }
        },
        {
          "step": 6,
          "action": "ClickSubmit",
          "button": "btnSubmit",
          "validationFlow": [
            "ClearUnusedFields() based on EquipmentType",
            "_Barge.IsValid",
            "UpdateBargePositions() (if fleet-owned position set)",
            "MyBase.SubmitNoRefreshClick()",
            "Close dialog"
          ],
          "autoClearing": {
            "if_HasInsufficientFreeboardFalse": "FreeboardRange",
            "if_FleetOwned": "Most status/damage fields",
            "if_NotFleetOwned": "FleetID",
            "if_NotFleetOwnedOrCustomerOwned": "ColorPairID",
            "if_CoverConfigDisabled": "CoverConfig",
            "if_IsDamagedFalse": "DamageNote"
          }
        }
      ]
    },
    {
      "name": "DeleteBarge",
      "description": "User deletes a barge record",
      "steps": [
        {
          "step": 1,
          "action": "SelectBarge",
          "control": "grdBargeSearch"
        },
        {
          "step": 2,
          "action": "ClickDeleteButton",
          "method": "ItemRemove (called by main form)",
          "confirmation": "Main.ItemRemoveDialog('Barge')"
        },
        {
          "step": 3,
          "action": "ConfirmDelete",
          "result": "If Yes: Barge.DeleteBarge(BargeID), RefreshList(False)"
        }
      ]
    },
    {
      "name": "BulkCloseTickets",
      "description": "User closes multiple barge tickets at once",
      "steps": [
        {
          "step": 1,
          "action": "SelectMultipleBarges",
          "control": "grdBargeSearch",
          "selectionType": "Extended (multi-row)"
        },
        {
          "step": 2,
          "action": "ClickCloseTickets",
          "method": "CloseTickets (called by main form)",
          "confirmation": "MessageBox with Yes/No"
        },
        {
          "step": 3,
          "action": "ProcessBulkClose",
          "behavior": "Iterate through selected rows, call Barge.CloseTicketAndSave for each",
          "errorHandling": "Collect success/failure lists, display summary MessageBox",
          "refresh": "RefreshList(False) if any succeeded"
        }
      ]
    },
    {
      "name": "OpenSubForms",
      "description": "User opens related detail forms from Barge Detail",
      "steps": [
        {
          "step": 1,
          "action": "OpenBargeDraftForm",
          "button": "btnDraftDetail",
          "navigation": "frmBargeDraft (modal)",
          "postAction": "LoadDraftControlsForBarge() to refresh draft display"
        },
        {
          "step": 2,
          "action": "OpenBargeChartersForm",
          "button": "btnBargeCharters",
          "navigation": "frmBargeCharters (modal)",
          "visibility": "Only if BargeCharterSupportCustomization enabled"
        },
        {
          "step": 3,
          "action": "OpenBargeConditionsForm",
          "button": "btnViewPhotos",
          "navigation": "frmBargeConditions (modal)",
          "parameters": "BargeID, BargeNum"
        },
        {
          "step": 4,
          "action": "DefineColors",
          "button": "btnDefineColors",
          "navigation": "frmBargeTokenColors (modal)",
          "postAction": "Repopulate cboColorPairID with updated colors"
        },
        {
          "step": 5,
          "action": "MapDamageLevelColors",
          "button": "btnMapColors",
          "navigation": "frmBargeTokenMap (modal, maps Damage level to Color)"
        }
      ]
    },
    {
      "name": "ResetSearchCriteria",
      "description": "User clears all search fields",
      "steps": [
        {
          "step": 1,
          "action": "ClickReset",
          "button": "btnReset",
          "result": "ResetControls() called"
        },
        {
          "step": 2,
          "action": "ClearAllFields",
          "behavior": "All search fields cleared, chkActiveOnly=True, chkOpenTicketsOnly=True",
          "note": "Grid is NOT cleared/refreshed"
        }
      ]
    }
  ],
  "formStates": [
    {
      "state": "Initial",
      "description": "Search form first loaded",
      "gridState": "Empty",
      "enabledButtons": [
        "btnFind",
        "btnReset"
      ],
      "focusedControl": "txtBargeNum",
      "initialization": "pnlBargeSearch.HandleCreated fires, FormatControls(), RestoreGrid()"
    },
    {
      "state": "ResultsDisplayed",
      "description": "Search results shown in grid",
      "gridState": "Populated with search results",
      "enabledButtons": [
        "btnFind",
        "btnReset",
        "Main form buttons (Add, Modify, Remove, etc.)"
      ],
      "gridBehavior": {
        "rowColorization": "Cross-chartered barges (CTC=color1, RTD=color2)",
        "damageColorization": "Damage level column colored per BargeTokenMapList",
        "sorting": "User-configurable, saved to database",
        "selection": "Extended multi-row"
      }
    },
    {
      "state": "DetailFormNew",
      "description": "Creating new barge",
      "formTitle": "New - Barge Detail",
      "enabledFields": [
        "txtBargeNum (editable)"
      ],
      "defaultValues": {
        "IsActive": true,
        "EquipmentType": "Determines which fields are enabled"
      },
      "businessObject": "_Barge.IsNew = True, _Barge.BeginEdit() called"
    },
    {
      "state": "DetailFormEdit",
      "description": "Editing existing barge",
      "formTitle": "{BargeNum} - Barge Detail",
      "readonlyFields": [
        "txtBargeNum",
        "txtStatus",
        "txtFleetBoatName",
        "txtFleetBoatActivityDateTime",
        "txtLocationDateTime",
        "txtInspectionStatus",
        "txtDestinationInName",
        "txtDestinationOutName",
        "txtScheduleInName",
        "txtScheduleOutName",
        "txtConsignLocationName",
        "txtAwaitingPickupReadyDateTime",
        "txtOnOrderScheduleDateTime",
        "chkIsOnHold (read-only, no TabStop)",
        "chkLoadFirst (read-only, no TabStop)",
        "chkLoadLast (read-only, no TabStop)",
        "chkLoadMultipleLots (read-only, no TabStop)",
        "chkIsOnOrder (read-only, no TabStop)",
        "chkIsAwaitingPickup (read-only, no TabStop)"
      ],
      "businessObject": "_Barge.IsNew = False, _Barge.BeginEdit() called"
    },
    {
      "state": "DetailFormFleetOwned",
      "description": "Equipment Type = Fleet-owned",
      "disabledGroups": [
        "grpStatus (most fields)",
        "grpDamageRepair",
        "grpTicketDetails"
      ],
      "enabledFields": [
        "cboEquipmentType",
        "cboColorPairID",
        "cboLocationID",
        "cboLoadStatus",
        "cboOwnerID",
        "cboCustomerID",
        "txtStatus",
        "txtFleetBoatName",
        "dtInServiceDate",
        "dtOutOfServiceDate",
        "btnBargeCharters",
        "cboFleetID",
        "txtFleetBoatActivityDateTime",
        "txtLocationDateTime"
      ],
      "autoSet": {
        "cboFleetID": "_SelectedFleetID"
      },
      "labelFormatting": {
        "lblSizeCategory": "Not bold",
        "lblCustomerID": "Not bold"
      }
    },
    {
      "state": "DetailFormCustomerOwned",
      "description": "Equipment Type = Customer-owned or other",
      "enabledGroups": [
        "grpStatus",
        "grpDamageRepair",
        "grpTicketDetails"
      ],
      "disabledFields": [
        "cboFleetID"
      ],
      "enabledColorPair": "If Customer-owned, otherwise disabled",
      "labelFormatting": {
        "lblSizeCategory": "Bold (if not Terminal active)",
        "lblCustomerID": "Bold (if not Terminal active)"
      }
    },
    {
      "state": "DetailFormLoading",
      "description": "Form is still loading data",
      "flag": "_IsStillLoading = True",
      "purpose": "Prevents event handlers from firing during initialization",
      "affectedEvents": [
        "chkIsOnHold.BeforeCheckStateChanged (cancels if not loading)",
        "chkLoadFirst.BeforeCheckStateChanged (cancels if not loading)",
        "chkLoadLast.BeforeCheckStateChanged (cancels if not loading)",
        "chkLoadMultipleLots.BeforeCheckStateChanged (cancels if not loading)",
        "chkIsOnOrder.BeforeCheckStateChanged (cancels if not loading)",
        "chkIsAwaitingPickup.BeforeCheckStateChanged (cancels if not loading)",
        "cboCoverType.ValueChanged (special handling for loading)"
      ],
      "resetTo": "_IsStillLoading = False in LoadControlsForBarge Finally block"
    },
    {
      "state": "DetailFormDamagedChecked",
      "description": "chkIsDamaged is checked",
      "enabledFields": [
        "txtDamageNote"
      ],
      "labelFormatting": {
        "chkIsDamaged": "Bold"
      }
    },
    {
      "state": "DetailFormInsufficientFreeboardChecked",
      "description": "chkHasInsufficientFreeboard is checked",
      "enabledFields": [
        "cboFreeboardRange"
      ],
      "labelFormatting": {
        "chkHasInsufficientFreeboard": "Bold"
      }
    },
    {
      "state": "DetailFormCoverTypeSpecialLogic",
      "description": "EnableCoverTypeSpecialLogic=True AND company-operated barge",
      "conditionalEnabling": {
        "cboCoverConfig": {
          "enabledIf": "CoverType not null AND CoverType <> 'OT'",
          "disabledIf": "CoverType is null OR CoverType = 'OT'",
          "required": "When enabled"
        }
      }
    },
    {
      "state": "DetailFormDraftReadonly",
      "description": "Corner drafts entered OR user has readonly access",
      "readonlyFields": [
        "txtDraftFeet",
        "txtDraftInches"
      ],
      "condition": "DraftPortBow/PortStern/StarboardBow/StarboardStern not empty OR _OperationsAccessLevel <= Readonly"
    }
  ],
  "navigationPatterns": [
    {
      "from": "frmBargeSearch",
      "to": "frmBargeDetail",
      "trigger": "Main form's Modify button OR double-click (handled by main)",
      "method": "ItemModify()",
      "dataPassedId": "GridControlIndex (BargeID from selected row)",
      "modalDialog": true
    },
    {
      "from": "frmBargeSearch",
      "to": "frmBargeDetail",
      "trigger": "Main form's Add button",
      "method": "ItemAdd()",
      "dataPassedId": "_SelectedFleetID (for new barge)",
      "modalDialog": true
    },
    {
      "from": "frmBargeDetail",
      "to": "frmBargeDraft",
      "trigger": "btnDraftDetail.Click",
      "parameters": "cTypeBarge, _Barge",
      "modalDialog": true,
      "postAction": "LoadDraftControlsForBarge()"
    },
    {
      "from": "frmBargeDetail",
      "to": "frmBargeTokenColors",
      "trigger": "btnDefineColors.Click",
      "parameters": "_SelectedFleetID",
      "modalDialog": true,
      "postAction": "Repopulate cboColorPairID"
    },
    {
      "from": "frmBargeDetail",
      "to": "frmBargeCharters",
      "trigger": "btnBargeCharters.Click",
      "parameters": "_Barge",
      "modalDialog": true,
      "visibility": "Only if BargeCharterSupportCustomization enabled"
    },
    {
      "from": "frmBargeDetail",
      "to": "frmBargeTokenMap",
      "trigger": "btnMapColors.Click",
      "parameters": "Damage level, Color, _SelectedFleetID",
      "modalDialog": true
    },
    {
      "from": "frmBargeDetail",
      "to": "frmBargeConditions",
      "trigger": "btnViewPhotos.Click",
      "parameters": "BargeID, BargeNum",
      "modalDialog": true
    },
    {
      "from": "External (frmBargeExVendorDocInboxSearch)",
      "to": "frmBargeDetail",
      "parameters": "_InitialBargeNum, _InitialUscgNum",
      "behavior": "Pre-populate BargeNum/UscgNum fields for new barge"
    }
  ],
  "stateTransitions": [
    {
      "from": "Initial",
      "to": "ResultsDisplayed",
      "trigger": "btnFind.Click",
      "action": "RefreshList(True)"
    },
    {
      "from": "ResultsDisplayed",
      "to": "DetailFormEdit",
      "trigger": "ItemModify called",
      "action": "Open frmBargeDetail with Barge.GetBarge()"
    },
    {
      "from": "ResultsDisplayed",
      "to": "DetailFormNew",
      "trigger": "ItemAdd called",
      "action": "Open frmBargeDetail with Barge.NewBarge()"
    },
    {
      "from": "DetailFormEdit/New",
      "to": "ResultsDisplayed",
      "trigger": "btnSubmit.Click (successful save)",
      "action": "Close dialog, main form refreshes search results"
    },
    {
      "from": "DetailFormEdit/New",
      "to": "ResultsDisplayed",
      "trigger": "btnCancel.Click",
      "action": "_Barge.CancelEdit(), Close dialog"
    },
    {
      "from": "DetailFormNew",
      "to": "DetailFormFleetOwned",
      "trigger": "cboEquipmentType = 'Fleet-owned'",
      "action": "FormatControlsForEquipmentType(), auto-set FleetID"
    },
    {
      "from": "DetailFormFleetOwned",
      "to": "DetailFormCustomerOwned",
      "trigger": "cboEquipmentType changed to non-fleet-owned",
      "action": "FormatControlsForEquipmentType(), enable status/damage groups"
    },
    {
      "from": "Any Detail State",
      "to": "DetailFormDamagedChecked",
      "trigger": "chkIsDamaged.CheckedChanged = True",
      "action": "Enable txtDamageNote, set chkIsDamaged.Bold=True"
    },
    {
      "from": "Any Detail State",
      "to": "DetailFormInsufficientFreeboardChecked",
      "trigger": "chkHasInsufficientFreeboard.CheckedChanged = True",
      "action": "Enable cboFreeboardRange, set chkHasInsufficientFreeboard.Bold=True"
    }
  ],
  "sessionManagement": {
    "fleetPersistence": {
      "variable": "_SelectedFleetID",
      "scope": "Search form instance",
      "behavior": "OnChangeOfFleet clears grid, repopulates facility combo, reloads damage level colors"
    },
    "gridSettings": {
      "saveEvent": "pnlBargeSearch.HandleDestroyed",
      "restoreEvent": "pnlBargeSearch.HandleCreated",
      "method": "MyAppSettingHelper.SaveGrid/RestoreGrid",
      "persistsColumns": "Visibility, width, order, sorting"
    },
    "editSession": {
      "businessObject": "_Barge",
      "editMode": "_Barge.BeginEdit() on Initialize",
      "commitMode": "ApplyEdit() in base SubmitNoRefreshClick",
      "cancelMode": "CancelEdit() in base CancelClick"
    },
    "positionTracking": {
      "variable": "_BargePositions",
      "scope": "Detail form, fleet-owned only",
      "validation": "UpdateBargePositions() before save",
      "errorHandling": "Displays errors, allows retry or workspace placement"
    }
  },
  "refreshTriggers": [
    {
      "trigger": "btnFind.Click",
      "action": "RefreshList(True)",
      "behavior": "Calls BusinessLogic.Lists.BargeSearch.GetList with all criteria",
      "selectFirstRow": true
    },
    {
      "trigger": "ItemRemove (delete) success",
      "action": "RefreshList(False)",
      "selectFirstRow": false
    },
    {
      "trigger": "CloseTickets success",
      "action": "RefreshList(False)",
      "selectFirstRow": false
    },
    {
      "trigger": "OnChangeOfFleet",
      "action": "grdBargeSearch.DataSource = Nothing",
      "behavior": "Grid cleared, NOT refreshed (only Find button allowed to refresh)"
    },
    {
      "trigger": "Detail form save",
      "action": "Main form responsible for refresh",
      "behavior": "Detail form closes, main form detects and refreshes search"
    },
    {
      "trigger": "cboFacilityLocationID.AfterSortChange",
      "action": "RepopulateExpandableFacilityCombo",
      "behavior": "Header click toggles between ConsignFacilities and AllFacilities"
    }
  ],
  "userExperience": {
    "defaultFocus": "txtBargeNum",
    "advancedSearch": {
      "expandableGroup": "grpMoreSearchOptions",
      "collapsedText": "Show search options",
      "expandedText": "Hide search options",
      "dynamicResize": "pnlCriteria height adjusts, grid repositions"
    },
    "enterKeyBehavior": "Not explicitly defined (likely triggers Find via form AcceptButton)",
    "gridBehavior": {
      "doubleClickBehavior": "Handled by main form (opens detail)",
      "multiSelect": true,
      "contextMenu": "Handled by main form",
      "rowColorization": "Cross-charter and damage level colors"
    },
    "conditionalEnabling": {
      "cboBoatLocationID": "Disabled until cboBoatSearchType has value",
      "cboFacilityLocationID": "Disabled until cboFacilitySearchType has value",
      "cboShipLocationID": "Disabled until cboShipSearchType has value",
      "cboFreeboardRange": "Disabled until chkHasInsufficientFreeboard checked",
      "txtDamageNote": "Disabled until chkIsDamaged checked"
    },
    "autoUncheck": {
      "chkOpenTicketsOnly": "Automatically unchecked when cboEquipmentType = 'Fleet-owned'"
    },
    "hyperlinkBehavior": {
      "llblLookup": "Opens UscgLookupWebsite, link stays blue (AddToVisitedLinks=False)"
    },
    "bargeNumberEditing": {
      "btnEditBargeNumber": "Enables txtBargeNum and sets focus (for existing records)"
    },
    "validationDisplay": {
      "validatorExtender": "Uses main form's status bar (RaiseStatusBarTextChangedEvent)"
    }
  },
  "businessLogicIntegration": {
    "autoCalculations": [
      {
        "field": "SizeCategory",
        "triggers": [
          "ExternalLength.Validated",
          "ExternalWidth.Validated"
        ],
        "calculation": "Barge.SizeCategory property setter"
      },
      {
        "field": "Status",
        "triggers": [
          "LocationID.Validated"
        ],
        "calculation": "Barge.Status property getter"
      },
      {
        "field": "DraftCalculatedFeet/Inches",
        "source": "Corner draft values (PortBow, PortStern, StarboardBow, StarboardStern)",
        "calculation": "Barge.DraftCalculated property"
      },
      {
        "field": "CoverSubTypeID",
        "triggers": [
          "CoverType.Validated (clears if changed)"
        ],
        "behavior": "Must be unique per CoverType, cleared on CoverType change"
      },
      {
        "field": "FleetID",
        "triggers": [
          "EquipmentType = 'Fleet-owned'"
        ],
        "calculation": "_SelectedFleetID"
      },
      {
        "field": "MultipleFields",
        "triggers": [
          "BargeSeriesID.Validated (when changed)"
        ],
        "affectedFields": [
          "OwnerID",
          "CustomerID",
          "HullType",
          "ExternalDepth",
          "ExternalLength",
          "ExternalWidth",
          "SizeCategory",
          "CoverType"
        ],
        "userNotification": "MessageBox listing updated fields"
      }
    ],
    "conditionalClearing": [
      {
        "condition": "EquipmentType = 'Fleet-owned'",
        "clearedOnSubmit": [
          "CoverConfig",
          "CommodityID",
          "CleanStatus",
          "RepairStatus",
          "IsCargoDamaged",
          "DamageLevel",
          "IsLeaker",
          "DamageNote",
          "IsDryDocked",
          "IsRepairScheduled"
        ]
      },
      {
        "condition": "EquipmentType <> 'Fleet-owned'",
        "clearedOnSubmit": [
          "FleetID"
        ]
      },
      {
        "condition": "EquipmentType <> 'Fleet-owned' AND <> 'Customer-owned'",
        "clearedOnSubmit": [
          "ColorPairID"
        ]
      },
      {
        "condition": "HasInsufficientFreeboard = False",
        "clearedOnSubmit": [
          "FreeboardRange"
        ]
      },
      {
        "condition": "IsDamaged = False",
        "clearedOnSubmit": [
          "DamageNote"
        ]
      },
      {
        "condition": "cboCoverConfig.Enabled = False AND EnableCoverTypeSpecialLogic = True",
        "clearedOnSubmit": [
          "CoverConfig"
        ]
      },
      {
        "condition": "CoverType changed",
        "clearedImmediately": [
          "CoverSubTypeID"
        ]
      }
    ],
    "validationRules": [
      {
        "rule": "BargeNum required",
        "type": "String",
        "enforced": "Business object validation"
      },
      {
        "rule": "SizeCategory required if not Fleet-owned OR Terminal active",
        "type": "Conditional",
        "enforced": "Label bold indicates required"
      },
      {
        "rule": "CustomerID required if not Fleet-owned OR Terminal active",
        "type": "Conditional",
        "enforced": "Label bold indicates required"
      },
      {
        "rule": "CoverType required if GlobalSetting or commodity requires",
        "type": "Conditional",
        "enforced": "SetStateCoverType() sets label bold"
      },
      {
        "rule": "CoverSubTypeID required if commodity requires cover",
        "type": "Conditional",
        "enforced": "SetStateCoverSubType() sets label bold"
      },
      {
        "rule": "CoverConfig required if CoverType not null/OT and special logic enabled",
        "type": "Conditional",
        "enforced": "SetStateCoverConfig() sets label bold"
      },
      {
        "rule": "FleetID auto-set and required for Fleet-owned",
        "type": "Auto-populated",
        "enforced": "cboEquipmentType.Validated"
      },
      {
        "rule": "Draft fields readonly if corner drafts entered",
        "type": "Conditional",
        "enforced": "LoadDraftControlsForBarge()"
      },
      {
        "rule": "BargePositions validation for fleet-owned moves",
        "type": "Complex",
        "enforced": "UpdateBargePositions() before save",
        "errors": [
          "Position already taken (bit 1)",
          "Not in expected premove position (bit 2)"
        ]
      }
    ]
  },
  "specialFeatures": [
    {
      "feature": "Cross-Charter Row Colorization",
      "implementation": "grdBargeSearch.InitializeRow",
      "dataSources": [
        "GlobalSettingList.CrossCharterBargeBackColorCTC",
        "GlobalSettingList.CrossCharterBargeBackColorRTD"
      ],
      "behavior": "Rows colored based on CrossCharterCode column value"
    },
    {
      "feature": "Damage Level Color Mapping",
      "implementation": "grdBargeSearch.InitializeRow",
      "dataSource": "_DamageLevelMapList (BargeTokenMapList)",
      "behavior": "Damage Level cell colored per mapping (text and background colors)"
    },
    {
      "feature": "Expandable Facility Combo",
      "controls": [
        "cboFacilityLocationID"
      ],
      "behavior": "Header click toggles between ConsignFacilities and AllFacilities modes",
      "persistence": "Previous search value retained after mode toggle"
    },
    {
      "feature": "License-Based Field Visibility",
      "licenseChecks": [
        {
          "license": "Terminal",
          "affectedFields": [
            "Cargo handling columns in grid",
            "txtDraftCalculatedFeet/Inches visibility",
            "SizeCategory/CustomerID required logic"
          ]
        },
        {
          "license": "Freight",
          "affectedFields": [
            "Freight customer columns in grid",
            "txtContractNumber visibility",
            "Default tonnage column"
          ]
        }
      ]
    },
    {
      "feature": "Customization-Based Feature Toggling",
      "customizations": [
        {
          "name": "BargeCharterSupportCustomization",
          "affects": "btnBargeCharters visibility"
        },
        {
          "name": "BargeSeriesSupportCustomization",
          "affects": "cboBargeSeriesID and label visibility"
        },
        {
          "name": "ShowCommodityInfoCustomization",
          "affects": "SurveyTons column display logic in grid"
        }
      ]
    },
    {
      "feature": "Barge Series Auto-Population",
      "trigger": "cboBargeSeriesID.Validated (when changed)",
      "behavior": "Populates 8 fields from series definition",
      "userFeedback": "MessageBox confirms which fields updated"
    },
    {
      "feature": "USCG Lookup Hyperlink",
      "control": "llblLookup",
      "urlSource": "GlobalSettingList.UscgLookupWebsite",
      "behavior": "Opens external website, validates URL before opening",
      "token": "[URL] placeholder replaced with actual URL"
    },
    {
      "feature": "Location DateTime Clearing",
      "button": "btnClearLocationDateTime",
      "action": "_Barge.LocationID(String.Empty) = _Barge.LocationID",
      "purpose": "Clear LocationDateTime while keeping LocationID"
    },
    {
      "feature": "Barge Positions for Fleet-Owned",
      "storage": "_BargePositions collection",
      "validation": "UpdateBargePositions() validates tier placement",
      "errorHandling": "Offers retry or workspace placement on conflict"
    },
    {
      "feature": "Grid Settings Persistence",
      "events": [
        "HandleCreated: RestoreGrid",
        "HandleDestroyed: SaveGrid"
      ],
      "persisted": [
        "Column widths",
        "Column order",
        "Column visibility",
        "Sort order"
      ],
      "storage": "Database via MyAppSettingHelper"
    },
    {
      "feature": "Multi-Row Ticket Operations",
      "method": "CloseTickets()",
      "behavior": "Batch close tickets for multiple selected barges",
      "feedback": "Success/failure summary MessageBox"
    },
    {
      "feature": "Cover Type Special Logic",
      "globalSetting": "EnableCoverTypeSpecialLogic",
      "affects": [
        "CoverConfig required logic",
        "CoverSubType required logic",
        "Auto-clearing on submit"
      ],
      "businessRule": "Company-operated barges with cover (not OT) require configuration"
    }
  ],
  "errorHandling": [
    {
      "scenario": "Barge Position Validation Failure",
      "handling": "MessageBox explains specific errors, allows user to retry or place in workspace",
      "errorBits": [
        "1 = Position already taken",
        "2 = Not in expected premove position (existing barges only)"
      ]
    },
    {
      "scenario": "Broken Rules on Ticket Close",
      "handling": "Collect failed barges, display summary with success and failure lists"
    },
    {
      "scenario": "Form Load Exception",
      "handling": "Publish exception, attempt to close form, show error if close fails"
    },
    {
      "scenario": "Invalid USCG Lookup URL",
      "handling": "MessageBox prompts to update global setting"
    },
    {
      "scenario": "All Standard Exceptions",
      "handling": "ExceptionManager.Publish(ex) in all catch blocks"
    }
  ],
  "dataBinding": {
    "searchGrid": {
      "dataSource": "BusinessLogic.Lists.BargeSearch.GetList(...).List",
      "bindingMethod": "MyBase.RefreshListBase()",
      "uniqueIdentifier": "BargeID",
      "initialSort": "BargeNum Ascending"
    },
    "detailForm": {
      "businessObject": "_Barge (BusinessLogic.Barge)",
      "bindingPattern": "Manual property assignment in Validated events",
      "validation": "ValidatorExtender for data types",
      "editMode": "BeginEdit/ApplyEdit/CancelEdit pattern"
    },
    "combos": {
      "populationMethods": [
        "PopulateValidationListCombo (static lists)",
        "PopulateListCombo (database lists)",
        "PopulateExpandableFacilityCombo (special mode-switching combo)",
        "PopulateCoverSubTypeCombo (filtered by CoverType)"
      ],
      "valueRetrieval": "InfragisticsHelper.SetObjectProperty",
      "valueSetting": "InfragisticsHelper.SetComboValue"
    }
  },
  "conversionNotes": {
    "sessionVariables": [
      "_SelectedFleetID: Pass via service layer or context",
      "_IsStillLoading: Client-side state management in modern framework",
      "_BargePositions: Consider separate API for position validation",
      "_DamageLevelMapList: Load once on form init, cache client-side"
    ],
    "stateManagement": [
      "Convert BeginEdit/ApplyEdit to change tracking or dirty checking",
      "Grid settings persistence: Use local storage or user preferences API",
      "Form lifecycle: Map HandleCreated/Destroyed to component mount/unmount"
    ],
    "complexLogic": [
      "Equipment type state changes affect many fields - use reactive patterns",
      "Cover type logic has multiple interdependencies - consider state machine",
      "Conditional field requirements - implement client-side validation rules",
      "Auto-population from BargeSeries - ensure change detection and notification"
    ],
    "uiPatterns": [
      "Modal dialogs: Convert to modern dialog/modal components",
      "Expandable search: Accordion or collapsible panel component",
      "Multi-select grid: Data table with row selection",
      "Combo mode switching (facility): Implement toggle or dual-mode selector",
      "Read-only checkboxes: Disabled checkboxes or readonly display",
      "Bold labels for required: Use CSS classes and ARIA attributes"
    ],
    "businessRulesHighlights": [
      "Fleet-owned equipment disables damage/status fields - critical for data integrity",
      "Cover type special logic affects multiple fields - document thoroughly",
      "Barge series auto-population - ensure user is notified of changes",
      "Position validation for fleet-owned - maintain same validation on API",
      "Conditional clearing on submit - ensure all rules are preserved in API"
    ]
  }
}
