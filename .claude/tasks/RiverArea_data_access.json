{
  "entity": "RiverArea",
  "softDelete": false,
  "hasIsActive": true,
  "namespace": {
    "dto": "BargeOps.Shared.Dto",
    "repositoryInterface": "Admin.Infrastructure.Abstractions",
    "repositoryImplementation": "Admin.Infrastructure.Repositories",
    "sqlFilesPath": "src/BargeOps.API/src/Admin.Infrastructure/DataAccess/Sql/"
  },
  "storedProcedures": {
    "search": {
      "name": "RiverAreaSearch",
      "operation": "Search",
      "description": "Search river areas with filtering",
      "parameters": [
        {
          "name": "@Name",
          "type": "VarChar",
          "dotNetType": "string",
          "required": false,
          "description": "Filter by river area name (partial match)"
        },
        {
          "name": "@ActiveOnly",
          "type": "Bit",
          "dotNetType": "bool",
          "required": true,
          "description": "Filter to active records only"
        },
        {
          "name": "@PricingZonesOnly",
          "type": "Bit",
          "dotNetType": "bool",
          "required": true,
          "description": "Filter to pricing zones only"
        },
        {
          "name": "@PortalAreasOnly",
          "type": "Bit",
          "dotNetType": "bool",
          "required": true,
          "description": "Filter to portal areas only"
        },
        {
          "name": "@CustomerID",
          "type": "Int",
          "dotNetType": "int?",
          "required": false,
          "description": "Filter by high water customer"
        },
        {
          "name": "@HighWaterAreasOnly",
          "type": "Bit",
          "dotNetType": "bool",
          "required": true,
          "description": "Filter to high water areas only"
        }
      ],
      "resultColumns": [
        {
          "column": "RiverAreaID",
          "property": "RiverAreaId",
          "type": "int",
          "description": "Primary key"
        },
        {
          "column": "Name",
          "property": "Name",
          "type": "string",
          "description": "River area name"
        },
        {
          "column": "IsActive",
          "property": "IsActive",
          "type": "bool",
          "description": "Active status"
        },
        {
          "column": "IsPriceZone",
          "property": "IsPriceZone",
          "type": "bool",
          "description": "Is pricing zone flag"
        },
        {
          "column": "IsPortalArea",
          "property": "IsPortalArea",
          "type": "bool",
          "description": "Is portal area flag"
        },
        {
          "column": "IsHighWaterArea",
          "property": "IsHighWaterArea",
          "type": "bool",
          "description": "Is high water area flag"
        },
        {
          "column": "CustomerName",
          "property": "CustomerName",
          "type": "string",
          "description": "High water customer name"
        },
        {
          "column": "IsFuelTaxArea",
          "property": "IsFuelTaxArea",
          "type": "bool",
          "description": "Is fuel tax area flag"
        },
        {
          "column": "IsLiquidRateArea",
          "property": "IsLiquidRateArea",
          "type": "bool",
          "description": "Is liquid rate area flag"
        }
      ]
    },
    "getById": {
      "name": "RiverAreaSelect",
      "operation": "GetById",
      "description": "Fetch single river area by ID with child segments",
      "parameters": [
        {
          "name": "@RiverAreaID",
          "type": "Int",
          "dotNetType": "int",
          "required": true,
          "description": "Primary key"
        }
      ],
      "resultColumns": [
        {
          "column": "RiverAreaID",
          "property": "RiverAreaId",
          "type": "int"
        },
        {
          "column": "Name",
          "property": "Name",
          "type": "string",
          "maxLength": 50
        },
        {
          "column": "IsActive",
          "property": "IsActive",
          "type": "bool"
        },
        {
          "column": "IsPriceZone",
          "property": "IsPriceZone",
          "type": "bool"
        },
        {
          "column": "IsPortalArea",
          "property": "IsPortalArea",
          "type": "bool"
        },
        {
          "column": "IsHighWaterArea",
          "property": "IsHighWaterArea",
          "type": "bool"
        },
        {
          "column": "CustomerID",
          "property": "CustomerId",
          "type": "int?",
          "description": "Nullable foreign key to Customer"
        },
        {
          "column": "IsFuelTaxArea",
          "property": "IsFuelTaxArea",
          "type": "bool"
        },
        {
          "column": "IsLiquidRateArea",
          "property": "IsLiquidRateArea",
          "type": "bool"
        }
      ],
      "childResultSets": [
        {
          "entity": "RiverAreaSegment",
          "description": "River area segments (river mile ranges)",
          "columns": [
            {
              "column": "RiverAreaSegmentID",
              "property": "RiverAreaSegmentId",
              "type": "int"
            },
            {
              "column": "RiverAreaID",
              "property": "RiverAreaId",
              "type": "int"
            },
            {
              "column": "River",
              "property": "River",
              "type": "string",
              "maxLength": 3,
              "description": "3-char river code"
            },
            {
              "column": "StartMile",
              "property": "StartMile",
              "type": "decimal?"
            },
            {
              "column": "EndMile",
              "property": "EndMile",
              "type": "decimal?"
            }
          ]
        }
      ]
    },
    "insert": {
      "name": "RiverAreaInsert",
      "operation": "Insert",
      "description": "Create new river area",
      "parameters": [
        {
          "name": "@RiverAreaID",
          "type": "Int",
          "dotNetType": "int",
          "direction": "InputOutput",
          "description": "Returns generated primary key"
        },
        {
          "name": "@Name",
          "type": "VarChar",
          "dotNetType": "string",
          "required": true,
          "maxLength": 50
        },
        {
          "name": "@IsActive",
          "type": "Bit",
          "dotNetType": "bool",
          "required": true
        },
        {
          "name": "@IsPriceZone",
          "type": "Bit",
          "dotNetType": "bool",
          "required": true
        },
        {
          "name": "@IsPortalArea",
          "type": "Bit",
          "dotNetType": "bool",
          "required": true
        },
        {
          "name": "@IsHighWaterArea",
          "type": "Bit",
          "dotNetType": "bool",
          "required": true
        },
        {
          "name": "@CustomerID",
          "type": "Int",
          "dotNetType": "int?",
          "required": false
        },
        {
          "name": "@IsFuelTaxArea",
          "type": "Bit",
          "dotNetType": "bool",
          "required": true
        },
        {
          "name": "@IsLiquidRateArea",
          "type": "Bit",
          "dotNetType": "bool",
          "required": true
        }
      ]
    },
    "update": {
      "name": "RiverAreaUpdate",
      "operation": "Update",
      "description": "Update existing river area",
      "parameters": [
        {
          "name": "@RiverAreaID",
          "type": "Int",
          "dotNetType": "int",
          "required": true
        },
        {
          "name": "@Name",
          "type": "VarChar",
          "dotNetType": "string",
          "required": true,
          "maxLength": 50
        },
        {
          "name": "@IsActive",
          "type": "Bit",
          "dotNetType": "bool",
          "required": true
        },
        {
          "name": "@IsPriceZone",
          "type": "Bit",
          "dotNetType": "bool",
          "required": true
        },
        {
          "name": "@IsPortalArea",
          "type": "Bit",
          "dotNetType": "bool",
          "required": true
        },
        {
          "name": "@IsHighWaterArea",
          "type": "Bit",
          "dotNetType": "bool",
          "required": true
        },
        {
          "name": "@CustomerID",
          "type": "Int",
          "dotNetType": "int?",
          "required": false
        },
        {
          "name": "@IsFuelTaxArea",
          "type": "Bit",
          "dotNetType": "bool",
          "required": true
        },
        {
          "name": "@IsLiquidRateArea",
          "type": "Bit",
          "dotNetType": "bool",
          "required": true
        }
      ]
    },
    "delete": {
      "name": "RiverAreaDelete",
      "operation": "Delete",
      "description": "Delete river area (hard delete, NOT soft delete)",
      "parameters": [
        {
          "name": "@RiverAreaID",
          "type": "Int",
          "dotNetType": "int",
          "required": true
        }
      ],
      "note": "This is a hard delete. Although entity has IsActive property, legacy code uses hard delete via DeleteRiverArea method."
    }
  },
  "childEntityStoredProcedures": {
    "riverAreaSegment": {
      "getByParentId": {
        "name": "RiverAreaSegmentsSelect",
        "operation": "GetRelated",
        "description": "Get all segments for a river area",
        "parameters": [
          {
            "name": "@RiverAreaID",
            "type": "Int",
            "dotNetType": "int",
            "required": true
          }
        ]
      },
      "insert": {
        "name": "RiverAreaSegmentInsert",
        "operation": "Insert",
        "description": "Create new river area segment",
        "parameters": [
          {
            "name": "@RiverAreaSegmentID",
            "type": "Int",
            "dotNetType": "int",
            "direction": "InputOutput"
          },
          {
            "name": "@RiverAreaID",
            "type": "Int",
            "dotNetType": "int",
            "required": true
          },
          {
            "name": "@River",
            "type": "Char",
            "dotNetType": "string",
            "required": true,
            "maxLength": 3
          },
          {
            "name": "@StartMile",
            "type": "Decimal",
            "dotNetType": "decimal?",
            "required": false
          },
          {
            "name": "@EndMile",
            "type": "Decimal",
            "dotNetType": "decimal?",
            "required": false
          }
        ]
      },
      "update": {
        "name": "RiverAreaSegmentUpdate",
        "operation": "Update",
        "description": "Update existing river area segment",
        "parameters": [
          {
            "name": "@RiverAreaSegmentID",
            "type": "Int",
            "dotNetType": "int",
            "required": true
          },
          {
            "name": "@RiverAreaID",
            "type": "Int",
            "dotNetType": "int",
            "required": true
          },
          {
            "name": "@River",
            "type": "Char",
            "dotNetType": "string",
            "required": true,
            "maxLength": 3
          },
          {
            "name": "@StartMile",
            "type": "Decimal",
            "dotNetType": "decimal?",
            "required": false
          },
          {
            "name": "@EndMile",
            "type": "Decimal",
            "dotNetType": "decimal?",
            "required": false
          }
        ]
      },
      "delete": {
        "name": "RiverAreaSegmentDelete",
        "operation": "Delete",
        "description": "Delete river area segment",
        "parameters": [
          {
            "name": "@RiverAreaSegmentID",
            "type": "Int",
            "dotNetType": "int",
            "required": true
          }
        ]
      }
    }
  },
  "sqlFiles": [
    {
      "fileName": "RiverArea_Search.sql",
      "operation": "Search",
      "description": "Search river areas with multiple filter criteria",
      "sourceStoredProcedure": "RiverAreaSearch",
      "embeddedResource": true
    },
    {
      "fileName": "RiverArea_GetById.sql",
      "operation": "GetById",
      "description": "Fetch single river area by ID with segments",
      "sourceStoredProcedure": "RiverAreaSelect",
      "embeddedResource": true,
      "note": "Returns multiple result sets: RiverArea + RiverAreaSegments"
    },
    {
      "fileName": "RiverArea_Insert.sql",
      "operation": "Insert",
      "description": "Create new river area",
      "sourceStoredProcedure": "RiverAreaInsert",
      "embeddedResource": true
    },
    {
      "fileName": "RiverArea_Update.sql",
      "operation": "Update",
      "description": "Update existing river area",
      "sourceStoredProcedure": "RiverAreaUpdate",
      "embeddedResource": true
    },
    {
      "fileName": "RiverArea_Delete.sql",
      "operation": "Delete",
      "description": "Hard delete river area (NOT soft delete)",
      "sourceStoredProcedure": "RiverAreaDelete",
      "embeddedResource": true,
      "note": "Hard delete despite IsActive property existing"
    },
    {
      "fileName": "RiverAreaSegment_GetByRiverAreaId.sql",
      "operation": "GetRelated",
      "description": "Get all segments for a river area",
      "sourceStoredProcedure": "RiverAreaSegmentsSelect",
      "embeddedResource": true
    },
    {
      "fileName": "RiverAreaSegment_Insert.sql",
      "operation": "Insert",
      "description": "Create new river area segment",
      "sourceStoredProcedure": "RiverAreaSegmentInsert",
      "embeddedResource": true
    },
    {
      "fileName": "RiverAreaSegment_Update.sql",
      "operation": "Update",
      "description": "Update existing river area segment",
      "sourceStoredProcedure": "RiverAreaSegmentUpdate",
      "embeddedResource": true
    },
    {
      "fileName": "RiverAreaSegment_Delete.sql",
      "operation": "Delete",
      "description": "Delete river area segment",
      "sourceStoredProcedure": "RiverAreaSegmentDelete",
      "embeddedResource": true
    }
  ],
  "repositoryInterface": {
    "name": "IRiverAreaRepository",
    "namespace": "Admin.Infrastructure.Abstractions",
    "methods": [
      {
        "name": "SearchAsync",
        "returnType": "Task<DataTableResponse<RiverAreaListDto>>",
        "parameters": [
          "RiverAreaSearchRequest request"
        ],
        "description": "Search river areas with filtering and pagination"
      },
      {
        "name": "GetByIdAsync",
        "returnType": "Task<RiverArea>",
        "parameters": [
          "int riverAreaId"
        ],
        "description": "Get river area by ID with segments"
      },
      {
        "name": "CreateAsync",
        "returnType": "Task<int>",
        "parameters": [
          "RiverArea riverArea"
        ],
        "description": "Create new river area, returns generated ID"
      },
      {
        "name": "UpdateAsync",
        "returnType": "Task",
        "parameters": [
          "RiverArea riverArea"
        ],
        "description": "Update existing river area"
      },
      {
        "name": "DeleteAsync",
        "returnType": "Task",
        "parameters": [
          "int riverAreaId"
        ],
        "description": "Hard delete river area"
      },
      {
        "name": "GetSegmentsByRiverAreaIdAsync",
        "returnType": "Task<IEnumerable<RiverAreaSegment>>",
        "parameters": [
          "int riverAreaId"
        ],
        "description": "Get all segments for a river area"
      },
      {
        "name": "CreateSegmentAsync",
        "returnType": "Task<int>",
        "parameters": [
          "RiverAreaSegment segment"
        ],
        "description": "Create new river area segment"
      },
      {
        "name": "UpdateSegmentAsync",
        "returnType": "Task",
        "parameters": [
          "RiverAreaSegment segment"
        ],
        "description": "Update existing river area segment"
      },
      {
        "name": "DeleteSegmentAsync",
        "returnType": "Task",
        "parameters": [
          "int riverAreaSegmentId"
        ],
        "description": "Delete river area segment"
      }
    ]
  },
  "dataTransferObjects": [
    {
      "name": "RiverAreaListDto",
      "namespace": "BargeOps.Shared.Dto",
      "description": "DTO for river area search results",
      "properties": [
        {
          "name": "RiverAreaId",
          "type": "int"
        },
        {
          "name": "Name",
          "type": "string"
        },
        {
          "name": "IsActive",
          "type": "bool"
        },
        {
          "name": "IsPriceZone",
          "type": "bool"
        },
        {
          "name": "IsPortalArea",
          "type": "bool"
        },
        {
          "name": "IsHighWaterArea",
          "type": "bool"
        },
        {
          "name": "CustomerName",
          "type": "string"
        },
        {
          "name": "IsFuelTaxArea",
          "type": "bool"
        },
        {
          "name": "IsLiquidRateArea",
          "type": "bool"
        }
      ]
    },
    {
      "name": "RiverArea",
      "namespace": "BargeOps.Shared.Dto",
      "description": "DTO for river area detail",
      "properties": [
        {
          "name": "RiverAreaId",
          "type": "int"
        },
        {
          "name": "Name",
          "type": "string",
          "maxLength": 50,
          "required": true
        },
        {
          "name": "IsActive",
          "type": "bool"
        },
        {
          "name": "IsPriceZone",
          "type": "bool"
        },
        {
          "name": "IsPortalArea",
          "type": "bool"
        },
        {
          "name": "IsHighWaterArea",
          "type": "bool"
        },
        {
          "name": "CustomerId",
          "type": "int?",
          "description": "Required if IsHighWaterArea is true"
        },
        {
          "name": "IsFuelTaxArea",
          "type": "bool"
        },
        {
          "name": "IsLiquidRateArea",
          "type": "bool"
        },
        {
          "name": "Segments",
          "type": "List<RiverAreaSegment>",
          "description": "Child collection of river segments"
        }
      ]
    },
    {
      "name": "RiverAreaSegment",
      "namespace": "BargeOps.Shared.Dto",
      "description": "DTO for river area segment (mile range)",
      "properties": [
        {
          "name": "RiverAreaSegmentId",
          "type": "int"
        },
        {
          "name": "RiverAreaId",
          "type": "int"
        },
        {
          "name": "River",
          "type": "string",
          "maxLength": 3,
          "description": "3-character river code"
        },
        {
          "name": "StartMile",
          "type": "decimal?"
        },
        {
          "name": "EndMile",
          "type": "decimal?"
        }
      ]
    },
    {
      "name": "RiverAreaSearchRequest",
      "namespace": "BargeOps.Shared.Dto",
      "description": "Request DTO for river area search",
      "properties": [
        {
          "name": "Name",
          "type": "string"
        },
        {
          "name": "ActiveOnly",
          "type": "bool",
          "defaultValue": true
        },
        {
          "name": "PricingZonesOnly",
          "type": "bool",
          "defaultValue": false
        },
        {
          "name": "PortalAreasOnly",
          "type": "bool",
          "defaultValue": false
        },
        {
          "name": "CustomerId",
          "type": "int?"
        },
        {
          "name": "HighWaterAreasOnly",
          "type": "bool",
          "defaultValue": false
        },
        {
          "name": "Start",
          "type": "int",
          "description": "Pagination offset"
        },
        {
          "name": "Length",
          "type": "int",
          "description": "Page size"
        },
        {
          "name": "Draw",
          "type": "int",
          "description": "DataTables draw counter"
        },
        {
          "name": "OrderColumn",
          "type": "string"
        },
        {
          "name": "OrderDirection",
          "type": "string",
          "defaultValue": "ASC"
        }
      ]
    }
  ],
  "listQueryFields": {
    "filterable": [
      "Name",
      "IsActive",
      "IsPriceZone",
      "IsPortalArea",
      "IsHighWaterArea",
      "CustomerId",
      "IsFuelTaxArea",
      "IsLiquidRateArea"
    ],
    "sortable": [
      "Name",
      "IsActive",
      "IsPriceZone",
      "IsPortalArea"
    ],
    "defaultSort": "Name ASC"
  },
  "businessRules": [
    {
      "rule": "MutuallyExclusiveFlags",
      "description": "Only one of IsPriceZone, IsPortalArea, or IsHighWaterArea may be true",
      "validation": "Exactly one or none of these flags can be checked"
    },
    {
      "rule": "ConditionalRequired",
      "description": "CustomerId required if IsHighWaterArea is true",
      "validation": "CustomerId must have value when IsHighWaterArea = true"
    },
    {
      "rule": "OverlappingPricingZones",
      "description": "Pricing zones cannot have overlapping river segment mile ranges",
      "validation": "Check segments against other pricing zones for same river",
      "implementation": "CheckOverlappingPricingZones method validates on IsValid"
    },
    {
      "rule": "NameRequired",
      "description": "Name is required and cannot exceed 50 characters",
      "maxLength": 50
    },
    {
      "rule": "SegmentValidation",
      "description": "Each segment must have River, StartMile, and EndMile",
      "validation": "Child segments require all three fields"
    }
  ],
  "dataTransformations": [
    {
      "field": "StartMile",
      "type": "decimal",
      "format": "Mile marker display formatting",
      "description": "Stored as decimal, displayed with proper formatting"
    },
    {
      "field": "EndMile",
      "type": "decimal",
      "format": "Mile marker display formatting",
      "description": "Stored as decimal, displayed with proper formatting"
    },
    {
      "field": "CustomerId",
      "type": "nullable",
      "description": "Cleared automatically if IsHighWaterArea is unchecked"
    }
  ],
  "implementationNotes": [
    "RiverArea has child collection RiverAreaSegments loaded via second result set",
    "Delete is HARD delete despite IsActive property - legacy pattern",
    "Business validation includes checking overlapping pricing zones",
    "CustomerID must be cleared if IsHighWaterArea is false (form enforces this)",
    "Segments use 3-character river codes (e.g., 'MIS', 'OHI')",
    "Mile markers stored as decimals for precision",
    "Search supports multiple boolean filters and customer filtering",
    "Portal and UnitTow license flags control visibility of certain features",
    "Global setting EnableRiverSegmentHighWaterModel controls high water area visibility",
    "Pricing zone overlap validation runs against RiverAreaPriceZoneSearch stored procedure",
    "Child segments support Add/Modify/Remove operations in detail screen",
    "Grid columns use custom comparers for numeric sorting on mile fields"
  ],
  "referenceImplementations": {
    "similar": "FacilityRepository.cs",
    "pattern": "Parent with child collections using Dapper",
    "childHandling": "QueryMultipleAsync for parent + children result sets"
  }
}
