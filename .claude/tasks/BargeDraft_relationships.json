{
  "parentEntity": "Draft",
  "entityAlias": "BargeDraft",
  "description": "Draft is a standalone business object that stores barge draft measurements. It does NOT have child entities. Instead, Draft is referenced by BargeEvent and TicketEvent as a related entity. The 'BargeDraft' columns found in database tables are denormalized fields on TicketEvent, not a separate child entity relationship.",
  "relationships": [],
  "lookupRelationships": [
    {
      "property": "BargeSeriesID",
      "lookupEntity": "BargeSeries",
      "displayProperty": "BargeSeriesName",
      "required": false,
      "description": "References BargeSeries for draft/tonnage conversion tables"
    }
  ],
  "parentReferences": [
    {
      "parentEntity": "BargeEvent",
      "referenceType": "Composition",
      "description": "BargeEvent can have draft measurements stored as denormalized fields (BargeDraft, BargeDraftPortBow, BargeDraftPortStern, BargeDraftStarboardBow, BargeDraftStarboardStern) directly on the BargeEvent record, not as a separate Draft entity reference",
      "properties": [
        "BargeDraft",
        "BargeDraftFeet",
        "BargeDraftInches",
        "BargeDraftPortBow",
        "BargeDraftPortBowFeet",
        "BargeDraftPortBowInches",
        "BargeDraftStarboardBow",
        "BargeDraftStarboardBowFeet",
        "BargeDraftStarboardBowInches",
        "BargeDraftPortStern",
        "BargeDraftPortSternFeet",
        "BargeDraftPortSternInches",
        "BargeDraftStarboardStern",
        "BargeDraftStarboardSternFeet",
        "BargeDraftStarboardSternInches"
      ]
    },
    {
      "parentEntity": "TicketEvent",
      "referenceType": "OneToOne",
      "foreignKey": "DraftID",
      "description": "TicketEvent references Draft entity for draft survey events. Draft Survey events create a Draft record and reference it via DraftID. Also contains denormalized BargeDraft* fields for quick access",
      "cascadeDelete": false,
      "properties": [
        "DraftID (FK to Draft.DraftID)",
        "BargeDraft (denormalized)",
        "BargeDraftPortBow (denormalized)",
        "BargeDraftPortStern (denormalized)",
        "BargeDraftStarboardBow (denormalized)",
        "BargeDraftStarboardStern (denormalized)"
      ]
    },
    {
      "parentEntity": "Barge",
      "referenceType": "Composition",
      "description": "Barge entity contains current draft measurements as denormalized fields for quick reference, not a separate Draft child entity",
      "properties": [
        "Draft (current barge draft)",
        "DraftPortBow",
        "DraftPortStern",
        "DraftStarboardBow",
        "DraftStarboardStern"
      ]
    }
  ],
  "collectionReferences": [
    {
      "property": "TicketEvents",
      "collectionType": "TicketEvents",
      "description": "Draft object maintains a reference to the collection of all TicketEvents for a ticket to find prior draft survey events for tonnage calculations. This is NOT a parent-child relationship, but a contextual reference for calculations",
      "purpose": "Find prior opposing draft survey events (Empty vs Load/PartLoad) for lightship correction and cargo deadweight calculations"
    },
    {
      "property": "DraftSurveyEvents",
      "collectionType": "List<TicketEvent>",
      "description": "Filtered list of non-voided draft survey events from TicketEvents collection, excluding the current event being edited",
      "purpose": "Support PriorOpposingDraftSurveyEvent lookup for tonnage calculations"
    }
  ],
  "relatedDataStructures": [
    {
      "entity": "BargeSeries",
      "relationship": "ManyToOne",
      "description": "Each Draft references a BargeSeries to access draft/tonnage conversion tables (BargeSeriesDrafts)",
      "childCollection": "BargeSeriesDrafts"
    },
    {
      "entity": "BargeSeriesDraft",
      "relationship": "Lookup",
      "description": "Tonnage lookup table with rows for each draft foot (0-99) and columns for each inch (Tons00-Tons11). Used for bidirectional draft<->tonnage conversion",
      "accessPattern": "Dictionary<int DraftFeet, BargeSeriesDraft>"
    }
  ],
  "gridPatterns": [],
  "notes": [
    "IMPORTANT: Draft (BargeDraft) does NOT have child entities or child grids",
    "The entity is a standalone object used for two purposes:",
    "1. As a separate Draft record for TicketEvent Draft Survey events (referenced via DraftID)",
    "2. As denormalized fields on BargeEvent/TicketEvent/Barge for quick access to draft measurements",
    "The BargeDraft* columns found in database tables are NOT child entities - they are denormalized draft measurement fields",
    "Draft object maintains references to TicketEvents collection for calculation purposes, but this is NOT a parent-child relationship",
    "The Draft object is designed to be used in two contexts:",
    "  - Standalone: Created and saved as separate record for Draft Survey events",
    "  - Transient: Used for calculations and UI display without persistence (e.g., when showing draft on Barge form)",
    "Cover weight adjustments require CoverType, CoverSubTypeID, and CoverConfig from TicketEvent",
    "Prior draft survey lookup is critical for tonnage calculations - requires filtering by load status and complete date/time"
  ],
  "modernDapperPattern": {
    "entityClass": {
      "description": "Draft entity with scalar properties only - no child collections as properties",
      "code": "public class Draft\n{\n    public int DraftID { get; set; }\n    public decimal? Draft { get; set; }\n    public int? DraftFeet { get; set; }\n    public int? DraftInches { get; set; }\n    public decimal? DraftPortBow { get; set; }\n    public int? DraftPortBowFeet { get; set; }\n    public int? DraftPortBowInches { get; set; }\n    public decimal? DraftStarboardBow { get; set; }\n    public int? DraftStarboardBowFeet { get; set; }\n    public int? DraftStarboardBowInches { get; set; }\n    public decimal? DraftPortStern { get; set; }\n    public int? DraftPortSternFeet { get; set; }\n    public int? DraftPortSternInches { get; set; }\n    public decimal? DraftStarboardStern { get; set; }\n    public int? DraftStarboardSternFeet { get; set; }\n    public int? DraftStarboardSternInches { get; set; }\n    public decimal? DraftAverage { get; set; }\n    public int? DraftAverageFeet { get; set; }\n    public int? DraftAverageInches { get; set; }\n    public decimal? EstimatedCargoDeadweight { get; set; }\n    public decimal? LightshipCorrection { get; set; }\n    public decimal? AdjustmentTons { get; set; }\n    public decimal? LoadUnloadTons { get; set; }\n    public int? ConvFesDraftID { get; set; }\n    \n    // Note: No child collection properties\n    // BargeSeries, TicketEvents are loaded separately via service layer\n}"
    },
    "repositoryMethods": {
      "description": "Repository methods for Draft entity",
      "code": "public interface IDraftRepository\n{\n    Task<Draft> GetByIdAsync(int draftId);\n    Task<Draft> CreateAsync(Draft draft);\n    Task<Draft> UpdateAsync(Draft draft);\n    Task DeleteAsync(int draftId);\n    \n    // No child entity methods - Draft has no children\n}"
    },
    "serviceLaye": {
      "description": "Service layer handles related data loading and calculations",
      "code": "public class DraftService\n{\n    private readonly IDraftRepository _draftRepo;\n    private readonly IBargeSeriesRepository _bargeSeriesRepo;\n    private readonly ITicketEventRepository _ticketEventRepo;\n    \n    public async Task<DraftDto> GetWithCalculationsAsync(int draftId, int ticketId)\n    {\n        var draft = await _draftRepo.GetByIdAsync(draftId);\n        if (draft == null) return null;\n        \n        // Load related data separately\n        var ticketEvents = await _ticketEventRepo.GetByTicketIdAsync(ticketId);\n        var priorSurveys = FilterDraftSurveyEvents(ticketEvents, draftId);\n        \n        // Perform calculations\n        var result = new DraftDto\n        {\n            // Map draft properties\n            DraftID = draft.DraftID,\n            Draft = draft.Draft,\n            // ... other properties\n            \n            // Add related data\n            PriorDraftSurveys = priorSurveys.ToList()\n        };\n        \n        return result;\n    }\n    \n    private List<TicketEvent> FilterDraftSurveyEvents(List<TicketEvent> events, int currentDraftId)\n    {\n        return events\n            .Where(e => !e.IsVoid && \n                       e.EventType == \"DraftSurvey\" && \n                       e.DraftID != currentDraftId)\n            .OrderByDescending(e => e.CompleteDateTime)\n            .ToList();\n    }\n}"
    }
  },
  "commonMistakes": [
    "❌ Treating BargeDraft as a separate parent entity with child collections (it has none)",
    "❌ Looking for child grids on Draft forms (none exist - Draft is leaf entity)",
    "❌ Confusing denormalized BargeDraft* fields on TicketEvent with Draft entity relationships",
    "❌ Trying to eager load child collections on Draft (there are none)",
    "❌ Missing the TicketEvents contextual reference needed for prior draft survey lookups",
    "❌ Not understanding that Draft can be used both as persisted entity (Draft Surveys) and transient calculation object (Barge drafts)"
  ]
}
