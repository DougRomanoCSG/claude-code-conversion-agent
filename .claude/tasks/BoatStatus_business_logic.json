{
  "businessObject": "BoatMaintenanceLog",
  "baseClass": "BoatMaintenanceLogBase",
  "namespace": "BargeOps.BusinessLogic",
  "parentEntity": "BoatLocation",
  "description": "Tracks boat status changes, division/facility changes, and boat role changes as maintenance log entries",
  "properties": [
    {
      "name": "BoatMaintenanceLogID",
      "type": "Int32",
      "access": "ReadOnly",
      "isPrimaryKey": true,
      "isNullable": false,
      "description": "Unique identifier for boat maintenance log entry"
    },
    {
      "name": "LocationID",
      "type": "Int32",
      "access": "ReadWrite",
      "isForeignKey": true,
      "isNullable": false,
      "relatedEntity": "BoatLocation",
      "description": "Foreign key to boat location (parent entity)"
    },
    {
      "name": "Division",
      "type": "String",
      "access": "ReadWrite",
      "maxLength": 14,
      "isNullable": true,
      "isRequired": false,
      "conditionalRequirement": "Required when MaintenanceType is 'Change Division/Facility'",
      "description": "Division code when changing boat division/facility"
    },
    {
      "name": "PortFacilityID",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": true,
      "isRequired": false,
      "shadowsBase": true,
      "conditionalRequirement": "Must be blank unless MaintenanceType is 'Change Division/Facility'",
      "description": "Port facility ID when changing boat location, stored as string but represents integer"
    },
    {
      "name": "PortFacility",
      "type": "String",
      "access": "ReadOnly",
      "isCalculated": true,
      "description": "Display name of port facility, updated when PortFacilityID changes"
    },
    {
      "name": "MaintenanceType",
      "type": "String",
      "access": "ReadWrite",
      "maxLength": 50,
      "isNullable": false,
      "isRequired": true,
      "allowedValues": ["Boat Status", "Change Division/Facility", "Change Boat Role"],
      "description": "Type of maintenance log entry - determines which fields are required"
    },
    {
      "name": "StartDateTime",
      "type": "SmartDate",
      "access": "ReadWrite",
      "isNullable": false,
      "isRequired": true,
      "defaultValue": "Date.Now",
      "description": "Date and time when status/change occurred"
    },
    {
      "name": "Status",
      "type": "String",
      "access": "ReadWrite",
      "maxLength": 50,
      "isNullable": true,
      "isRequired": false,
      "conditionalRequirement": "Required when MaintenanceType is 'Boat Status'",
      "validationList": "BoatStatus",
      "description": "Boat status value (e.g., In Service, Out of Service, etc.)"
    },
    {
      "name": "Note",
      "type": "String",
      "access": "ReadWrite",
      "maxLength": 500,
      "isNullable": true,
      "isRequired": false,
      "description": "Optional notes about the maintenance log entry"
    },
    {
      "name": "BoatRoleID",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": true,
      "isRequired": false,
      "shadowsBase": true,
      "conditionalRequirement": "Required when MaintenanceType is 'Change Boat Role'",
      "description": "Boat role ID when changing boat role, stored as string but represents integer"
    },
    {
      "name": "BoatRole",
      "type": "String",
      "access": "ReadOnly",
      "isCalculated": true,
      "description": "Display name of boat role, updated when BoatRoleID changes"
    },
    {
      "name": "DeckLogActivityID",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": true,
      "isRequired": false,
      "description": "Optional reference to deck log activity, stored as string but represents integer"
    }
  ],
  "businessRules": [
    {
      "ruleName": "MaintenanceTypeRequired",
      "property": "MaintenanceType",
      "condition": "String.IsNullOrEmpty(p_MaintenanceType)",
      "message": "Type is required.",
      "severity": "Error",
      "context": "Always",
      "source": "Base class"
    },
    {
      "ruleName": "MaintenanceTypeMaxLength",
      "property": "MaintenanceType",
      "condition": "p_MaintenanceType.Length > 50",
      "message": "Type must be less than or equal to 50.",
      "severity": "Error",
      "context": "Always",
      "source": "Base class"
    },
    {
      "ruleName": "StartDateTimeRequired",
      "property": "StartDateTime",
      "condition": "p_StartDateTime.IsEmpty",
      "message": "Start date/time is required.",
      "severity": "Error",
      "context": "Always",
      "source": "Base class"
    },
    {
      "ruleName": "TypeStatusConditional",
      "property": "Status",
      "condition": "(p_MaintenanceType == 'Boat Status' && String.IsNullOrEmpty(p_Status)) || (p_MaintenanceType != 'Boat Status' && !String.IsNullOrEmpty(p_Status))",
      "message": "If Type is 'Boat Status', then Status is required.  Otherwise, Status must be blank.",
      "severity": "Error",
      "context": "Depends on MaintenanceType value",
      "modernEquivalent": "RuleFor(x => x.Status).NotEmpty().When(x => x.MaintenanceType == 'Boat Status').WithMessage('If Type is \\'Boat Status\\', then Status is required.  Otherwise, Status must be blank.')"
    },
    {
      "ruleName": "TypeDivisionFacilityConditional",
      "property": "Division",
      "condition": "(p_MaintenanceType == 'Change Division/Facility' && String.IsNullOrEmpty(p_Division)) || (p_MaintenanceType != 'Change Division/Facility' && (!String.IsNullOrEmpty(p_Division) || !String.IsNullOrEmpty(p_PortFacilityID)))",
      "message": "If Type is 'Change Division/Facility', then Division is required.  Otherwise, Division and PortFacilityID must be blank.",
      "severity": "Error",
      "context": "Depends on MaintenanceType value",
      "modernEquivalent": "RuleFor(x => x.Division).NotEmpty().When(x => x.MaintenanceType == 'Change Division/Facility').WithMessage('If Type is \\'Change Division/Facility\\', then Division is required.  Otherwise, Division and PortFacilityID must be blank.')"
    },
    {
      "ruleName": "TypeBoatRoleConditional",
      "property": "BoatRoleID",
      "condition": "(p_MaintenanceType == 'Change Boat Role' && String.IsNullOrEmpty(p_BoatRoleID)) || (p_MaintenanceType != 'Change Boat Role' && !String.IsNullOrEmpty(p_BoatRoleID))",
      "message": "If Type is 'Change Boat Role', then Boat Role is required.  Otherwise, Boat Role must be blank.",
      "severity": "Error",
      "context": "Depends on MaintenanceType value",
      "modernEquivalent": "RuleFor(x => x.BoatRoleID).NotEmpty().When(x => x.MaintenanceType == 'Change Boat Role').WithMessage('If Type is \\'Change Boat Role\\', then Boat Role is required.  Otherwise, Boat Role must be blank.')"
    },
    {
      "ruleName": "DivisionMaxLength",
      "property": "Division",
      "condition": "p_Division.Length > 14",
      "message": "Division must be less than or equal to 14.",
      "severity": "Error",
      "context": "Always",
      "source": "Base class"
    },
    {
      "ruleName": "StatusMaxLength",
      "property": "Status",
      "condition": "p_Status.Length > 50",
      "message": "Status must be less than or equal to 50.",
      "severity": "Error",
      "context": "Always",
      "source": "Base class"
    },
    {
      "ruleName": "NoteMaxLength",
      "property": "Note",
      "condition": "p_Note.Length > 500",
      "message": "Note must be less than or equal to 500.",
      "severity": "Error",
      "context": "Always",
      "source": "Base class"
    }
  ],
  "methods": {
    "factory": [
      {
        "name": "NewBoatMaintenanceLog",
        "returnType": "BoatMaintenanceLog",
        "parameters": [],
        "scope": "Public Shared",
        "description": "Creates new parent instance with default MaintenanceType of 'Boat Status'"
      },
      {
        "name": "NewBoatMaintenanceLogAsChild",
        "returnType": "BoatMaintenanceLog",
        "parameters": [],
        "scope": "Friend Shared",
        "description": "Creates new child instance for use in BoatMaintenanceLogs collection"
      }
    ],
    "crud": [
      {
        "name": "GetBoatMaintenanceLog",
        "returnType": "BoatMaintenanceLog",
        "parameters": [
          {
            "name": "ID",
            "type": "Int32"
          }
        ],
        "scope": "Public Shared",
        "description": "Loads existing parent instance by ID"
      },
      {
        "name": "GetBoatMaintenanceLogChild",
        "returnType": "BoatMaintenanceLog",
        "parameters": [
          {
            "name": "ID",
            "type": "Int32"
          }
        ],
        "scope": "Friend Shared",
        "description": "Loads existing child instance by ID"
      },
      {
        "name": "GetBoatMaintenanceLogChild",
        "returnType": "BoatMaintenanceLog",
        "parameters": [
          {
            "name": "dr",
            "type": "SafeDataReader"
          }
        ],
        "scope": "Friend Shared",
        "description": "Loads existing child instance from data reader"
      },
      {
        "name": "DeleteBoatMaintenanceLog",
        "returnType": "void",
        "parameters": [
          {
            "name": "ID",
            "type": "Int32"
          }
        ],
        "scope": "Public Shared",
        "description": "Deletes boat maintenance log by ID"
      }
    ],
    "business": [
      {
        "name": "Initialize",
        "returnType": "void",
        "description": "Initializes new instance with StartDateTime = Now and MaintenanceType = 'Boat Status'"
      },
      {
        "name": "CheckBusinessRules",
        "returnType": "void",
        "parameters": [
          {
            "name": "PropertyName",
            "type": "String"
          }
        ],
        "description": "Validates business rules including conditional validation based on MaintenanceType"
      },
      {
        "name": "LoadProperties",
        "returnType": "void",
        "parameters": [
          {
            "name": "dr",
            "type": "SafeDataReader"
          }
        ],
        "scope": "Protected",
        "description": "Loads property values from database including PortFacility and BoatRole display names"
      },
      {
        "name": "UpdateParentKeys",
        "returnType": "void",
        "parameters": [
          {
            "name": "parent",
            "type": "BusinessLogicBase"
          }
        ],
        "scope": "Protected",
        "description": "Updates LocationID from parent BoatLocation"
      }
    ]
  },
  "relationships": [
    {
      "property": "Parent",
      "relatedEntity": "BoatLocation",
      "type": "ManyToOne",
      "foreignKey": "LocationID",
      "description": "Each maintenance log belongs to one boat location"
    },
    {
      "property": "BoatMaintenanceLogs",
      "relatedEntity": "BoatLocation",
      "type": "OneToMany",
      "inverseProperty": "BoatMaintenanceLogs",
      "description": "BoatLocation has collection of maintenance logs"
    },
    {
      "property": "PortFacilityID",
      "relatedEntity": "FacilityLocation",
      "type": "ManyToOne",
      "optional": true,
      "description": "Optional reference to port facility when MaintenanceType is 'Change Division/Facility'"
    },
    {
      "property": "BoatRoleID",
      "relatedEntity": "BoatRole",
      "type": "ManyToOne",
      "optional": true,
      "description": "Optional reference to boat role when MaintenanceType is 'Change Boat Role'"
    },
    {
      "property": "DeckLogActivityID",
      "relatedEntity": "DeckLogActivity",
      "type": "ManyToOne",
      "optional": true,
      "description": "Optional reference to deck log activity"
    }
  ],
  "initialization": {
    "method": "Initialize",
    "defaults": [
      {
        "property": "BoatMaintenanceLogID",
        "value": "0"
      },
      {
        "property": "LocationID",
        "value": "0"
      },
      {
        "property": "Division",
        "value": "String.Empty"
      },
      {
        "property": "PortFacilityID",
        "value": "String.Empty"
      },
      {
        "property": "MaintenanceType",
        "value": "TypeBoatStatus ('Boat Status')"
      },
      {
        "property": "StartDateTime",
        "value": "Date.Now"
      },
      {
        "property": "Status",
        "value": "String.Empty"
      },
      {
        "property": "Note",
        "value": "String.Empty"
      },
      {
        "property": "BoatRoleID",
        "value": "String.Empty"
      },
      {
        "property": "DeckLogActivityID",
        "value": "String.Empty"
      },
      {
        "property": "_PortFacility",
        "value": "String.Empty"
      },
      {
        "property": "_BoatRole",
        "value": "String.Empty"
      }
    ]
  },
  "constants": [
    {
      "name": "TypeBoatStatus",
      "value": "\"Boat Status\"",
      "scope": "Public Const",
      "description": "Maintenance type constant for boat status changes"
    },
    {
      "name": "TypeChangeDivisionFacility",
      "value": "\"Change Division/Facility\"",
      "scope": "Public Const",
      "description": "Maintenance type constant for division/facility changes"
    },
    {
      "name": "TypeChangeBoatRole",
      "value": "\"Change Boat Role\"",
      "scope": "Public Const",
      "description": "Maintenance type constant for boat role changes"
    }
  ],
  "storedProcedures": {
    "select": "BoatMaintenanceLogSelect",
    "selectAll": "BoatMaintenanceLogsSelect",
    "insert": "BoatMaintenanceLogInsert",
    "update": "BoatMaintenanceLogUpdate",
    "delete": "BoatMaintenanceLogDelete"
  },
  "dataAuditing": {
    "enabled": true,
    "auditedFields": [
      "LocationID",
      "Division",
      "PortFacilityID",
      "MaintenanceType",
      "StartDateTime",
      "Status",
      "Note",
      "BoatRoleID",
      "DeckLogActivityID"
    ],
    "description": "Field-level auditing tracks changes to all properties except primary key"
  },
  "specialPatterns": [
    {
      "pattern": "Shadowed Properties",
      "properties": ["PortFacilityID", "BoatRoleID"],
      "description": "Properties shadow base class to enforce passing display name when setting ID, enabling grid display without additional lookups"
    },
    {
      "pattern": "Conditional Validation",
      "description": "Business rules enforce mutually exclusive field requirements based on MaintenanceType value - only one set of fields can be populated per record"
    },
    {
      "pattern": "Display Name Caching",
      "properties": ["PortFacility", "BoatRole"],
      "description": "Private fields cache display names loaded from database, updated when corresponding ID properties change"
    },
    {
      "pattern": "Parent State Synchronization",
      "description": "BoatLocation entity maintains CurrentStatus, Division, PortFacility, and BoatRole properties that are updated from the latest maintenance log entries via ChangesApplied event"
    }
  ],
  "uiConsiderations": [
    {
      "control": "optMaintenanceType",
      "type": "OptionSet",
      "description": "Radio buttons for selecting maintenance type - changes which fields are enabled/required"
    },
    {
      "control": "cboStatus",
      "type": "ComboBox",
      "validationList": "BoatStatus",
      "enabledWhen": "MaintenanceType == 'Boat Status'",
      "description": "Status dropdown, only enabled for Boat Status type"
    },
    {
      "control": "cboDivision",
      "type": "ComboBox",
      "validationList": "Division",
      "enabledWhen": "MaintenanceType == 'Change Division/Facility'",
      "description": "Division dropdown, only enabled for Change Division/Facility type"
    },
    {
      "control": "cboPortFacilityID",
      "type": "ComboBox",
      "enabledWhen": "MaintenanceType == 'Change Division/Facility'",
      "description": "Port facility dropdown, filtered by selected division and fleet"
    },
    {
      "control": "cboBoatRoleID",
      "type": "ComboBox",
      "enabledWhen": "MaintenanceType == 'Change Boat Role'",
      "description": "Boat role dropdown, only enabled for Change Boat Role type"
    },
    {
      "control": "dtStartDate",
      "type": "DateTimePicker",
      "defaultValue": "Date.Now",
      "description": "Date portion of start date/time"
    },
    {
      "control": "cboStartTime",
      "type": "TimeComboBox",
      "description": "Time portion of start date/time"
    },
    {
      "control": "txtNote",
      "type": "TextBox",
      "maxLength": 500,
      "description": "Optional notes field"
    },
    {
      "behavior": "ClearUnusedFields",
      "description": "Before saving, fields not relevant to selected MaintenanceType are cleared to ensure data integrity"
    },
    {
      "behavior": "MaintenanceTypeReadOnly",
      "description": "MaintenanceType cannot be changed when editing existing record (only on add)"
    }
  ],
  "businessLogicSummary": {
    "purpose": "Tracks three types of boat maintenance events: status changes, division/facility relocations, and boat role assignments",
    "keyFeatures": [
      "Polymorphic behavior based on MaintenanceType - different fields required for different types",
      "Parent entity (BoatLocation) maintains current state derived from latest log entries",
      "Field-level auditing tracks all changes",
      "Display name caching prevents repeated database lookups in grid views",
      "Conditional validation ensures data integrity based on record type"
    ],
    "integrationPoints": [
      "BoatLocation.BoatMaintenanceLogs collection",
      "BoatLocation.CurrentStatus property (from latest 'Boat Status' log)",
      "BoatLocation.Division/PortFacilityID (from latest 'Change Division/Facility' log)",
      "BoatLocation.BoatRoleID (from latest 'Change Boat Role' log)",
      "frmBoatStatus form for data entry and display"
    ]
  },
  "modernizationNotes": {
    "entityFramework": {
      "discriminator": "Consider using TPH (Table Per Hierarchy) pattern with MaintenanceType as discriminator, creating BoatStatusLog, DivisionFacilityLog, and BoatRoleLog derived classes",
      "navigation": "Add navigation properties to PortFacility (FacilityLocation), BoatRole entities",
      "validation": "Use FluentValidation with custom validators for conditional logic"
    },
    "domainModel": {
      "valueObjects": "Consider MaintenanceType as value object/enum",
      "aggregateRoot": "BoatLocation is aggregate root, BoatMaintenanceLog is entity within aggregate",
      "events": "Consider domain events: BoatStatusChanged, BoatRelocated, BoatRoleAssigned"
    },
    "apiDesign": {
      "endpoints": [
        "POST /api/boats/{boatId}/status - Add boat status log",
        "POST /api/boats/{boatId}/relocation - Add division/facility change",
        "POST /api/boats/{boatId}/role - Add boat role change",
        "GET /api/boats/{boatId}/maintenance-logs - Get all logs",
        "GET /api/boats/{boatId}/current-status - Get current derived state"
      ]
    }
  }
}
