{
  "parentEntity": "Vendor",
  "relationships": [
    {
      "relatedEntity": "VendorContact",
      "relationshipType": "OneToMany",
      "parentProperty": "VendorContacts",
      "childProperty": "Vendor",
      "foreignKey": "VendorID",
      "cascadeDelete": true,
      "gridName": "grdContacts",
      "gridColumns": [
        {
          "key": "Name",
          "header": "Name",
          "type": "String",
          "width": 142,
          "alignment": "Left"
        },
        {
          "key": "IsPrimary",
          "header": "Primary",
          "type": "Boolean",
          "width": 50,
          "alignment": "Center"
        },
        {
          "key": "IsDispatcher",
          "header": "Dispatcher",
          "type": "Boolean",
          "width": 90,
          "alignment": "Center"
        },
        {
          "key": "IsLiquidBroker",
          "header": "Liquid Broker",
          "type": "Boolean",
          "width": 90,
          "alignment": "Center",
          "conditional": "LicenseComponent.UnitTow"
        },
        {
          "key": "PhoneNumber",
          "header": "Phone",
          "type": "String",
          "width": 90,
          "alignment": "Left"
        },
        {
          "key": "PhoneExt",
          "header": "Ext",
          "type": "String",
          "width": 44,
          "alignment": "Left"
        },
        {
          "key": "EmailAddress",
          "header": "Email",
          "type": "String",
          "width": 168,
          "alignment": "Left"
        }
      ],
      "operations": {
        "add": "ItemAdd(grdContacts, False)",
        "edit": "ItemModify(grdContacts)",
        "delete": "ItemRemove(grdContacts)",
        "export": "Main.ExportGrid(grdContacts)"
      },
      "loadingStrategy": "Eager",
      "notes": "VendorContacts are loaded immediately with parent. Special logic: only one contact can be marked as IsPrimary. Portal user deletion requires confirmation."
    },
    {
      "relatedEntity": "VendorBusinessUnit",
      "relationshipType": "OneToMany",
      "parentProperty": "VendorBusinessUnits",
      "childProperty": "Vendor",
      "foreignKey": "VendorID",
      "cascadeDelete": true,
      "gridName": "grdVendorBusinessUnits",
      "gridColumns": [
        {
          "key": "Name",
          "header": "Name",
          "type": "String",
          "width": 200,
          "alignment": "Left"
        },
        {
          "key": "AccountingCode",
          "header": "Accounting #",
          "type": "String",
          "width": 100,
          "alignment": "Left"
        },
        {
          "key": "River",
          "header": "River",
          "type": "String",
          "width": 50,
          "alignment": "Left"
        },
        {
          "key": "Mile",
          "header": "Mile",
          "type": "Decimal",
          "width": 50,
          "alignment": "Right"
        },
        {
          "key": "Bank",
          "header": "Bank",
          "type": "String",
          "width": 60,
          "alignment": "Left"
        },
        {
          "key": "IsFuelSupplier",
          "header": "Fuel Supplier",
          "type": "Boolean",
          "width": 100,
          "alignment": "Center"
        },
        {
          "key": "IsDefaultFuelSupplier",
          "header": "Default",
          "type": "Boolean",
          "width": 60,
          "alignment": "Center"
        },
        {
          "key": "IsBoatAssistSupplier",
          "header": "Boat Assist",
          "type": "Boolean",
          "width": 80,
          "alignment": "Center"
        },
        {
          "key": "IsActive",
          "header": "Active",
          "type": "Boolean",
          "width": 50,
          "alignment": "Center"
        }
      ],
      "operations": {
        "add": "ItemAdd(grdVendorBusinessUnits, False)",
        "edit": "ItemModify(grdVendorBusinessUnits)",
        "delete": "ItemRemove(grdVendorBusinessUnits)",
        "export": "Main.ExportGrid(grdVendorBusinessUnits)"
      },
      "loadingStrategy": "Deferred",
      "notes": "Deferred loading. Special logic: only one VendorBusinessUnit can be marked as IsDefaultFuelSupplier. Validates cache VendorBusinessUnitList on save."
    },
    {
      "relatedEntity": "VendorPortalGroup",
      "relationshipType": "OneToMany",
      "parentProperty": "VendorPortalGroups",
      "childProperty": "Vendor",
      "foreignKey": "VendorID",
      "cascadeDelete": true,
      "gridName": "grdPortalGroups",
      "gridColumns": [
        {
          "key": "Name",
          "header": "Name",
          "type": "String",
          "width": 200,
          "alignment": "Left"
        },
        {
          "key": "EventHistoryDays",
          "header": "Event History Days",
          "type": "Integer",
          "width": 110,
          "alignment": "Right"
        },
        {
          "key": "LimitBargeEvents",
          "header": "Limit Events",
          "type": "Boolean",
          "width": 90,
          "alignment": "Center"
        },
        {
          "key": "LimitDestinations",
          "header": "Limit Destinations",
          "type": "Boolean",
          "width": 90,
          "alignment": "Center"
        },
        {
          "key": "LimitCustomers",
          "header": "Limit Customers",
          "type": "Boolean",
          "width": 90,
          "alignment": "Center"
        },
        {
          "key": "IsActive",
          "header": "Active",
          "type": "Boolean",
          "width": 90,
          "alignment": "Center"
        }
      ],
      "operations": {
        "add": "ItemAdd(grdPortalGroups, False)",
        "edit": "ItemModify(grdPortalGroups) via frmVendorPortalGroup",
        "delete": "ItemRemove(grdPortalGroups) via VendorPortalGroup.DeleteVendorPortalGroup",
        "copy": "ItemAdd(grdPortalGroups, True) via VendorPortalGroup.CopyVendorPortalGroup",
        "export": "Main.ExportGrid(grdPortalGroups)"
      },
      "loadingStrategy": "Deferred",
      "notes": "Deferred loading. Loaded via VendorPortalGroupSearch.GetList(VendorID). Portal groups edited via separate form (frmVendorPortalGroup). Requires Vendor to be saved before adding groups. Tab only visible if Portal license is active."
    }
  ],
  "childEntityCollections": [
    {
      "entityName": "VendorPortalGroupCustomer",
      "description": "Child of VendorPortalGroup - defines customer access limits",
      "parentEntity": "VendorPortalGroup",
      "foreignKey": "VendorPortalGroupID",
      "loadingStrategy": "Eager"
    },
    {
      "entityName": "VendorPortalGroupCriteria",
      "description": "Child of VendorPortalGroup - defines filter criteria",
      "parentEntity": "VendorPortalGroup",
      "foreignKey": "VendorPortalGroupID",
      "loadingStrategy": "Eager"
    },
    {
      "entityName": "VendorPortalGroupDestArea",
      "description": "Child of VendorPortalGroup - defines destination area access limits",
      "parentEntity": "VendorPortalGroup",
      "foreignKey": "VendorPortalGroupID",
      "loadingStrategy": "Eager"
    },
    {
      "entityName": "VendorPortalGroupDestFacility",
      "description": "Child of VendorPortalGroup - defines destination facility access limits",
      "parentEntity": "VendorPortalGroup",
      "foreignKey": "VendorPortalGroupID",
      "loadingStrategy": "Eager"
    },
    {
      "entityName": "VendorPortalGroupEvent",
      "description": "Child of VendorPortalGroup - defines event type access limits",
      "parentEntity": "VendorPortalGroup",
      "foreignKey": "VendorPortalGroupID",
      "loadingStrategy": "Eager"
    },
    {
      "entityName": "VendorPortalGroupUser",
      "description": "Child of VendorPortalGroup - maps contacts to portal groups",
      "parentEntity": "VendorPortalGroup",
      "foreignKey": "VendorPortalGroupID",
      "loadingStrategy": "Eager"
    },
    {
      "entityName": "VendorPortalGroupReport",
      "description": "Child of VendorPortalGroup - defines report access limits",
      "parentEntity": "VendorPortalGroup",
      "foreignKey": "VendorPortalGroupID",
      "loadingStrategy": "Eager"
    }
  ],
  "lookupRelationships": [
    {
      "property": "BargeExConfigID",
      "lookupEntity": "BargeExConfig",
      "displayProperty": "Name",
      "required": false,
      "notes": "Only required if IsBargeExEnabled is true. Combo populated via Lists.BargeExConfigSearch.GetList"
    },
    {
      "property": "TermsCode",
      "lookupEntity": "ValidationList",
      "displayProperty": "TermsCode",
      "validationType": "VendorBillTermsCode",
      "required": false,
      "notes": "Populated via Main.PopulateValidationListCombo(ValidationTypes.VendorBillTermsCode)"
    },
    {
      "property": "State",
      "lookupEntity": "State",
      "displayProperty": "State",
      "required": false,
      "notes": "Populated via Main.PopulateStateCombo"
    }
  ],
  "childLookupRelationships": [
    {
      "childEntity": "VendorContact",
      "property": "PortalUserID",
      "lookupEntity": "User",
      "displayProperty": "UserID",
      "required": false,
      "notes": "Links contact to portal user account. Deletion of contact with PortalUserID requires special confirmation."
    },
    {
      "childEntity": "VendorBusinessUnit",
      "property": "River",
      "lookupEntity": "River",
      "displayProperty": "RiverCode",
      "validationType": "River",
      "required": false,
      "notes": "Populated via PopulateRiverCombo. Used for location tracking. Mile value must be within river's min/max range."
    },
    {
      "childEntity": "VendorBusinessUnit",
      "property": "Bank",
      "lookupEntity": "ValidationList",
      "displayProperty": "Bank",
      "validationType": "RiverBank",
      "required": false,
      "notes": "Populated via PopulateValidationListCombo(ValidationTypes.RiverBank)"
    },
    {
      "childEntity": "VendorBusinessUnit",
      "property": "MinDiscountFrequency",
      "lookupEntity": "FrequencyList",
      "displayProperty": "Value",
      "required": false,
      "notes": "Values: Weekly, Monthly, Quarterly, Yearly. Only enabled if IsFuelSupplier is true."
    }
  ],
  "businessRules": [
    {
      "rule": "IsBargeExEnabled requires BargeExTradingPartnerNum and BargeExConfigID",
      "affectedProperties": ["IsBargeExEnabled", "BargeExTradingPartnerNum", "BargeExConfigID"],
      "description": "When BargeEx is enabled, both trading partner number and configuration must be provided"
    },
    {
      "rule": "Only one VendorContact can be IsPrimary",
      "affectedProperties": ["VendorContacts[*].IsPrimary"],
      "description": "When setting a contact as primary, all other contacts are automatically unmarked as primary"
    },
    {
      "rule": "Only one VendorBusinessUnit can be IsDefaultFuelSupplier",
      "affectedProperties": ["VendorBusinessUnits[*].IsDefaultFuelSupplier"],
      "description": "When setting a business unit as default fuel supplier, other units are automatically unmarked"
    },
    {
      "rule": "River and Mile must both be set or both be empty",
      "affectedEntity": "VendorBusinessUnit",
      "affectedProperties": ["River", "Mile"],
      "description": "Cannot have River value without Mile value, or vice versa"
    },
    {
      "rule": "Mile must be within river's min/max range",
      "affectedEntity": "VendorBusinessUnit",
      "affectedProperties": ["Mile", "River"],
      "description": "Mile value must be between the selected river's MinMile and MaxMile values"
    },
    {
      "rule": "IsFuelSupplier controls fuel-related fields",
      "affectedEntity": "VendorBusinessUnit",
      "affectedProperties": ["IsFuelSupplier", "IsDefaultFuelSupplier", "MinDiscountQty", "MinDiscountFrequency"],
      "description": "When IsFuelSupplier is false, IsDefaultFuelSupplier, MinDiscountQty, and MinDiscountFrequency are cleared and disabled"
    },
    {
      "rule": "Portal groups require saved Vendor",
      "affectedEntity": "VendorPortalGroup",
      "description": "Vendor must be saved (not IsNew) before portal groups can be added"
    },
    {
      "rule": "Contact deletion with PortalUserID requires confirmation",
      "affectedEntity": "VendorContact",
      "affectedProperties": ["PortalUserID"],
      "description": "Removing a contact with a portal user account shows special warning about deleting saved searches and preferences"
    }
  ],
  "dataAccessNotes": {
    "storedProcedures": {
      "select": "VendorSelect",
      "selectAll": "VendorsSelect",
      "insert": "VendorInsert",
      "update": "VendorUpdate",
      "delete": "VendorDelete"
    },
    "childStoredProcedures": {
      "VendorContact": {
        "select": "VendorContactSelect",
        "selectAll": "VendorContactsSelect",
        "insert": "VendorContactInsert",
        "update": "VendorContactUpdate",
        "delete": "VendorContactDelete"
      },
      "VendorBusinessUnit": {
        "select": "VendorBusinessUnitSelect",
        "selectAll": "VendorBusinessUnitsSelect",
        "insert": "VendorBusinessUnitInsert",
        "update": "VendorBusinessUnitUpdate",
        "delete": "VendorBusinessUnitDelete"
      },
      "VendorPortalGroup": {
        "select": "VendorPortalGroupSelect",
        "selectAll": "VendorPortalGroupsSelect",
        "insert": "VendorPortalGroupInsert",
        "update": "VendorPortalGroupUpdate",
        "delete": "VendorPortalGroupDelete"
      }
    }
  },
  "modernDapperPattern": {
    "repositoryMethods": [
      "Task<Vendor> GetByIdAsync(int vendorId)",
      "Task<IEnumerable<VendorContact>> GetContactsAsync(int vendorId)",
      "Task<IEnumerable<VendorBusinessUnit>> GetBusinessUnitsAsync(int vendorId)",
      "Task<IEnumerable<VendorPortalGroup>> GetPortalGroupsAsync(int vendorId)"
    ],
    "serviceLevelComposition": "Service layer loads relationships separately and composes DTOs. Child collections are NOT properties on entity classes.",
    "notes": "VendorContacts loaded eagerly, VendorBusinessUnits and VendorPortalGroups loaded on demand (deferred). Modern pattern loads via separate repository methods instead of navigation properties."
  }
}
