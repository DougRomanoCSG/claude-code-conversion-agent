{
  "entity": "BargeConditions",
  "legacy": {
    "formName": "frmBargeConditions",
    "subsystem": "frmBargeSearch",
    "baseForm": "frmBaseDetailEditList",
    "securityFramework": "Csg.Windows.Forms.Security.ControlAuthorizationBase",
    "subsystemIdentifier": "SubSystem.frmBargeSearch",
    "securityButtons": [
      {
        "button": "btnClose",
        "type": "Cancel",
        "legacyPermission": "None",
        "description": "Close the form"
      },
      {
        "button": "Remove",
        "type": "Remove",
        "legacyPermission": "CanDelete",
        "description": "Delete barge condition and related photos",
        "grid": "grdBargeConditions",
        "location": "frmBargeConditions.vb:368-377"
      },
      {
        "button": "Export",
        "type": "Open",
        "legacyPermission": "CanExport",
        "description": "Export barge conditions grid",
        "grid": "grdBargeConditions"
      },
      {
        "button": "ViewPhoto",
        "type": "Open",
        "legacyPermission": "CanView",
        "description": "View barge condition photo",
        "grid": "grdBargeConditionPhotos",
        "location": "frmBargeConditions.vb:407-411"
      },
      {
        "button": "RemovePhoto",
        "type": "Remove",
        "legacyPermission": "CanDelete",
        "description": "Delete barge condition photo",
        "grid": "grdBargeConditionPhotos",
        "location": "frmBargeConditions.vb:381-391"
      },
      {
        "button": "ExportPhoto",
        "type": "Open",
        "legacyPermission": "CanExport",
        "description": "Export barge condition photos grid",
        "grid": "grdBargeConditionPhotos"
      }
    ],
    "operations": [
      {
        "action": "ViewBargeConditions",
        "description": "View barge conditions list",
        "requiredPermission": "CanView",
        "location": "frmBargeConditions.vb:398"
      },
      {
        "action": "DeleteBargeCondition",
        "description": "Delete barge condition (soft delete via Delete() method)",
        "requiredPermission": "CanDelete",
        "location": "frmBargeConditions.vb:368-377",
        "implementation": "bc.Delete() followed by SaveNoRefresh()"
      },
      {
        "action": "ViewBargeConditionPhotos",
        "description": "View photos associated with barge condition",
        "requiredPermission": "CanView",
        "location": "frmBargeConditions.vb:401-403"
      },
      {
        "action": "DeleteBargeConditionPhoto",
        "description": "Delete individual photo from barge condition",
        "requiredPermission": "CanDelete",
        "location": "frmBargeConditions.vb:381-391",
        "implementation": "bcp.Delete() followed by SaveNoRefresh()"
      },
      {
        "action": "ViewPhoto",
        "description": "Open photo file for viewing",
        "requiredPermission": "CanView",
        "location": "frmBargeConditions.vb:407-411",
        "implementation": "Uses GlobalSettingList.DocumentsFilePath + file details"
      }
    ],
    "notes": [
      "Form is read-only - no Add/Modify operations (created from barge system)",
      "Delete operations are soft deletes (bc.Delete() followed by SaveNoRefresh())",
      "Photo viewing requires access to server file path from GlobalSettingList.DocumentsFilePath",
      "txtNote is always readonly (line 96, 200)",
      "Form inherits from frmBaseDetailEditList"
    ]
  },
  "modern": {
    "api": {
      "authentication": "ApiKey",
      "attributePattern": "[ApiKey]",
      "configurationLocation": "appsettings.json",
      "endpoints": [
        {
          "method": "GET",
          "route": "api/BargeConditions",
          "action": "GetList",
          "requiredAuth": "ApiKey",
          "futurePermission": "BargeConditionsView",
          "description": "Retrieve barge conditions for a specific barge",
          "queryParameters": ["bargeId", "startDate", "endDate"]
        },
        {
          "method": "GET",
          "route": "api/BargeConditions/{id}",
          "action": "Get",
          "requiredAuth": "ApiKey",
          "futurePermission": "BargeConditionsView",
          "description": "Retrieve single barge condition by ID"
        },
        {
          "method": "DELETE",
          "route": "api/BargeConditions/{id}",
          "action": "Delete",
          "requiredAuth": "ApiKey",
          "futurePermission": "BargeConditionsModify",
          "description": "Soft delete barge condition and related photos",
          "cascadeDelete": "All related photos are deleted"
        },
        {
          "method": "GET",
          "route": "api/BargeConditions/{id}/Photos",
          "action": "GetPhotos",
          "requiredAuth": "ApiKey",
          "futurePermission": "BargeConditionsView",
          "description": "Retrieve photos for a barge condition"
        },
        {
          "method": "DELETE",
          "route": "api/BargeConditions/Photos/{photoId}",
          "action": "DeletePhoto",
          "requiredAuth": "ApiKey",
          "futurePermission": "BargeConditionsModify",
          "description": "Delete individual photo from barge condition"
        },
        {
          "method": "GET",
          "route": "api/BargeConditions/Photos/{photoId}/Download",
          "action": "DownloadPhoto",
          "requiredAuth": "ApiKey",
          "futurePermission": "BargeConditionsView",
          "description": "Download/view photo file"
        }
      ],
      "implementationExample": {
        "controller": "BargeConditionsApiController",
        "baseController": "ApiControllerBase",
        "code": "[ApiController]\n[ApiKey]\npublic class BargeConditionsApiController : ApiControllerBase\n{\n    [HttpGet]\n    public async Task<IActionResult> GetList([FromQuery] BargeConditionsQuery query)\n    {\n        // API Key authentication required\n        // Future: CSG Authorization check for BargeConditionsView\n    }\n\n    [HttpDelete(\"{id}\")]\n    public async Task<IActionResult> Delete(int id)\n    {\n        // API Key authentication required\n        // Future: CSG Authorization check for BargeConditionsModify\n    }\n}"
      }
    },
    "ui": {
      "authentication": "OIDC",
      "developmentAuth": "DevelopmentAutoSignInMiddleware",
      "attributePattern": "[Authorize]",
      "authScheme": "IdentityConstants.ApplicationScheme",
      "permissions": [
        {
          "name": "BargeConditionsView",
          "enumValue": "AuthPermissions.BargeConditionsView",
          "description": "View barge conditions and photos",
          "granularity": "ReadOnly",
          "requiredFor": [
            "Index",
            "List",
            "Details",
            "GetPhotos",
            "ViewPhoto",
            "Export"
          ]
        },
        {
          "name": "BargeConditionsModify",
          "enumValue": "AuthPermissions.BargeConditionsModify",
          "description": "Delete barge conditions and photos",
          "granularity": "Modify",
          "requiredFor": [
            "Delete",
            "DeletePhoto"
          ],
          "note": "No Create/Edit operations - records are created by barge system"
        }
      ],
      "controllers": [
        {
          "name": "BargeConditionsController",
          "baseController": "AppController",
          "authorize": "[Authorize]",
          "actions": [
            {
              "actionName": "Index",
              "permission": "BargeConditionsView",
              "policy": "[Authorize(Policy = \"BargeConditionsView\")]",
              "description": "Main barge conditions view for a barge",
              "viewModel": "BargeConditionsViewModel",
              "httpMethod": "GET"
            },
            {
              "actionName": "List",
              "permission": "BargeConditionsView",
              "policy": "[Authorize(Policy = \"BargeConditionsView\")]",
              "description": "Get paginated list of barge conditions",
              "returnType": "JsonResult",
              "httpMethod": "GET"
            },
            {
              "actionName": "Details",
              "permission": "BargeConditionsView",
              "policy": "[Authorize(Policy = \"BargeConditionsView\")]",
              "description": "Get details of specific barge condition",
              "returnType": "PartialViewResult",
              "httpMethod": "GET"
            },
            {
              "actionName": "Delete",
              "permission": "BargeConditionsModify",
              "policy": "[Authorize(Policy = \"BargeConditionsModify\")]",
              "description": "Soft delete barge condition and related photos",
              "httpMethod": "POST",
              "returnType": "JsonResult",
              "validateAntiForgeryToken": true
            },
            {
              "actionName": "GetPhotos",
              "permission": "BargeConditionsView",
              "policy": "[Authorize(Policy = \"BargeConditionsView\")]",
              "description": "Get photos for a barge condition",
              "returnType": "JsonResult",
              "httpMethod": "GET"
            },
            {
              "actionName": "ViewPhoto",
              "permission": "BargeConditionsView",
              "policy": "[Authorize(Policy = \"BargeConditionsView\")]",
              "description": "Download/view photo file",
              "returnType": "FileResult",
              "httpMethod": "GET"
            },
            {
              "actionName": "DeletePhoto",
              "permission": "BargeConditionsModify",
              "policy": "[Authorize(Policy = \"BargeConditionsModify\")]",
              "description": "Delete individual photo",
              "httpMethod": "POST",
              "returnType": "JsonResult",
              "validateAntiForgeryToken": true
            }
          ]
        }
      ],
      "uiElements": [
        {
          "element": "DeleteButton",
          "permission": "BargeConditionsModify",
          "description": "Show/enable delete button for barge conditions",
          "implementationNote": "Use CSG Authorization to hide/disable if user lacks permission",
          "razorPattern": "@if (User.HasPermission(AuthPermissions.BargeConditionsModify)) { ... }"
        },
        {
          "element": "DeletePhotoButton",
          "permission": "BargeConditionsModify",
          "description": "Show/enable delete button for photos",
          "implementationNote": "Use CSG Authorization to hide/disable if user lacks permission",
          "razorPattern": "@if (User.HasPermission(AuthPermissions.BargeConditionsModify)) { ... }"
        },
        {
          "element": "ExportButton",
          "permission": "BargeConditionsView",
          "description": "Export grid to Excel/CSV",
          "implementationNote": "Available to users with view permission"
        },
        {
          "element": "ViewPhotoButton",
          "permission": "BargeConditionsView",
          "description": "View photo file",
          "implementationNote": "Available to users with view permission"
        }
      ],
      "implementationExample": {
        "controller": "BargeConditionsController",
        "code": "[Authorize]\npublic class BargeConditionsController : AppController\n{\n    [Authorize(Policy = \"BargeConditionsView\")]\n    public IActionResult Index(int bargeId)\n    {\n        var viewModel = new BargeConditionsViewModel\n        {\n            BargeId = bargeId,\n            CanDelete = User.HasPermission(AuthPermissions.BargeConditionsModify)\n        };\n        return View(viewModel);\n    }\n\n    [Authorize(Policy = \"BargeConditionsModify\")]\n    [HttpPost]\n    [ValidateAntiForgeryToken]\n    public async Task<IActionResult> Delete(int id)\n    {\n        // Soft delete barge condition and cascade to photos\n        return Json(new { success = true });\n    }\n}"
      }
    },
    "permissionEnum": {
      "file": "Enums/AuthPermissions.cs",
      "entries": [
        {
          "name": "BargeConditionsView",
          "value": "Auto-assigned",
          "description": "View barge conditions and photos"
        },
        {
          "name": "BargeConditionsModify",
          "value": "Auto-assigned",
          "description": "Delete barge conditions and photos"
        }
      ],
      "implementationExample": "public enum AuthPermissions\n{\n    // Barge Conditions\n    [Description(\"View barge conditions and photos\")]\n    BargeConditionsView,\n    \n    [Description(\"Delete barge conditions and photos\")]\n    BargeConditionsModify\n}"
    }
  },
  "implementationNotes": [
    "This is a read-only viewing form - barge conditions are created from the barge/vessel system, not directly by users",
    "No Create/Edit permissions needed - only View and Delete (Modify)",
    "Delete operations are soft deletes using entity.Delete() method",
    "Photo management is integrated - deleting condition deletes all photos via cascade",
    "Photo files stored on server path from GlobalSettingList.DocumentsFilePath",
    "Modern implementation should use file storage service (Azure Blob, S3, etc.) instead of file paths",
    "Export functionality should be available to all users with View permission",
    "Consider adding email notification tracking (EmailSentDateTime field exists in legacy)",
    "Grid columns: CreateDateTime, CreateUser, Note, EmailSentDateTime",
    "Photo grid columns: DocumentName, DocumentExtension",
    "Always use IdentityConstants.ApplicationScheme (not 'Cookies') for authentication scheme"
  ],
  "securityPatterns": {
    "permissionGranularity": "TwoTier",
    "pattern": "ReadOnly and Modify (No Create/Edit)",
    "tiers": [
      {
        "level": "ReadOnly",
        "permission": "BargeConditionsView",
        "actions": [
          "View list",
          "View details",
          "View photos",
          "Download photos",
          "Export data"
        ]
      },
      {
        "level": "Modify",
        "permission": "BargeConditionsModify",
        "actions": [
          "Delete conditions (soft delete)",
          "Delete photos (soft delete)"
        ],
        "note": "No Create/Edit - records created by barge system"
      }
    ],
    "buttonMapping": [
      {
        "legacyType": "Cancel",
        "modernPermission": "None",
        "description": "Close button requires no permission"
      },
      {
        "legacyType": "Remove",
        "legacyPermission": "CanDelete",
        "modernPermission": "BargeConditionsModify",
        "description": "Delete button requires Modify permission"
      },
      {
        "legacyType": "Open",
        "legacyPermission": "CanView/CanExport",
        "modernPermission": "BargeConditionsView",
        "description": "View and Export buttons require View permission"
      }
    ]
  },
  "extractionMetadata": {
    "sourceFile": "C:/Dev/BargeOps.Admin.Mono/OnShore/apps/Onshore/Forms/frmBargeConditions.vb",
    "extractedDate": "2025-12-22",
    "extractorVersion": "1.0",
    "subsystemIdentifier": "SubSystem.frmBargeSearch",
    "legacySecurityFramework": "Csg.Windows.Forms.Security.ControlAuthorizationBase",
    "baseFormHierarchy": [
      "frmBargeConditions",
      "frmBaseDetailEditList",
      "ControlAuthorizationBase"
    ],
    "securityButtonsCount": 6,
    "operationsCount": 5,
    "modernPermissionsCount": 2
  }
}
