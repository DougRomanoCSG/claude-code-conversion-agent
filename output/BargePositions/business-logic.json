{
  "businessObject": "BargePosition",
  "baseClass": "BusinessLogicBase",
  "namespace": "Onshore.BusinessLogic",
  "collectionClass": {
    "name": "BargePositions",
    "baseClass": "BusinessLogicCollectionBase",
    "description": "Collection class managing multiple barge position updates in a single transaction"
  },
  "description": "Business object for managing barge positions including tier locations, berth locations, and workspace movements. Handles complex position validation and conflict detection.",
  "properties": [
    {
      "name": "BargePositionID",
      "type": "Int32",
      "access": "ReadOnly",
      "isPrimaryKey": true,
      "isNullable": false,
      "defaultValue": 0,
      "description": "Primary key identifier, not actively used but expected by framework"
    },
    {
      "name": "FleetID",
      "type": "Int32",
      "access": "ReadWrite",
      "isRequired": true,
      "description": "Identifier for the fleet managing this position"
    },
    {
      "name": "BargeID",
      "type": "Int32",
      "access": "ReadWrite",
      "isRequired": true,
      "defaultValue": -1,
      "description": "Identifier for the barge being positioned"
    },
    {
      "name": "BargeLocationID",
      "type": "Int32",
      "access": "ReadWrite",
      "isNullable": true,
      "defaultValue": -1,
      "description": "Optional location identifier for the barge. Not always set by the form."
    },
    {
      "name": "PositionType",
      "type": "String",
      "access": "ReadWrite",
      "isRequired": true,
      "allowedValues": ["tier", "berth", "rake", "anchor"],
      "defaultValue": "",
      "description": "Type of position operation: 'tier' for tier positions, 'berth' for facility berth positions, 'rake' for changing rake direction only, 'anchor' for setting anchor wire flag"
    },
    {
      "name": "TierGroupID",
      "type": "Int32",
      "access": "ReadWrite",
      "isNullable": true,
      "defaultValue": -1,
      "description": "Tier group identifier, used for maintaining unsaved changes between grid refreshes"
    },
    {
      "name": "TierID",
      "type": "Int32",
      "access": "ReadWrite",
      "isNullable": true,
      "defaultValue": -1,
      "description": "Tier identifier for tier-based positions"
    },
    {
      "name": "TierX",
      "type": "Int32",
      "access": "ReadWrite",
      "isNullable": true,
      "defaultValue": -1,
      "description": "X coordinate within tier grid"
    },
    {
      "name": "TierY",
      "type": "Int32",
      "access": "ReadWrite",
      "isNullable": true,
      "defaultValue": -1,
      "description": "Y coordinate within tier grid"
    },
    {
      "name": "GridX",
      "type": "Int32",
      "access": "ReadWrite",
      "isNullable": true,
      "defaultValue": -1,
      "description": "Grid X coordinate, used only for maintaining unsaved changes between grid refreshes; not persisted to database"
    },
    {
      "name": "FacilityBerthID",
      "type": "Int32",
      "access": "ReadWrite",
      "isNullable": true,
      "defaultValue": -1,
      "description": "Facility berth identifier for berth-based positions"
    },
    {
      "name": "FacilityBerthX",
      "type": "Int32",
      "access": "ReadWrite",
      "isNullable": true,
      "defaultValue": -1,
      "description": "X coordinate within facility berth"
    },
    {
      "name": "FacilityBerthY",
      "type": "Int32",
      "access": "ReadWrite",
      "isNullable": true,
      "defaultValue": -1,
      "description": "Y coordinate within facility berth"
    },
    {
      "name": "PremoveTierID",
      "type": "Int32",
      "access": "ReadWrite",
      "isNullable": true,
      "defaultValue": -1,
      "description": "Original tier ID before move, used for position validation. Value of -1 indicates coming from workspace."
    },
    {
      "name": "PremoveTierX",
      "type": "Int32",
      "access": "ReadWrite",
      "isNullable": true,
      "defaultValue": -1,
      "description": "Original tier X coordinate before move"
    },
    {
      "name": "PremoveTierY",
      "type": "Int32",
      "access": "ReadWrite",
      "isNullable": true,
      "defaultValue": -1,
      "description": "Original tier Y coordinate before move"
    },
    {
      "name": "PremoveFacilityBerthID",
      "type": "Int32",
      "access": "ReadWrite",
      "isNullable": true,
      "defaultValue": -1,
      "description": "Original facility berth ID before move, used for position validation. Value of -1 indicates coming from workspace."
    },
    {
      "name": "PremoveFacilityBerthX",
      "type": "Int32",
      "access": "ReadWrite",
      "isNullable": true,
      "defaultValue": -1,
      "description": "Original facility berth X coordinate before move"
    },
    {
      "name": "PremoveFacilityBerthY",
      "type": "Int32",
      "access": "ReadWrite",
      "isNullable": true,
      "defaultValue": -1,
      "description": "Original facility berth Y coordinate before move"
    },
    {
      "name": "ValidateOnly",
      "type": "Boolean",
      "access": "ReadWrite",
      "defaultValue": false,
      "description": "When true, only validates the move without persisting changes"
    },
    {
      "name": "Result",
      "type": "Int32",
      "access": "ReadOnly",
      "defaultValue": -99,
      "description": "Output result from stored procedure: -1 = position already taken, 0 = barge not in expected premove position, 1 = success"
    },
    {
      "name": "TokenIndex",
      "type": "Int32",
      "access": "ReadWrite",
      "description": "Index of the token representation, used for maintaining unsaved changes between grid refreshes; not persisted to database"
    },
    {
      "name": "TokenCaption",
      "type": "String",
      "access": "ReadWrite",
      "description": "Display caption for token, used when opening frmBargePositions from Barge Event or BargeDetail form"
    },
    {
      "name": "IsDisplayed",
      "type": "Boolean",
      "access": "ReadWrite",
      "defaultValue": false,
      "description": "Flag indicating if token is currently displayed, used for maintaining unsaved changes between grid refreshes; not persisted to database"
    },
    {
      "name": "FleetBoatID",
      "type": "Int32",
      "access": "ReadWrite",
      "isNullable": true,
      "defaultValue": -1,
      "description": "Identifier for the fleet boat associated with this position"
    },
    {
      "name": "RakeDirection",
      "type": "String",
      "access": "ReadWrite",
      "maxLength": 5,
      "isNullable": true,
      "defaultValue": "",
      "description": "Direction of rake for the barge. Not always set by the form; uses current value if not provided."
    },
    {
      "name": "HullType",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": true,
      "description": "Type of hull for the barge"
    },
    {
      "name": "HasAnchorWire",
      "type": "Boolean",
      "access": "ReadWrite",
      "defaultValue": false,
      "description": "Indicates if barge has anchor wire. Only one barge per tier can have anchor wire set to true."
    }
  ],
  "businessRules": [
    {
      "ruleName": "TierPositionCollisionPrevention",
      "category": "PositionConflict",
      "property": "TierID, TierX, TierY",
      "condition": "PositionType == 'tier' AND another barge exists at (TierID, TierX, TierY) with open ticket in fleet",
      "message": "Position already taken",
      "severity": "Error",
      "context": "When moving to a tier position",
      "resultCode": -1,
      "implementation": "Check if another barge (excluding current) exists at the target tier position (TierID, TierX, TierY) that: (a) is located in the selected fleet, AND (b) has an open (non-void, non-closed) ticket in the selected fleet. Per Mark Maxwell 04/05/2007: Do not prevent collision if other barges at the position have no open tickets in the fleet or are not currently in the fleet."
    },
    {
      "ruleName": "BerthPositionCollisionPrevention",
      "category": "PositionConflict",
      "property": "FacilityBerthID, FacilityBerthX, FacilityBerthY",
      "condition": "PositionType == 'berth' AND another barge exists at (FacilityBerthID, FacilityBerthX, FacilityBerthY)",
      "message": "Position already taken",
      "severity": "Error",
      "context": "When moving to a berth position",
      "resultCode": -1,
      "implementation": "Check if any other barge (excluding current) exists at the target berth position (FacilityBerthID, FacilityBerthX, FacilityBerthY)"
    },
    {
      "ruleName": "TierPremovePositionValidation",
      "category": "PositionValidation",
      "property": "PremoveTierID, PremoveTierX, PremoveTierY",
      "condition": "ValidateOnly == true AND PositionType == 'tier' AND PremoveTierID != -1",
      "message": "Barge not in expected position",
      "severity": "Error",
      "context": "When validating tier position movement",
      "resultCode": 0,
      "implementation": "When ValidateOnly is true and PremoveTierID is not -1 (not from workspace), verify barge is currently at the expected premove position (TierID == PremoveTierID AND TierX == PremoveTierX AND TierY == PremoveTierY). If PremoveTierID is -1, skip validation as barge is coming from workspace."
    },
    {
      "ruleName": "BerthPremovePositionValidation",
      "category": "PositionValidation",
      "property": "PremoveFacilityBerthID, PremoveFacilityBerthX, PremoveFacilityBerthY",
      "condition": "ValidateOnly == true AND PositionType == 'berth' AND PremoveFacilityBerthID != -1",
      "message": "Barge not in expected position",
      "severity": "Error",
      "context": "When validating berth position movement",
      "resultCode": 0,
      "implementation": "When ValidateOnly is true and PremoveFacilityBerthID is not -1 (not from workspace), verify barge is currently at the expected premove position (FacilityBerthID == PremoveFacilityBerthID AND FacilityBerthX == PremoveFacilityBerthX AND FacilityBerthY == PremoveFacilityBerthY). If PremoveFacilityBerthID is -1, skip validation as barge is coming from workspace."
    },
    {
      "ruleName": "SingleAnchorWirePerTier",
      "category": "AnchorWireConstraint",
      "property": "HasAnchorWire",
      "condition": "PositionType == 'anchor' AND HasAnchorWire == true",
      "message": "Only one anchor wire barge allowed per tier",
      "severity": "Warning",
      "context": "When setting anchor wire flag",
      "implementation": "When HasAnchorWire is set to true for a barge, automatically set HasAnchorWire to false for all other barges in the same tier. Only one barge per tier can have the anchor wire flag."
    },
    {
      "ruleName": "RakeDirectionUpdateOnly",
      "category": "SpecialOperation",
      "property": "RakeDirection",
      "condition": "PositionType == 'rake'",
      "message": "Rake direction change does not require position validation",
      "severity": "Info",
      "context": "When only changing rake direction",
      "implementation": "When PositionType is 'rake', only update the RakeDirection field without validating or changing barge position"
    },
    {
      "ruleName": "LocationConditionalUpdate",
      "category": "ConditionalUpdate",
      "property": "BargeLocationID",
      "condition": "BargeLocationID is not always set by the form",
      "message": "LocationID only updated when valid value provided",
      "severity": "Info",
      "context": "During position update",
      "implementation": "Barge.LocationID is not always set by the form. When an invalid value (<=0) is passed, preserve the existing field value. Do not update LocationDateTime when LocationID is set."
    },
    {
      "ruleName": "RakeDirectionConditionalUpdate",
      "category": "ConditionalUpdate",
      "property": "RakeDirection",
      "condition": "RakeDirection is not always set by the form",
      "message": "RakeDirection only updated when provided",
      "severity": "Info",
      "context": "During position update",
      "implementation": "Barge.RakeDirection is not always set by the form. If empty or null, use the field's current value."
    },
    {
      "ruleName": "FleetBoatActivityTracking",
      "category": "AuditTracking",
      "property": "FleetBoatID, FleetBoatActivityDateTime",
      "condition": "FleetBoatID >= 0",
      "message": "Track fleet boat activity timestamp when fleet boat changes",
      "severity": "Info",
      "context": "During position update",
      "implementation": "When FleetBoatID is updated (value >= 0), set FleetBoatActivityDateTime to ModifyDateTime. If FleetBoatID < 0, preserve existing FleetBoatActivityDateTime."
    },
    {
      "ruleName": "TierMovementResetsBerthFields",
      "category": "PositionMutualExclusion",
      "property": "TierID, FacilityBerthID",
      "condition": "PositionType == 'tier'",
      "message": "Tier movement clears berth position and tow information",
      "severity": "Info",
      "context": "When moving to tier position",
      "implementation": "When moving to a tier position, clear FacilityBerthID, FacilityBerthX, FacilityBerthY, TowCut, TowString, and set HasAnchorWire to false"
    },
    {
      "ruleName": "BerthMovementResetsTierFields",
      "category": "PositionMutualExclusion",
      "property": "FacilityBerthID, TierID",
      "condition": "PositionType == 'berth'",
      "message": "Berth movement clears tier position",
      "severity": "Info",
      "context": "When moving to berth position",
      "implementation": "When moving to a berth position, clear TierID, TierX, TierY, and set HasAnchorWire to false"
    }
  ],
  "methods": {
    "factory": [
      {
        "name": "NewBargePosition",
        "returnType": "BargePosition",
        "isStatic": true,
        "parameters": [],
        "description": "Creates a new parent BargePosition instance using DataPortal"
      },
      {
        "name": "NewBargePositionAsChild",
        "returnType": "BargePosition",
        "isStatic": true,
        "scope": "Friend",
        "parameters": [],
        "description": "Creates a new child BargePosition instance using DataPortal"
      }
    ],
    "crud": [
      {
        "name": "GetBargePosition",
        "returnType": "BargePosition",
        "isStatic": true,
        "parameters": [
          {
            "name": "ID",
            "type": "Int32"
          }
        ],
        "description": "Loads an existing parent BargePosition by ID"
      },
      {
        "name": "GetBargePositionChild",
        "returnType": "BargePosition",
        "isStatic": true,
        "scope": "Friend",
        "parameters": [
          {
            "name": "ID",
            "type": "Int32"
          }
        ],
        "description": "Loads an existing child BargePosition by ID"
      },
      {
        "name": "GetBargePositionChild",
        "returnType": "BargePosition",
        "isStatic": true,
        "scope": "Friend",
        "parameters": [
          {
            "name": "dr",
            "type": "SafeDataReader"
          }
        ],
        "description": "Loads a child BargePosition from a DataReader"
      },
      {
        "name": "Update",
        "returnType": "void",
        "description": "Persists changes to database via stored procedure, validates position conflicts and premove position"
      }
    ],
    "businessLogic": [
      {
        "name": "Initialize",
        "returnType": "void",
        "description": "Initializes instance with default values and sets stored procedure names. All CRUD operations use 'BargePositionUpdate' stored procedure."
      },
      {
        "name": "AddInsertParameters",
        "returnType": "void",
        "scope": "Protected",
        "parameters": [
          {
            "name": "cmd",
            "type": "SqlCommand",
            "isRef": true
          }
        ],
        "description": "Adds parameters for insert operation, conditionally selecting tier or berth coordinates based on PositionType"
      },
      {
        "name": "AddUpdateParameters",
        "returnType": "void",
        "scope": "Protected",
        "parameters": [
          {
            "name": "cmd",
            "type": "SqlCommand",
            "isRef": true
          }
        ],
        "description": "Adds parameters for update operation, conditionally selecting tier or berth coordinates based on PositionType"
      },
      {
        "name": "GetInsertOutputParameters",
        "returnType": "void",
        "scope": "Protected",
        "parameters": [
          {
            "name": "cmd",
            "type": "SqlCommand",
            "isRef": true
          }
        ],
        "description": "Retrieves Result output parameter from stored procedure after insert"
      },
      {
        "name": "GetUpdateOutputParameters",
        "returnType": "void",
        "scope": "Protected",
        "parameters": [
          {
            "name": "cmd",
            "type": "SqlCommand",
            "isRef": true
          }
        ],
        "description": "Retrieves Result output parameter from stored procedure after update"
      }
    ],
    "validation": [
      {
        "name": "IsValid",
        "returnType": "Boolean",
        "isOverride": true,
        "description": "Returns validation status from base class"
      }
    ],
    "utilities": [
      {
        "name": "GetHashCode",
        "returnType": "Int32",
        "isOverride": true,
        "description": "Returns hash code based on BargeID for object comparison"
      }
    ]
  },
  "collectionMethods": {
    "factory": [
      {
        "name": "NewBargePositions",
        "returnType": "BargePositions",
        "isStatic": true,
        "parameters": [],
        "description": "Creates a new parent BargePositions collection"
      },
      {
        "name": "NewBargePositionsAsChild",
        "returnType": "BargePositions",
        "isStatic": true,
        "scope": "Friend",
        "parameters": [],
        "description": "Creates a new child BargePositions collection"
      },
      {
        "name": "NewBargePosition",
        "returnType": "BargePosition",
        "isStatic": true,
        "parameters": [],
        "description": "Factory method to create new child BargePosition for collection"
      }
    ],
    "crud": [
      {
        "name": "GetBargePositions",
        "returnType": "BargePositions",
        "isStatic": true,
        "parameters": [],
        "description": "Loads an empty parent BargePositions collection"
      },
      {
        "name": "GetBargePositions",
        "returnType": "BargePositions",
        "isStatic": true,
        "parameters": [
          {
            "name": "ParentID",
            "type": "Int32"
          }
        ],
        "description": "Loads BargePositions collection by parent ID"
      },
      {
        "name": "Update",
        "returnType": "void",
        "scope": "Protected Friend",
        "parameters": [
          {
            "name": "tr",
            "type": "SqlTransaction",
            "isRef": true
          },
          {
            "name": "Parent",
            "type": "BusinessLogicBase"
          }
        ],
        "description": "Updates all child BargePosition objects within transaction, accumulates error results using bitwise flags"
      }
    ],
    "businessLogic": [
      {
        "name": "Add",
        "returnType": "Integer",
        "parameters": [
          {
            "name": "BargePosition",
            "type": "BargePosition",
            "isRef": true
          }
        ],
        "description": "Adds BargePosition to collection with auto-generated negative ID"
      },
      {
        "name": "FindObject",
        "returnType": "BargePosition",
        "parameters": [
          {
            "name": "ID",
            "type": "Int32"
          }
        ],
        "description": "Finds and returns BargePosition in collection by BargeID, returns new instance if not found"
      },
      {
        "name": "Find",
        "returnType": "Int32",
        "parameters": [
          {
            "name": "ID",
            "type": "Int32"
          }
        ],
        "description": "Finds index of BargePosition in collection by BargeID, returns -1 if not found"
      },
      {
        "name": "ResetIsDisplayed",
        "returnType": "void",
        "parameters": [
          {
            "name": "TierGroupID",
            "type": "Int32"
          }
        ],
        "description": "Resets IsDisplayed flag to false for all children, optionally filtered by TierGroupID"
      },
      {
        "name": "Contains",
        "returnType": "Boolean",
        "parameters": [
          {
            "name": "item",
            "type": "BargePosition"
          }
        ],
        "description": "Checks if BargePosition exists in collection using equality comparison"
      }
    ],
    "utilities": [
      {
        "name": "GetEventTypeString",
        "returnType": "String",
        "isStatic": true,
        "parameters": [
          {
            "name": "evType",
            "type": "EventType"
          }
        ],
        "description": "Converts EventType enum to display string"
      }
    ]
  },
  "relationships": [],
  "enumerations": [
    {
      "name": "EventType",
      "values": [
        {
          "name": "Workspace",
          "value": 0,
          "displayName": "Workspace"
        },
        {
          "name": "MidstreamInStart",
          "value": 1,
          "displayName": "Midstream-In Start"
        },
        {
          "name": "MidstreamInComplete",
          "value": 2,
          "displayName": "Midstream-In Complete"
        },
        {
          "name": "MidstreamOutStart",
          "value": 3,
          "displayName": "Midstream-Out Start"
        },
        {
          "name": "MidstreamInUpdate",
          "value": 4,
          "displayName": "Midstream-In Update"
        },
        {
          "name": "MidstreamOutUpdate",
          "value": 5,
          "displayName": "Midstream-Out Update"
        },
        {
          "name": "ShiftStart",
          "value": 6,
          "displayName": "Shift Start"
        },
        {
          "name": "ShiftComplete",
          "value": 7,
          "displayName": "Shift Complete"
        },
        {
          "name": "Berth",
          "value": 8,
          "displayName": "Berth"
        },
        {
          "name": "TowDiagram",
          "value": 9,
          "displayName": "Tow Diagram"
        }
      ],
      "description": "Types of barge position events and operations"
    }
  ],
  "initialization": {
    "method": "Initialize",
    "storedProcedures": {
      "insert": "BargePositionUpdate",
      "update": "BargePositionUpdate",
      "delete": "BargePositionUpdate",
      "fetch": "BargePositionUpdate",
      "fetchAll": "BargePositionUpdate",
      "note": "Framework keeps trying to insert due to IsNew flag, even though conceptually doing an update, so all operations use the same stored procedure"
    },
    "defaults": [
      {
        "property": "BargePositionID",
        "value": "0"
      },
      {
        "property": "BargeID",
        "value": "-1"
      },
      {
        "property": "BargeLocationID",
        "value": "-1"
      },
      {
        "property": "TierGroupID",
        "value": "-1"
      },
      {
        "property": "TierID",
        "value": "-1"
      },
      {
        "property": "FacilityBerthID",
        "value": "-1"
      },
      {
        "property": "TierX",
        "value": "-1"
      },
      {
        "property": "GridX",
        "value": "-1"
      },
      {
        "property": "TierY",
        "value": "-1"
      }
    ]
  },
  "collectionUpdateResult": {
    "property": "UpdateResult",
    "type": "Int32",
    "description": "Bitwise flags indicating update problems across all child records",
    "values": [
      {
        "value": 0,
        "description": "All updated successfully"
      },
      {
        "value": 1,
        "description": "Bitwise flag: Position was already taken (from child Result == -1)"
      },
      {
        "value": 2,
        "description": "Bitwise flag: Barge not in expected premove position (from child Result == 0)"
      }
    ],
    "implementation": "Collection Update method accumulates child Result values using bitwise OR to set appropriate flags"
  },
  "dataAccess": {
    "storedProcedure": "BargePositionUpdate",
    "parameters": [
      {
        "name": "@FleetID",
        "type": "Int",
        "direction": "Input",
        "source": "FleetID"
      },
      {
        "name": "@BargeID",
        "type": "Int",
        "direction": "Input",
        "source": "BargeID"
      },
      {
        "name": "@BargeLocationID",
        "type": "Int",
        "direction": "Input",
        "source": "BargeLocationID"
      },
      {
        "name": "@TierID",
        "type": "Int",
        "direction": "Input",
        "source": "TierID"
      },
      {
        "name": "@FacilityBerthID",
        "type": "Int",
        "direction": "Input",
        "source": "FacilityBerthID"
      },
      {
        "name": "@PremoveTierID",
        "type": "Int",
        "direction": "Input",
        "source": "PremoveTierID"
      },
      {
        "name": "@PremoveFacilityBerthID",
        "type": "Int",
        "direction": "Input",
        "source": "PremoveFacilityBerthID"
      },
      {
        "name": "@LocationX",
        "type": "Int",
        "direction": "Input",
        "source": "Conditional: TierX when PositionType='tier', FacilityBerthX when PositionType='berth'"
      },
      {
        "name": "@LocationY",
        "type": "Int",
        "direction": "Input",
        "source": "Conditional: TierY when PositionType='tier', FacilityBerthY when PositionType='berth'"
      },
      {
        "name": "@PremoveLocationX",
        "type": "Int",
        "direction": "Input",
        "source": "Conditional: PremoveTierX when PositionType='tier', PremoveFacilityBerthX when PositionType='berth'"
      },
      {
        "name": "@PremoveLocationY",
        "type": "Int",
        "direction": "Input",
        "source": "Conditional: PremoveTierY when PositionType='tier', PremoveFacilityBerthY when PositionType='berth'"
      },
      {
        "name": "@ValidateOnly",
        "type": "bit",
        "direction": "Input",
        "source": "ValidateOnly"
      },
      {
        "name": "@PositionType",
        "type": "varchar(6)",
        "direction": "Input",
        "source": "PositionType",
        "defaultValue": "tier"
      },
      {
        "name": "@RakeDirection",
        "type": "VarChar(5)",
        "direction": "Input",
        "source": "RakeDirection",
        "isNullable": true
      },
      {
        "name": "@FleetBoatID",
        "type": "Int",
        "direction": "Input",
        "source": "FleetBoatID"
      },
      {
        "name": "@HasAnchorWire",
        "type": "bit",
        "direction": "Input",
        "source": "HasAnchorWire"
      },
      {
        "name": "@Result",
        "type": "int",
        "direction": "Output",
        "target": "Result",
        "description": "-1 = position already taken; 0 = barge not where expected; 1 = success"
      },
      {
        "name": "@ModifyDateTime",
        "type": "DateTime",
        "direction": "Output",
        "description": "Managed by base class"
      },
      {
        "name": "@ModifyUser",
        "type": "VarChar(50)",
        "direction": "Input",
        "description": "Managed by base class"
      }
    ]
  },
  "modernEquivalents": {
    "dataAnnotations": [
      "[Required(ErrorMessage = \"Fleet is required\")]",
      "[Required(ErrorMessage = \"Barge is required\")]",
      "[Required(ErrorMessage = \"Position type is required\")]",
      "[StringLength(6)]",
      "[StringLength(5)]"
    ],
    "fluentValidation": [
      "RuleFor(x => x.FleetID).GreaterThan(0).WithMessage(\"Fleet is required\");",
      "RuleFor(x => x.BargeID).GreaterThan(0).WithMessage(\"Barge is required\");",
      "RuleFor(x => x.PositionType).NotEmpty().Must(BeValidPositionType).WithMessage(\"Position type must be 'tier', 'berth', 'rake', or 'anchor'\");",
      "RuleFor(x => x.TierID).GreaterThan(0).When(x => x.PositionType == \"tier\").WithMessage(\"Tier ID is required for tier positions\");",
      "RuleFor(x => x.FacilityBerthID).GreaterThan(0).When(x => x.PositionType == \"berth\").WithMessage(\"Facility Berth ID is required for berth positions\");",
      "RuleFor(x => x).MustAsync(NotConflictWithExistingPosition).When(x => x.PositionType == \"tier\" || x.PositionType == \"berth\").WithMessage(\"Position already taken\");",
      "RuleFor(x => x).MustAsync(BeAtExpectedPremovePosition).When(x => x.ValidateOnly && (x.PremoveTierID > 0 || x.PremoveFacilityBerthID > 0)).WithMessage(\"Barge not in expected position\");"
    ],
    "domainServices": [
      "IBargePositionService.ValidatePositionAsync(BargePositionDto dto) - Validates position without saving",
      "IBargePositionService.UpdatePositionAsync(BargePositionDto dto) - Updates barge position",
      "IBargePositionService.UpdatePositionsAsync(IEnumerable<BargePositionDto> dtos) - Batch update with transaction",
      "IBargePositionService.CheckPositionConflictAsync(int tierID, int x, int y, int excludeBargeID) - Check for position conflicts",
      "IBargePositionService.SetAnchorWireAsync(int bargeID, bool hasAnchorWire) - Set anchor wire flag with tier constraint",
      "IBargePositionService.UpdateRakeDirectionAsync(int bargeID, string rakeDirection) - Update rake direction only"
    ]
  },
  "architecturalNotes": [
    "This is a position management business object, not a typical CRUD entity",
    "All operations (insert, update, delete, fetch) use the same stored procedure 'BargePositionUpdate'",
    "The framework treats this as 'IsNew' causing insert attempts, but stored procedure handles all as updates",
    "Position validation is complex with collision detection and premove position verification",
    "Collection class accumulates error results from multiple child updates using bitwise flags",
    "Some properties (GridX, TokenIndex, IsDisplayed, TokenCaption, TierGroupID) are transient UI state, not persisted",
    "Conditional parameter mapping based on PositionType ('tier' vs 'berth') for coordinates",
    "Business rule enforces single anchor wire barge per tier through cascading updates",
    "Workspace positions indicated by PremoveTierID=-1 or PremoveFacilityBerthID=-1, skip premove validation",
    "Per Mark Maxwell 04/05/2007: Collision detection only prevents drops when conflicting barge has open ticket in fleet AND is located in fleet",
    "Modern implementation should use separate commands for different operations (Move, ValidateMove, SetAnchorWire, UpdateRakeDirection) rather than overloaded stored procedure",
    "Consider implementing as Command pattern with BargePositionMoveCommand, ValidatePositionCommand, SetAnchorWireCommand, UpdateRakeDirectionCommand"
  ]
}
