{
  "entity": "Draft",
  "databaseTable": "Draft",
  "softDelete": false,
  "hasIsActive": false,
  "description": "Data access patterns for barge draft measurements including four-corner drafts, average calculations, and tonnage computations for draft surveys",
  "storedProcedures": [
    {
      "name": "DraftSelect",
      "operation": "GetById",
      "parameters": [
        {
          "name": "@DraftID",
          "type": "int",
          "required": true,
          "description": "Primary key identifier for the draft record"
        }
      ],
      "resultColumns": [
        {
          "column": "DraftID",
          "property": "DraftID",
          "type": "int",
          "nullable": false,
          "isPrimaryKey": true
        },
        {
          "column": "Draft",
          "property": "Draft",
          "type": "decimal(10,3)",
          "nullable": true,
          "description": "Overall maximum draft in decimal feet"
        },
        {
          "column": "DraftPortBow",
          "property": "DraftPortBow",
          "type": "decimal(10,3)",
          "nullable": true,
          "description": "Port bow corner draft in decimal feet"
        },
        {
          "column": "DraftPortStern",
          "property": "DraftPortStern",
          "type": "decimal(10,3)",
          "nullable": true,
          "description": "Port stern corner draft in decimal feet"
        },
        {
          "column": "DraftStarboardBow",
          "property": "DraftStarboardBow",
          "type": "decimal(10,3)",
          "nullable": true,
          "description": "Starboard bow corner draft in decimal feet"
        },
        {
          "column": "DraftStarboardStern",
          "property": "DraftStarboardStern",
          "type": "decimal(10,3)",
          "nullable": true,
          "description": "Starboard stern corner draft in decimal feet"
        },
        {
          "column": "DraftFeet",
          "property": "DraftFeet",
          "type": "int",
          "nullable": true,
          "description": "Feet portion of overall draft"
        },
        {
          "column": "DraftInches",
          "property": "DraftInches",
          "type": "int",
          "nullable": true,
          "description": "Inches portion of overall draft (0-11)"
        },
        {
          "column": "DraftPortBowFeet",
          "property": "DraftPortBowFeet",
          "type": "int",
          "nullable": true
        },
        {
          "column": "DraftPortBowInches",
          "property": "DraftPortBowInches",
          "type": "int",
          "nullable": true
        },
        {
          "column": "DraftPortSternFeet",
          "property": "DraftPortSternFeet",
          "type": "int",
          "nullable": true
        },
        {
          "column": "DraftPortSternInches",
          "property": "DraftPortSternInches",
          "type": "int",
          "nullable": true
        },
        {
          "column": "DraftStarboardBowFeet",
          "property": "DraftStarboardBowFeet",
          "type": "int",
          "nullable": true
        },
        {
          "column": "DraftStarboardBowInches",
          "property": "DraftStarboardBowInches",
          "type": "int",
          "nullable": true
        },
        {
          "column": "DraftStarboardSternFeet",
          "property": "DraftStarboardSternFeet",
          "type": "int",
          "nullable": true
        },
        {
          "column": "DraftStarboardSternInches",
          "property": "DraftStarboardSternInches",
          "type": "int",
          "nullable": true
        },
        {
          "column": "DraftAverage",
          "property": "DraftAverage",
          "type": "decimal(10,3)",
          "nullable": true,
          "description": "Average of four corner drafts (for draft survey events)"
        },
        {
          "column": "DraftAverageFeet",
          "property": "DraftAverageFeet",
          "type": "int",
          "nullable": true
        },
        {
          "column": "DraftAverageInches",
          "property": "DraftAverageInches",
          "type": "int",
          "nullable": true
        },
        {
          "column": "EstimatedCargoDeadweight",
          "property": "EstimatedCargoDeadweight",
          "type": "decimal(18,2)",
          "nullable": true,
          "description": "Calculated cargo tonnage from draft"
        },
        {
          "column": "LightshipCorrection",
          "property": "LightshipCorrection",
          "type": "decimal(18,2)",
          "nullable": true,
          "description": "Lightship correction tonnage for empty barge weight"
        },
        {
          "column": "AdjustmentTons",
          "property": "AdjustmentTons",
          "type": "decimal(18,2)",
          "nullable": true,
          "description": "Manual tonnage adjustment"
        },
        {
          "column": "LoadUnloadTons",
          "property": "LoadUnloadTons",
          "type": "decimal(18,2)",
          "nullable": true,
          "description": "Final calculated tonnage"
        },
        {
          "column": "ConvFesDraftID",
          "property": "ConvFesDraftID",
          "type": "int",
          "nullable": true,
          "description": "Legacy conversion field"
        }
      ]
    },
    {
      "name": "DraftsSelect",
      "operation": "GetAll",
      "parameters": [],
      "resultColumns": "Same as DraftSelect",
      "description": "Returns all draft records"
    },
    {
      "name": "DraftInsert",
      "operation": "Insert",
      "parameters": [
        {
          "name": "@DraftID",
          "type": "int",
          "direction": "InputOutput",
          "description": "Returns generated primary key"
        },
        {
          "name": "@Draft",
          "type": "decimal(10,3)",
          "nullable": true
        },
        {
          "name": "@DraftPortBow",
          "type": "decimal(10,3)",
          "nullable": true
        },
        {
          "name": "@DraftPortStern",
          "type": "decimal(10,3)",
          "nullable": true
        },
        {
          "name": "@DraftStarboardBow",
          "type": "decimal(10,3)",
          "nullable": true
        },
        {
          "name": "@DraftStarboardStern",
          "type": "decimal(10,3)",
          "nullable": true
        },
        {
          "name": "@DraftFeet",
          "type": "int",
          "nullable": true
        },
        {
          "name": "@DraftInches",
          "type": "int",
          "nullable": true
        },
        {
          "name": "@DraftPortBowFeet",
          "type": "int",
          "nullable": true
        },
        {
          "name": "@DraftPortBowInches",
          "type": "int",
          "nullable": true
        },
        {
          "name": "@DraftPortSternFeet",
          "type": "int",
          "nullable": true
        },
        {
          "name": "@DraftPortSternInches",
          "type": "int",
          "nullable": true
        },
        {
          "name": "@DraftStarboardBowFeet",
          "type": "int",
          "nullable": true
        },
        {
          "name": "@DraftStarboardBowInches",
          "type": "int",
          "nullable": true
        },
        {
          "name": "@DraftStarboardSternFeet",
          "type": "int",
          "nullable": true
        },
        {
          "name": "@DraftStarboardSternInches",
          "type": "int",
          "nullable": true
        },
        {
          "name": "@DraftAverage",
          "type": "decimal(10,3)",
          "nullable": true
        },
        {
          "name": "@DraftAverageFeet",
          "type": "int",
          "nullable": true
        },
        {
          "name": "@DraftAverageInches",
          "type": "int",
          "nullable": true
        },
        {
          "name": "@EstimatedCargoDeadweight",
          "type": "decimal(18,2)",
          "nullable": true
        },
        {
          "name": "@LightshipCorrection",
          "type": "decimal(18,2)",
          "nullable": true
        },
        {
          "name": "@AdjustmentTons",
          "type": "decimal(18,2)",
          "nullable": true
        },
        {
          "name": "@LoadUnloadTons",
          "type": "decimal(18,2)",
          "nullable": true
        }
      ]
    },
    {
      "name": "DraftUpdate",
      "operation": "Update",
      "parameters": [
        {
          "name": "@DraftID",
          "type": "int",
          "required": true
        },
        {
          "name": "@Draft",
          "type": "decimal(10,3)",
          "nullable": true
        },
        {
          "name": "@DraftPortBow",
          "type": "decimal(10,3)",
          "nullable": true
        },
        {
          "name": "@DraftPortStern",
          "type": "decimal(10,3)",
          "nullable": true
        },
        {
          "name": "@DraftStarboardBow",
          "type": "decimal(10,3)",
          "nullable": true
        },
        {
          "name": "@DraftStarboardStern",
          "type": "decimal(10,3)",
          "nullable": true
        },
        {
          "name": "@DraftFeet",
          "type": "int",
          "nullable": true
        },
        {
          "name": "@DraftInches",
          "type": "int",
          "nullable": true
        },
        {
          "name": "@DraftPortBowFeet",
          "type": "int",
          "nullable": true
        },
        {
          "name": "@DraftPortBowInches",
          "type": "int",
          "nullable": true
        },
        {
          "name": "@DraftPortSternFeet",
          "type": "int",
          "nullable": true
        },
        {
          "name": "@DraftPortSternInches",
          "type": "int",
          "nullable": true
        },
        {
          "name": "@DraftStarboardBowFeet",
          "type": "int",
          "nullable": true
        },
        {
          "name": "@DraftStarboardBowInches",
          "type": "int",
          "nullable": true
        },
        {
          "name": "@DraftStarboardSternFeet",
          "type": "int",
          "nullable": true
        },
        {
          "name": "@DraftStarboardSternInches",
          "type": "int",
          "nullable": true
        },
        {
          "name": "@DraftAverage",
          "type": "decimal(10,3)",
          "nullable": true
        },
        {
          "name": "@DraftAverageFeet",
          "type": "int",
          "nullable": true
        },
        {
          "name": "@DraftAverageInches",
          "type": "int",
          "nullable": true
        },
        {
          "name": "@EstimatedCargoDeadweight",
          "type": "decimal(18,2)",
          "nullable": true
        },
        {
          "name": "@LightshipCorrection",
          "type": "decimal(18,2)",
          "nullable": true
        },
        {
          "name": "@AdjustmentTons",
          "type": "decimal(18,2)",
          "nullable": true
        },
        {
          "name": "@LoadUnloadTons",
          "type": "decimal(18,2)",
          "nullable": true
        }
      ]
    },
    {
      "name": "DraftDelete",
      "operation": "Delete",
      "parameters": [
        {
          "name": "@DraftID",
          "type": "int",
          "required": true,
          "description": "Primary key of draft record to delete"
        }
      ],
      "description": "Hard delete - removes draft record permanently"
    }
  ],
  "sqlFiles": [
    {
      "fileName": "Draft_GetById.sql",
      "operation": "GetById",
      "description": "Fetch single draft record by ID",
      "modernEquivalent": "SELECT * FROM Draft WHERE DraftID = @DraftID",
      "returnType": "Single<DraftDto>"
    },
    {
      "fileName": "Draft_Insert.sql",
      "operation": "Insert",
      "description": "Create new draft record with all corner measurements",
      "modernEquivalent": "INSERT INTO Draft with SCOPE_IDENTITY() return",
      "returnType": "int (DraftID)"
    },
    {
      "fileName": "Draft_Update.sql",
      "operation": "Update",
      "description": "Update existing draft record with all measurements",
      "modernEquivalent": "UPDATE Draft SET ... WHERE DraftID = @DraftID"
    },
    {
      "fileName": "Draft_Delete.sql",
      "operation": "Delete",
      "description": "Hard delete draft record",
      "modernEquivalent": "DELETE FROM Draft WHERE DraftID = @DraftID"
    }
  ],
  "repositoryInterface": {
    "name": "IDraftRepository",
    "namespace": "Admin.Infrastructure.Abstractions",
    "filePath": "src/BargeOps.API/src/Admin.Infrastructure/Abstractions/IDraftRepository.cs",
    "methods": [
      {
        "name": "GetByIdAsync",
        "returnType": "Task<DraftDto?>",
        "parameters": [
          {
            "name": "id",
            "type": "int"
          },
          {
            "name": "cancellationToken",
            "type": "CancellationToken",
            "default": "default"
          }
        ],
        "description": "Retrieve draft record by ID"
      },
      {
        "name": "CreateAsync",
        "returnType": "Task<DraftDto>",
        "parameters": [
          {
            "name": "draft",
            "type": "DraftDto"
          },
          {
            "name": "cancellationToken",
            "type": "CancellationToken",
            "default": "default"
          }
        ],
        "description": "Create new draft record and return with generated ID"
      },
      {
        "name": "UpdateAsync",
        "returnType": "Task<DraftDto>",
        "parameters": [
          {
            "name": "draft",
            "type": "DraftDto"
          },
          {
            "name": "cancellationToken",
            "type": "CancellationToken",
            "default": "default"
          }
        ],
        "description": "Update existing draft record"
      },
      {
        "name": "DeleteAsync",
        "returnType": "Task<bool>",
        "parameters": [
          {
            "name": "id",
            "type": "int"
          },
          {
            "name": "cancellationToken",
            "type": "CancellationToken",
            "default": "default"
          }
        ],
        "description": "Hard delete draft record"
      }
    ]
  },
  "repositoryImplementation": {
    "name": "DraftRepository",
    "namespace": "Admin.Infrastructure.Repositories",
    "filePath": "src/BargeOps.API/src/Admin.Infrastructure/Repositories/DraftRepository.cs",
    "connectionString": "ServiceData",
    "pattern": "Dapper with embedded SQL resources",
    "useSqlText": true,
    "exampleImplementation": {
      "getById": "var sql = SqlText.GetSqlText(\"Draft_GetById\");\nreturn await _connection.QuerySingleOrDefaultAsync<DraftDto>(sql, new { DraftID = id });",
      "insert": "var sql = SqlText.GetSqlText(\"Draft_Insert\");\nvar id = await _connection.ExecuteScalarAsync<int>(sql, draft);\ndraft.DraftID = id;\nreturn draft;",
      "update": "var sql = SqlText.GetSqlText(\"Draft_Update\");\nawait _connection.ExecuteAsync(sql, draft);\nreturn draft;",
      "delete": "var sql = SqlText.GetSqlText(\"Draft_Delete\");\nvar rowsAffected = await _connection.ExecuteAsync(sql, new { DraftID = id });\nreturn rowsAffected > 0;"
    }
  },
  "dto": {
    "name": "DraftDto",
    "namespace": "BargeOps.Shared.Dto",
    "filePath": "src/BargeOps.Shared/BargeOps.Shared/Dto/DraftDto.cs",
    "properties": [
      {
        "name": "DraftID",
        "type": "int",
        "nullable": false,
        "isPrimaryKey": true,
        "attributes": ["[Sortable]", "[Filterable]"]
      },
      {
        "name": "Draft",
        "type": "decimal?",
        "display": "Draft",
        "attributes": ["[Range(0, 99.999)]", "[Sortable]"],
        "description": "Overall maximum draft in decimal feet"
      },
      {
        "name": "DraftPortBow",
        "type": "decimal?",
        "display": "Port Bow Draft",
        "attributes": ["[Range(0, 99.999)]"],
        "description": "Port bow corner draft"
      },
      {
        "name": "DraftPortStern",
        "type": "decimal?",
        "display": "Port Stern Draft",
        "attributes": ["[Range(0, 99.999)]"],
        "description": "Port stern corner draft"
      },
      {
        "name": "DraftStarboardBow",
        "type": "decimal?",
        "display": "Starboard Bow Draft",
        "attributes": ["[Range(0, 99.999)]"],
        "description": "Starboard bow corner draft"
      },
      {
        "name": "DraftStarboardStern",
        "type": "decimal?",
        "display": "Starboard Stern Draft",
        "attributes": ["[Range(0, 99.999)]"],
        "description": "Starboard stern corner draft"
      },
      {
        "name": "DraftFeet",
        "type": "int?",
        "display": "Draft Feet",
        "description": "Feet portion of overall draft"
      },
      {
        "name": "DraftInches",
        "type": "int?",
        "display": "Draft Inches",
        "attributes": ["[Range(0, 11)]"],
        "description": "Inches portion (0-11)"
      },
      {
        "name": "DraftPortBowFeet",
        "type": "int?",
        "description": "Port bow feet"
      },
      {
        "name": "DraftPortBowInches",
        "type": "int?",
        "attributes": ["[Range(0, 11)]"]
      },
      {
        "name": "DraftPortSternFeet",
        "type": "int?",
        "description": "Port stern feet"
      },
      {
        "name": "DraftPortSternInches",
        "type": "int?",
        "attributes": ["[Range(0, 11)]"]
      },
      {
        "name": "DraftStarboardBowFeet",
        "type": "int?",
        "description": "Starboard bow feet"
      },
      {
        "name": "DraftStarboardBowInches",
        "type": "int?",
        "attributes": ["[Range(0, 11)]"]
      },
      {
        "name": "DraftStarboardSternFeet",
        "type": "int?",
        "description": "Starboard stern feet"
      },
      {
        "name": "DraftStarboardSternInches",
        "type": "int?",
        "attributes": ["[Range(0, 11)]"]
      },
      {
        "name": "DraftAverage",
        "type": "decimal?",
        "display": "Average Draft",
        "attributes": ["[Range(0, 99.999)]"],
        "description": "Average of four corners (draft survey only)"
      },
      {
        "name": "DraftAverageFeet",
        "type": "int?",
        "display": "Avg Draft Feet"
      },
      {
        "name": "DraftAverageInches",
        "type": "int?",
        "display": "Avg Draft Inches",
        "attributes": ["[Range(0, 11)]"]
      },
      {
        "name": "EstimatedCargoDeadweight",
        "type": "decimal?",
        "display": "Est. Cargo Tons",
        "description": "Calculated cargo tonnage"
      },
      {
        "name": "LightshipCorrection",
        "type": "decimal?",
        "display": "Lightship Correction",
        "description": "Empty barge weight adjustment"
      },
      {
        "name": "AdjustmentTons",
        "type": "decimal?",
        "display": "Adjustment Tons",
        "description": "Manual tonnage adjustment"
      },
      {
        "name": "LoadUnloadTons",
        "type": "decimal?",
        "display": "Load/Unload Tons",
        "description": "Final calculated tonnage"
      },
      {
        "name": "ConvFesDraftID",
        "type": "int?",
        "description": "Legacy conversion field"
      }
    ]
  },
  "relatedEntities": [
    {
      "entity": "BargeSeriesDraft",
      "relationship": "ManyToOne",
      "description": "Draft/tonnage conversion tables",
      "foreignKey": "BargeSeriesID",
      "storedProcedures": [
        {
          "name": "BargeSeriesDraftSelect",
          "operation": "GetById",
          "parameters": [
            {
              "name": "@BargeSeriesDraftID",
              "type": "int"
            }
          ]
        },
        {
          "name": "BargeSeriesDraftsSelect",
          "operation": "GetBySeriesId",
          "parameters": [
            {
              "name": "@BargeSeriesID",
              "type": "int"
            }
          ],
          "description": "Loads all draft/tonnage table rows for a barge series"
        }
      ],
      "sqlFiles": [
        {
          "fileName": "BargeSeriesDraft_GetById.sql",
          "description": "Get single draft table row"
        },
        {
          "fileName": "BargeSeriesDraft_GetBySeriesId.sql",
          "description": "Get all draft table rows for barge series (sorted by DraftFeet)"
        }
      ]
    }
  ],
  "dataTransformations": [
    {
      "field": "Draft fields (decimal)",
      "transformation": "Convert decimal feet to/from feet+inches format",
      "precision": "0.001 feet (stored), rounded to nearest inch for display",
      "notes": "All draft calculations work in inches internally for precision"
    },
    {
      "field": "DraftAverage",
      "transformation": "Calculate average of four corner drafts, round to nearest inch with midpoint away from zero",
      "applicableWhen": "EventType = DraftSurvey"
    },
    {
      "field": "Tonnage fields",
      "transformation": "Format to two decimal places",
      "notes": "Derived from BargeSeries draft tables with cover weight adjustments"
    }
  ],
  "businessLogicNotes": [
    "Draft is a child object of Barge or TicketEvent - typically not queried independently",
    "Most operations load/save Draft as part of parent entity transaction",
    "Complex tonnage calculations are performed in business layer, not database",
    "Draft/tonnage conversions require loading BargeSeriesDrafts collection",
    "Cover weight adjustments applied based on event type and cover configuration",
    "No search/list operations - Draft records accessed via parent entities only"
  ],
  "modernizationNotes": [
    "Consider making DraftDto a nested/child DTO of BargeEventDto or TicketEventDto",
    "Tonnage calculation logic should be service layer (DraftCalculationService)",
    "BargeSeriesDraft lookups could be cached for performance",
    "Feet/inches conversions should be extension methods or value objects",
    "No ListQuery needed - not a searchable entity"
  ],
  "embeddedResourceConfiguration": {
    "csprojLocation": "src/BargeOps.API/src/Admin.Infrastructure/Admin.Infrastructure.csproj",
    "itemGroup": [
      "<EmbeddedResource Include=\"DataAccess\\Sql\\Draft_GetById.sql\" />",
      "<EmbeddedResource Include=\"DataAccess\\Sql\\Draft_Insert.sql\" />",
      "<EmbeddedResource Include=\"DataAccess\\Sql\\Draft_Update.sql\" />",
      "<EmbeddedResource Include=\"DataAccess\\Sql\\Draft_Delete.sql\" />",
      "<EmbeddedResource Include=\"DataAccess\\Sql\\BargeSeriesDraft_GetById.sql\" />",
      "<EmbeddedResource Include=\"DataAccess\\Sql\\BargeSeriesDraft_GetBySeriesId.sql\" />"
    ]
  },
  "extractionMetadata": {
    "sourceFiles": [
      "C:\\Dev\\BargeOps.Admin.Mono\\OnShore\\apps\\Onshore.BusinessLogic\\Business Objects\\Base Classes\\DraftBase.vb",
      "C:\\Dev\\BargeOps.Admin.Mono\\OnShore\\apps\\Onshore.BusinessLogic\\Business Objects\\Draft.vb",
      "C:\\Dev\\BargeOps.Admin.Mono\\OnShore\\apps\\Onshore.BusinessLogic\\Business Objects\\Base Classes\\BargeSeriesDraftBase.vb",
      "C:\\Dev\\BargeOps.Admin.Mono\\OnShore\\apps\\Onshore.BusinessLogic\\Business Objects\\BargeSeriesDraft.vb"
    ],
    "extractedDate": "2025-12-18",
    "extractedBy": "Data Access Analyzer",
    "referencePatterns": [
      "FacilityRepository.cs - Dapper with inline SQL",
      "BoatLocationRepository.cs - Dapper with SqlText pattern"
    ]
  }
}
