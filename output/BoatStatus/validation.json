{
  "entity": "BoatStatus",
  "description": "Validation rules for Boat Status (BoatMaintenanceLog) entity. This form tracks boat maintenance events including status changes, division/facility changes, and boat role changes.",
  "formValidation": {
    "method": "ValidatorExtender and SetValidatorExtenderForBoatMaintenanceLog",
    "rules": [
      {
        "field": "txtNote",
        "rule": "String validation",
        "validationType": "ValidationTypeConstants.String",
        "condition": "Always applies",
        "message": "Standard string validation",
        "severity": "Error",
        "clientSide": true
      },
      {
        "field": "txtNote",
        "rule": "MaxLength",
        "maxLength": 500,
        "condition": "Always applies",
        "message": "Note cannot exceed maximum length of 500.",
        "severity": "Error",
        "clientSide": true
      },
      {
        "field": "optMaintenanceType",
        "rule": "Required",
        "condition": "Always applies when editing",
        "message": "Type (MaintenanceType) is required.",
        "severity": "Error",
        "clientSide": true
      },
      {
        "field": "dtStartDate",
        "rule": "Required",
        "condition": "Always applies",
        "message": "Start date/time is required.",
        "severity": "Error",
        "clientSide": true
      }
    ]
  },
  "businessValidation": {
    "method": "CheckBusinessRules",
    "baseRules": [
      {
        "ruleName": "MaintenanceTypeRequired",
        "property": "MaintenanceType",
        "condition": "String.IsNullOrEmpty(p_MaintenanceType)",
        "message": "Type is required.",
        "severity": "Error",
        "alwaysApplies": true,
        "ruleConstant": "cIsRequiredName"
      },
      {
        "ruleName": "MaintenanceTypeMaxLength",
        "property": "MaintenanceType",
        "condition": "p_MaintenanceType.Length > MaxLength.MaintenanceType",
        "message": "Type cannot exceed maximum length of 50.",
        "severity": "Error",
        "alwaysApplies": true,
        "maxLength": 50,
        "ruleConstant": "cMaxLengthName"
      },
      {
        "ruleName": "StartDateTimeRequired",
        "property": "StartDateTime",
        "condition": "p_StartDateTime.IsEmpty",
        "message": "Start date/time is required.",
        "severity": "Error",
        "alwaysApplies": true,
        "ruleConstant": "cIsRequiredName"
      },
      {
        "ruleName": "DivisionMaxLength",
        "property": "Division",
        "condition": "p_Division.Length > MaxLength.Division",
        "message": "Division cannot exceed maximum length of 14.",
        "severity": "Error",
        "alwaysApplies": true,
        "maxLength": 14,
        "ruleConstant": "cMaxLengthName"
      },
      {
        "ruleName": "StatusMaxLength",
        "property": "Status",
        "condition": "p_Status.Length > MaxLength.Status",
        "message": "Status cannot exceed maximum length of 50.",
        "severity": "Error",
        "alwaysApplies": true,
        "maxLength": 50,
        "ruleConstant": "cMaxLengthName"
      },
      {
        "ruleName": "NoteMaxLength",
        "property": "Note",
        "condition": "p_Note.Length > MaxLength.Note",
        "message": "Note cannot exceed maximum length of 500.",
        "severity": "Error",
        "alwaysApplies": true,
        "maxLength": 500,
        "ruleConstant": "cMaxLengthName"
      }
    ],
    "conditionalRules": [
      {
        "ruleName": "TypeStatusConditional",
        "property": "Status",
        "condition": "p_MaintenanceType == BoatMaintenanceLog.TypeBoatStatus",
        "message": "If Type is 'Boat Status', then Status is required.  Otherwise, Status must be blank.",
        "severity": "Error",
        "appliesWhen": "Type is 'Boat Status'",
        "validationLogic": "If Type is 'Boat Status', Status is required. If Type is not 'Boat Status', Status must be blank.",
        "ruleConstant": "c_TypeStatusName",
        "dependencies": ["MaintenanceType"],
        "possibleValues": ["Boat Status", "Change Division/Facility", "Change Boat Role"]
      },
      {
        "ruleName": "TypeDivisionFacilityConditional",
        "property": "Division",
        "secondaryProperty": "PortFacilityID",
        "condition": "p_MaintenanceType == BoatMaintenanceLog.TypeChangeDivisionFacility",
        "message": "If Type is 'Change Division/Facility', then Division is required.  Otherwise, Division and Port Facility must be blank.",
        "severity": "Error",
        "appliesWhen": "Type is 'Change Division/Facility'",
        "validationLogic": "If Type is 'Change Division/Facility', Division is required. If Type is not 'Change Division/Facility', Division and Port Facility must be blank.",
        "ruleConstant": "c_TypeDivisionFacilityName",
        "dependencies": ["MaintenanceType"],
        "possibleValues": ["Boat Status", "Change Division/Facility", "Change Boat Role"]
      },
      {
        "ruleName": "TypeBoatRoleConditional",
        "property": "BoatRoleID",
        "condition": "p_MaintenanceType == BoatMaintenanceLog.TypeChangeBoatRole",
        "message": "If Type is 'Change Boat Role', then Boat Role is required.  Otherwise, Boat Role must be blank.",
        "severity": "Error",
        "appliesWhen": "Type is 'Change Boat Role'",
        "validationLogic": "If Type is 'Change Boat Role', BoatRoleID is required. If Type is not 'Change Boat Role', BoatRoleID must be blank.",
        "ruleConstant": "c_TypeBoatRoleName",
        "dependencies": ["MaintenanceType"],
        "possibleValues": ["Boat Status", "Change Division/Facility", "Change Boat Role"]
      }
    ]
  },
  "fieldConstraints": {
    "StartDateTime": {
      "required": true,
      "dataType": "DateTime",
      "defaultValue": "Date.Now",
      "displayFormat": "SmartDateTimeFormat",
      "components": ["dtStartDate", "cboStartTime"],
      "description": "Combined date and time field"
    },
    "MaintenanceType": {
      "required": true,
      "dataType": "String",
      "maxLength": 50,
      "control": "optMaintenanceType (OptionSet)",
      "possibleValues": [
        "Boat Status",
        "Change Division/Facility",
        "Change Boat Role"
      ],
      "defaultValue": "Boat Status",
      "readOnlyWhen": "Editing existing record (not IsNew)",
      "description": "Type of maintenance log entry"
    },
    "Status": {
      "required": false,
      "conditionallyRequired": true,
      "requiredWhen": "MaintenanceType == 'Boat Status'",
      "mustBeBlankWhen": "MaintenanceType != 'Boat Status'",
      "dataType": "String",
      "maxLength": 50,
      "control": "cboStatus (Combo)",
      "validationList": "ValidationList.ValidationTypes.BoatStatus",
      "enabledWhen": "MaintenanceType == 'Boat Status'",
      "description": "Boat status value from validation list"
    },
    "Division": {
      "required": false,
      "conditionallyRequired": true,
      "requiredWhen": "MaintenanceType == 'Change Division/Facility'",
      "mustBeBlankWhen": "MaintenanceType != 'Change Division/Facility'",
      "dataType": "String",
      "maxLength": 14,
      "control": "cboDivision (Combo)",
      "validationList": "ValidationList.ValidationTypes.Division",
      "enabledWhen": "MaintenanceType == 'Change Division/Facility'",
      "excludeFreightDivision": true,
      "description": "Division selection from validation list"
    },
    "PortFacilityID": {
      "required": false,
      "conditionallyRequired": true,
      "requiredWhen": "MaintenanceType == 'Change Division/Facility'",
      "mustBeBlankWhen": "MaintenanceType != 'Change Division/Facility'",
      "dataType": "Int32 (stored as String)",
      "control": "cboPortFacilityID (Combo)",
      "dataSource": "FleetList.Facilities or FacilityLocationList (based on IsFleetBoat)",
      "dependsOn": ["Division", "FleetID"],
      "enabledWhen": "MaintenanceType == 'Change Division/Facility'",
      "description": "Port facility selection, filtered by fleet or division"
    },
    "BoatRoleID": {
      "required": false,
      "conditionallyRequired": true,
      "requiredWhen": "MaintenanceType == 'Change Boat Role'",
      "mustBeBlankWhen": "MaintenanceType != 'Change Boat Role'",
      "dataType": "Int32 (stored as String)",
      "control": "cboBoatRoleID (Combo)",
      "dataSource": "BoatRoleList.GetList()",
      "enabledWhen": "MaintenanceType == 'Change Boat Role'",
      "description": "Boat role selection from list"
    },
    "Note": {
      "required": false,
      "dataType": "String",
      "maxLength": 500,
      "control": "txtNote (Multiline TextBox)",
      "validationType": "ValidationTypeConstants.String",
      "description": "Free-text note field"
    },
    "LocationID": {
      "required": true,
      "dataType": "Int32",
      "description": "Parent BoatLocation ID (set automatically from parent)",
      "updatedBy": "UpdateParentKeys method"
    }
  },
  "validationTriggers": {
    "onControlValidated": [
      "cboDivision_Validated",
      "cboPortFacilityID_Validated",
      "optMaintenanceType_Validated",
      "dtStartDate_Validated",
      "cboStartTime_Validated",
      "cboStatus_Validated",
      "txtNote_Validated",
      "cboBoatRoleID_Validated"
    ],
    "onPropertyChange": [
      "MaintenanceType triggers CheckBusinessRules for Status, Division, PortFacilityID, BoatRoleID",
      "Status triggers CheckBusinessRules for Status",
      "Division triggers CheckBusinessRules for Division",
      "PortFacilityID triggers CheckBusinessRules for PortFacilityID",
      "BoatRoleID triggers CheckBusinessRules for BoatRoleID",
      "StartDateTime triggers CheckBusinessRules for StartDateTime"
    ],
    "onValueChange": [
      "optMaintenanceType_ValueChanged triggers EnableDisableMaintenanceTypes",
      "cboDivision_ValueChanged triggers PopulatePortFacilityCombo"
    ],
    "beforeSave": [
      "ClearUnusedFields clears disabled fields based on MaintenanceType",
      "MyBase.SetClickListAndDetail validates via IsValid property"
    ]
  },
  "uiEnabledDisabledLogic": {
    "description": "Controls are dynamically enabled/disabled based on MaintenanceType selection",
    "rules": [
      {
        "maintenanceType": "Boat Status",
        "enabledControls": ["cboStatus", "lblStatus"],
        "disabledControls": ["cboDivision", "lblDivision", "cboPortFacilityID", "lblPortFacilityID", "cboBoatRoleID", "lblBoatRoleID"]
      },
      {
        "maintenanceType": "Change Division/Facility",
        "enabledControls": ["cboDivision", "lblDivision", "cboPortFacilityID", "lblPortFacilityID"],
        "disabledControls": ["cboStatus", "lblStatus", "cboBoatRoleID", "lblBoatRoleID"]
      },
      {
        "maintenanceType": "Change Boat Role",
        "enabledControls": ["cboBoatRoleID", "lblBoatRoleID"],
        "disabledControls": ["cboStatus", "lblStatus", "cboDivision", "lblDivision", "cboPortFacilityID", "lblPortFacilityID"]
      },
      {
        "condition": "isEditing && !_BoatMaintenanceLog.IsNew",
        "effect": "optMaintenanceType becomes ReadOnly (cannot change type for existing records)"
      }
    ]
  },
  "clearUnusedFieldsLogic": {
    "description": "Before saving, fields not applicable to the selected MaintenanceType are cleared",
    "rules": [
      {
        "condition": "MaintenanceType != 'Boat Status'",
        "action": "Clear Status field"
      },
      {
        "condition": "MaintenanceType != 'Change Division/Facility'",
        "action": "Clear Division and PortFacilityID fields"
      },
      {
        "condition": "MaintenanceType != 'Change Boat Role'",
        "action": "Clear BoatRoleID field"
      }
    ]
  },
  "modernValidationMapping": {
    "dataAnnotations": [
      "[Required(ErrorMessage = \"Type is required\")]",
      "[StringLength(50, ErrorMessage = \"Type cannot exceed maximum length of 50.\")]",
      "public string MaintenanceType { get; set; }",
      "",
      "[Required(ErrorMessage = \"Start date/time is required.\")]",
      "public DateTime StartDateTime { get; set; }",
      "",
      "[StringLength(50, ErrorMessage = \"Status cannot exceed maximum length of 50.\")]",
      "public string Status { get; set; }",
      "",
      "[StringLength(14, ErrorMessage = \"Division cannot exceed maximum length of 14.\")]",
      "public string Division { get; set; }",
      "",
      "[StringLength(500, ErrorMessage = \"Note cannot exceed maximum length of 500.\")]",
      "public string Note { get; set; }"
    ],
    "fluentValidation": [
      "RuleFor(x => x.MaintenanceType)",
      "    .NotEmpty().WithMessage(\"Type is required.\")",
      "    .MaximumLength(50).WithMessage(\"Type cannot exceed maximum length of 50.\");",
      "",
      "RuleFor(x => x.StartDateTime)",
      "    .NotEmpty().WithMessage(\"Start date/time is required.\");",
      "",
      "RuleFor(x => x.Status)",
      "    .NotEmpty()",
      "    .When(x => x.MaintenanceType == \"Boat Status\")",
      "    .WithMessage(\"If Type is 'Boat Status', then Status is required.  Otherwise, Status must be blank.\")",
      "    .MaximumLength(50);",
      "",
      "RuleFor(x => x.Status)",
      "    .Empty()",
      "    .When(x => x.MaintenanceType != \"Boat Status\")",
      "    .WithMessage(\"If Type is 'Boat Status', then Status is required.  Otherwise, Status must be blank.\");",
      "",
      "RuleFor(x => x.Division)",
      "    .NotEmpty()",
      "    .When(x => x.MaintenanceType == \"Change Division/Facility\")",
      "    .WithMessage(\"If Type is 'Change Division/Facility', then Division is required.  Otherwise, Division and Port Facility must be blank.\")",
      "    .MaximumLength(14);",
      "",
      "RuleFor(x => x.Division)",
      "    .Empty()",
      "    .When(x => x.MaintenanceType != \"Change Division/Facility\")",
      "    .WithMessage(\"If Type is 'Change Division/Facility', then Division is required.  Otherwise, Division and Port Facility must be blank.\");",
      "",
      "RuleFor(x => x.PortFacilityID)",
      "    .NotEmpty()",
      "    .When(x => x.MaintenanceType == \"Change Division/Facility\")",
      "    .WithMessage(\"If Type is 'Change Division/Facility', then Division is required.  Otherwise, Division and Port Facility must be blank.\");",
      "",
      "RuleFor(x => x.PortFacilityID)",
      "    .Empty()",
      "    .When(x => x.MaintenanceType != \"Change Division/Facility\")",
      "    .WithMessage(\"If Type is 'Change Division/Facility', then Division is required.  Otherwise, Division and Port Facility must be blank.\");",
      "",
      "RuleFor(x => x.BoatRoleID)",
      "    .NotEmpty()",
      "    .When(x => x.MaintenanceType == \"Change Boat Role\")",
      "    .WithMessage(\"If Type is 'Change Boat Role', then Boat Role is required.  Otherwise, Boat Role must be blank.\")",
      "",
      "RuleFor(x => x.BoatRoleID)",
      "    .Empty()",
      "    .When(x => x.MaintenanceType != \"Change Boat Role\")",
      "    .WithMessage(\"If Type is 'Change Boat Role', then Boat Role is required.  Otherwise, Boat Role must be blank.\");",
      "",
      "RuleFor(x => x.Note)",
      "    .MaximumLength(500).WithMessage(\"Note cannot exceed maximum length of 500.\");"
    ],
    "clientSideValidation": {
      "library": "jquery.validate",
      "rules": [
        "MaintenanceType: { required: true, maxlength: 50 }",
        "StartDateTime: { required: true }",
        "Status: { required: function() { return $('#MaintenanceType').val() === 'Boat Status'; }, maxlength: 50 }",
        "Division: { required: function() { return $('#MaintenanceType').val() === 'Change Division/Facility'; }, maxlength: 14 }",
        "PortFacilityID: { required: function() { return $('#MaintenanceType').val() === 'Change Division/Facility'; } }",
        "BoatRoleID: { required: function() { return $('#MaintenanceType').val() === 'Change Boat Role'; } }",
        "Note: { maxlength: 500 }"
      ]
    }
  },
  "implementationNotes": [
    "The form uses a master-detail pattern with BoatLocation as parent and BoatMaintenanceLog collection as children",
    "Validation is complex due to mutually exclusive field requirements based on MaintenanceType",
    "The ClearUnusedFields method ensures data integrity by clearing fields that don't apply to the selected type",
    "MaintenanceType cannot be changed once a record is saved (IsNew = false)",
    "Division selection affects PortFacility options (filtered by FleetID if IsFleetBoat)",
    "The form uses Infragistics controls with custom ValidatorExtender for client-side validation",
    "BrokenRules collection is used for server-side validation in the business object",
    "All validation is triggered on control Validated events and property setters",
    "The form inherits from frmBaseDetailEditList which provides base validation infrastructure",
    "Error messages are displayed in staStatus (status bar) via ValidatorExtender.DisplayControl"
  ],
  "sourceFiles": [
    "C:/Dev/BargeOps.Admin.Mono/OnShore/apps/Onshore/Forms/frmBoatStatus.vb",
    "C:/Dev/BargeOps.Admin.Mono/OnShore/apps/Onshore/Forms/frmBoatStatus.designer.vb",
    "C:/Dev/BargeOps.Admin.Mono/OnShore/apps/Onshore.BusinessLogic/Business Objects/BoatMaintenanceLog.vb",
    "C:/Dev/BargeOps.Admin.Mono/OnShore/apps/Onshore.BusinessLogic/Business Objects/Base Classes/BoatMaintenanceLogBase.vb"
  ]
}
