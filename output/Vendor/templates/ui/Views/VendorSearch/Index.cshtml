@model VendorSearchViewModel
@{
    ViewData["Title"] = "Vendor Search";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h2 class="page-header mb-4">Vendors</h2>

            @if (TempData["SuccessMessage"] != null)
            {
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    @TempData["SuccessMessage"]
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            }

            @if (TempData["ErrorMessage"] != null)
            {
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    @TempData["ErrorMessage"]
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            }

            <!-- Search Criteria Card -->
            <div class="card mb-3">
                <div class="card-header">
                    <h5 class="mb-0">Search Criteria</h5>
                </div>
                <div class="card-body">
                    <form id="searchForm" asp-action="Index" method="get">
                        <div class="row g-3">
                            <!-- Row 1: Name, Accounting Code, Active Only -->
                            <div class="col-md-3">
                                <label asp-for="Name" class="form-label"></label>
                                <input asp-for="Name" class="form-control" maxlength="50" placeholder="Search by name..." />
                            </div>
                            <div class="col-md-3">
                                <label asp-for="AccountingCode" class="form-label"></label>
                                <input asp-for="AccountingCode" class="form-control" maxlength="20" placeholder="Search by code..." />
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">&nbsp;</label>
                                <div class="form-check">
                                    <input asp-for="IsActiveOnly" class="form-check-input" type="checkbox" />
                                    <label asp-for="IsActiveOnly" class="form-check-label"></label>
                                </div>
                            </div>
                            <div class="col-md-4 d-flex align-items-end">
                                <button type="button" id="btnSearch" class="btn btn-primary me-2">
                                    <i class="fas fa-search"></i> Search
                                </button>
                                <button type="button" id="btnReset" class="btn btn-secondary me-2">
                                    <i class="fas fa-undo"></i> Reset
                                </button>
                                @if (User.HasPermission(AuthPermissions.VendorModify))
                                {
                                    <a asp-action="Create" class="btn btn-success">
                                        <i class="fas fa-plus"></i> Create New
                                    </a>
                                }
                            </div>
                        </div>

                        <!-- Row 2: Additional Filters (Collapsible) -->
                        <div class="row mt-3">
                            <div class="col-12">
                                <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#additionalFilters" aria-expanded="false" aria-controls="additionalFilters">
                                    <i class="fas fa-filter"></i> Additional Filters
                                </button>
                            </div>
                        </div>

                        <div class="collapse" id="additionalFilters">
                            <div class="row g-3 mt-2">
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input asp-for="FuelSuppliersOnly" class="form-check-input" type="checkbox" />
                                        <label asp-for="FuelSuppliersOnly" class="form-check-label"></label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input asp-for="InternalVendorOnly" class="form-check-input" type="checkbox" />
                                        <label asp-for="InternalVendorOnly" class="form-check-label"></label>
                                    </div>
                                </div>
                                @if (Model.BargeExGlobalSettingEnabled)
                                {
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input asp-for="IsBargeExEnabledOnly" class="form-check-input" type="checkbox" />
                                            <label asp-for="IsBargeExEnabledOnly" class="form-check-label"></label>
                                        </div>
                                    </div>
                                }
                                @if (Model.PortalLicenseActive)
                                {
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input asp-for="EnablePortalOnly" class="form-check-input" type="checkbox" />
                                            <label asp-for="EnablePortalOnly" class="form-check-label"></label>
                                        </div>
                                    </div>
                                }
                                @if (Model.UnitTowLicenseActive)
                                {
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input asp-for="LiquidBrokerOnly" class="form-check-input" type="checkbox" />
                                            <label asp-for="LiquidBrokerOnly" class="form-check-label"></label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input asp-for="TankermanOnly" class="form-check-input" type="checkbox" />
                                            <label asp-for="TankermanOnly" class="form-check-label"></label>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Results Grid Card -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Search Results</h5>
                </div>
                <div class="card-body">
                    <table id="vendorTable" class="table table-striped table-hover" style="width:100%">
                        <thead>
                            <tr>
                                <th style="width: 80px;">Actions</th>
                                <th>Name</th>
                                <th>Long Name</th>
                                <th>Accounting #</th>
                                <th class="text-center">Active</th>
                                <th class="text-center">Fuel Supplier</th>
                                <th class="text-center">Boat Assist</th>
                                <th class="text-center">Internal</th>
                                @if (Model.BargeExGlobalSettingEnabled)
                                {
                                    <th class="text-center">BargeEx</th>
                                }
                                @if (Model.PortalLicenseActive)
                                {
                                    <th class="text-center">Portal</th>
                                }
                                @if (Model.UnitTowLicenseActive)
                                {
                                    <th class="text-center">Liquid Broker</th>
                                    <th class="text-center">Tankerman</th>
                                }
                            </tr>
                        </thead>
                        <tbody>
                            <!-- DataTables will populate this -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/vendor-search.js"></script>
    <script>
        // Pass license flags to JavaScript
        window.vendorSearchConfig = {
            portalLicenseActive: @Json.Serialize(Model.PortalLicenseActive),
            unitTowLicenseActive: @Json.Serialize(Model.UnitTowLicenseActive),
            bargeExGlobalSettingEnabled: @Json.Serialize(Model.BargeExGlobalSettingEnabled),
            hasVendorModifyPermission: @Json.Serialize(User.HasPermission(AuthPermissions.VendorModify))
        };
    </script>
}
