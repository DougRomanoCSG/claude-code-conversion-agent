{
  "entity": "RiverArea",
  "legacy": {
    "searchForm": {
      "formName": "frmRiverAreaSearch",
      "filePath": "OnShore/apps/Onshore/Forms/frmRiverAreaSearch.vb",
      "subsystem": "SubSystem.frmRiverAreaSearch",
      "securityButtons": [
        {
          "button": "btnFind",
          "type": "Open",
          "legacyPermission": "CanOpen",
          "description": "Search for river areas"
        },
        {
          "button": "btnReset",
          "type": "Open",
          "legacyPermission": "CanOpen",
          "description": "Reset search criteria"
        }
      ],
      "standardButtons": {
        "add": {
          "method": "ItemAdd",
          "description": "Opens frmRiverAreaDetail with new RiverArea object",
          "requiredPermission": "CanCreate"
        },
        "modify": {
          "method": "ItemModify",
          "description": "Opens frmRiverAreaDetail with existing RiverArea",
          "requiredPermission": "CanModify"
        },
        "remove": {
          "method": "ItemRemove",
          "description": "Soft delete RiverArea via DeleteRiverArea method",
          "requiredPermission": "CanRemove"
        }
      }
    },
    "detailForm": {
      "formName": "frmRiverAreaDetail",
      "filePath": "OnShore/apps/Onshore/Forms/frmRiverAreaDetail.vb",
      "subsystem": "SubSystem.frmRiverAreaSearch",
      "securityButtons": [
        {
          "button": "btnSubmit",
          "type": "Submit",
          "legacyPermission": "CanSubmit",
          "description": "Save RiverArea changes"
        },
        {
          "button": "btnCancel",
          "type": "Cancel",
          "legacyPermission": "CanCancel",
          "description": "Cancel RiverArea changes"
        },
        {
          "button": "btnSet",
          "type": "Submit",
          "legacyPermission": "CanSubmit",
          "description": "Save RiverAreaSegment changes"
        },
        {
          "button": "btnCancelEdit",
          "type": "CancelEdit",
          "legacyPermission": "CanCancel",
          "description": "Cancel RiverAreaSegment changes"
        }
      ],
      "toolbarButtons": [
        {
          "key": "Add",
          "type": "Add",
          "legacyPermission": "CanCreate",
          "description": "Add new river area segment"
        },
        {
          "key": "Modify",
          "type": "Modify",
          "legacyPermission": "CanModify",
          "description": "Modify selected river area segment"
        },
        {
          "key": "Remove",
          "type": "Remove",
          "legacyPermission": "CanRemove",
          "description": "Remove selected river area segment"
        },
        {
          "key": "Export",
          "type": "Open",
          "legacyPermission": "CanOpen",
          "description": "Export river area segments to file"
        }
      ]
    },
    "licenseFeatures": [
      {
        "feature": "Portal Areas",
        "licenseComponent": "Licenses.LicenseComponent.Portal",
        "affectedControls": [
          "chkPortalAreasOnly (search)",
          "chkIsPortalArea (detail)"
        ],
        "locations": [
          "frmRiverAreaSearch.vb:208,244",
          "frmRiverAreaDetail.vb:367"
        ]
      },
      {
        "feature": "Liquid Rate Area",
        "licenseComponent": "BusinessLogic.Licenses.LicenseComponent.UnitTow",
        "affectedControls": [
          "chkIsLiquidRateArea (detail)"
        ],
        "locations": [
          "frmRiverAreaSearch.vb:217",
          "frmRiverAreaDetail.vb:368"
        ]
      },
      {
        "feature": "High Water Model",
        "globalSetting": "Lists.GlobalSettingList.EnableRiverSegmentHighWaterModel",
        "affectedControls": [
          "lblCustomerID",
          "cboCustomerID",
          "chkHighWaterAreasOnly (search)",
          "chkIsHighWaterArea (detail)"
        ],
        "locations": [
          "frmRiverAreaSearch.vb:211,250-259",
          "frmRiverAreaDetail.vb:371-380"
        ]
      }
    ]
  },
  "modern": {
    "api": {
      "authentication": "INCORRECT - Currently uses [Authorize] instead of [ApiKey]",
      "correctPattern": "ApiKey",
      "attributePattern": "[ApiKey]",
      "currentImplementation": {
        "controller": "RiverAreaController.cs",
        "location": "src/BargeOps.API/src/Admin.Api/Controllers/RiverAreaController.cs",
        "currentAttribute": "[Authorize]",
        "line": 15
      },
      "endpoints": [
        {
          "method": "POST",
          "route": "api/RiverArea/riverareaFilter",
          "action": "ListPost",
          "requiredAuth": "ApiKey",
          "futurePermission": "RiverAreaView",
          "description": "Get filtered list of river areas"
        },
        {
          "method": "GET",
          "route": "api/RiverArea/{id}",
          "action": "Get",
          "requiredAuth": "ApiKey",
          "futurePermission": "RiverAreaView",
          "description": "Get river area by ID"
        },
        {
          "method": "POST",
          "route": "api/RiverArea",
          "action": "Post",
          "requiredAuth": "ApiKey",
          "futurePermission": "RiverAreaModify",
          "description": "Create new river area"
        },
        {
          "method": "PUT",
          "route": "api/RiverArea/{id}",
          "action": "Put",
          "requiredAuth": "ApiKey",
          "futurePermission": "RiverAreaModify",
          "description": "Update existing river area"
        },
        {
          "method": "PUT",
          "route": "api/RiverArea/{id}/active/{isActive}",
          "action": "SetActive",
          "requiredAuth": "ApiKey",
          "futurePermission": "RiverAreaModify",
          "description": "Set active status (soft delete/activate)"
        }
      ],
      "requiredChanges": [
        {
          "file": "RiverAreaController.cs",
          "line": 15,
          "change": "Replace [Authorize] with [ApiKey]",
          "reason": "API endpoints must use API Key authentication, not OIDC"
        }
      ]
    },
    "ui": {
      "authentication": "OIDC",
      "developmentAuth": "DevelopmentAutoSignInMiddleware",
      "attributePattern": "[Authorize]",
      "authenticationScheme": "IdentityConstants.ApplicationScheme",
      "controllers": [
        {
          "name": "RiverAreaSearchController",
          "route": "/RiverAreaSearch",
          "status": "TO BE CREATED",
          "baseAuthorization": "[Authorize]",
          "actions": [
            {
              "name": "Index",
              "route": "/RiverAreaSearch",
              "requiredPermission": "RiverAreaView",
              "description": "Display river area search page"
            },
            {
              "name": "Search",
              "route": "/RiverAreaSearch/Search",
              "requiredPermission": "RiverAreaView",
              "description": "Execute search and return results"
            }
          ]
        },
        {
          "name": "RiverAreaDetailController",
          "route": "/RiverAreaDetail",
          "status": "TO BE CREATED",
          "baseAuthorization": "[Authorize]",
          "actions": [
            {
              "name": "Details",
              "route": "/RiverAreaDetail/{id}",
              "requiredPermission": "RiverAreaView",
              "description": "View river area details"
            },
            {
              "name": "Create",
              "route": "/RiverAreaDetail/Create",
              "requiredPermission": "RiverAreaModify",
              "description": "Create new river area"
            },
            {
              "name": "Edit",
              "route": "/RiverAreaDetail/Edit/{id}",
              "requiredPermission": "RiverAreaModify",
              "description": "Edit existing river area"
            },
            {
              "name": "SetActive",
              "route": "/RiverAreaDetail/SetActive/{id}",
              "requiredPermission": "RiverAreaModify",
              "description": "Activate or deactivate river area"
            }
          ]
        }
      ],
      "permissions": [
        {
          "name": "RiverAreaView",
          "enumValue": "AuthPermissions.RiverAreaView",
          "description": "View river areas and search",
          "granularity": "ReadOnly",
          "requiredFor": [
            "Index",
            "Search",
            "Details"
          ],
          "csgAuthorizationMapping": {
            "subsystem": "Administration",
            "resource": "RiverArea",
            "action": "View"
          }
        },
        {
          "name": "RiverAreaModify",
          "enumValue": "AuthPermissions.RiverAreaModify",
          "description": "Create, update, and deactivate river areas",
          "granularity": "Modify",
          "requiredFor": [
            "Create",
            "Edit",
            "SetActive",
            "ManageSegments"
          ],
          "csgAuthorizationMapping": {
            "subsystem": "Administration",
            "resource": "RiverArea",
            "action": "Modify"
          },
          "notes": "Includes soft delete via SetActive(false). No hard delete in legacy system."
        }
      ],
      "uiElementSecurity": [
        {
          "element": "Add button (main search)",
          "permission": "RiverAreaModify",
          "behavior": "Hide if user lacks permission"
        },
        {
          "element": "Edit button (main search)",
          "permission": "RiverAreaModify",
          "behavior": "Hide if user lacks permission"
        },
        {
          "element": "Remove button (main search)",
          "permission": "RiverAreaModify",
          "behavior": "Hide if user lacks permission"
        },
        {
          "element": "Submit button (detail form)",
          "permission": "RiverAreaModify",
          "behavior": "Disable if user lacks permission"
        },
        {
          "element": "Add segment toolbar button",
          "permission": "RiverAreaModify",
          "behavior": "Disable if user lacks permission"
        },
        {
          "element": "Modify segment toolbar button",
          "permission": "RiverAreaModify",
          "behavior": "Disable if user lacks permission"
        },
        {
          "element": "Remove segment toolbar button",
          "permission": "RiverAreaModify",
          "behavior": "Disable if user lacks permission"
        },
        {
          "element": "Export segment toolbar button",
          "permission": "RiverAreaView",
          "behavior": "Enable for view permission"
        }
      ]
    },
    "permissionEnum": {
      "file": "Enums/AuthPermissions.cs",
      "location": "src/BargeOps.Shared/Enums/AuthPermissions.cs",
      "entries": [
        {
          "name": "RiverAreaView",
          "description": "View river areas",
          "value": "AUTO_ASSIGNED"
        },
        {
          "name": "RiverAreaModify",
          "description": "Modify river areas",
          "value": "AUTO_ASSIGNED"
        }
      ]
    }
  },
  "securityNotes": {
    "deletePattern": "Soft delete only via SetActive(false) - legacy uses DeleteRiverArea which likely soft deletes",
    "permissionGranularity": "Two-tier: View (ReadOnly) and Modify (Create/Update/Deactivate)",
    "childEntitySecurity": "RiverAreaSegment management inherits RiverAreaModify permission",
    "subsystemIdentifier": "Administration (implied from SubSystem.frmRiverAreaSearch)",
    "apiAuthenticationIssue": "Current API uses [Authorize] instead of [ApiKey] - must be corrected",
    "licenseBasedFeatures": "Portal Areas, Liquid Rate Area, and High Water Model features are controlled by license/global settings, not permissions"
  },
  "implementationChecklist": [
    {
      "task": "Update RiverAreaController.cs to use [ApiKey] instead of [Authorize]",
      "file": "src/BargeOps.API/src/Admin.Api/Controllers/RiverAreaController.cs:15",
      "priority": "CRITICAL",
      "reason": "API authentication pattern violation"
    },
    {
      "task": "Add RiverAreaView and RiverAreaModify to AuthPermissions.cs enum",
      "file": "src/BargeOps.Shared/Enums/AuthPermissions.cs",
      "priority": "HIGH"
    },
    {
      "task": "Create RiverAreaSearchController with [Authorize] attribute",
      "file": "src/BargeOps.UI/Controllers/RiverAreaSearchController.cs",
      "priority": "HIGH"
    },
    {
      "task": "Create RiverAreaDetailController with [Authorize] attribute",
      "file": "src/BargeOps.UI/Controllers/RiverAreaDetailController.cs",
      "priority": "HIGH"
    },
    {
      "task": "Implement CSG Authorization checks in UI controllers",
      "description": "Use CSG Authorization framework to check RiverAreaView and RiverAreaModify permissions",
      "priority": "HIGH"
    },
    {
      "task": "Implement UI element security (hide/disable buttons based on permissions)",
      "description": "ViewModels should include permission flags for button visibility",
      "priority": "MEDIUM"
    },
    {
      "task": "Map SubSystem identifier in CSG Authorization configuration",
      "description": "Configure Administration subsystem for RiverArea resource",
      "priority": "MEDIUM"
    }
  ],
  "validationQuestions": [
    "Is RiverArea considered part of 'Administration' subsystem in CSG Authorization?",
    "Should RiverAreaSegment operations require a separate permission or inherit from RiverAreaModify?",
    "Are license-based features (Portal, UnitTow) separate from permission checks?",
    "Should Export function require separate permission or included in View permission?"
  ]
}
