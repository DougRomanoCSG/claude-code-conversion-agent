{
  "entity": "Barge",
  "sourceFiles": [
    "C:/Dev/BargeOps.Admin.Mono/OnShore/apps/Onshore.BusinessLogic/Business Objects/Barge.vb",
    "C:/Dev/BargeOps.Admin.Mono/OnShore/apps/Onshore.BusinessLogic/Business Objects/Base Classes/BargeBase.vb",
    "C:/Dev/BargeOps.Admin.Mono/OnShore/apps/Onshore/Forms/frmBargeDetail.vb"
  ],
  "formValidation": {
    "formName": "frmBargeDetail",
    "method": "N/A - Uses ValidatorExtender control framework",
    "validatorControls": [
      {
        "control": "txtBargeNum",
        "validationType": "String",
        "maxLength": "MaxLength.BargeNum",
        "required": true,
        "editableWhen": "IsNew (readonly when modifying existing)",
        "description": "Barge number field with automatic validation via ValidatorExtender"
      },
      {
        "control": "txtUscgNum",
        "validationType": "String",
        "maxLength": "MaxLength.UscgNum",
        "description": "US Coast Guard VIN number"
      },
      {
        "control": "txtHullNumber",
        "validationType": "String",
        "maxLength": "MaxLength.HullNumber",
        "description": "Hull number field"
      }
    ],
    "validationFramework": "ValidatorExtender control provides client-side validation for string types and max lengths",
    "notes": [
      "Form uses ValidatorExtender.SetValidationType pattern instead of traditional AreFieldsValid method",
      "Validation is declarative via ValidatorExtender settings in SetValidatorSettings method",
      "BargeNum is editable only when creating new barge (IsNew=True), readonly when editing",
      "All property updates trigger CheckBusinessRules on the business object"
    ]
  },
  "businessValidation": {
    "method": "CheckBusinessRules",
    "baseClassFile": "BargeBase.vb",
    "derivedClassFile": "Barge.vb",
    "baseClassRules": [
      {
        "ruleName": "BargeNum_Required",
        "property": "BargeNum",
        "field": "p_BargeNum",
        "displayName": "Barge number",
        "condition": "String.IsNullOrEmpty(p_BargeNum)",
        "message": "Barge number is required",
        "severity": "Error",
        "alwaysApplies": true,
        "source": "BargeBase.vb:1294-1295",
        "brokenRuleName": "BargeNumIsRequired"
      },
      {
        "ruleName": "BargeNum_MaxLength",
        "property": "BargeNum",
        "field": "p_BargeNum",
        "displayName": "Barge number",
        "condition": "p_BargeNum.Length > MaxLength.BargeNum",
        "message": "Barge number exceeds maximum length of {MaxLength.BargeNum}.",
        "severity": "Error",
        "alwaysApplies": true,
        "source": "BargeBase.vb:1296-1298",
        "brokenRuleName": "BargeNumMaxLength"
      }
    ],
    "derivedClassRules": [
      {
        "ruleName": "ExternalLength_Reasonable",
        "property": "ExternalLength",
        "field": "p_ExternalLength",
        "displayName": "Length",
        "condition": "p_ExternalLength <> String.Empty AndAlso (CType(p_ExternalLength, Decimal) > 50000.0 OrElse CType(p_ExternalLength, Decimal) < 0.0)",
        "message": "{ExternalLength value} is not a reasonable value for Length",
        "severity": "Error",
        "alwaysApplies": true,
        "source": "Barge.vb:1533-1539",
        "range": {
          "min": 0.0,
          "max": 50000.0
        }
      },
      {
        "ruleName": "ExternalWidth_Reasonable",
        "property": "ExternalWidth",
        "field": "p_ExternalWidth",
        "displayName": "Width",
        "condition": "p_ExternalWidth <> String.Empty AndAlso (CType(p_ExternalWidth, Decimal) > 20000.0 OrElse CType(p_ExternalWidth, Decimal) < 0.0)",
        "message": "{ExternalWidth value} is not a reasonable value for Width",
        "severity": "Error",
        "alwaysApplies": true,
        "source": "Barge.vb:1542-1548",
        "range": {
          "min": 0.0,
          "max": 20000.0
        }
      },
      {
        "ruleName": "ExternalDepth_Reasonable",
        "property": "ExternalDepth",
        "field": "p_ExternalDepth",
        "displayName": "Depth",
        "condition": "p_ExternalDepth <> String.Empty AndAlso (CType(p_ExternalDepth, Decimal) > 10000.0 OrElse CType(p_ExternalDepth, Decimal) < 0.0)",
        "message": "{ExternalDepth value} is not a reasonable value for Depth",
        "severity": "Error",
        "alwaysApplies": true,
        "source": "Barge.vb:1551-1557",
        "range": {
          "min": 0.0,
          "max": 10000.0
        }
      },
      {
        "ruleName": "Draft_MaxDraft",
        "property": "Draft",
        "field": "p_Draft",
        "displayName": "Draft",
        "condition": "p_Draft <> String.Empty AndAlso ((p_DraftPortBow <> String.Empty AndAlso CDec(p_DraftPortBow) > CDec(p_Draft)) OrElse (p_DraftPortStern <> String.Empty AndAlso CDec(p_DraftPortStern) > CDec(p_Draft)) OrElse (p_DraftStarboardBow <> String.Empty AndAlso CDec(p_DraftStarboardBow) > CDec(p_Draft)) OrElse (p_DraftStarboardStern <> String.Empty AndAlso CDec(p_DraftStarboardStern) > CDec(p_Draft)))",
        "message": "Overall draft must be >= the highest corner draft.",
        "severity": "Error",
        "alwaysApplies": true,
        "source": "Barge.vb:1559-1574",
        "crossFieldValidation": true,
        "relatedFields": ["DraftPortBow", "DraftPortStern", "DraftStarboardBow", "DraftStarboardStern"],
        "brokenRuleName": "DraftMAX"
      },
      {
        "ruleName": "Draft_Range",
        "property": "Draft",
        "field": "p_Draft",
        "displayName": "Draft",
        "condition": "p_Draft <> String.Empty AndAlso (CType(p_Draft, Decimal) > 99.999 OrElse CType(p_Draft, Decimal) < 0.0)",
        "message": "Draft must be between 0 and 99 ft 11 in",
        "severity": "Error",
        "alwaysApplies": true,
        "source": "Barge.vb:1577-1580",
        "range": {
          "min": 0.0,
          "max": 99.999
        }
      },
      {
        "ruleName": "DraftInches_Range",
        "property": "DraftInches",
        "field": "_DraftInches",
        "displayName": "Draft inches",
        "condition": "_DraftInches <> String.Empty AndAlso (CInt(_DraftInches) < 0 OrElse CInt(_DraftInches) > 11)",
        "message": "Draft inches must be between 0 and 11.",
        "severity": "Error",
        "alwaysApplies": true,
        "source": "Barge.vb:1583-1586",
        "range": {
          "min": 0,
          "max": 11
        }
      },
      {
        "ruleName": "DraftPortBow_Range",
        "property": "DraftPortBow",
        "field": "p_DraftPortBow",
        "displayName": "Port bow draft",
        "condition": "p_DraftPortBow <> String.Empty AndAlso (CType(p_DraftPortBow, Decimal) > 99.999 OrElse CType(p_DraftPortBow, Decimal) < 0.0)",
        "message": "Port bow draft must be between 0 and 99 ft 11 in",
        "severity": "Error",
        "alwaysApplies": true,
        "source": "Barge.vb:1589-1593",
        "range": {
          "min": 0.0,
          "max": 99.999
        }
      },
      {
        "ruleName": "DraftStarboardBow_Range",
        "property": "DraftStarboardBow",
        "field": "p_DraftStarboardBow",
        "displayName": "Starboard bow draft",
        "condition": "p_DraftStarboardBow <> String.Empty AndAlso (CType(p_DraftStarboardBow, Decimal) > 99.999 OrElse CType(p_DraftStarboardBow, Decimal) < 0.0)",
        "message": "Starboard bow draft must be between 0 and 99 ft 11 in",
        "severity": "Error",
        "alwaysApplies": true,
        "source": "Barge.vb:1596-1600",
        "range": {
          "min": 0.0,
          "max": 99.999
        }
      },
      {
        "ruleName": "DraftPortStern_Range",
        "property": "DraftPortStern",
        "field": "p_DraftPortStern",
        "displayName": "Port stern draft",
        "condition": "p_DraftPortStern <> String.Empty AndAlso (CType(p_DraftPortStern, Decimal) > 99.999 OrElse CType(p_DraftPortStern, Decimal) < 0.0)",
        "message": "Port stern draft must be between 0 and 99 ft 11 in",
        "severity": "Error",
        "alwaysApplies": true,
        "source": "Barge.vb:1603-1607",
        "range": {
          "min": 0.0,
          "max": 99.999
        }
      },
      {
        "ruleName": "DraftStarboardStern_Range",
        "property": "DraftStarboardStern",
        "field": "p_DraftStarboardStern",
        "displayName": "Starboard stern draft",
        "condition": "p_DraftStarboardStern <> String.Empty AndAlso (CType(p_DraftStarboardStern, Decimal) > 99.999 OrElse CType(p_DraftStarboardStern, Decimal) < 0.0)",
        "message": "Starboard stern draft must be between 0 and 99 ft 11 in",
        "severity": "Error",
        "alwaysApplies": true,
        "source": "Barge.vb:1610-1614",
        "range": {
          "min": 0.0,
          "max": 99.999
        }
      },
      {
        "ruleName": "DraftCalculated_Range",
        "property": "DraftCalculated",
        "field": "p_DraftCalculated",
        "displayName": "Calculated draft",
        "condition": "p_DraftCalculated <> String.Empty AndAlso (CType(p_DraftCalculated, Decimal) > 99.999 OrElse CType(p_DraftCalculated, Decimal) < 0.0)",
        "message": "Calculated draft must be between 0 and 99 ft 11 in",
        "severity": "Error",
        "alwaysApplies": true,
        "source": "Barge.vb:1617-1621",
        "range": {
          "min": 0.0,
          "max": 99.999
        }
      },
      {
        "ruleName": "CustomerID_RequiredFleetOwned",
        "property": "CustomerID",
        "field": "p_CustomerID",
        "displayName": "Operator",
        "condition": "(Not _IsTerminalActive) AndAlso (p_EquipmentType.ToLower() <> 'fleet-owned') AndAlso (p_CustomerID = String.Empty)",
        "message": "Operator is required",
        "severity": "Error",
        "alwaysApplies": false,
        "appliesWhen": "Not Terminal Mode AND EquipmentType is not 'fleet-owned'",
        "source": "Barge.vb:1624-1631",
        "brokenRuleName": "CustomerIDBargeIsRequiredFleetOwned",
        "conditionalLogic": {
          "dependencies": ["EquipmentType", "_IsTerminalActive"],
          "description": "Operator is required unless barge is fleet-owned or in Terminal mode"
        }
      },
      {
        "ruleName": "SizeCategory_RequiredFleetOwned",
        "property": "SizeCategory",
        "field": "p_SizeCategory",
        "displayName": "Size",
        "condition": "(Not _IsTerminalActive) AndAlso (p_EquipmentType.ToLower() <> 'fleet-owned') AndAlso (p_SizeCategory = String.Empty)",
        "message": "Size is required",
        "severity": "Error",
        "alwaysApplies": false,
        "appliesWhen": "Not Terminal Mode AND EquipmentType is not 'fleet-owned'",
        "source": "Barge.vb:1634-1639",
        "brokenRuleName": "SizeCategoryIsRequiredFleetOwned",
        "conditionalLogic": {
          "dependencies": ["EquipmentType", "_IsTerminalActive"],
          "description": "Size is required unless barge is fleet-owned or in Terminal mode"
        }
      },
      {
        "ruleName": "FleetID_RequiredFleetOwned",
        "property": "FleetID",
        "field": "p_FleetID",
        "displayName": "Fleet",
        "condition": "p_EquipmentType.ToLower() = 'fleet-owned' AndAlso (p_FleetID = String.Empty)",
        "message": "Fleet is required",
        "severity": "Error",
        "alwaysApplies": false,
        "appliesWhen": "EquipmentType is 'fleet-owned'",
        "source": "Barge.vb:1642-1646",
        "brokenRuleName": "FleetIDIsRequiredFleetOwned",
        "conditionalLogic": {
          "dependencies": ["EquipmentType"],
          "description": "Fleet is required when barge is fleet-owned"
        }
      },
      {
        "ruleName": "FacilityBerthID_MustBeBlank",
        "property": "FacilityBerthID",
        "field": "p_FacilityBerthID",
        "displayName": "Facility Berth ID, Facility Berth X, and Facility Berth Y",
        "condition": "((Not String.IsNullOrEmpty(p_FacilityBerthID)) OrElse (Not String.IsNullOrEmpty(p_FacilityBerthX)) OrElse (Not String.IsNullOrEmpty(p_FacilityBerthY))) AndAlso (p_LocationID <> Lists.FacilityBerthList.GetLocationID(p_FacilityBerthID))",
        "message": "Facility Berth ID, Facility Berth X, and Facility Berth Y must be blank when the barge location does not match the berth location.",
        "severity": "Error",
        "alwaysApplies": false,
        "appliesWhen": "Berth location does not match barge location",
        "source": "Barge.vb:1649-1656",
        "brokenRuleName": "FacilityBerthIDMustBeBlank.",
        "crossFieldValidation": true,
        "relatedFields": ["LocationID", "FacilityBerthX", "FacilityBerthY"],
        "conditionalLogic": {
          "dependencies": ["LocationID"],
          "description": "Berth coordinates must be cleared if berth location doesn't match barge location"
        }
      },
      {
        "ruleName": "DamageNote_IsDamaged_Required",
        "property": "DamageNote",
        "field": "p_DamageNote",
        "displayName": "Damage note",
        "condition": "(Not p_IsDamaged) AndAlso (Not String.IsNullOrEmpty(p_DamageNote))",
        "message": "Damage note must be blank if Damage noted is not checked.",
        "severity": "Error",
        "alwaysApplies": false,
        "appliesWhen": "IsDamaged is false",
        "source": "Barge.vb:1660-1664",
        "brokenRuleName": "DamageNoteDamage notedIsRequired",
        "crossFieldValidation": true,
        "relatedFields": ["IsDamaged"],
        "conditionalLogic": {
          "dependencies": ["IsDamaged"],
          "description": "Damage note must be blank unless damage is flagged"
        }
      },
      {
        "ruleName": "FreeboardRange_Required",
        "property": "FreeboardRange",
        "field": "p_FreeboardRange",
        "displayName": "Freeboard range",
        "condition": "(p_HasInsufficientFreeboard AndAlso String.IsNullOrEmpty(p_FreeboardRange)) OrElse ((Not p_HasInsufficientFreeboard) AndAlso (Not String.IsNullOrEmpty(p_FreeboardRange)))",
        "message": "Freeboard range is required if Insufficient freeboard is checked.",
        "severity": "Error",
        "alwaysApplies": false,
        "appliesWhen": "HasInsufficientFreeboard is true OR is false",
        "source": "Barge.vb:1667-1674",
        "brokenRuleName": "FreeboardRangeIsRequired",
        "crossFieldValidation": true,
        "relatedFields": ["HasInsufficientFreeboard"],
        "conditionalLogic": {
          "dependencies": ["HasInsufficientFreeboard"],
          "description": "Freeboard range required when insufficient freeboard is checked, must be blank otherwise"
        }
      },
      {
        "ruleName": "OutOfServiceDate_MustBeLater",
        "property": "OutOfServiceDate",
        "field": "p_OutOfServiceDate",
        "displayName": "Out of service date",
        "condition": "(Not String.IsNullOrEmpty(InServiceDate)) AndAlso (Not String.IsNullOrEmpty(OutOfServiceDate)) AndAlso (InServiceDate >= OutOfServiceDate)",
        "message": "The Out of service date must be later than the In service date.",
        "severity": "Error",
        "alwaysApplies": false,
        "appliesWhen": "Both InServiceDate and OutOfServiceDate have values",
        "source": "Barge.vb:1677-1684",
        "crossFieldValidation": true,
        "relatedFields": ["InServiceDate"],
        "conditionalLogic": {
          "dependencies": ["InServiceDate"],
          "description": "Out of service date must be chronologically after in service date"
        }
      },
      {
        "ruleName": "BargeCharters_UniqueDateRanges",
        "property": "BargeCharters",
        "field": "BargeCharters",
        "displayName": "BargeCharters",
        "condition": "Any two charters have overlapping date ranges (complex logic comparing all charter pairs)",
        "message": "The date ranges of two charters may not overlap.",
        "severity": "Error",
        "alwaysApplies": false,
        "appliesWhen": "Multiple charters exist",
        "source": "Barge.vb:1687-1741",
        "brokenRuleName": "BargeChartersUniqueDateRanges",
        "collectionValidation": true,
        "complexLogic": {
          "description": "Iterates through all BargeCharter pairs comparing StartDate and EndDate (coalesced to MaxValue if empty) to ensure no overlaps",
          "algorithm": "Nested loop comparing each charter against all other charters with index > current"
        }
      },
      {
        "ruleName": "CoverConfig_BlankOrRequiredCoverConfig",
        "property": "CoverConfig",
        "field": "p_CoverConfig",
        "displayName": "Cover config",
        "condition": "IsCompanyOperatedBargeCoverTypeSpecialLogic = True AndAlso IsNotNullAndNotOTCoverType = True AndAlso (String.IsNullOrEmpty(p_CoverConfig) OrElse p_CoverConfig.ToLower = 'open')",
        "message": "Cover config is required and must have a value other than 'Open' when Cover type has a value and is not 'OT'.",
        "severity": "Error",
        "alwaysApplies": false,
        "appliesWhen": "Company-operated with special logic enabled AND CoverType is not OT/blank",
        "source": "Barge.vb:1744-1770",
        "brokenRuleName": "CoverConfigBlankOrRequiredCoverConfigName",
        "crossFieldValidation": true,
        "relatedFields": ["CoverType", "CustomerID"],
        "conditionalLogic": {
          "dependencies": ["IsCompanyOperatedBargeCoverTypeSpecialLogic", "IsNotNullAndNotOTCoverType"],
          "description": "Complex cover configuration logic for company-operated barges when special logic is enabled",
          "specialProperties": [
            "IsCompanyOperatedBargeCoverTypeSpecialLogic: EnableCoverTypeSpecialLogic = True AND barge is company-operated",
            "IsNotNullAndNotOTCoverType: CoverType is not null and not 'OT'"
          ]
        }
      },
      {
        "ruleName": "CoverConfig_MustBeBlank",
        "property": "CoverConfig",
        "field": "p_CoverConfig",
        "displayName": "Cover config",
        "condition": "IsCompanyOperatedBargeCoverTypeSpecialLogic = True AndAlso (Not IsNotNullAndNotOTCoverType) AndAlso (Not String.IsNullOrEmpty(p_CoverConfig))",
        "message": "Cover config must be blank.",
        "severity": "Error",
        "alwaysApplies": false,
        "appliesWhen": "Company-operated with special logic enabled AND CoverType is OT or blank",
        "source": "Barge.vb:1760-1764",
        "crossFieldValidation": true,
        "relatedFields": ["CoverType", "CustomerID"],
        "conditionalLogic": {
          "dependencies": ["IsCompanyOperatedBargeCoverTypeSpecialLogic", "IsNotNullAndNotOTCoverType"],
          "description": "Cover config must be blank when cover type is OT or not set"
        }
      },
      {
        "ruleName": "CoverType_CommodityID_Required",
        "property": "CoverType",
        "field": "p_CoverType",
        "displayName": "Cover type",
        "condition": "(String.IsNullOrEmpty(p_CoverType) OrElse p_CoverType.ToLower = 'OT') AndAlso IsRequiredCoverForCommodity = True",
        "message": "The selected Commodity requires a cover, therefore a Cover type other than 'OT' is required.",
        "severity": "Error",
        "alwaysApplies": false,
        "appliesWhen": "Commodity requires cover AND barge is company-operated",
        "source": "Barge.vb:1774-1783",
        "brokenRuleName": "CoverTypeCommodityIsRequired",
        "crossFieldValidation": true,
        "relatedFields": ["CommodityID", "CustomerID"],
        "conditionalLogic": {
          "dependencies": ["IsRequiredCoverForCommodity"],
          "description": "Cover type required when commodity mandates covered transport",
          "specialProperties": [
            "IsRequiredCoverForCommodity: Commodity.IsCoverRequired = True AND barge is company-operated"
          ]
        }
      },
      {
        "ruleName": "CoverSubTypeID_CommodityID_Required",
        "property": "CoverSubTypeID",
        "field": "p_CoverSubTypeID",
        "displayName": "Sub type",
        "condition": "(String.IsNullOrEmpty(p_CoverSubTypeID) OrElse (CInt(p_CoverSubTypeID) <= 0)) AndAlso IsRequiredCoverForCommodity = True",
        "message": "The selected Commodity requires a cover, therefore Sub type is required.",
        "severity": "Error",
        "alwaysApplies": false,
        "appliesWhen": "Commodity requires cover AND barge is company-operated",
        "source": "Barge.vb:1789-1794",
        "brokenRuleName": "CoverSubTypeIDCommodityIsRequired",
        "crossFieldValidation": true,
        "relatedFields": ["CommodityID", "CustomerID"],
        "conditionalLogic": {
          "dependencies": ["IsRequiredCoverForCommodity"],
          "description": "Cover sub-type required when commodity mandates covered transport"
        }
      },
      {
        "ruleName": "CoverSubTypeID_CoverType_Required",
        "property": "CoverSubTypeID",
        "field": "p_CoverSubTypeID",
        "displayName": "Sub type",
        "condition": "((Not String.IsNullOrEmpty(p_CoverSubTypeID)) AndAlso (CInt(p_CoverSubTypeID) > 0)) AndAlso (String.IsNullOrEmpty(p_CoverType) OrElse p_CoverType.ToLower = 'OT')",
        "message": "Sub type must be blank when Cover type is 'OT' or has no value.",
        "severity": "Error",
        "alwaysApplies": false,
        "appliesWhen": "CoverType is 'OT' or blank",
        "source": "Barge.vb:1797-1803",
        "brokenRuleName": "CoverSubTypeIDCoverTypeIsRequired",
        "crossFieldValidation": true,
        "relatedFields": ["CoverType"],
        "conditionalLogic": {
          "dependencies": ["CoverType"],
          "description": "Cover sub-type must be cleared when cover type is OT or not set"
        }
      },
      {
        "ruleName": "CoverType_Required",
        "property": "CoverType",
        "field": "p_CoverType",
        "displayName": "Cover type",
        "condition": "String.IsNullOrEmpty(p_CoverType) AndAlso GlobalSettingList.RequireBargeCoverType = True",
        "message": "Cover type is required",
        "severity": "Error",
        "alwaysApplies": false,
        "appliesWhen": "GlobalSettingList.RequireBargeCoverType is True",
        "source": "Barge.vb:1807-1812",
        "brokenRuleName": "CoverTypeIsRequired",
        "conditionalLogic": {
          "dependencies": ["GlobalSettingList.RequireBargeCoverType"],
          "description": "Cover type is conditionally required based on global system setting"
        }
      }
    ]
  },
  "validationTriggers": {
    "propertySetters": [
      {
        "property": "BargeNum",
        "trigger": "CheckBusinessRules(p_dispBargeNum)",
        "source": "BargeBase.vb:272"
      },
      {
        "property": "ExternalLength",
        "trigger": "CheckBusinessRules(p_dispExternalLength) + SetInitialSizeCategory()",
        "source": "Barge.vb:132-133",
        "sideEffect": "Auto-calculates SizeCategory based on length and width"
      },
      {
        "property": "ExternalWidth",
        "trigger": "CheckBusinessRules(p_dispExternalWidth) + SetInitialSizeCategory()",
        "source": "Barge.vb:144-145",
        "sideEffect": "Auto-calculates SizeCategory based on length and width"
      },
      {
        "property": "DraftInches",
        "trigger": "CheckBusinessRules(_DispDraftInches) + ConvertFromFeetAndInches()",
        "source": "Barge.vb:758, 761",
        "sideEffect": "Recalculates Draft property from feet and inches"
      },
      {
        "property": "DraftCalculatedInches",
        "trigger": "CheckBusinessRules(_DispDraftCalculatedInches) + ConvertFromFeetAndInches()",
        "source": "Barge.vb:807, 810",
        "sideEffect": "Recalculates DraftCalculated property from feet and inches"
      },
      {
        "property": "IsActive",
        "trigger": "CheckBusinessRules(p_dispIsActive)",
        "source": "Barge.vb:1495",
        "context": "Initialize method"
      },
      {
        "property": "LocationID",
        "trigger": "UpdateStatus()",
        "source": "Barge.vb:241",
        "sideEffect": "Recalculates barge status when location changes"
      }
    ],
    "isValidOverride": {
      "method": "IsValid",
      "additionalCheck": "CheckBusinessRules(c_dispBargeCharters)",
      "source": "Barge.vb:119",
      "reason": "Ensures charter collection date range validation runs at least once before checking object validity"
    }
  },
  "modernValidationMapping": {
    "dataAnnotations": [
      {
        "property": "BargeNum",
        "annotations": [
          "[Required(ErrorMessage = \"Barge number is required\")]",
          "[StringLength({MaxLength.BargeNum}, ErrorMessage = \"Barge number exceeds maximum length of {MaxLength.BargeNum}.\")]"
        ]
      },
      {
        "property": "ExternalLength",
        "annotations": [
          "[Range(0.0, 50000.0, ErrorMessage = \"{0} is not a reasonable value for Length\")]"
        ]
      },
      {
        "property": "ExternalWidth",
        "annotations": [
          "[Range(0.0, 20000.0, ErrorMessage = \"{0} is not a reasonable value for Width\")]"
        ]
      },
      {
        "property": "ExternalDepth",
        "annotations": [
          "[Range(0.0, 10000.0, ErrorMessage = \"{0} is not a reasonable value for Depth\")]"
        ]
      },
      {
        "property": "Draft",
        "annotations": [
          "[Range(0.0, 99.999, ErrorMessage = \"Draft must be between 0 and 99 ft 11 in\")]"
        ]
      },
      {
        "property": "DraftInches",
        "annotations": [
          "[Range(0, 11, ErrorMessage = \"Draft inches must be between 0 and 11.\")]"
        ]
      },
      {
        "property": "DraftPortBow",
        "annotations": [
          "[Range(0.0, 99.999, ErrorMessage = \"Port bow draft must be between 0 and 99 ft 11 in\")]"
        ]
      },
      {
        "property": "DraftStarboardBow",
        "annotations": [
          "[Range(0.0, 99.999, ErrorMessage = \"Starboard bow draft must be between 0 and 99 ft 11 in\")]"
        ]
      },
      {
        "property": "DraftPortStern",
        "annotations": [
          "[Range(0.0, 99.999, ErrorMessage = \"Port stern draft must be between 0 and 99 ft 11 in\")]"
        ]
      },
      {
        "property": "DraftStarboardStern",
        "annotations": [
          "[Range(0.0, 99.999, ErrorMessage = \"Starboard stern draft must be between 0 and 99 ft 11 in\")]"
        ]
      },
      {
        "property": "DraftCalculated",
        "annotations": [
          "[Range(0.0, 99.999, ErrorMessage = \"Calculated draft must be between 0 and 99 ft 11 in\")]"
        ]
      }
    ],
    "fluentValidation": [
      {
        "property": "BargeNum",
        "rules": [
          "RuleFor(x => x.BargeNum).NotEmpty().WithMessage(\"Barge number is required\")",
          "RuleFor(x => x.BargeNum).MaximumLength(MaxLength.BargeNum).WithMessage($\"Barge number exceeds maximum length of {MaxLength.BargeNum}.\")"
        ]
      },
      {
        "property": "ExternalLength",
        "rules": [
          "RuleFor(x => x.ExternalLength).InclusiveBetween(0.0m, 50000.0m).When(x => x.ExternalLength.HasValue).WithMessage(\"{PropertyValue} is not a reasonable value for Length\")"
        ]
      },
      {
        "property": "ExternalWidth",
        "rules": [
          "RuleFor(x => x.ExternalWidth).InclusiveBetween(0.0m, 20000.0m).When(x => x.ExternalWidth.HasValue).WithMessage(\"{PropertyValue} is not a reasonable value for Width\")"
        ]
      },
      {
        "property": "ExternalDepth",
        "rules": [
          "RuleFor(x => x.ExternalDepth).InclusiveBetween(0.0m, 10000.0m).When(x => x.ExternalDepth.HasValue).WithMessage(\"{PropertyValue} is not a reasonable value for Depth\")"
        ]
      },
      {
        "property": "Draft",
        "rules": [
          "RuleFor(x => x.Draft).InclusiveBetween(0.0m, 99.999m).When(x => x.Draft.HasValue).WithMessage(\"Draft must be between 0 and 99 ft 11 in\")",
          "RuleFor(x => x.Draft).Must((barge, draft) => draft >= GetMaxCornerDraft(barge)).When(x => x.Draft.HasValue).WithMessage(\"Overall draft must be >= the highest corner draft.\")"
        ],
        "customValidators": [
          "private decimal GetMaxCornerDraft(Barge barge) => new[] { barge.DraftPortBow, barge.DraftPortStern, barge.DraftStarboardBow, barge.DraftStarboardStern }.Where(d => d.HasValue).DefaultIfEmpty(0).Max() ?? 0;"
        ]
      },
      {
        "property": "DraftInches",
        "rules": [
          "RuleFor(x => x.DraftInches).InclusiveBetween(0, 11).When(x => x.DraftInches.HasValue).WithMessage(\"Draft inches must be between 0 and 11.\")"
        ]
      },
      {
        "property": "CustomerID",
        "rules": [
          "RuleFor(x => x.CustomerID).NotEmpty().When(x => !IsTerminalActive && x.EquipmentType?.ToLower() != \"fleet-owned\").WithMessage(\"Operator is required\")"
        ]
      },
      {
        "property": "SizeCategory",
        "rules": [
          "RuleFor(x => x.SizeCategory).NotEmpty().When(x => !IsTerminalActive && x.EquipmentType?.ToLower() != \"fleet-owned\").WithMessage(\"Size is required\")"
        ]
      },
      {
        "property": "FleetID",
        "rules": [
          "RuleFor(x => x.FleetID).NotEmpty().When(x => x.EquipmentType?.ToLower() == \"fleet-owned\").WithMessage(\"Fleet is required\")"
        ]
      },
      {
        "property": "FacilityBerthID",
        "rules": [
          "RuleFor(x => x).Must(barge => BerthMatchesLocation(barge)).When(x => !string.IsNullOrEmpty(x.FacilityBerthID) || !string.IsNullOrEmpty(x.FacilityBerthX) || !string.IsNullOrEmpty(x.FacilityBerthY)).WithMessage(\"Facility Berth ID, Facility Berth X, and Facility Berth Y must be blank when the barge location does not match the berth location.\")"
        ],
        "customValidators": [
          "private bool BerthMatchesLocation(Barge barge) => barge.LocationID == FacilityBerthList.GetLocationID(barge.FacilityBerthID);"
        ]
      },
      {
        "property": "DamageNote",
        "rules": [
          "RuleFor(x => x.DamageNote).Empty().When(x => !x.IsDamaged).WithMessage(\"Damage note must be blank if Damage noted is not checked.\")"
        ]
      },
      {
        "property": "FreeboardRange",
        "rules": [
          "RuleFor(x => x.FreeboardRange).NotEmpty().When(x => x.HasInsufficientFreeboard).WithMessage(\"Freeboard range is required if Insufficient freeboard is checked.\")",
          "RuleFor(x => x.FreeboardRange).Empty().When(x => !x.HasInsufficientFreeboard).WithMessage(\"Freeboard range must be blank if Insufficient freeboard is not checked.\")"
        ]
      },
      {
        "property": "OutOfServiceDate",
        "rules": [
          "RuleFor(x => x.OutOfServiceDate).GreaterThan(x => x.InServiceDate).When(x => x.InServiceDate.HasValue && x.OutOfServiceDate.HasValue).WithMessage(\"The Out of service date must be later than the In service date.\")"
        ]
      },
      {
        "property": "BargeCharters",
        "rules": [
          "RuleFor(x => x.BargeCharters).Must(charters => !HasOverlappingDateRanges(charters)).When(x => x.BargeCharters?.Count > 1).WithMessage(\"The date ranges of two charters may not overlap.\")"
        ],
        "customValidators": [
          "private bool HasOverlappingDateRanges(ICollection<BargeCharter> charters) { /* complex logic comparing all pairs */ }"
        ]
      },
      {
        "property": "CoverConfig",
        "rules": [
          "RuleFor(x => x.CoverConfig).NotEmpty().Must(x => x?.ToLower() != \"open\").When(x => IsCompanyOperatedBargeCoverTypeSpecialLogic(x) && IsNotNullAndNotOTCoverType(x)).WithMessage(\"Cover config is required and must have a value other than 'Open' when Cover type has a value and is not 'OT'.\")",
          "RuleFor(x => x.CoverConfig).Empty().When(x => IsCompanyOperatedBargeCoverTypeSpecialLogic(x) && !IsNotNullAndNotOTCoverType(x)).WithMessage(\"Cover config must be blank.\")"
        ]
      },
      {
        "property": "CoverType",
        "rules": [
          "RuleFor(x => x.CoverType).NotEmpty().Must(x => x?.ToLower() != \"ot\").When(x => IsRequiredCoverForCommodity(x)).WithMessage(\"The selected Commodity requires a cover, therefore a Cover type other than 'OT' is required.\")",
          "RuleFor(x => x.CoverType).NotEmpty().When(x => GlobalSettingList.RequireBargeCoverType).WithMessage(\"Cover type is required\")"
        ]
      },
      {
        "property": "CoverSubTypeID",
        "rules": [
          "RuleFor(x => x.CoverSubTypeID).NotEmpty().GreaterThan(0).When(x => IsRequiredCoverForCommodity(x)).WithMessage(\"The selected Commodity requires a cover, therefore Sub type is required.\")",
          "RuleFor(x => x.CoverSubTypeID).Empty().When(x => string.IsNullOrEmpty(x.CoverType) || x.CoverType?.ToLower() == \"ot\").WithMessage(\"Sub type must be blank when Cover type is 'OT' or has no value.\")"
        ]
      }
    ],
    "jqueryValidate": [
      {
        "field": "BargeNum",
        "rules": {
          "required": true,
          "maxlength": "MaxLength.BargeNum"
        },
        "messages": {
          "required": "Barge number is required",
          "maxlength": "Barge number exceeds maximum length"
        }
      },
      {
        "field": "ExternalLength",
        "rules": {
          "range": "[0, 50000]"
        },
        "messages": {
          "range": "Value is not a reasonable value for Length"
        }
      },
      {
        "field": "Draft",
        "rules": {
          "range": "[0, 99.999]"
        },
        "messages": {
          "range": "Draft must be between 0 and 99 ft 11 in"
        }
      },
      {
        "field": "DraftInches",
        "rules": {
          "range": "[0, 11]"
        },
        "messages": {
          "range": "Draft inches must be between 0 and 11"
        }
      }
    ]
  },
  "complexValidationLogic": [
    {
      "name": "Cover Type Special Logic",
      "description": "Complex conditional validation for cover configuration based on company operation status and global settings",
      "properties": [
        "IsCompanyOperatedBargeCoverTypeSpecialLogic",
        "IsNotNullAndNotOTCoverType",
        "IsRequiredCoverForCommodity"
      ],
      "details": {
        "IsCompanyOperatedBargeCoverTypeSpecialLogic": {
          "definition": "GlobalSettingList.EnableCoverTypeSpecialLogic = True AND IsCompanyOperatedBarge() = True",
          "description": "True when special cover logic is enabled globally AND barge is company-operated"
        },
        "IsNotNullAndNotOTCoverType": {
          "definition": "(Not String.IsNullOrEmpty(CoverType)) AndAlso (CoverType.ToLower <> ValidationList.CoverTypeList(ValidationList.CoverType.OT).ToLower)",
          "description": "True when CoverType has a value and is not 'OT' (Open Top)"
        },
        "IsRequiredCoverForCommodity": {
          "definition": "IsCompanyOperatedBarge() AndAlso (Not String.IsNullOrEmpty(CommodityID)) AndAlso CommodityList.GetList().GetCommodity(CommodityID).IsCoverRequired",
          "description": "True when commodity requires cover AND barge is company-operated"
        }
      },
      "validationRules": [
        "If special logic enabled AND cover type not OT: CoverConfig required and not 'Open'",
        "If special logic enabled AND cover type is OT/blank: CoverConfig must be blank",
        "If commodity requires cover: CoverType must not be OT/blank",
        "If commodity requires cover: CoverSubTypeID is required",
        "If CoverType is OT/blank: CoverSubTypeID must be blank"
      ]
    },
    {
      "name": "Charter Date Range Validation",
      "description": "Ensures no overlapping date ranges across all charters in the collection",
      "algorithm": "Nested loop iteration comparing each charter's date range against all subsequent charters",
      "pseudocode": [
        "For each charter i from 0 to Count-2:",
        "  Get charter i's start and end dates (coalesce end to MaxValue)",
        "  For each charter j from i+1 to Count-1:",
        "    Get charter j's start and end dates (coalesce end to MaxValue)",
        "    If ranges overlap: set broken flag",
        "Assert broken rule if any overlaps found"
      ],
      "source": "Barge.vb:1687-1741"
    },
    {
      "name": "Draft Cross-Field Validation",
      "description": "Overall draft must be >= all corner drafts",
      "relatedFields": [
        "Draft",
        "DraftPortBow",
        "DraftPortStern",
        "DraftStarboardBow",
        "DraftStarboardStern"
      ],
      "logic": "Draft >= Max(DraftPortBow, DraftPortStern, DraftStarboardBow, DraftStarboardStern)",
      "source": "Barge.vb:1559-1574"
    },
    {
      "name": "Equipment Type Conditional Requirements",
      "description": "Different fields required based on whether barge is fleet-owned",
      "conditions": [
        {
          "when": "EquipmentType = 'fleet-owned'",
          "required": ["FleetID"],
          "notRequired": ["CustomerID", "SizeCategory"]
        },
        {
          "when": "EquipmentType != 'fleet-owned' AND NOT Terminal Mode",
          "required": ["CustomerID", "SizeCategory"],
          "notRequired": ["FleetID"]
        }
      ]
    },
    {
      "name": "Facility Berth Location Matching",
      "description": "Berth coordinates must be cleared if berth location doesn't match barge location",
      "logic": "If any of (FacilityBerthID, FacilityBerthX, FacilityBerthY) has a value, then LocationID must equal FacilityBerthList.GetLocationID(FacilityBerthID)",
      "relatedFields": ["LocationID", "FacilityBerthID", "FacilityBerthX", "FacilityBerthY"],
      "source": "Barge.vb:1649-1656"
    }
  ],
  "validationConstants": {
    "errorMessages": {
      "cPropReasonableValueDesc": " is not a reasonable value for ",
      "cPropDraftRangeDesc": " must be between 0 and 99 ft 11 in",
      "cPropDraftInchesDesc": " must be between 0 and 11.",
      "cPropMaxDraft": "Overall draft must be >= the highest corner draft.",
      "cPropRequiredCoverConfigDesc": " is required and must have a value other than '{0}' when {1} has a value and is not '{2}'.",
      "cPropBlankForOTorBlankCoverTypeDesc": " must be blank when {0} is '{1}' or has no value.",
      "cPropMustBeBlankDesc": " must be blank.",
      "cPropRequiredCoverTypeDesc": "The selected {0} requires a cover, therefore a {1} other than '{2}' is required.",
      "cPropRequiredCoverSubTypeDesc": "The selected {0} requires a cover, therefore {1} is required.",
      "c_UniqueDateRangesDesc": "The date ranges of two charters may not overlap.",
      "cFacilityBerthMustBeBlank": " must be blank when the barge location does not match the berth location.",
      "cMustBeLater": "The {0} must be later than the {1}.",
      "cIsRequiredDesc": " is required",
      "cMaxLengthDesc": " exceeds maximum length of "
    },
    "displayNames": {
      "p_dispBargeNum": "Barge number",
      "p_dispExternalLength": "Length",
      "p_dispExternalWidth": "Width",
      "p_dispExternalDepth": "Depth",
      "p_dispDraft": "Draft",
      "_DispDraftInches": "Draft inches",
      "p_dispDraftPortBow": "Port bow draft",
      "p_dispDraftStarboardBow": "Starboard bow draft",
      "p_dispDraftPortStern": "Port stern draft",
      "p_dispDraftStarboardStern": "Starboard stern draft",
      "p_dispDraftCalculated": "Calculated draft",
      "_DispDraftCalculatedInches": "Calculated draft inches",
      "p_dispCustomerID": "Operator",
      "p_dispSizeCategory": "Size",
      "p_dispFleetID": "Fleet",
      "p_dispCoverType": "Cover type",
      "p_dispCoverConfig": "Cover config",
      "p_dispCoverSubTypeID": "Sub type",
      "p_dispCommodityID": "Commodity",
      "p_dispDamageNote": "Damage note",
      "p_dispIsDamaged": "Damage noted",
      "p_dispFreeboardRange": "Freeboard range",
      "p_dispHasInsufficientFreeboard": "Insufficient freeboard",
      "p_dispInServiceDate": "In service date",
      "p_dispOutOfServiceDate": "Out of service date",
      "c_dispBargeCharters": "BargeCharters"
    }
  },
  "globalSettings": {
    "RequireBargeCoverType": {
      "description": "When true, CoverType is required for all barges",
      "affectedRules": ["CoverType_Required"]
    },
    "EnableCoverTypeSpecialLogic": {
      "description": "When true, enables special cover configuration validation for company-operated barges",
      "affectedRules": [
        "CoverConfig_BlankOrRequiredCoverConfig",
        "CoverConfig_MustBeBlank"
      ]
    }
  },
  "notes": [
    "Validation framework uses BrokenRules.Assert pattern where condition=true indicates a broken rule",
    "Base class (BargeBase) provides fundamental validation (required fields, max lengths)",
    "Derived class (Barge) adds business-specific validation (ranges, cross-field, conditional)",
    "Form validation uses ValidatorExtender control framework for declarative client-side validation",
    "CheckBusinessRules is called automatically on property changes and can be invoked with specific property name or String.Empty for all rules",
    "Draft properties support dual representation: decimal (feet) and separate feet/inches fields with auto-conversion",
    "Cover type validation has complex conditional logic based on company operation status, commodity requirements, and global settings",
    "Charter collection validation uses sophisticated date range overlap detection",
    "Terminal mode (_IsTerminalActive) affects whether certain fields are required",
    "IsValid property override ensures charter collection validation runs before validity check",
    "Many conditional validations depend on calculated readonly properties (IsCompanyOperatedBarge, IsRequiredCoverForCommodity, etc.)",
    "Berth location validation requires database lookup via FacilityBerthList.GetLocationID",
    "Error messages use format strings with placeholders for dynamic field names and values"
  ]
}
