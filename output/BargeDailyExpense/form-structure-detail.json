{
  "formName": "frmBargeDailyExpenseDetail",
  "implements": ["IBaseDetailEdit"],
  "inherits": "frmBaseDetailEditList",
  "description": "Detail form for managing Barge Daily Expense entries. This form uses in-grid editing so it differs from standard detail forms. Data is changed directly in grid cells and child objects are updated immediately without Set/Cancel buttons at the child level.",
  "businessObjects": [
    {
      "name": "_BargeDailyExpenseDate",
      "type": "BargeDailyExpenseDate",
      "description": "Parent business object containing the effective date and collection of daily expenses"
    },
    {
      "name": "_BargeDailyExpense",
      "type": "BargeDailyExpense",
      "description": "Individual daily expense item (edited within grid)"
    }
  ],
  "controls": [
    {
      "name": "dtEffectiveDate",
      "type": "UltraDateTimeEditor",
      "category": "DataEntry",
      "label": "Effective date",
      "dataBinding": "_BargeDailyExpenseDate.EffectiveDate",
      "validation": ["Required via ValidatorExtender"],
      "events": ["Validated"],
      "location": "pnlDetailEdit",
      "modernPattern": {
        "type": "SplitDateTime",
        "dateInput": {
          "id": "dtEffectiveDate",
          "type": "date",
          "label": "Effective Date",
          "required": true
        },
        "timeInput": null,
        "displayFormat": "MM/dd/yyyy",
        "note": "Date-only control, no time component required"
      }
    },
    {
      "name": "lblEffectiveDate",
      "type": "UltraLabel",
      "category": "Label",
      "text": "Effective date:",
      "location": "pnlDetailEdit"
    }
  ],
  "grids": [
    {
      "name": "grdBargeDailyExpenses",
      "type": "UltraGrid",
      "uniqueIdentifier": null,
      "description": "In-grid editing grid for BargeDailyExpense collection. Uses unbound columns for editing with data transferred to/from bound business object properties.",
      "dataSource": "_BargeDailyExpenseDate.BargeDailyExpenses",
      "editMode": "InGrid",
      "updateMode": "OnCellChangeOrLostFocus",
      "columns": [
        {
          "key": "SizeCategoryUnbound",
          "header": "Size Category",
          "dataType": "String",
          "width": 100,
          "sortable": true,
          "filterable": false,
          "alignment": "Left",
          "editorType": "UltraCombo",
          "validationList": "BargeSizeCategory",
          "nullable": true,
          "boundProperty": "SizeCategory",
          "description": "Unbound column for editing barge size category"
        },
        {
          "key": "CoverTypeUnbound",
          "header": "Cover Type",
          "dataType": "String",
          "width": 100,
          "sortable": true,
          "filterable": false,
          "alignment": "Left",
          "editorType": "UltraCombo",
          "validationList": "CoverType",
          "nullable": true,
          "boundProperty": "CoverType",
          "description": "Unbound column for editing cover type. When changed, CoverSubTypeID is cleared.",
          "cascades": ["CoverSubTypeIDUnbound"]
        },
        {
          "key": "CoverSubTypeIDUnbound",
          "header": "Sub Type",
          "dataType": "String",
          "width": 100,
          "sortable": true,
          "filterable": false,
          "alignment": "Left",
          "editorType": "UltraCombo",
          "validationList": "CoverSubType",
          "nullable": true,
          "boundProperty": "CoverSubTypeID",
          "description": "Unbound column for editing cover sub-type. Dynamically populated based on CoverType selection.",
          "dependsOn": "CoverTypeUnbound"
        },
        {
          "key": "IsCharteredInUnbound",
          "header": "Chartered-In",
          "dataType": "Boolean",
          "width": 100,
          "sortable": true,
          "filterable": false,
          "alignment": "Center",
          "editorType": "Checkbox",
          "nullable": false,
          "boundProperty": "IsCharteredIn",
          "description": "Unbound column for editing chartered-in flag"
        },
        {
          "key": "DailyExpenseUnbound",
          "header": "Daily Expense",
          "dataType": "Decimal",
          "width": 100,
          "sortable": true,
          "filterable": false,
          "alignment": "Right",
          "format": "Currency",
          "nullable": true,
          "boundProperty": "DailyExpense",
          "description": "Unbound column for editing daily expense amount. Validated as decimal.",
          "validation": ["Must be valid decimal"]
        }
      ],
      "hiddenColumns": [
        {
          "key": "SizeCategory",
          "description": "Bound property - hidden, data transferred from SizeCategoryUnbound"
        },
        {
          "key": "CoverType",
          "description": "Bound property - hidden, data transferred from CoverTypeUnbound"
        },
        {
          "key": "CoverSubTypeID",
          "description": "Bound property - hidden, data transferred from CoverSubTypeIDUnbound"
        },
        {
          "key": "IsCharteredIn",
          "description": "Bound property - hidden, data transferred from IsCharteredInUnbound"
        },
        {
          "key": "DailyExpense",
          "description": "Bound property - hidden, data transferred from DailyExpenseUnbound"
        }
      ],
      "gridSettings": {
        "allowUpdate": true,
        "cellClickAction": "EditAndSelectText",
        "selectTypeRow": "Single",
        "selectTypeCell": "Single",
        "rowSelectors": true,
        "autoFitStyle": "ExtendLastColumn",
        "tabNavigation": "NextControlOnLastCell",
        "invalidValueBehavior": "RetainValueAndFocus",
        "supportDataErrorInfo": "CellsOnly",
        "columnChooserEnabled": false,
        "initialSort": [
          {
            "column": "SizeCategory",
            "direction": "Ascending"
          }
        ]
      },
      "events": [
        "AfterEnterEditMode",
        "AfterExitEditMode",
        "BeforeExitEditMode",
        "CellChange",
        "CellDataError",
        "Enter",
        "InitializeLayout",
        "InitializeRow",
        "KeyDown"
      ]
    }
  ],
  "dropdowns": [
    {
      "name": "cboSizeCategory",
      "label": "Size Category",
      "type": "InGridCombo",
      "populationMethod": "Main.PopulateValidationListCombo",
      "validationType": "BargeSizeCategory",
      "valueField": "Value",
      "displayField": "Text",
      "allowBlank": true,
      "location": "Grid Cell Editor"
    },
    {
      "name": "cboCoverType",
      "label": "Cover Type",
      "type": "InGridCombo",
      "populationMethod": "Main.PopulateValidationListCombo + FormatCoverTypeCombo",
      "validationType": "CoverType",
      "valueField": "Value",
      "displayField": "Text",
      "allowBlank": true,
      "location": "Grid Cell Editor",
      "triggers": "UpdateCoverSubTypeCombo on change"
    },
    {
      "name": "cboCoverSubType",
      "label": "Cover Sub Type",
      "type": "InGridCombo",
      "populationMethod": "PopulateCoverSubTypeCombo (filtered by CoverType)",
      "validationType": "CoverSubType",
      "valueField": "Value",
      "displayField": "Text",
      "allowBlank": true,
      "location": "Grid Cell Editor",
      "dynamicFilter": "Based on selected CoverType"
    }
  ],
  "buttons": [
    {
      "name": "btnSubmit",
      "text": "&Submit",
      "type": "Submit",
      "enabled": true,
      "visible": true,
      "handler": "btnSubmit_Click",
      "location": "grpSubmitCancel",
      "purpose": "Submit parent object changes and close form"
    },
    {
      "name": "btnCancel",
      "text": "&Cancel",
      "type": "Cancel",
      "enabled": true,
      "visible": true,
      "handler": "btnCancel_Click",
      "location": "grpSubmitCancel",
      "purpose": "Cancel parent object changes and close form"
    },
    {
      "name": "btnAdd",
      "text": "&Add",
      "type": "Add",
      "enabled": "Based on security",
      "visible": true,
      "handler": "ToolbarsManager_ToolClick",
      "location": "ChildEditToolbar",
      "purpose": "Add new BargeDailyExpense to collection"
    },
    {
      "name": "btnRemove",
      "text": "&Remove",
      "type": "Remove",
      "enabled": "Based on security and row selection",
      "visible": true,
      "handler": "ToolbarsManager_ToolClick",
      "location": "ChildEditToolbar",
      "purpose": "Remove selected BargeDailyExpense from collection"
    }
  ],
  "panels": [
    {
      "name": "pnlBargeDailyExpenseDetail",
      "type": "UltraPanel",
      "dockStyle": "Fill",
      "description": "Main container panel",
      "controls": [
        "pnlDetailEdit",
        "grpDetailEditList",
        "grpSubmitCancel",
        "staStatus"
      ]
    },
    {
      "name": "pnlDetailEdit",
      "type": "UltraPanel",
      "dockStyle": "Top",
      "description": "Panel containing parent object controls (effective date)",
      "controls": [
        "lblEffectiveDate",
        "dtEffectiveDate"
      ]
    },
    {
      "name": "grpDetailEditList",
      "type": "UltraGroupBox",
      "text": "Daily Expenses",
      "dockStyle": "Fill",
      "description": "Group box containing child collection grid and toolbar",
      "controls": [
        "pnlDetailEditList"
      ]
    },
    {
      "name": "pnlDetailEditList",
      "type": "UltraPanel",
      "dockStyle": "Fill",
      "description": "Panel containing grid and toolbar dock areas",
      "controls": [
        "grdBargeDailyExpenses",
        "ToolbarsManager"
      ]
    },
    {
      "name": "grpSubmitCancel",
      "type": "UltraGroupBox",
      "dockStyle": "Bottom",
      "description": "Group box containing Submit and Cancel buttons",
      "controls": [
        "btnSubmit",
        "btnCancel"
      ]
    }
  ],
  "validation": {
    "extender": "ValidatorExtender",
    "displayControl": "staStatus",
    "methods": [
      {
        "name": "SetValidatorExtenderForBargeDailyExpenseDate",
        "purpose": "Configure validator for parent object controls"
      }
    ],
    "cellValidation": [
      {
        "column": "DailyExpenseUnbound",
        "rule": "Must be valid decimal",
        "handler": "BeforeExitEditMode",
        "message": "Invalid data type. Expecting: Decimal"
      }
    ],
    "businessRules": [
      {
        "rule": "Dollar signs are removed from currency input",
        "location": "BeforeExitEditMode"
      },
      {
        "rule": "Empty values allowed for nullable fields",
        "location": "AfterExitEditMode"
      }
    ]
  },
  "eventHandlers": {
    "frmDetailEdit_Load": "Initializes form: formats controls, loads parent data, refreshes grid",
    "frmDetailEdit_FormClosed": "Saves grid settings to user preferences",
    "btnSubmit_Click": "Calls SubmitNoRefreshClick to save and close",
    "btnCancel_Click": "Calls CancelClick to discard changes and close",
    "ToolbarsManager_ToolClick": "Handles Add and Remove toolbar button clicks",
    "grdBargeDailyExpenses_AfterEnterEditMode": "Clears row selection when entering edit mode, enables/disables controls",
    "grdBargeDailyExpenses_AfterExitEditMode": "Transfers data from unbound columns to business object properties",
    "grdBargeDailyExpenses_BeforeExitEditMode": "Validates cell data (e.g., decimal format), prevents exit if invalid",
    "grdBargeDailyExpenses_CellChange": "Handles cascading updates (e.g., clears SubType when CoverType changes)",
    "grdBargeDailyExpenses_CellDataError": "Suppresses Infragistics error dialog, keeps focus on invalid cell",
    "grdBargeDailyExpenses_Enter": "Activates first cell in edit mode when tabbing into grid",
    "grdBargeDailyExpenses_InitializeLayout": "Adds unbound columns to grid layout",
    "grdBargeDailyExpenses_InitializeRow": "Assigns combo editors to cells, transfers bound to unbound data",
    "grdBargeDailyExpenses_KeyDown": "Custom arrow key navigation between cells",
    "dtEffectiveDate_Validated": "Updates business object with effective date value"
  },
  "methods": {
    "FormatControls": "Configures grid settings, validator, and initial sort order",
    "FormatGridColumns": "Defines visible grid columns with headers, widths, and alignment",
    "FormatGridCustomComparers": "Sets custom numeric sorter for DailyExpense column",
    "ItemAdd": "Creates new BargeDailyExpense and adds to collection",
    "ItemRemove": "Removes selected BargeDailyExpense after confirmation dialog",
    "EnableDisableControls": "Updates toolbar button states based on selection and security",
    "RefreshList": "Refreshes grid with current collection data",
    "SetToolState": "Enables/disables toolbar buttons based on selection and security",
    "TransferBoundToUnbound": "Copies data from hidden bound columns to visible unbound columns",
    "TransferCoverSubTypeID": "Copies CoverSubTypeID from bound to unbound column",
    "UpdateCoverSubTypeCombo": "Populates CoverSubType combo filtered by selected CoverType",
    "AssignEditorControlsToRow": "Assigns combo editors to grid cells for a row",
    "LoadControlsForBargeDailyExpenseDate": "Loads parent object data into form controls"
  },
  "constants": {
    "c_BtnKeyAdd": "Add",
    "c_BtnKeyRemove": "Remove",
    "c_CellKeySizeCategory": "SizeCategory",
    "c_CellKeyCoverType": "CoverType",
    "c_CellKeyCoverSubTypeID": "CoverSubTypeID",
    "c_CellKeyIsCharteredIn": "IsCharteredIn",
    "c_CellKeyDailyExpense": "DailyExpense",
    "c_CellKeySizeCategoryUnbound": "SizeCategoryUnbound",
    "c_CellKeyCoverTypeUnbound": "CoverTypeUnbound",
    "c_CellKeyCoverSubTypeIDUnbound": "CoverSubTypeIDUnbound",
    "c_CellKeyIsCharteredInUnbound": "IsCharteredInUnbound",
    "c_CellKeyDailyExpenseUnbound": "DailyExpenseUnbound"
  },
  "specialFeatures": {
    "inGridEditing": {
      "enabled": true,
      "description": "All child object editing happens directly in grid cells. No separate detail form or Set/Cancel buttons for child objects.",
      "unboundColumnPattern": "Visible unbound columns are used for editing. Data is transferred to/from hidden bound columns that represent business object properties.",
      "immediateUpdate": "Business objects are updated immediately when exiting cell edit mode (after validation)"
    },
    "cascadingDropdowns": {
      "enabled": true,
      "description": "CoverSubType dropdown is filtered based on CoverType selection. Changing CoverType clears CoverSubType.",
      "implementation": "UpdateCoverSubTypeCombo method dynamically populates combo when CoverType changes"
    },
    "customKeyboardNavigation": {
      "enabled": true,
      "description": "Arrow keys navigate between cells in edit mode",
      "arrows": ["Left", "Right", "Up", "Down"],
      "implementation": "grdBargeDailyExpenses_KeyDown event"
    },
    "autoEnterEditMode": {
      "enabled": true,
      "description": "First cell automatically enters edit mode when tabbing into grid",
      "implementation": "grdBargeDailyExpenses_Enter event"
    }
  },
  "modernizationNotes": {
    "uiPattern": "Convert to ASP.NET Core MVC with inline grid editing using DataTables Editor or similar jQuery plugin",
    "dateControl": "dtEffectiveDate should use HTML5 date input (date only, no time component)",
    "gridEditing": "Implement with DataTables Editor for inline editing or custom row editing with validation",
    "dropdowns": "Use Select2 for all dropdowns with cascading logic for CoverType/CoverSubType",
    "validation": "Implement client-side validation with jQuery Validation and server-side validation in controller",
    "security": "Apply authorization attributes to controller actions and conditional UI rendering based on user permissions",
    "gridColumns": "All unbound columns should become standard DataTables columns with editor configuration",
    "toolbarButtons": "Convert to Bootstrap buttons with security-based visibility/disabled state",
    "dataFlow": "Parent object (EffectiveDate) posted with collection of child objects (BargeDailyExpenses) to single controller action"
  }
}
