{
  "entity": "River",
  "legacy": {
    "searchForm": "frmRiverSearch",
    "detailForm": "frmRiverDetail",
    "subsystem": "frmRiverSearch",
    "description": "River/Waterway master data management for tracking waterways, mile markers, and directional labels",
    "securityButtons": [
      {
        "form": "frmRiverSearch",
        "button": "btnFind",
        "type": "Open",
        "legacyPermission": "CanView",
        "description": "Search/filter river list",
        "line": 105
      },
      {
        "form": "frmRiverDetail",
        "button": "btnSubmit",
        "type": "Submit",
        "legacyPermission": "CanModify",
        "description": "Save river changes",
        "line": 35
      },
      {
        "form": "frmRiverDetail",
        "button": "btnCancel",
        "type": "Cancel",
        "legacyPermission": "None",
        "description": "Cancel river edit",
        "line": 36
      }
    ],
    "authorizationPattern": {
      "searchMethod": "InitializeBase(SubSystem.frmRiverSearch)",
      "detailMethod": "InitializeBase(businessObject, SubSystem.frmRiverSearch)",
      "searchLocation": "frmRiverSearch.vb line 35",
      "detailLocation": "frmRiverDetail.vb line 25",
      "description": "Uses CSG Windows Forms Security framework with ButtonType enumeration"
    },
    "crudOperations": {
      "create": {
        "method": "ItemAdd",
        "location": "frmRiverSearch.vb lines 39-45",
        "businessLogic": "BusinessLogic.River.NewRiver",
        "requiredPermission": "CanCreate"
      },
      "read": {
        "method": "RefreshList",
        "location": "frmRiverSearch.vb lines 86-96",
        "businessLogic": "BusinessLogic.Lists.RiverSearch.GetList",
        "requiredPermission": "CanView"
      },
      "update": {
        "method": "ItemModify",
        "location": "frmRiverSearch.vb lines 48-54",
        "businessLogic": "BusinessLogic.River.GetRiver(GridControlIndex)",
        "requiredPermission": "CanModify"
      },
      "delete": {
        "method": "ItemRemove",
        "location": "frmRiverSearch.vb lines 57-65",
        "businessLogic": "BusinessLogic.River.DeleteRiver(Me.GridControlIndex)",
        "requiredPermission": "CanDelete",
        "confirmation": "Main.ItemRemoveDialog(\"River\")"
      }
    }
  },
  "modern": {
    "api": {
      "authentication": "ApiKey",
      "attributePattern": "[ApiKey]",
      "description": "API endpoints require API Key authentication configured in appsettings.json",
      "endpoints": [
        {
          "method": "GET",
          "route": "api/river",
          "action": "GetList",
          "requiredAuth": "ApiKey",
          "futurePermission": "RiverView",
          "description": "Retrieve filtered river list"
        },
        {
          "method": "GET",
          "route": "api/river/{id}",
          "action": "GetRiver",
          "requiredAuth": "ApiKey",
          "futurePermission": "RiverView",
          "description": "Retrieve specific river details"
        },
        {
          "method": "POST",
          "route": "api/river",
          "action": "CreateRiver",
          "requiredAuth": "ApiKey",
          "futurePermission": "RiverModify",
          "description": "Create new river/waterway"
        },
        {
          "method": "PUT",
          "route": "api/river/{id}",
          "action": "UpdateRiver",
          "requiredAuth": "ApiKey",
          "futurePermission": "RiverModify",
          "description": "Update existing river/waterway"
        },
        {
          "method": "DELETE",
          "route": "api/river/{id}",
          "action": "DeleteRiver",
          "requiredAuth": "ApiKey",
          "futurePermission": "RiverModify",
          "description": "Delete river/waterway (soft delete via IsActive flag)"
        }
      ]
    },
    "ui": {
      "authentication": "OIDC",
      "developmentAuth": "DevelopmentAutoSignInMiddleware",
      "attributePattern": "[Authorize]",
      "description": "UI uses OIDC (Azure AD) in production, DevelopmentAutoSignInMiddleware in development",
      "permissions": [
        {
          "name": "RiverView",
          "enumValue": "AuthPermissions.RiverView",
          "description": "View rivers and waterways",
          "granularity": "ReadOnly",
          "requiredFor": [
            "Index",
            "Search",
            "Details"
          ],
          "uiElements": [
            "View river list grid",
            "Search/filter rivers",
            "View river details"
          ]
        },
        {
          "name": "RiverModify",
          "enumValue": "AuthPermissions.RiverModify",
          "description": "Create, update, and delete rivers and waterways",
          "granularity": "Modify",
          "requiredFor": [
            "Create",
            "Edit",
            "Delete"
          ],
          "uiElements": [
            "New button (main form toolbar)",
            "Modify button (main form toolbar)",
            "Remove button (main form toolbar)",
            "Submit button (detail form)",
            "All edit form fields"
          ]
        }
      ],
      "buttonSecurity": [
        {
          "button": "Find",
          "requiredPermission": "RiverView",
          "visibilityCondition": "Always visible to users with RiverView",
          "enabledCondition": "Always enabled"
        },
        {
          "button": "New (toolbar)",
          "requiredPermission": "RiverModify",
          "visibilityCondition": "User has RiverModify permission",
          "enabledCondition": "Always enabled when visible"
        },
        {
          "button": "Modify (toolbar)",
          "requiredPermission": "RiverModify",
          "visibilityCondition": "User has RiverModify permission",
          "enabledCondition": "Row selected in grid"
        },
        {
          "button": "Remove (toolbar)",
          "requiredPermission": "RiverModify",
          "visibilityCondition": "User has RiverModify permission",
          "enabledCondition": "Row selected in grid"
        },
        {
          "button": "Submit",
          "requiredPermission": "RiverModify",
          "visibilityCondition": "User has RiverModify permission",
          "enabledCondition": "Form validation passes"
        },
        {
          "button": "Cancel",
          "requiredPermission": "None",
          "visibilityCondition": "Always visible",
          "enabledCondition": "Always enabled"
        }
      ]
    },
    "permissionEnum": {
      "file": "Enums/AuthPermissions.cs",
      "entries": [
        {
          "name": "RiverView",
          "description": "View rivers and waterways"
        },
        {
          "name": "RiverModify",
          "description": "Create, update, and delete rivers and waterways"
        }
      ]
    },
    "implementation": {
      "apiController": {
        "name": "RiverController",
        "baseClass": "ApiControllerBase",
        "attributes": [
          "[ApiController]",
          "[ApiKey]"
        ],
        "route": "api/river"
      },
      "uiSearchController": {
        "name": "RiverSearchController",
        "baseClass": "AppController",
        "attributes": [
          "[Authorize]"
        ],
        "actions": [
          {
            "name": "Index",
            "attributes": [
              "[Authorize(Policy = \"RiverView\")]"
            ]
          }
        ]
      },
      "uiDetailController": {
        "name": "RiverController",
        "baseClass": "AppController",
        "attributes": [
          "[Authorize]"
        ],
        "actions": [
          {
            "name": "Details",
            "attributes": [
              "[Authorize(Policy = \"RiverView\")]"
            ]
          },
          {
            "name": "Create",
            "attributes": [
              "[Authorize(Policy = \"RiverModify\")]"
            ]
          },
          {
            "name": "Edit",
            "attributes": [
              "[Authorize(Policy = \"RiverModify\")]"
            ]
          },
          {
            "name": "Delete",
            "attributes": [
              "[Authorize(Policy = \"RiverModify\")]"
            ]
          }
        ]
      }
    }
  },
  "businessRules": {
    "fields": [
      {
        "field": "Code",
        "required": true,
        "maxLength": "MaxLength.Code",
        "validation": "Must be exactly MaxLength.Code characters long (custom regex)",
        "validationType": "ValidationTypeConstants.Custom",
        "description": "River abbreviation code",
        "line": 335
      },
      {
        "field": "Name",
        "required": true,
        "maxLength": "MaxLength.Name",
        "validation": "String",
        "validationType": "ValidationTypeConstants.String",
        "description": "River/Waterway name",
        "line": 328
      },
      {
        "field": "BargeExCode",
        "required": false,
        "maxLength": "MaxLength.BargeExCode",
        "validation": "String",
        "validationType": "ValidationTypeConstants.String",
        "description": "BargeEx trading partner code",
        "line": 329
      },
      {
        "field": "StartMile",
        "required": false,
        "validation": "Decimal",
        "validationType": "ValidationTypeConstants.Decimal",
        "description": "Starting mile marker",
        "line": 330
      },
      {
        "field": "EndMile",
        "required": false,
        "validation": "Decimal",
        "validationType": "ValidationTypeConstants.Decimal",
        "description": "Ending mile marker",
        "line": 331
      },
      {
        "field": "IsLowToHighDirection",
        "required": false,
        "validation": "Boolean",
        "description": "Direction flag: low to high mile markers",
        "line": 236
      },
      {
        "field": "IsActive",
        "required": false,
        "validation": "Boolean",
        "description": "Active status flag",
        "line": 256
      },
      {
        "field": "UpLabel",
        "required": false,
        "maxLength": "MaxLength.UpLabel",
        "validation": "String",
        "validationType": "ValidationTypeConstants.String",
        "description": "Upstream direction label",
        "line": 337
      },
      {
        "field": "DownLabel",
        "required": false,
        "maxLength": "MaxLength.DownLabel",
        "validation": "String",
        "validationType": "ValidationTypeConstants.String",
        "description": "Downstream direction label",
        "line": 338
      }
    ],
    "searchFilters": [
      {
        "field": "Name",
        "type": "string",
        "description": "Filter by river/waterway name (partial match)",
        "line": 94
      },
      {
        "field": "Code",
        "type": "string",
        "description": "Filter by river code (partial match)",
        "line": 95
      },
      {
        "field": "IsActive",
        "type": "boolean",
        "description": "Filter by active status",
        "line": 95
      }
    ],
    "gridColumns": [
      {
        "field": "Code",
        "header": "Code",
        "width": 56,
        "align": "Left",
        "line": 190
      },
      {
        "field": "Name",
        "header": "River/Waterway",
        "width": 234,
        "align": "Left",
        "line": 191
      },
      {
        "field": "StartMile",
        "header": "Start Mile",
        "width": 72,
        "align": "Right",
        "sortComparer": "NumericSortComparer",
        "line": 192
      },
      {
        "field": "EndMile",
        "header": "End Mile",
        "width": 72,
        "align": "Right",
        "sortComparer": "NumericSortComparer",
        "line": 193
      },
      {
        "field": "IsLowToHighDirection",
        "header": "Low to High",
        "width": 100,
        "align": "Center",
        "line": 194
      },
      {
        "field": "IsActive",
        "header": "Active",
        "width": 72,
        "align": "Center",
        "line": 195
      },
      {
        "field": "UpLabel",
        "header": "Upstream",
        "width": 120,
        "align": "Left",
        "line": 196
      },
      {
        "field": "DownLabel",
        "header": "Downstream",
        "width": 120,
        "align": "Left",
        "line": 197
      }
    ],
    "defaultSort": {
      "field": "Code",
      "direction": "Ascending",
      "line": 227
    }
  },
  "notes": [
    "River is a master data entity with no child entities or tabs",
    "Uses SubSystem.frmRiverSearch for security context in both search and detail forms",
    "Delete operation is soft delete via IsActive flag",
    "Code field has custom validation requiring exact character length",
    "Grid uses custom NumericSortComparer for StartMile and EndMile columns",
    "Search form implements IBaseSearch interface from CSG framework",
    "Detail form implements IBaseDetailEdit interface from CSG framework",
    "No special licensing requirements identified",
    "Form supports grid settings persistence via MyAppSettingHelper",
    "Delete requires user confirmation via Main.ItemRemoveDialog"
  ]
}
