{
  "entity": "River",
  "softDelete": true,
  "hasIsActive": true,
  "legacyAnalysis": {
    "businessObject": "River.vb / RiverBase.vb",
    "searchClass": "RiverSearch.vb",
    "listClass": "RiverList.vb",
    "primaryKey": "RiverID",
    "tableName": "River (implied)"
  },
  "storedProcedures": [
    {
      "name": "RiverSelect",
      "operation": "GetById",
      "targetSqlFile": "River_GetById.sql",
      "description": "Fetch single river record by ID",
      "parameters": [
        {
          "name": "@RiverID",
          "type": "int",
          "dbType": "SqlDbType.Int",
          "required": true,
          "source": "RiverBase.vb:544"
        }
      ],
      "resultColumns": [
        {
          "column": "RiverID",
          "property": "RiverID",
          "type": "int",
          "nullable": false,
          "source": "RiverBase.vb:670"
        },
        {
          "column": "Name",
          "property": "Name",
          "type": "string",
          "maxLength": 40,
          "nullable": false,
          "source": "RiverBase.vb:671"
        },
        {
          "column": "Code",
          "property": "Code",
          "type": "string",
          "maxLength": 3,
          "nullable": false,
          "source": "RiverBase.vb:672"
        },
        {
          "column": "BargeExCode",
          "property": "BargeExCode",
          "type": "string",
          "maxLength": 10,
          "nullable": true,
          "source": "RiverBase.vb:673"
        },
        {
          "column": "StartMile",
          "property": "StartMile",
          "type": "decimal",
          "format": "TwoDecimalPlaces",
          "nullable": true,
          "source": "RiverBase.vb:674"
        },
        {
          "column": "EndMile",
          "property": "EndMile",
          "type": "decimal",
          "format": "TwoDecimalPlaces",
          "nullable": true,
          "source": "RiverBase.vb:675"
        },
        {
          "column": "IsLowToHighDirection",
          "property": "IsLowToHighDirection",
          "type": "bool",
          "nullable": false,
          "defaultValue": true,
          "source": "RiverBase.vb:676"
        },
        {
          "column": "IsActive",
          "property": "IsActive",
          "type": "bool",
          "nullable": false,
          "defaultValue": true,
          "source": "RiverBase.vb:677"
        },
        {
          "column": "UpLabel",
          "property": "UpLabel",
          "type": "string",
          "maxLength": 20,
          "nullable": false,
          "source": "RiverBase.vb:678"
        },
        {
          "column": "DownLabel",
          "property": "DownLabel",
          "type": "string",
          "maxLength": 20,
          "nullable": false,
          "source": "RiverBase.vb:679"
        }
      ]
    },
    {
      "name": "RiversSelect",
      "operation": "GetAll",
      "targetSqlFile": "River_GetAll.sql",
      "description": "Fetch all river records",
      "parameters": [],
      "notes": "Referenced in RiverBase.vb:338 as p_SqlFetchAll"
    },
    {
      "name": "RiverSearch",
      "operation": "Search",
      "targetSqlFile": "River_Search.sql",
      "description": "Search rivers with filters and pagination",
      "parameters": [
        {
          "name": "@Name",
          "type": "string",
          "dbType": "SqlDbType.VarChar",
          "required": false,
          "source": "RiverSearch.vb:69"
        },
        {
          "name": "@Code",
          "type": "string",
          "dbType": "SqlDbType.VarChar",
          "required": false,
          "source": "RiverSearch.vb:70"
        },
        {
          "name": "@ActiveOnly",
          "type": "bool",
          "dbType": "SqlDbType.Bit",
          "required": true,
          "source": "RiverSearch.vb:71"
        }
      ],
      "resultColumns": [
        {
          "column": "RiverID",
          "property": "RiverID",
          "type": "int",
          "source": "RiverSearch.vb:93"
        },
        {
          "column": "Name",
          "property": "Name",
          "type": "string",
          "source": "RiverSearch.vb:94"
        },
        {
          "column": "Code",
          "property": "Code",
          "type": "string",
          "source": "RiverSearch.vb:95"
        },
        {
          "column": "StartMile",
          "property": "StartMile",
          "type": "decimal",
          "format": "TwoDecimalPlaces",
          "notes": "NULL values appear as empty strings",
          "source": "RiverSearch.vb:98-103"
        },
        {
          "column": "EndMile",
          "property": "EndMile",
          "type": "decimal",
          "format": "TwoDecimalPlaces",
          "notes": "NULL values appear as empty strings",
          "source": "RiverSearch.vb:104-109"
        },
        {
          "column": "IsLowToHighDirection",
          "property": "IsLowToHighDirection",
          "type": "bool",
          "source": "RiverSearch.vb:110"
        },
        {
          "column": "IsActive",
          "property": "IsActive",
          "type": "bool",
          "source": "RiverSearch.vb:111"
        },
        {
          "column": "UpLabel",
          "property": "UpLabel",
          "type": "string",
          "source": "RiverSearch.vb:112"
        },
        {
          "column": "DownLabel",
          "property": "DownLabel",
          "type": "string",
          "source": "RiverSearch.vb:113"
        }
      ]
    },
    {
      "name": "RiverList",
      "operation": "List",
      "targetSqlFile": "River_List.sql",
      "description": "Get active rivers for dropdown lists (cached)",
      "parameters": [],
      "resultColumns": [
        {
          "column": "RiverID",
          "property": "RiverID",
          "type": "int",
          "source": "RiverList.vb:108"
        },
        {
          "column": "Name",
          "property": "Name",
          "type": "string",
          "source": "RiverList.vb:109"
        },
        {
          "column": "Code",
          "property": "Code",
          "type": "string",
          "source": "RiverList.vb:110"
        },
        {
          "column": "BargeExCode",
          "property": "BargeExCode",
          "type": "string",
          "source": "RiverList.vb:111"
        },
        {
          "column": "StartMile",
          "property": "StartMile",
          "type": "string",
          "source": "RiverList.vb:112"
        },
        {
          "column": "EndMile",
          "property": "EndMile",
          "type": "string",
          "source": "RiverList.vb:113"
        },
        {
          "column": "IsLowToHighDirection",
          "property": "IsLowToHighDirection",
          "type": "bool",
          "source": "RiverList.vb:114"
        },
        {
          "column": "IsActive",
          "property": "IsActive",
          "type": "bool",
          "source": "RiverList.vb:115"
        }
      ],
      "notes": "DisplayMember='Code', ValueMember='Code' (RiverList.vb:75-76)"
    },
    {
      "name": "RiverInsert",
      "operation": "Insert",
      "targetSqlFile": "River_Insert.sql",
      "description": "Create new river record",
      "parameters": [
        {
          "name": "@RiverID",
          "type": "int",
          "dbType": "SqlDbType.Int",
          "direction": "InputOutput",
          "required": true,
          "source": "RiverBase.vb:553-554"
        },
        {
          "name": "@Name",
          "type": "string",
          "dbType": "SqlDbType.VarChar",
          "maxLength": 40,
          "required": true,
          "source": "RiverBase.vb:567"
        },
        {
          "name": "@Code",
          "type": "string",
          "dbType": "SqlDbType.Char",
          "maxLength": 3,
          "required": true,
          "source": "RiverBase.vb:568"
        },
        {
          "name": "@BargeExCode",
          "type": "string",
          "dbType": "SqlDbType.VarChar",
          "maxLength": 10,
          "required": false,
          "source": "RiverBase.vb:569"
        },
        {
          "name": "@StartMile",
          "type": "decimal",
          "dbType": "SqlDbType.Decimal",
          "required": false,
          "source": "RiverBase.vb:570"
        },
        {
          "name": "@EndMile",
          "type": "decimal",
          "dbType": "SqlDbType.Decimal",
          "required": false,
          "source": "RiverBase.vb:571"
        },
        {
          "name": "@IsLowToHighDirection",
          "type": "bool",
          "dbType": "SqlDbType.Bit",
          "required": true,
          "defaultValue": true,
          "source": "RiverBase.vb:572"
        },
        {
          "name": "@IsActive",
          "type": "bool",
          "dbType": "SqlDbType.Bit",
          "required": true,
          "defaultValue": true,
          "source": "RiverBase.vb:573"
        },
        {
          "name": "@UpLabel",
          "type": "string",
          "dbType": "SqlDbType.VarChar",
          "maxLength": 20,
          "required": true,
          "source": "RiverBase.vb:574"
        },
        {
          "name": "@DownLabel",
          "type": "string",
          "dbType": "SqlDbType.VarChar",
          "maxLength": 20,
          "required": true,
          "source": "RiverBase.vb:575"
        }
      ],
      "outputParameters": [
        {
          "name": "@RiverID",
          "type": "int",
          "description": "Returns the newly created RiverID",
          "source": "RiverBase.vb:638-639"
        }
      ]
    },
    {
      "name": "RiverUpdate",
      "operation": "Update",
      "targetSqlFile": "River_Update.sql",
      "description": "Update existing river record",
      "parameters": [
        {
          "name": "@RiverID",
          "type": "int",
          "dbType": "SqlDbType.Int",
          "required": true,
          "source": "RiverBase.vb:584"
        },
        {
          "name": "@Name",
          "type": "string",
          "dbType": "SqlDbType.VarChar",
          "maxLength": 40,
          "required": true,
          "source": "RiverBase.vb:597"
        },
        {
          "name": "@Code",
          "type": "string",
          "dbType": "SqlDbType.Char",
          "maxLength": 3,
          "required": true,
          "source": "RiverBase.vb:598"
        },
        {
          "name": "@BargeExCode",
          "type": "string",
          "dbType": "SqlDbType.VarChar",
          "maxLength": 10,
          "required": false,
          "source": "RiverBase.vb:599"
        },
        {
          "name": "@StartMile",
          "type": "decimal",
          "dbType": "SqlDbType.Decimal",
          "required": false,
          "source": "RiverBase.vb:600"
        },
        {
          "name": "@EndMile",
          "type": "decimal",
          "dbType": "SqlDbType.Decimal",
          "required": false,
          "source": "RiverBase.vb:601"
        },
        {
          "name": "@IsLowToHighDirection",
          "type": "bool",
          "dbType": "SqlDbType.Bit",
          "required": true,
          "source": "RiverBase.vb:602"
        },
        {
          "name": "@IsActive",
          "type": "bool",
          "dbType": "SqlDbType.Bit",
          "required": true,
          "source": "RiverBase.vb:603"
        },
        {
          "name": "@UpLabel",
          "type": "string",
          "dbType": "SqlDbType.VarChar",
          "maxLength": 20,
          "required": true,
          "source": "RiverBase.vb:604"
        },
        {
          "name": "@DownLabel",
          "type": "string",
          "dbType": "SqlDbType.VarChar",
          "maxLength": 20,
          "required": true,
          "source": "RiverBase.vb:605"
        }
      ],
      "notes": "Also updates audit fields: ModifyDateTime, ModifyUser (handled by base class)"
    },
    {
      "name": "RiverDelete",
      "operation": "SetActive",
      "targetSqlFile": "River_SetActive.sql",
      "description": "Soft delete river (set IsActive = false)",
      "parameters": [
        {
          "name": "@RiverID",
          "type": "int",
          "dbType": "SqlDbType.Int",
          "required": true,
          "source": "RiverBase.vb:625"
        },
        {
          "name": "@IsActive",
          "type": "bool",
          "dbType": "SqlDbType.Bit",
          "required": true,
          "notes": "IMPORTANT: Convert from hard delete to soft delete pattern"
        }
      ],
      "notes": "CRITICAL: Legacy uses RiverDelete SP but entity has IsActive property. Modern implementation MUST use soft delete pattern with SetActive operation."
    }
  ],
  "sqlFiles": [
    {
      "fileName": "River_GetById.sql",
      "operation": "GetById",
      "description": "Fetch single river record by ID",
      "embedded": true,
      "namespace": "Admin.Infrastructure.DataAccess.Sql"
    },
    {
      "fileName": "River_GetAll.sql",
      "operation": "GetAll",
      "description": "Fetch all river records",
      "embedded": true,
      "namespace": "Admin.Infrastructure.DataAccess.Sql"
    },
    {
      "fileName": "River_Search.sql",
      "operation": "Search",
      "description": "Search rivers with ListQuery filters and pagination",
      "embedded": true,
      "namespace": "Admin.Infrastructure.DataAccess.Sql"
    },
    {
      "fileName": "River_List.sql",
      "operation": "List",
      "description": "Get active rivers for dropdown lists (cached)",
      "embedded": true,
      "namespace": "Admin.Infrastructure.DataAccess.Sql"
    },
    {
      "fileName": "River_Insert.sql",
      "operation": "Insert",
      "description": "Create new river record with output RiverID",
      "embedded": true,
      "namespace": "Admin.Infrastructure.DataAccess.Sql"
    },
    {
      "fileName": "River_Update.sql",
      "operation": "Update",
      "description": "Update existing river record",
      "embedded": true,
      "namespace": "Admin.Infrastructure.DataAccess.Sql"
    },
    {
      "fileName": "River_SetActive.sql",
      "operation": "SetActive",
      "description": "Soft delete river (set IsActive = false or true)",
      "embedded": true,
      "namespace": "Admin.Infrastructure.DataAccess.Sql",
      "notes": "CRITICAL: DO NOT create River_Delete.sql - use soft delete pattern"
    }
  ],
  "dataTransformations": [
    {
      "field": "StartMile",
      "transformation": "Decimal formatting with 2 decimal places",
      "format": "FmtTwoDecimalPlaces",
      "nullHandling": "Display as empty string",
      "source": "River.vb:55, RiverSearch.vb:98-103"
    },
    {
      "field": "EndMile",
      "transformation": "Decimal formatting with 2 decimal places",
      "format": "FmtTwoDecimalPlaces",
      "nullHandling": "Display as empty string",
      "source": "River.vb:76, RiverSearch.vb:104-109"
    },
    {
      "field": "Code",
      "transformation": "Exactly 3 characters required",
      "validation": "Must be 3 characters",
      "source": "River.vb:198-201"
    }
  ],
  "businessRules": [
    {
      "rule": "StartMile <= EndMile",
      "description": "Start Mile must be less than or equal to End Mile",
      "severity": "Error",
      "source": "River.vb:168-176"
    },
    {
      "rule": "StartMile >= 0",
      "description": "Start Mile must be greater than or equal to 0",
      "severity": "Error",
      "source": "River.vb:178-183"
    },
    {
      "rule": "StartMile <= 5000",
      "description": "Start Mile must be a reasonable number",
      "severity": "Error",
      "source": "River.vb:185-188"
    },
    {
      "rule": "EndMile <= 5000",
      "description": "End Mile must be a reasonable number",
      "severity": "Error",
      "source": "River.vb:190-195"
    },
    {
      "rule": "Code.Length = 3",
      "description": "Code must be exactly 3 characters",
      "severity": "Error",
      "source": "River.vb:198-201"
    },
    {
      "rule": "Name required",
      "description": "Name cannot be null or empty",
      "severity": "Error",
      "source": "RiverBase.vb:350-356"
    },
    {
      "rule": "Code required",
      "description": "Code cannot be null or empty",
      "severity": "Error",
      "source": "RiverBase.vb:358-364"
    },
    {
      "rule": "UpLabel required",
      "description": "UpLabel cannot be null or empty",
      "severity": "Error",
      "source": "RiverBase.vb:372-378"
    },
    {
      "rule": "DownLabel required",
      "description": "DownLabel cannot be null or empty",
      "severity": "Error",
      "source": "RiverBase.vb:380-386"
    }
  ],
  "repositoryInterface": {
    "name": "IRiverRepository",
    "namespace": "Admin.Infrastructure.Abstractions",
    "methods": [
      {
        "name": "GetByIdAsync",
        "returnType": "Task<River>",
        "parameters": [
          "int riverId"
        ],
        "description": "Get single river by ID"
      },
      {
        "name": "GetAllAsync",
        "returnType": "Task<IEnumerable<River>>",
        "parameters": [],
        "description": "Get all rivers"
      },
      {
        "name": "SearchAsync",
        "returnType": "Task<DataTableResponse<RiverListDto>>",
        "parameters": [
          "RiverSearchRequest request"
        ],
        "description": "Search rivers with filters"
      },
      {
        "name": "GetListAsync",
        "returnType": "Task<IEnumerable<RiverListItemDto>>",
        "parameters": [],
        "description": "Get active rivers for dropdown (cached)"
      },
      {
        "name": "CreateAsync",
        "returnType": "Task<int>",
        "parameters": [
          "River river"
        ],
        "description": "Create new river, returns RiverID"
      },
      {
        "name": "UpdateAsync",
        "returnType": "Task",
        "parameters": [
          "River river"
        ],
        "description": "Update existing river"
      },
      {
        "name": "SetActiveAsync",
        "returnType": "Task",
        "parameters": [
          "int riverId",
          "bool isActive"
        ],
        "description": "Soft delete/activate river (set IsActive)"
      }
    ]
  },
  "repositoryImplementation": {
    "name": "RiverRepository",
    "namespace": "Admin.Infrastructure.Repositories",
    "sqlTextPattern": "SqlText.GetSqlText(\"River_{Operation}\")",
    "connectionFactory": "IDbConnectionFactory",
    "notes": "All SQL queries loaded from embedded resources via SqlText.GetSqlText()"
  },
  "listQueryFields": {
    "filterable": [
      "Name",
      "Code",
      "IsActive"
    ],
    "sortable": [
      "RiverID",
      "Name",
      "Code",
      "StartMile",
      "EndMile",
      "IsActive"
    ],
    "defaultSort": "Code ASC",
    "searchParameters": {
      "Name": "string - partial match",
      "Code": "string - partial match",
      "ActiveOnly": "bool - filter by IsActive"
    }
  },
  "dtoMapping": {
    "primaryDto": {
      "name": "River",
      "namespace": "BargeOps.Shared.Dto",
      "properties": [
        {
          "name": "RiverID",
          "type": "int",
          "nullable": false
        },
        {
          "name": "Name",
          "type": "string",
          "maxLength": 40,
          "nullable": false
        },
        {
          "name": "Code",
          "type": "string",
          "maxLength": 3,
          "nullable": false
        },
        {
          "name": "BargeExCode",
          "type": "string",
          "maxLength": 10,
          "nullable": true
        },
        {
          "name": "StartMile",
          "type": "decimal?",
          "nullable": true,
          "format": "0.00"
        },
        {
          "name": "EndMile",
          "type": "decimal?",
          "nullable": true,
          "format": "0.00"
        },
        {
          "name": "IsLowToHighDirection",
          "type": "bool",
          "nullable": false
        },
        {
          "name": "IsActive",
          "type": "bool",
          "nullable": false
        },
        {
          "name": "UpLabel",
          "type": "string",
          "maxLength": 20,
          "nullable": false
        },
        {
          "name": "DownLabel",
          "type": "string",
          "maxLength": 20,
          "nullable": false
        }
      ]
    },
    "searchDto": {
      "name": "RiverListDto",
      "namespace": "BargeOps.Shared.Dto",
      "properties": [
        {
          "name": "RiverID",
          "type": "int"
        },
        {
          "name": "Name",
          "type": "string"
        },
        {
          "name": "Code",
          "type": "string"
        },
        {
          "name": "StartMile",
          "type": "string",
          "notes": "Formatted with 2 decimal places, NULL as empty string"
        },
        {
          "name": "EndMile",
          "type": "string",
          "notes": "Formatted with 2 decimal places, NULL as empty string"
        },
        {
          "name": "IsLowToHighDirection",
          "type": "bool"
        },
        {
          "name": "IsActive",
          "type": "bool"
        },
        {
          "name": "UpLabel",
          "type": "string"
        },
        {
          "name": "DownLabel",
          "type": "string"
        }
      ]
    },
    "listItemDto": {
      "name": "RiverListItemDto",
      "namespace": "BargeOps.Shared.Dto",
      "properties": [
        {
          "name": "RiverID",
          "type": "int"
        },
        {
          "name": "Code",
          "type": "string",
          "notes": "DisplayMember for dropdowns"
        },
        {
          "name": "Name",
          "type": "string"
        },
        {
          "name": "BargeExCode",
          "type": "string"
        },
        {
          "name": "StartMile",
          "type": "string"
        },
        {
          "name": "EndMile",
          "type": "string"
        },
        {
          "name": "IsLowToHighDirection",
          "type": "bool"
        },
        {
          "name": "IsActive",
          "type": "bool"
        }
      ]
    },
    "searchRequestDto": {
      "name": "RiverSearchRequest",
      "namespace": "BargeOps.Shared.Dto",
      "properties": [
        {
          "name": "Name",
          "type": "string?",
          "description": "Optional filter by name"
        },
        {
          "name": "Code",
          "type": "string?",
          "description": "Optional filter by code"
        },
        {
          "name": "ActiveOnly",
          "type": "bool",
          "defaultValue": true,
          "description": "Filter by IsActive"
        },
        {
          "name": "Start",
          "type": "int",
          "description": "Pagination start index"
        },
        {
          "name": "Length",
          "type": "int",
          "description": "Page size"
        },
        {
          "name": "Draw",
          "type": "int",
          "description": "DataTables draw counter"
        },
        {
          "name": "OrderColumn",
          "type": "string?",
          "description": "Column to sort by"
        },
        {
          "name": "OrderDirection",
          "type": "string",
          "defaultValue": "ASC",
          "description": "Sort direction"
        }
      ]
    }
  },
  "cacheStrategy": {
    "operation": "GetList",
    "cacheType": "Static in-memory cache",
    "refreshTriggers": [
      "After Insert",
      "After Update",
      "After Delete/SetActive"
    ],
    "implementation": "Lists.RiverList.GetList.MarkCacheDirty()",
    "source": "River.vb:99-100, 108-109, 119-120"
  },
  "childRelationships": [
    {
      "name": "Alert",
      "type": "Alert",
      "cardinality": "1:1",
      "loadStrategy": "Deferred",
      "source": "RiverBase.vb:272-288",
      "notes": "Alert child object loaded on demand"
    }
  ],
  "relatedEntities": [
    {
      "entity": "RiverArea",
      "relationship": "River -> RiverArea (1:Many)",
      "notes": "River has multiple areas"
    },
    {
      "entity": "RiverSegmentDraft",
      "relationship": "River -> RiverSegmentDraft (1:Many)",
      "notes": "River has segment drafts"
    },
    {
      "entity": "RiverConfluence",
      "relationship": "River -> RiverConfluence (1:Many)",
      "notes": "River has confluences"
    },
    {
      "entity": "FacilityLocation",
      "relationship": "River -> FacilityLocation (1:Many)",
      "notes": "Facilities located on rivers (via RiverID)"
    }
  ],
  "auditFields": {
    "enabled": true,
    "fields": [
      "RiverID",
      "Name",
      "Code",
      "BargeExCode",
      "StartMile",
      "EndMile",
      "IsLowToHighDirection",
      "IsActive",
      "UpLabel",
      "DownLabel"
    ],
    "implementation": "AuditFieldEvent collection",
    "source": "RiverBase.vb:750-793"
  },
  "modernizationNotes": {
    "criticalChanges": [
      "MUST use soft delete pattern (SetActive) instead of hard delete",
      "SQL queries MUST be stored in embedded .sql files",
      "Repository MUST use SqlText.GetSqlText() to load SQL",
      "DO NOT create River_Delete.sql file",
      "Mile formatting: Use decimal with 2 decimal places (0.00 format)",
      "NULL mile values display as empty strings in search results"
    ],
    "sqlFileLocation": "src/BargeOps.API/src/Admin.Infrastructure/DataAccess/Sql/",
    "dtoLocation": "src/BargeOps.Shared/BargeOps.Shared/Dto/",
    "repositoryLocation": "src/BargeOps.API/src/Admin.Infrastructure/Repositories/",
    "interfaceLocation": "src/BargeOps.API/src/Admin.Infrastructure/Abstractions/"
  }
}
