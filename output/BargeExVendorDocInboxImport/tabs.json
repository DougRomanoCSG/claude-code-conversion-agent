{
  "formName": "frmBargeExVendorDocInboxImport",
  "formTitle": "Import BargeEx Vendor Documents",
  "formType": "ImportProcessor",
  "hasTabControl": false,
  "description": "Import processor form for BargeEx vendor documents - processes selected vendor documents to create barge events and/or parts and service bills",
  "baseForm": "frmBaseDetailEdit",
  "mainPanel": {
    "name": "pnlDailyReports",
    "dockStyle": "Fill",
    "controls": [
      {
        "name": "lblInstructions",
        "type": "UltraLabel",
        "label": "Instructions",
        "text": "Selected vendor documents will be imported to create barge events and/or parts and service bills.",
        "location": "Top",
        "order": 1,
        "purpose": "Display import instructions to user"
      },
      {
        "name": "btnStart",
        "type": "UltraButton",
        "label": "Start",
        "text": "&Start",
        "location": "Top Right",
        "order": 2,
        "purpose": "Initiate the import process",
        "buttonType": "Action",
        "behavior": "Disabled after first click, triggers ProcessAll"
      },
      {
        "name": "btnCancel",
        "type": "UltraButton",
        "label": "Cancel/Close",
        "text": "&Close",
        "location": "Top Right",
        "order": 3,
        "purpose": "Cancel running process or close form",
        "buttonType": "Cancel",
        "behavior": "Text changes to '&Cancel' during run, back to '&Close' after completion"
      },
      {
        "name": "proProgress",
        "type": "UltraProgressBar",
        "label": "Progress Bar",
        "location": "Below buttons",
        "order": 4,
        "purpose": "Display progress of import operation",
        "behavior": "Maximum set to count of selected records"
      },
      {
        "name": "txtLog",
        "type": "UltraTextEditor",
        "label": "Log",
        "location": "Main content area",
        "order": 5,
        "purpose": "Display import processing log and results",
        "multiline": true,
        "readonly": true,
        "scrollbars": "Both",
        "anchor": "Top, Bottom, Left, Right"
      }
    ]
  },
  "sharedControls": {
    "location": "Top right of panel",
    "controls": [
      {
        "name": "btnStart",
        "type": "Button",
        "text": "&Start",
        "action": "Process all selected vendor documents"
      },
      {
        "name": "btnCancel",
        "type": "Button",
        "text": "&Close / &Cancel",
        "action": "Close form or cancel running process"
      }
    ]
  },
  "businessLogic": {
    "processTypes": [
      {
        "docType": "BargeStatus",
        "targetEntity": "BargeEvent",
        "method": "ProcessBargeStatus",
        "description": "Import BargeEx BargeStatus documents to create/update barge events on tickets",
        "supportedEventTypes": [
          "BreakTow",
          "Clean",
          "CoverHandling",
          "Fleeting",
          "MakeTow",
          "MidstreamIn",
          "MidstreamOut",
          "Pumping",
          "Shift"
        ]
      },
      {
        "docType": "BoatStatus",
        "targetEntity": "PartsServiceBillItem",
        "method": "ProcessBoatStatus",
        "description": "Import BargeEx BoatStatus documents to create/update parts and service bill items"
      }
    ],
    "importFeatures": [
      "Processes records in sort order: VendorName, BargeNum, OriginalControlNumber, RevisionNumber",
      "Supports both new transactions and revision/update transactions",
      "Updates existing events/bills when OriginalControlNumber differs from ControlNumber",
      "Removes successfully imported records from BargeExVendorDocumentInbox table",
      "Prevents updates to voided tickets/events",
      "Prevents adjustments to vendor bills in 'Final Bill' status",
      "Skips duplicate Fleeting events when GlobalSetting is enabled",
      "Sets Division to 'Outside Vendor' and assigns vendor from document",
      "Adds estimated cost to invoice notes when provided",
      "Updates all revision rows with new IDs after successful import",
      "Tracks open tickets and updates other events for same barge",
      "Does not auto-close tickets (MarkedForClose = False)"
    ]
  },
  "validation": {
    "extender": "ValidatorExtender",
    "rules": [
      "Start button disabled if no rows selected in dataset",
      "Barge must exist in database (BargeID required)",
      "Vendor must exist and be tied to SenderTradingPartnerNumber",
      "Event type must be valid for BargeStatus imports",
      "Cannot update voided tickets or ticket events",
      "Cannot adjust vendor bills in Final Bill status",
      "Additional Clean events require original Clean event to exist"
    ]
  },
  "initialization": {
    "parameters": [
      {
        "name": "subSys",
        "type": "SubSystem",
        "description": "SubSystem value associated with calling search form"
      },
      {
        "name": "selectedFleetID",
        "type": "Int32",
        "description": "Selected fleet ID for import operations"
      },
      {
        "name": "vendorDocInboxList",
        "type": "DataTable",
        "description": "Dataset containing all BargeExVendorDocumentInboxSearch results (not just selected rows)"
      }
    ]
  },
  "dataAccess": {
    "storedProcedures": [
      {
        "name": "BargeExVendorTicketEventSearch",
        "purpose": "Find existing ticket event by barge, vendor, and control number"
      },
      {
        "name": "BargeExVendorPSBillItemSearch",
        "purpose": "Find existing P&S bill item by vendor and control number"
      },
      {
        "name": "BargeExVendorFleetingEventSearch",
        "purpose": "Find existing fleeting event to detect duplicates"
      }
    ],
    "directAccess": [
      "BargeExVendorDocumentInbox.MultiDelete - Remove successfully imported records"
    ]
  },
  "modernImplementationNotes": {
    "uiPattern": "Single-panel progress form",
    "layout": "Bootstrap card with progress tracking",
    "components": [
      "Alert/Info box for instructions",
      "Bootstrap progress bar component",
      "Textarea with scrolling for log output",
      "Action buttons (Start, Cancel/Close)"
    ],
    "behavior": [
      "Real-time log updates during processing",
      "Progress bar updates per record",
      "Button state management (disable Start, toggle Cancel/Close)",
      "Allow user cancellation during processing"
    ],
    "apiEndpoints": [
      "POST /api/bargex-vendor-doc-inbox/import - Process import",
      "GET /api/bargex-vendor-doc-inbox/import/status/{id} - Check progress",
      "POST /api/bargex-vendor-doc-inbox/import/cancel/{id} - Cancel processing"
    ]
  }
}
