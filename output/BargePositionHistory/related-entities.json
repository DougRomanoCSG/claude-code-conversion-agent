{
  "parentEntity": "BargePositionHistory",
  "entityDescription": "Tracks historical positions of barges within fleet tier configurations, including when barges leave the fleet.",
  "note": "FleetPositionHistory is the actual business object name, but represents BargePositionHistory conceptually",
  "relationships": [],
  "lookupRelationships": [
    {
      "property": "FleetID",
      "foreignKey": "FleetID",
      "lookupEntity": "Fleet",
      "displayProperty": "FleetName",
      "required": true,
      "notes": "Identifies which fleet the position history belongs to. Set on add and not exposed in UI."
    },
    {
      "property": "BargeID",
      "foreignKey": "BargeID",
      "lookupEntity": "Barge",
      "displayProperty": "BargeNum",
      "inputProperty": "BargeNum",
      "required": true,
      "notes": "Resolved from BargeNum via Barge.GetBargeID(). Validates that barge exists in system."
    },
    {
      "property": "TierID",
      "foreignKey": "TierID",
      "lookupEntity": "Tier",
      "displayProperty": "TierName",
      "required": false,
      "notes": "Optional tier assignment. Disabled when LeftFleet=true. Filtered by TierGroup."
    }
  ],
  "childCollections": [],
  "parentChildRelationships": {
    "isChildOf": [],
    "hasParent": "Fleet",
    "parentKey": "FleetID",
    "notes": "Entity is not a child collection of Fleet, but has a required parent relationship via FleetID"
  },
  "gridConfiguration": {
    "mainGridName": "grdDetailEditList",
    "uniqueIdentifier": "FleetPositionHistoryID",
    "columns": [
      {
        "key": "PositionStartDateTime",
        "header": "Date/Time",
        "type": "DateTime",
        "width": 105,
        "align": "Left",
        "sortable": true,
        "defaultSort": "Ascending"
      },
      {
        "key": "BargeNum",
        "header": "Barge",
        "type": "String",
        "width": 146,
        "align": "Left"
      },
      {
        "key": "LeftFleet",
        "header": "Left Fleet",
        "type": "Boolean",
        "width": 62,
        "align": "Center"
      },
      {
        "key": "TierName",
        "header": "Tier",
        "type": "String",
        "width": 195,
        "align": "Left"
      },
      {
        "key": "TierPos",
        "header": "Tier Pos",
        "type": "String",
        "width": 57,
        "align": "Left",
        "notes": "Computed from TierX and TierY coordinates"
      }
    ]
  },
  "operations": {
    "add": {
      "method": "ItemAdd",
      "buttonKey": "Add",
      "description": "Creates new position history record for selected fleet",
      "defaultValues": {
        "FleetID": "_SelectedFleetID",
        "PositionStartDateTime": "Search date + Fleet day start time"
      }
    },
    "edit": {
      "method": "ItemModify",
      "buttonKey": "Modify",
      "description": "Edits selected position history record"
    },
    "delete": {
      "method": "ItemRemove",
      "buttonKey": "Remove",
      "description": "Immediate delete of position history record"
    },
    "export": {
      "method": "ExportGrid",
      "buttonKey": "Export",
      "description": "Exports grid data"
    }
  },
  "searchCriteria": {
    "fields": [
      {
        "name": "FleetID",
        "type": "Int32",
        "source": "_SelectedFleetID",
        "required": true
      },
      {
        "name": "Date",
        "type": "Date",
        "control": "dtDateSearch",
        "required": true
      },
      {
        "name": "TierGroup",
        "type": "String",
        "control": "cboTierGroupSearch",
        "lookupList": "TierGroupSearch",
        "required": true
      },
      {
        "name": "BargeNum",
        "type": "String",
        "control": "txtBargeNumSearch",
        "required": false
      },
      {
        "name": "IncludeBlankTierPos",
        "type": "Boolean",
        "control": "chkIncludeBlankTierPos",
        "required": false
      }
    ],
    "listMethod": "FleetPositionHistorySearch.GetList"
  },
  "businessRules": [
    {
      "property": "BargeNum",
      "rule": "BargeNumberNotFound",
      "description": "Barge number must match an existing barge record",
      "validation": "BargeID must be > 0 when BargeNum is provided"
    },
    {
      "property": "PositionStartDateTime",
      "rule": "IsRequired",
      "description": "Position start date/time is required"
    },
    {
      "property": "LeftFleet",
      "rule": "ConditionalClear",
      "description": "When LeftFleet=true, TierID, TierX, and TierY are cleared and disabled"
    }
  ],
  "dataIntegrity": {
    "conditionalFields": {
      "LeftFleet": {
        "whenTrue": {
          "clearFields": ["TierID", "TierX", "TierY"],
          "disableFields": ["cboTierID", "txtTierX", "txtTierY"]
        }
      }
    }
  },
  "moderServiceLayerPattern": {
    "entityClass": "FleetPositionHistory",
    "properties": [
      {
        "name": "FleetPositionHistoryID",
        "type": "int",
        "isPrimaryKey": true
      },
      {
        "name": "FleetID",
        "type": "int",
        "isForeignKey": true,
        "references": "Fleet"
      },
      {
        "name": "BargeID",
        "type": "int",
        "isForeignKey": true,
        "references": "Barge"
      },
      {
        "name": "TierID",
        "type": "int?",
        "isForeignKey": true,
        "references": "Tier"
      },
      {
        "name": "TierX",
        "type": "short?",
        "notes": "X coordinate in tier"
      },
      {
        "name": "TierY",
        "type": "short?",
        "notes": "Y coordinate in tier"
      },
      {
        "name": "PositionStartDateTime",
        "type": "DateTime",
        "isRequired": true
      },
      {
        "name": "LeftFleet",
        "type": "bool",
        "defaultValue": false
      }
    ],
    "repositoryMethods": [
      {
        "name": "GetByIdAsync",
        "returnType": "Task<FleetPositionHistory>",
        "parameters": ["int id"]
      },
      {
        "name": "GetByFleetAsync",
        "returnType": "Task<IEnumerable<FleetPositionHistory>>",
        "parameters": ["int fleetId", "DateTime date", "string tierGroup", "string bargeNum", "bool includeBlankTierPos"]
      },
      {
        "name": "InsertAsync",
        "returnType": "Task<int>",
        "parameters": ["FleetPositionHistory entity"]
      },
      {
        "name": "UpdateAsync",
        "returnType": "Task",
        "parameters": ["FleetPositionHistory entity"]
      },
      {
        "name": "DeleteAsync",
        "returnType": "Task",
        "parameters": ["int id"]
      }
    ],
    "notes": [
      "No child collections on entity",
      "Lookup relationships loaded separately via service layer",
      "BargeNum is a UI-only property that resolves to BargeID",
      "TierPos (displayed in grid) is computed from TierX and TierY"
    ]
  }
}
