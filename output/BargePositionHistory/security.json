{
  "entity": "BargePositionHistory",
  "legacy": {
    "formName": "frmBargePositionHistory",
    "subsystem": "None",
    "subsystemNote": "Line 36: InitializeBase(businessObject, SubSystem.None) - This form does not affect search form security but still uses CSG Security framework for button authorization",
    "securityButtons": [
      {
        "button": "btnAdd (toolbar)",
        "type": "Add",
        "legacyPermission": "CanCreate",
        "description": "Create new barge position history entry",
        "location": "frmBargePositionHistory.vb:61"
      },
      {
        "button": "btnModify (toolbar)",
        "type": "Open",
        "legacyPermission": "CanModify",
        "description": "Edit existing barge position history entry",
        "location": "frmBargePositionHistory.vb:62"
      },
      {
        "button": "btnRemove (toolbar)",
        "type": "Remove",
        "legacyPermission": "CanDelete",
        "description": "Hard delete barge position history entry",
        "location": "frmBargePositionHistory.vb:63"
      },
      {
        "button": "btnExport (toolbar)",
        "type": "Open",
        "legacyPermission": "CanView",
        "description": "Export barge position history grid to file",
        "location": "frmBargePositionHistory.vb:64"
      },
      {
        "button": "btnFind",
        "type": "Action",
        "legacyPermission": "None",
        "description": "Search/filter barge position history records",
        "location": "frmBargePositionHistory.vb:46"
      },
      {
        "button": "btnReset",
        "type": "Action",
        "legacyPermission": "None",
        "description": "Reset search criteria",
        "location": "frmBargePositionHistory.vb:47"
      },
      {
        "button": "btnSubmit",
        "type": "Submit",
        "legacyPermission": "CanCreate/CanModify",
        "description": "Save changes to barge position history",
        "location": "frmBargePositionHistory.vb:48"
      },
      {
        "button": "btnClose",
        "type": "Cancel",
        "legacyPermission": "None",
        "description": "Close form",
        "location": "frmBargePositionHistory.vb:49"
      },
      {
        "button": "btnCancel",
        "type": "CancelEdit",
        "legacyPermission": "None",
        "description": "Cancel current edit operation",
        "location": "frmBargePositionHistory.vb:50"
      }
    ],
    "authorizationLogic": {
      "description": "Security controlled through ControlAuthorization.ToolbarButtonCanBeEnabled method",
      "implementation": [
        {
          "location": "frmBargePositionHistory.vb:334-335",
          "button": "Add",
          "logic": "Enabled when not editing child AND ControlAuthorization.ToolbarButtonCanBeEnabled returns true",
          "permissionCheck": "CSG Security checks ButtonType.Add permission"
        },
        {
          "location": "frmBargePositionHistory.vb:337-338",
          "button": "Modify",
          "logic": "Enabled when item selected AND not editing child AND ControlAuthorization.ToolbarButtonCanBeEnabled returns true",
          "permissionCheck": "CSG Security checks ButtonType.Open permission"
        },
        {
          "location": "frmBargePositionHistory.vb:340-341",
          "button": "Remove",
          "logic": "Enabled when item selected AND not editing child AND ControlAuthorization.ToolbarButtonCanBeEnabled returns true",
          "permissionCheck": "CSG Security checks ButtonType.Remove permission"
        },
        {
          "location": "frmBargePositionHistory.vb:343-345",
          "button": "Export",
          "logic": "Visible always, enabled when at least one row AND not editing child AND ControlAuthorization.ToolbarButtonCanBeEnabled returns true",
          "permissionCheck": "CSG Security checks ButtonType.Open permission"
        }
      ]
    }
  },
  "modern": {
    "api": {
      "authentication": "ApiKey",
      "attributePattern": "[ApiKey]",
      "configLocation": "appsettings.json",
      "endpoints": [
        {
          "method": "GET",
          "route": "api/BargePositionHistory",
          "action": "GetList",
          "requiredAuth": "ApiKey",
          "futurePermission": "BargePositionHistoryView",
          "description": "Get list of barge position history for a fleet"
        },
        {
          "method": "GET",
          "route": "api/BargePositionHistory/{id}",
          "action": "GetById",
          "requiredAuth": "ApiKey",
          "futurePermission": "BargePositionHistoryView",
          "description": "Get single barge position history record"
        },
        {
          "method": "POST",
          "route": "api/BargePositionHistory",
          "action": "Create",
          "requiredAuth": "ApiKey",
          "futurePermission": "BargePositionHistoryModify",
          "description": "Create new barge position history entry"
        },
        {
          "method": "PUT",
          "route": "api/BargePositionHistory/{id}",
          "action": "Update",
          "requiredAuth": "ApiKey",
          "futurePermission": "BargePositionHistoryModify",
          "description": "Update existing barge position history entry"
        },
        {
          "method": "DELETE",
          "route": "api/BargePositionHistory/{id}",
          "action": "Delete",
          "requiredAuth": "ApiKey",
          "futurePermission": "BargePositionHistoryDelete",
          "description": "Hard delete barge position history entry"
        }
      ]
    },
    "ui": {
      "authentication": "OIDC",
      "developmentAuth": "DevelopmentAutoSignInMiddleware",
      "attributePattern": "[Authorize]",
      "authenticationScheme": "IdentityConstants.ApplicationScheme",
      "permissions": [
        {
          "name": "BargePositionHistoryView",
          "enumValue": "AuthPermissions.BargePositionHistoryView",
          "description": "View barge position history",
          "granularity": "ReadOnly",
          "requiredFor": [
            "Index",
            "Search",
            "Details",
            "Export"
          ],
          "uiElements": [
            "Search panel (pnlDetailEdit)",
            "Grid display (grdDetailEditList)",
            "Export button",
            "Find/Reset buttons"
          ]
        },
        {
          "name": "BargePositionHistoryModify",
          "enumValue": "AuthPermissions.BargePositionHistoryModify",
          "description": "Create and update barge position history entries",
          "granularity": "Modify",
          "requiredFor": [
            "Create",
            "Edit"
          ],
          "uiElements": [
            "Add button (toolbar)",
            "Modify button (toolbar)",
            "Detail edit section (grpDetailEditChild)",
            "Submit/Cancel buttons",
            "All input controls in detail section"
          ]
        },
        {
          "name": "BargePositionHistoryDelete",
          "enumValue": "AuthPermissions.BargePositionHistoryDelete",
          "description": "Delete barge position history entries (hard delete)",
          "granularity": "FullControl",
          "requiredFor": [
            "Delete"
          ],
          "uiElements": [
            "Remove button (toolbar)"
          ],
          "notes": "Separate delete permission due to hard delete operation (not soft delete)"
        }
      ]
    },
    "permissionEnum": {
      "file": "Enums/AuthPermissions.cs",
      "entries": [
        {
          "name": "BargePositionHistoryView",
          "description": "View barge position history"
        },
        {
          "name": "BargePositionHistoryModify",
          "description": "Create and modify barge position history entries"
        },
        {
          "name": "BargePositionHistoryDelete",
          "description": "Delete barge position history entries"
        }
      ]
    }
  },
  "implementationPatterns": {
    "apiController": {
      "example": "```csharp\n[ApiController]\n[Route(\"api/[controller]\")]\n[ApiKey]\npublic class BargePositionHistoryController : ApiControllerBase\n{\n    private readonly IBargePositionHistoryRepository _repository;\n\n    [HttpGet]\n    public async Task<IActionResult> GetList([FromQuery] int fleetId, [FromQuery] DateTime date, [FromQuery] string tierGroup)\n    {\n        // API Key authentication required\n        var results = await _repository.GetListAsync(fleetId, date, tierGroup);\n        return Ok(results);\n    }\n\n    [HttpGet(\"{id}\")]\n    public async Task<IActionResult> GetById(int id)\n    {\n        var result = await _repository.GetByIdAsync(id);\n        return result != null ? Ok(result) : NotFound();\n    }\n\n    [HttpPost]\n    public async Task<IActionResult> Create([FromBody] BargePositionHistoryDto dto)\n    {\n        var id = await _repository.CreateAsync(dto);\n        return CreatedAtAction(nameof(GetById), new { id }, null);\n    }\n\n    [HttpPut(\"{id}\")]\n    public async Task<IActionResult> Update(int id, [FromBody] BargePositionHistoryDto dto)\n    {\n        await _repository.UpdateAsync(id, dto);\n        return NoContent();\n    }\n\n    [HttpDelete(\"{id}\")]\n    public async Task<IActionResult> Delete(int id)\n    {\n        await _repository.DeleteAsync(id);\n        return NoContent();\n    }\n}\n```"
    },
    "uiController": {
      "example": "```csharp\n[Authorize]\npublic class BargePositionHistoryController : AppController\n{\n    [Authorize(Policy = \"BargePositionHistoryView\")]\n    public IActionResult Index(int fleetId)\n    {\n        var viewModel = new BargePositionHistoryIndexViewModel\n        {\n            FleetId = fleetId,\n            CanModify = User.HasPermission(AuthPermissions.BargePositionHistoryModify),\n            CanDelete = User.HasPermission(AuthPermissions.BargePositionHistoryDelete)\n        };\n        return View(viewModel);\n    }\n\n    [Authorize(Policy = \"BargePositionHistoryModify\")]\n    public IActionResult Create(int fleetId)\n    {\n        var viewModel = new BargePositionHistoryEditViewModel\n        {\n            FleetId = fleetId,\n            PositionStartDateTime = DateTime.Now\n        };\n        return View(viewModel);\n    }\n\n    [HttpPost]\n    [Authorize(Policy = \"BargePositionHistoryModify\")]\n    public async Task<IActionResult> Create(BargePositionHistoryEditViewModel model)\n    {\n        if (!ModelState.IsValid)\n            return View(model);\n\n        await _repository.CreateAsync(model);\n        return RedirectToAction(nameof(Index), new { fleetId = model.FleetId });\n    }\n\n    [Authorize(Policy = \"BargePositionHistoryModify\")]\n    public async Task<IActionResult> Edit(int id)\n    {\n        var entity = await _repository.GetByIdAsync(id);\n        if (entity == null)\n            return NotFound();\n\n        var viewModel = _mapper.Map<BargePositionHistoryEditViewModel>(entity);\n        return View(viewModel);\n    }\n\n    [HttpPost]\n    [Authorize(Policy = \"BargePositionHistoryModify\")]\n    public async Task<IActionResult> Edit(int id, BargePositionHistoryEditViewModel model)\n    {\n        if (!ModelState.IsValid)\n            return View(model);\n\n        await _repository.UpdateAsync(id, model);\n        return RedirectToAction(nameof(Index), new { fleetId = model.FleetId });\n    }\n\n    [HttpPost]\n    [Authorize(Policy = \"BargePositionHistoryDelete\")]\n    public async Task<IActionResult> Delete(int id)\n    {\n        await _repository.DeleteAsync(id);\n        return Json(new { success = true });\n    }\n}\n```"
    },
    "viewPermissionChecks": {
      "example": "```cshtml\n@model BargePositionHistoryIndexViewModel\n\n<div class=\"toolbar\">\n    @if (Model.CanModify)\n    {\n        <button type=\"button\" class=\"btn btn-primary\" id=\"btnAdd\">\n            <i class=\"fas fa-plus\"></i> Add\n        </button>\n        <button type=\"button\" class=\"btn btn-secondary\" id=\"btnModify\" disabled>\n            <i class=\"fas fa-edit\"></i> Modify\n        </button>\n    }\n    @if (Model.CanDelete)\n    {\n        <button type=\"button\" class=\"btn btn-danger\" id=\"btnRemove\" disabled>\n            <i class=\"fas fa-trash\"></i> Remove\n        </button>\n    }\n    <button type=\"button\" class=\"btn btn-info\" id=\"btnExport\">\n        <i class=\"fas fa-file-export\"></i> Export\n    </button>\n</div>\n```"
    }
  },
  "securityNotes": {
    "subsystemNone": "This form uses SubSystem.None because it's a detail form opened from another context (fleet management). It doesn't affect main search form security but still requires proper permission checks for all operations.",
    "hardDelete": "The Remove button performs HARD DELETE (FleetPositionHistory.DeleteFleetPositionHistory) at line 451, not a soft delete. This requires a separate delete permission (BargePositionHistoryDelete) due to data permanence concerns.",
    "toolbarSecurity": "All toolbar buttons are security-controlled through ControlAuthorization.ToolbarButtonCanBeEnabled method which checks CSG Security permissions based on ButtonType.",
    "parentContextRequired": "This form requires a FleetID to be passed during initialization (line 255), making it context-dependent on the parent fleet selection.",
    "exportPermission": "Export button is mapped to ButtonType.Open (line 64), suggesting view-only permission is sufficient for exporting data.",
    "detailEditMode": "Form has two modes: search mode (enabled when IsEditingChild=false) and detail-edit mode (enabled when IsEditingChild=true). Security controls must respect both modes."
  },
  "dataFields": {
    "required": [
      {
        "field": "FleetID",
        "description": "Parent fleet identifier (passed from parent form)",
        "validation": "Required, inherited from parent context"
      },
      {
        "field": "PositionStartDateTime",
        "description": "Date and time of position entry",
        "validation": "Required, combined from dtPositionStartDate and cboPositionStartTime"
      },
      {
        "field": "BargeNum",
        "description": "Barge number",
        "validation": "Required (bold label), string"
      }
    ],
    "optional": [
      {
        "field": "TierID",
        "description": "Tier identifier",
        "validation": "Optional, disabled when LeftFleet is checked"
      },
      {
        "field": "TierX",
        "description": "Tier X position coordinate",
        "validation": "Optional, Int16, disabled when LeftFleet is checked"
      },
      {
        "field": "TierY",
        "description": "Tier Y position coordinate",
        "validation": "Optional, Int16, disabled when LeftFleet is checked"
      },
      {
        "field": "LeftFleet",
        "description": "Flag indicating barge left the fleet",
        "validation": "Boolean checkbox, when checked, tier fields are cleared and disabled"
      }
    ]
  },
  "businessLogic": {
    "conditionalFields": {
      "description": "When LeftFleet checkbox is checked, tier-related fields (TierID, TierX, TierY) are disabled and cleared",
      "implementation": "frmBargePositionHistory.vb:480-497 EnableDisableTierPos method"
    },
    "searchCriteria": {
      "required": [
        "Date (dtDateSearch)",
        "TierGroup (cboTierGroupSearch)"
      ],
      "optional": [
        "BargeNum (txtBargeNumSearch)",
        "IncludeBlankTierPos (chkIncludeBlankTierPos)"
      ],
      "validation": "Line 520: MessageBox shown if Date or TierGroup is missing"
    }
  }
}
