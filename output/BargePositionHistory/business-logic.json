{
  "businessObject": "BoatPositionHistory",
  "baseClass": "BoatPositionHistoryBase",
  "namespace": "BusinessLogic.BaseClass",
  "inheritsFrom": "BusinessLogicBase",
  "description": "Tracks historical position updates for boats on rivers with river mile markers, direction of travel, GPS coordinates, and timestamp information",
  "properties": [
    {
      "name": "BoatPositionHistoryID",
      "type": "Int32",
      "access": "ReadOnly",
      "isPrimaryKey": true,
      "isNullable": false,
      "isAutoGenerated": true,
      "description": "Unique identifier for the boat position history record",
      "sqlDbType": "Int",
      "parameterDirection": "InputOutput"
    },
    {
      "name": "LocationID",
      "type": "Int32",
      "access": "ReadWrite",
      "isForeignKey": true,
      "isRequired": true,
      "isNullable": false,
      "description": "Foreign key reference to Location table - identifies the boat",
      "displayName": "Boat",
      "sqlDbType": "Int",
      "auditable": true
    },
    {
      "name": "River",
      "type": "String",
      "access": "ReadWrite",
      "maxLength": 3,
      "isRequired": true,
      "isNullable": false,
      "description": "Three-character river code identifying which river the boat is on",
      "sqlDbType": "Char",
      "auditable": true,
      "validationPattern": "SetCharProp with maxLength 3"
    },
    {
      "name": "Mile",
      "type": "String",
      "access": "ReadWrite",
      "isRequired": true,
      "isNullable": false,
      "description": "Mile marker position on the river (stored as string, formatted with 2 decimal places)",
      "displayFormat": "Two decimal places (FmtTwoDecimalPlaces)",
      "sqlDbType": "Decimal",
      "auditable": true,
      "validationPattern": "SetDecimalProp with rounding to 0.01, Nearest method"
    },
    {
      "name": "PositionUpdatedDateTime",
      "type": "SmartDate",
      "access": "ReadWrite",
      "isRequired": true,
      "isNullable": false,
      "description": "Date and time when the position was updated",
      "displayFormat": "SmartDateTimeFormat",
      "sqlDbType": "DateTime",
      "auditable": true
    },
    {
      "name": "Direction",
      "type": "String",
      "access": "ReadWrite",
      "maxLength": 20,
      "isRequired": true,
      "isNullable": false,
      "description": "Direction of travel on the river",
      "sqlDbType": "VarChar",
      "auditable": true
    },
    {
      "name": "Latitude",
      "type": "String",
      "access": "ReadWrite",
      "isRequired": false,
      "isNullable": true,
      "description": "GPS latitude coordinate at the time of position update",
      "sqlDbType": "Decimal",
      "auditable": true,
      "validationPattern": "SetDecimalProp"
    },
    {
      "name": "Longitude",
      "type": "String",
      "access": "ReadWrite",
      "isRequired": false,
      "isNullable": true,
      "description": "GPS longitude coordinate at the time of position update",
      "sqlDbType": "Decimal",
      "auditable": true,
      "validationPattern": "SetDecimalProp"
    },
    {
      "name": "Source",
      "type": "String",
      "access": "ReadWrite",
      "maxLength": 15,
      "isRequired": false,
      "isNullable": true,
      "description": "Source system or method that generated the position update",
      "sqlDbType": "VarChar",
      "auditable": true
    },
    {
      "name": "MinMile",
      "type": "String",
      "access": "Private",
      "isCalculated": true,
      "description": "Minimum mile marker for the selected river (used for validation, not persisted)",
      "displayFormat": "Two decimal places (FmtTwoDecimalPlaces)",
      "validationPattern": "SetDecimalProp with rounding to 0.01"
    },
    {
      "name": "MaxMile",
      "type": "String",
      "access": "Private",
      "isCalculated": true,
      "description": "Maximum mile marker for the selected river (used for validation, not persisted)",
      "displayFormat": "Two decimal places (FmtTwoDecimalPlaces)",
      "validationPattern": "SetDecimalProp with rounding to 0.01"
    }
  ],
  "businessRules": [
    {
      "ruleName": "LocationIDRequired",
      "property": "LocationID",
      "ruleType": "Required",
      "condition": "p_LocationID <= 0",
      "message": "Boat is required.",
      "severity": "Error",
      "context": "Always",
      "sourceFile": "BoatPositionHistory.vb",
      "lineNumber": 165,
      "modernEquivalent": {
        "dataAnnotation": "[Required(ErrorMessage = \"Boat is required.\")]",
        "fluentValidation": "RuleFor(x => x.LocationID).GreaterThan(0).WithMessage(\"Boat is required.\");"
      }
    },
    {
      "ruleName": "RiverRequired",
      "property": "River",
      "ruleType": "Required",
      "condition": "String.IsNullOrEmpty(p_River)",
      "message": "River is required.",
      "severity": "Error",
      "context": "Always",
      "sourceFile": "BoatPositionHistoryBase.vb",
      "lineNumber": 290,
      "modernEquivalent": {
        "dataAnnotation": "[Required(ErrorMessage = \"River is required.\")]",
        "fluentValidation": "RuleFor(x => x.River).NotEmpty().WithMessage(\"River is required.\");"
      }
    },
    {
      "ruleName": "RiverMaxLength",
      "property": "River",
      "ruleType": "MaxLength",
      "condition": "(p_River.Length > MaxLength.River)",
      "message": "River cannot exceed maximum length of 3.",
      "severity": "Error",
      "context": "Always",
      "maxLength": 3,
      "sourceFile": "BoatPositionHistoryBase.vb",
      "lineNumber": 292,
      "modernEquivalent": {
        "dataAnnotation": "[MaxLength(3, ErrorMessage = \"River cannot exceed maximum length of 3.\")]",
        "fluentValidation": "RuleFor(x => x.River).MaximumLength(3).WithMessage(\"River cannot exceed maximum length of 3.\");"
      }
    },
    {
      "ruleName": "MileRequired",
      "property": "Mile",
      "ruleType": "Required",
      "condition": "String.IsNullOrEmpty(p_Mile)",
      "message": "Mile is required.",
      "severity": "Error",
      "context": "Always",
      "sourceFile": "BoatPositionHistoryBase.vb",
      "lineNumber": 298,
      "modernEquivalent": {
        "dataAnnotation": "[Required(ErrorMessage = \"Mile is required.\")]",
        "fluentValidation": "RuleFor(x => x.Mile).NotEmpty().WithMessage(\"Mile is required.\");"
      }
    },
    {
      "ruleName": "MileReasonable",
      "property": "Mile",
      "ruleType": "RangeValidation",
      "condition": "((Not String.IsNullOrEmpty(p_Mile.Trim)) AndAlso (CType(p_Mile.Trim, Decimal) > 2000.0))",
      "message": "Mile {Mile} is not a reasonable value for Mile.",
      "severity": "Error",
      "context": "When mile value is greater than 2000",
      "sourceFile": "BoatPositionHistory.vb",
      "lineNumber": 172,
      "modernEquivalent": {
        "dataAnnotation": "[Range(0, 2000, ErrorMessage = \"Mile is not a reasonable value for Mile.\")]",
        "fluentValidation": "RuleFor(x => x.Mile).LessThanOrEqualTo(2000.0m).When(x => !string.IsNullOrEmpty(x.Mile)).WithMessage(x => $\"Mile {x.Mile} is not a reasonable value for Mile.\");"
      }
    },
    {
      "ruleName": "MileBetweenStartAndEnd",
      "property": "Mile",
      "ruleType": "ConditionalValidation",
      "condition": "(Not String.IsNullOrEmpty(p_Mile)) AndAlso (((Not String.IsNullOrEmpty(_MinMile)) AndAlso (CType(p_Mile, Decimal) < CType(_MinMile, Decimal))) OrElse ((Not String.IsNullOrEmpty(_MaxMile)) AndAlso (CType(p_Mile, Decimal) > CType(_MaxMile, Decimal))))",
      "message": "Mile {Mile} must be within the river's mile range of {MinMile} to {MaxMile}.",
      "severity": "Error",
      "context": "When mile is outside the river's min/max range",
      "sourceFile": "BoatPositionHistory.vb",
      "lineNumber": 185,
      "modernEquivalent": {
        "dataAnnotation": "Custom validation attribute needed",
        "fluentValidation": "RuleFor(x => x.Mile).Must((model, mile) => ValidateMileRange(model)).When(x => !string.IsNullOrEmpty(x.Mile)).WithMessage(x => $\"Mile {x.Mile} must be within the river's mile range of {x.MinMile} to {x.MaxMile}.\");"
      }
    },
    {
      "ruleName": "PositionUpdatedDateTimeRequired",
      "property": "PositionUpdatedDateTime",
      "ruleType": "Required",
      "condition": "(p_PositionUpdatedDateTime.IsEmpty)",
      "message": "Position updated date/time is required.",
      "severity": "Error",
      "context": "Always",
      "sourceFile": "BoatPositionHistoryBase.vb",
      "lineNumber": 303,
      "modernEquivalent": {
        "dataAnnotation": "[Required(ErrorMessage = \"Position updated date/time is required.\")]",
        "fluentValidation": "RuleFor(x => x.PositionUpdatedDateTime).NotEmpty().WithMessage(\"Position updated date/time is required.\");"
      }
    },
    {
      "ruleName": "PositionUpdatedDateTimeFuture",
      "property": "PositionUpdatedDateTime",
      "ruleType": "ConditionalValidation",
      "condition": "DateTime is in future beyond MaxFutureIntervalHoursOnboard",
      "message": "Dynamic message based on MaxFutureIntervalHoursOnboard setting",
      "severity": "Error",
      "context": "When position updated date/time is in the future beyond allowed threshold",
      "sourceFile": "BoatPositionHistory.vb",
      "lineNumber": 189,
      "dependencies": ["Lists.GlobalSettingList.MaxFutureIntervalHoursOnboard()"],
      "modernEquivalent": {
        "dataAnnotation": "Custom validation attribute needed",
        "fluentValidation": "RuleFor(x => x.PositionUpdatedDateTime).Must((model, dt) => ValidateFutureDateTime(dt, maxFutureHours)).WithMessage(\"Position updated date/time cannot be more than {MaxHours} hours in the future.\");"
      }
    },
    {
      "ruleName": "DirectionRequired",
      "property": "Direction",
      "ruleType": "Required",
      "condition": "String.IsNullOrEmpty(p_Direction)",
      "message": "Direction is required.",
      "severity": "Error",
      "context": "Always",
      "sourceFile": "BoatPositionHistoryBase.vb",
      "lineNumber": 308,
      "modernEquivalent": {
        "dataAnnotation": "[Required(ErrorMessage = \"Direction is required.\")]",
        "fluentValidation": "RuleFor(x => x.Direction).NotEmpty().WithMessage(\"Direction is required.\");"
      }
    },
    {
      "ruleName": "DirectionMaxLength",
      "property": "Direction",
      "ruleType": "MaxLength",
      "condition": "(p_Direction.Length > MaxLength.Direction)",
      "message": "Direction cannot exceed maximum length of 20.",
      "severity": "Error",
      "context": "Always",
      "maxLength": 20,
      "sourceFile": "BoatPositionHistoryBase.vb",
      "lineNumber": 310,
      "modernEquivalent": {
        "dataAnnotation": "[MaxLength(20, ErrorMessage = \"Direction cannot exceed maximum length of 20.\")]",
        "fluentValidation": "RuleFor(x => x.Direction).MaximumLength(20).WithMessage(\"Direction cannot exceed maximum length of 20.\");"
      }
    },
    {
      "ruleName": "SourceMaxLength",
      "property": "Source",
      "ruleType": "MaxLength",
      "condition": "(p_Source.Length > MaxLength.Source)",
      "message": "Source cannot exceed maximum length of 15.",
      "severity": "Error",
      "context": "Always",
      "maxLength": 15,
      "sourceFile": "BoatPositionHistoryBase.vb",
      "lineNumber": 316,
      "modernEquivalent": {
        "dataAnnotation": "[MaxLength(15, ErrorMessage = \"Source cannot exceed maximum length of 15.\")]",
        "fluentValidation": "RuleFor(x => x.Source).MaximumLength(15).When(x => !string.IsNullOrEmpty(x.Source)).WithMessage(\"Source cannot exceed maximum length of 15.\");"
      }
    }
  ],
  "methods": {
    "factory": [
      {
        "name": "NewBoatPositionHistory",
        "returnType": "BoatPositionHistory",
        "parameters": [],
        "visibility": "Public Shared",
        "description": "Creates a new parent BoatPositionHistory object",
        "sourceFile": "BoatPositionHistoryBase.vb",
        "lineNumber": 420
      },
      {
        "name": "NewBoatPositionHistoryAsChild",
        "returnType": "BoatPositionHistory",
        "parameters": [],
        "visibility": "Friend Shared",
        "description": "Creates a new child BoatPositionHistory object",
        "sourceFile": "BoatPositionHistoryBase.vb",
        "lineNumber": 425
      },
      {
        "name": "GetBoatPositionHistory",
        "returnType": "BoatPositionHistory",
        "parameters": [
          {
            "name": "ID",
            "type": "Int32",
            "description": "BoatPositionHistoryID to retrieve"
          }
        ],
        "visibility": "Public Shared",
        "description": "Loads an existing parent object by ID",
        "sourceFile": "BoatPositionHistoryBase.vb",
        "lineNumber": 430
      },
      {
        "name": "GetBoatPositionHistoryChild",
        "returnType": "BoatPositionHistory",
        "parameters": [
          {
            "name": "ID",
            "type": "Int32",
            "description": "BoatPositionHistoryID to retrieve"
          }
        ],
        "visibility": "Friend Shared",
        "description": "Loads an existing child object by ID",
        "sourceFile": "BoatPositionHistoryBase.vb",
        "lineNumber": 435
      },
      {
        "name": "GetBoatPositionHistoryChild",
        "returnType": "BoatPositionHistory",
        "parameters": [
          {
            "name": "dr",
            "type": "SafeDataReader",
            "description": "DataReader containing record data"
          }
        ],
        "visibility": "Friend Shared",
        "description": "Loads an existing child object from a Data Reader",
        "sourceFile": "BoatPositionHistoryBase.vb",
        "lineNumber": 440
      }
    ],
    "crud": [
      {
        "name": "DeleteBoatPositionHistory",
        "returnType": "void",
        "parameters": [
          {
            "name": "ID",
            "type": "Int32",
            "description": "BoatPositionHistoryID to delete"
          }
        ],
        "visibility": "Public Shared",
        "description": "Deletes a parent object by ID",
        "sourceFile": "BoatPositionHistoryBase.vb",
        "lineNumber": 449
      }
    ],
    "business": [
      {
        "name": "CheckBoatSpeed",
        "returnType": "Boolean",
        "parameters": [
          {
            "name": "locationID",
            "type": "Integer",
            "description": "Location ID of the boat"
          },
          {
            "name": "river",
            "type": "String",
            "description": "River code"
          },
          {
            "name": "mile",
            "type": "String",
            "description": "Mile marker position"
          },
          {
            "name": "positionUpdatedDateTime",
            "type": "String",
            "description": "Position update timestamp"
          }
        ],
        "visibility": "Public Shared",
        "description": "Validates boat speed by comparing position and time data to ensure realistic location information",
        "storedProcedure": "CheckBoatSpeed",
        "sourceFile": "BoatPositionHistory.vb",
        "lineNumber": 202
      }
    ]
  },
  "relationships": [
    {
      "property": "LocationID",
      "relatedEntity": "Location",
      "type": "ManyToOne",
      "description": "Each position history record belongs to one Location (Boat)",
      "cascadeDelete": false,
      "foreignKeyConstraint": true
    }
  ],
  "initialization": {
    "method": "Initialize",
    "sourceFile": "BoatPositionHistoryBase.vb",
    "lineNumber": 254,
    "defaults": [
      {
        "property": "BoatPositionHistoryID",
        "value": "0"
      },
      {
        "property": "LocationID",
        "value": "0"
      },
      {
        "property": "River",
        "value": "String.Empty"
      },
      {
        "property": "Mile",
        "value": "String.Empty"
      },
      {
        "property": "PositionUpdatedDateTime",
        "value": "New SmartDate"
      },
      {
        "property": "Direction",
        "value": "String.Empty"
      },
      {
        "property": "Latitude",
        "value": "String.Empty"
      },
      {
        "property": "Longitude",
        "value": "String.Empty"
      },
      {
        "property": "Source",
        "value": "String.Empty"
      },
      {
        "property": "MinMile",
        "value": "String.Empty"
      },
      {
        "property": "MaxMile",
        "value": "String.Empty"
      }
    ],
    "customInitialization": [
      {
        "description": "Set display name for LocationID to 'Boat'",
        "code": "MyBase.p_dispLocationID = \"Boat\"",
        "sourceFile": "BoatPositionHistory.vb",
        "lineNumber": 129
      },
      {
        "description": "Set display name for PositionUpdatedDateTime",
        "code": "MyBase.p_dispPositionUpdatedDateTime = \"Position updated date/time\"",
        "sourceFile": "BoatPositionHistory.vb",
        "lineNumber": 132
      },
      {
        "description": "Initialize MinMile and MaxMile for river range validation",
        "sourceFile": "BoatPositionHistory.vb",
        "lineNumber": 145
      }
    ]
  },
  "storedProcedures": {
    "select": "BoatPositionHistorySelect",
    "selectAll": "BoatPositionHistoriesSelect",
    "insert": "BoatPositionHistoryInsert",
    "update": "BoatPositionHistoryUpdate",
    "delete": "BoatPositionHistoryDelete",
    "custom": [
      {
        "name": "CheckBoatSpeed",
        "description": "Validates that boat speed is reasonable based on position changes",
        "parameters": [
          "@LocationID (Int)",
          "@River (Char, 3)",
          "@Mile (Decimal)",
          "@PositionUpdatedDateTime (DateTime)",
          "@IsBoatSpeedValid (Bit, Output)"
        ]
      }
    ]
  },
  "dataAccess": {
    "insertParameters": [
      "@BoatPositionHistoryID (Int, InputOutput)",
      "@LocationID (Int)",
      "@River (Char)",
      "@Mile (Decimal)",
      "@PositionUpdatedDateTime (DateTime)",
      "@Direction (VarChar)",
      "@Latitude (Decimal)",
      "@Longitude (Decimal)",
      "@Source (VarChar)"
    ],
    "updateParameters": [
      "@BoatPositionHistoryID (Int)",
      "@LocationID (Int)",
      "@River (Char)",
      "@Mile (Decimal)",
      "@PositionUpdatedDateTime (DateTime)",
      "@Direction (VarChar)",
      "@Latitude (Decimal)",
      "@Longitude (Decimal)",
      "@Source (VarChar)"
    ],
    "deleteParameters": [
      "@BoatPositionHistoryID (Int)"
    ]
  },
  "auditing": {
    "enabled": true,
    "auditedFields": [
      "BoatPositionHistoryID",
      "LocationID",
      "River",
      "Mile",
      "PositionUpdatedDateTime",
      "Direction",
      "Latitude",
      "Longitude",
      "Source"
    ],
    "auditMethod": "FieldAudit",
    "description": "All field changes are tracked via the auditing framework using AuditFieldEvent"
  },
  "integrationPoints": [
    {
      "name": "RiverList",
      "type": "Lookup",
      "description": "Retrieves min/max mile markers for river validation",
      "method": "Lists.RiverList.GetRiver(River, MinMile, MaxMile)",
      "sourceFile": "BoatPositionHistory.vb",
      "lineNumber": 48
    },
    {
      "name": "GlobalSettingList",
      "type": "Configuration",
      "description": "Gets maximum future interval hours for position timestamp validation",
      "method": "Lists.GlobalSettingList.MaxFutureIntervalHoursOnboard()",
      "sourceFile": "BoatPositionHistory.vb",
      "lineNumber": 190
    },
    {
      "name": "Location",
      "type": "Parent",
      "description": "Parent entity that contains BoatPositionHistory as a child object",
      "sourceFile": "Location.vb",
      "lineNumber": 25,
      "usage": "BoatPositionHistory records are created whenever a BoatLocation position is modified"
    }
  ],
  "usagePatterns": [
    {
      "pattern": "Child Object Creation",
      "description": "BoatPositionHistory is created as a child object of Location when boat position information is updated",
      "code": "p_BoatPositionHistory = BoatPositionHistory.NewBoatPositionHistoryAsChild",
      "sourceFile": "Location.vb",
      "lineNumber": 301
    },
    {
      "pattern": "Position Update Tracking",
      "description": "Whenever Location river, mile, direction, or position timestamp changes, the values are synchronized to BoatPositionHistory",
      "sourceFile": "Location.vb",
      "lineNumbers": [95, 159, 213, 282]
    },
    {
      "pattern": "GPS Coordinate Pass-through",
      "description": "Location provides write-only properties to set latitude/longitude on the BoatPositionHistory child object",
      "sourceFile": "Location.vb",
      "lineNumbers": [234, 255]
    },
    {
      "pattern": "Conditional Child Persistence",
      "description": "BoatPositionHistory is only persisted if all position fields have values, otherwise set to Nothing",
      "sourceFile": "Location.vb",
      "lineNumber": 520
    }
  ],
  "validationDependencies": [
    {
      "dependency": "River Min/Max Mile Range",
      "description": "River must have valid min/max mile markers for range validation to work",
      "source": "Lists.RiverList"
    },
    {
      "dependency": "MaxFutureIntervalHoursOnboard",
      "description": "Global setting determines how far in the future a position timestamp can be",
      "source": "Lists.GlobalSettingList"
    },
    {
      "dependency": "IsInFutureCheck",
      "description": "Base class method that validates if a datetime is too far in the future",
      "source": "BusinessLogicBase"
    }
  ],
  "notes": [
    "This object is typically created as a child object of Location, not as a standalone entity",
    "Mile values are stored as strings but validated/formatted as decimals with 2 decimal places",
    "River/mile validation includes both reasonable value checks (< 2000) and river-specific range checks",
    "Position updates require all four core fields: River, Mile, Direction, and PositionUpdatedDateTime",
    "Latitude and Longitude are optional GPS coordinates that supplement the river/mile position",
    "The Source field tracks which system or method generated the position update",
    "CheckBoatSpeed is a static validation method that calls a stored procedure to verify realistic boat movement",
    "The object uses the SmartDate type for datetime handling with custom format strings",
    "All data changes are audited through the AuditFieldEvent framework",
    "The object inherits from BusinessLogicBase which provides CSLA-style data portal operations"
  ],
  "modernArchitectureMapping": {
    "domainModel": "BoatPositionHistory.cs",
    "repository": "IBoatPositionHistoryRepository.cs",
    "service": "IBoatPositionHistoryService.cs",
    "validator": "BoatPositionHistoryValidator.cs (FluentValidation)",
    "dto": "BoatPositionHistoryDto.cs",
    "dbContext": "Add DbSet<BoatPositionHistory> to ApplicationDbContext"
  }
}
