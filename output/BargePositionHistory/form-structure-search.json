{
  "formName": "frmBargePositionHistory",
  "formTitle": "Barge Position History",
  "formType": "DetailEditList",
  "implements": ["IBaseDetailEdit"],
  "baseForm": "frmBaseDetailEditList",
  "businessObject": "FleetPositionHistory",
  "description": "Search and manage barge position history records for a selected fleet. Allows adding, modifying, and removing position records with tier placement and date/time tracking.",

  "sections": [
    {
      "name": "pnlDetailEdit",
      "label": "Search Criteria",
      "type": "SearchPanel",
      "dockStyle": "Top",
      "controls": ["dtDateSearch", "cboTierGroupSearch", "txtBargeNumSearch", "chkIncludeBlankTierPos", "btnFind", "btnReset"]
    },
    {
      "name": "grpDetailEditList",
      "label": "Barge Positions",
      "type": "GridPanel",
      "dockStyle": "Fill",
      "controls": ["grdDetailEditList", "ToolbarsManager"]
    },
    {
      "name": "grpDetailEditChild",
      "label": "Detail",
      "type": "DetailEditPanel",
      "dockStyle": "Bottom",
      "controls": ["dtPositionStartDate", "cboPositionStartTime", "txtBargeNum", "chkLeftFleet", "cboTierID", "txtTierX", "txtTierY", "btnSubmit", "btnCancel"]
    },
    {
      "name": "grpSubmitCancel",
      "label": null,
      "type": "FormActionsPanel",
      "dockStyle": "Bottom",
      "controls": ["btnClose"]
    }
  ],

  "controls": [
    {
      "name": "dtDateSearch",
      "type": "UltraDateTimeEditor",
      "category": "SearchCriteria",
      "label": "Date",
      "dataBinding": null,
      "defaultValue": "Date.Today",
      "validation": [],
      "required": true,
      "bold": true,
      "tabIndex": 1,
      "events": [],
      "notes": "Required for search operation"
    },
    {
      "name": "cboTierGroupSearch",
      "type": "UltraCombo",
      "category": "SearchCriteria",
      "label": "Tier group",
      "dataBinding": null,
      "populationMethod": "Lists.TierGroupSearch.GetList(_SelectedFleetID)",
      "validation": [],
      "required": true,
      "bold": true,
      "tabIndex": 3,
      "events": [],
      "notes": "Required for search operation. Populated based on selected Fleet ID"
    },
    {
      "name": "txtBargeNumSearch",
      "type": "UltraTextEditor",
      "category": "SearchCriteria",
      "label": "Barge",
      "dataBinding": null,
      "validation": ["ValidationTypeConstants.String"],
      "required": false,
      "tabIndex": 5,
      "events": [],
      "notes": "Optional search filter"
    },
    {
      "name": "chkIncludeBlankTierPos",
      "type": "UltraCheckEditor",
      "category": "SearchCriteria",
      "label": "Include blank tier positions",
      "dataBinding": null,
      "validation": [],
      "required": false,
      "tabIndex": 6,
      "events": [],
      "notes": "Filter option for search"
    },
    {
      "name": "btnFind",
      "type": "UltraButton",
      "category": "SearchAction",
      "text": "F&ind",
      "handler": "btnFind_Click",
      "buttonType": "Action",
      "tabIndex": 7,
      "enabled": true,
      "visible": true,
      "anchor": "TopRight",
      "notes": "Executes search with validation that Date and Tier group are provided"
    },
    {
      "name": "btnReset",
      "type": "UltraButton",
      "category": "SearchAction",
      "text": "Reset",
      "handler": "btnReset_Click",
      "buttonType": "Action",
      "tabIndex": 8,
      "enabled": true,
      "visible": true,
      "anchor": "TopRight",
      "causesValidation": false,
      "notes": "Clears search criteria"
    },
    {
      "name": "dtPositionStartDate",
      "type": "UltraDateTimeEditor",
      "category": "DetailEdit",
      "label": "Date/Time",
      "dataBinding": "PositionStartDateTime",
      "validation": [],
      "required": true,
      "bold": true,
      "tabIndex": 1,
      "events": ["Validated"],
      "modernPattern": {
        "type": "SplitDateTime",
        "dateInput": {
          "id": "dtPositionStartDate",
          "type": "date",
          "label": "Position Date",
          "required": true
        },
        "timeInput": {
          "id": "cboPositionStartTime",
          "type": "time",
          "label": "Position Time (24-hour)",
          "required": true
        },
        "displayFormat": "MM/dd/yyyy HH:mm",
        "combinedProperty": "PositionStartDateTime",
        "notes": "Uses InfragisticsHelper.SetCombinedDateTimeProp() to combine date and time"
      },
      "notes": "CRITICAL: Split date/time pattern required. Combined in Validated event using InfragisticsHelper.SetCombinedDateTimeProp()"
    },
    {
      "name": "cboPositionStartTime",
      "type": "UltraCombo",
      "category": "DetailEdit",
      "label": "Position Time (24-hour)",
      "dataBinding": "PositionStartDateTime",
      "populationMethod": "InfragisticsHelper.PopulateTimeCombo(cboPositionStartTime)",
      "validation": ["Time - Main.SetTimeValidatorExtender()"],
      "required": true,
      "tabIndex": 2,
      "events": ["Validated"],
      "notes": "CRITICAL: Part of split DateTime control. Populated with time values. Combined with dtPositionStartDate"
    },
    {
      "name": "txtBargeNum",
      "type": "UltraTextEditor",
      "category": "DetailEdit",
      "label": "Barge",
      "dataBinding": "BargeNum",
      "validation": ["ValidationTypeConstants.String"],
      "required": true,
      "bold": true,
      "tabIndex": 4,
      "events": ["Validated"],
      "notes": "Barge number identifier"
    },
    {
      "name": "chkLeftFleet",
      "type": "UltraCheckEditor",
      "category": "DetailEdit",
      "label": "Left fleet",
      "dataBinding": "LeftFleet",
      "validation": [],
      "required": false,
      "tabIndex": 5,
      "events": ["CheckedChanged"],
      "notes": "When checked, disables tier-related fields (cboTierID, txtTierX, txtTierY) via EnableDisableTierPos()"
    },
    {
      "name": "cboTierID",
      "type": "UltraCombo",
      "category": "DetailEdit",
      "label": "Tier",
      "dataBinding": "TierID",
      "populationMethod": "Lists.TierList.GetList(CStr(cboTierGroupSearch.ValueOrNull))",
      "validation": [],
      "required": false,
      "tabIndex": 7,
      "events": ["Validated"],
      "conditionalDisplay": {
        "enabledWhen": "chkLeftFleet.Checked = False",
        "disabledWhen": "chkLeftFleet.Checked = True"
      },
      "notes": "Disabled when barge has left fleet. Populated based on selected tier group from search"
    },
    {
      "name": "txtTierX",
      "type": "UltraTextEditor",
      "category": "DetailEdit",
      "label": "Tier X",
      "dataBinding": "TierX",
      "validation": ["ValidationTypeConstants.Int16"],
      "required": false,
      "tabIndex": 9,
      "events": ["Validated"],
      "conditionalDisplay": {
        "enabledWhen": "chkLeftFleet.Checked = False",
        "disabledWhen": "chkLeftFleet.Checked = True"
      },
      "notes": "X coordinate in tier. Disabled when barge has left fleet"
    },
    {
      "name": "txtTierY",
      "type": "UltraTextEditor",
      "category": "DetailEdit",
      "label": "Tier Y",
      "dataBinding": "TierY",
      "validation": ["ValidationTypeConstants.Int16"],
      "required": false,
      "tabIndex": 11,
      "events": ["Validated"],
      "conditionalDisplay": {
        "enabledWhen": "chkLeftFleet.Checked = False",
        "disabledWhen": "chkLeftFleet.Checked = True"
      },
      "notes": "Y coordinate in tier. Disabled when barge has left fleet"
    },
    {
      "name": "btnSubmit",
      "type": "UltraButton",
      "category": "DetailEdit",
      "text": "&Submit",
      "handler": "btnSubmit_Click",
      "buttonType": "Submit",
      "tabIndex": 12,
      "enabled": true,
      "visible": true,
      "anchor": "BottomRight",
      "notes": "Saves changes to FleetPositionHistory. Calls ClearUnusedFields() before submit"
    },
    {
      "name": "btnCancel",
      "type": "UltraButton",
      "category": "DetailEdit",
      "text": "C&ancel",
      "handler": "btnCancel_Click",
      "buttonType": "CancelEdit",
      "tabIndex": 13,
      "enabled": true,
      "visible": true,
      "anchor": "BottomRight",
      "causesValidation": false,
      "notes": "Cancels edit and refreshes grid"
    },
    {
      "name": "btnClose",
      "type": "UltraButton",
      "category": "FormAction",
      "text": "&Close",
      "handler": "btnClose_Click",
      "buttonType": "Cancel",
      "tabIndex": 0,
      "enabled": true,
      "visible": true,
      "anchor": "BottomRight",
      "causesValidation": false,
      "dialogResult": "DialogResult.Cancel",
      "notes": "Closes form with unsaved changes warning"
    }
  ],

  "grids": [
    {
      "name": "grdDetailEditList",
      "type": "UltraGrid",
      "uniqueIdentifier": "FleetPositionHistoryID",
      "dataSource": "Lists.FleetPositionHistorySearch.GetList()",
      "dataSourceParameters": [
        "_SelectedFleetID.ToString",
        "dtDateSearch.Value.ToString",
        "CStr(cboTierGroupSearch.ValueOrNull)",
        "txtBargeNumSearch.Text",
        "chkIncludeBlankTierPos.Checked"
      ],
      "dockStyle": "Fill",
      "columns": [
        {
          "key": "PositionStartDateTime",
          "header": "Date/Time",
          "dataType": "DateTime",
          "width": 105,
          "alignment": "Left",
          "sortable": true,
          "sortIndicator": "Ascending",
          "customComparer": "DateTimeSortComparer",
          "notes": "Initial sort column"
        },
        {
          "key": "BargeNum",
          "header": "Barge",
          "dataType": "String",
          "width": 146,
          "alignment": "Left",
          "sortable": true
        },
        {
          "key": "LeftFleet",
          "header": "Left Fleet",
          "dataType": "Boolean",
          "width": 62,
          "alignment": "Center",
          "sortable": true
        },
        {
          "key": "TierName",
          "header": "Tier",
          "dataType": "String",
          "width": 195,
          "alignment": "Left",
          "sortable": true
        },
        {
          "key": "TierPos",
          "header": "Tier Pos",
          "dataType": "String",
          "width": 57,
          "alignment": "Left",
          "sortable": true
        }
      ],
      "autoFitStyle": "ExtendLastColumn",
      "events": ["DoubleClick", "AfterSelectChange"],
      "notes": "Double-click opens record for editing via ItemModify(). Grid settings saved on form close."
    }
  ],

  "toolbars": [
    {
      "name": "ChildEditToolbar",
      "type": "UltraToolbar",
      "dockPosition": "Top",
      "tools": [
        {
          "key": "Add",
          "caption": "&Add",
          "image": "Resources.Add",
          "buttonType": "Add",
          "handler": "ItemAdd",
          "displayStyle": "ImageAndText",
          "enabledWhen": "Not IsEditingChild",
          "notes": "Creates new FleetPositionHistory with default values"
        },
        {
          "key": "Modify",
          "caption": "&Modify",
          "image": "Resources.Modify",
          "buttonType": "Open",
          "handler": "ItemModify",
          "displayStyle": "ImageAndText",
          "enabledWhen": "itemIsSelected And Not IsEditingChild",
          "notes": "Opens selected record for editing"
        },
        {
          "key": "Remove",
          "caption": "&Remove",
          "image": "Resources.Remove",
          "buttonType": "Remove",
          "handler": "ItemRemove",
          "displayStyle": "ImageAndText",
          "enabledWhen": "itemIsSelected And Not IsEditingChild",
          "notes": "Deletes selected record with confirmation dialog"
        },
        {
          "key": "Export",
          "caption": "Export",
          "image": "Resources.ExportResults",
          "buttonType": "Open",
          "handler": "Main.ExportGrid",
          "displayStyle": "ImageAndText",
          "enabledWhen": "atLeastOneRow And Not IsEditingChild",
          "isFirstInGroup": true,
          "notes": "Exports grid data"
        }
      ]
    }
  ],

  "validation": {
    "method": "ValidatorExtender",
    "displayControl": "staStatus",
    "rules": [
      {
        "control": "dtDateSearch",
        "rule": "Required for search",
        "validationType": null,
        "message": "Date and Tier group are required."
      },
      {
        "control": "cboTierGroupSearch",
        "rule": "Required for search",
        "validationType": null,
        "message": "Date and Tier group are required."
      },
      {
        "control": "txtTierX",
        "rule": "Int16",
        "validationType": "ValidationTypeConstants.Int16",
        "message": null
      },
      {
        "control": "txtTierY",
        "rule": "Int16",
        "validationType": "ValidationTypeConstants.Int16",
        "message": null
      },
      {
        "control": "cboPositionStartTime",
        "rule": "Time",
        "validationType": "Main.SetTimeValidatorExtender()",
        "message": null
      }
    ],
    "notes": "Search validation is manual check in RefreshList(). Detail validation uses ValidatorExtender."
  },

  "eventHandlers": {
    "frmDetailEdit_Load": "Calls FormatControls() and ResetControls(). Initializes form state.",
    "frmDetailEdit_FormClosed": "Saves grid settings via MyAppSettingHelper.SaveGrid()",
    "btnFind_Click": "Executes search via RefreshList(True). Validates Date and TierGroup are provided.",
    "btnReset_Click": "Calls ResetControls() to clear search criteria and set Date to Today",
    "btnSubmit_Click": "Calls ClearUnusedFields() then SubmitClick(). Refreshes grid on success.",
    "btnClose_Click": "Calls CancelClick() to close form with unsaved changes warning",
    "btnCancel_Click": "Calls CancelClick() to cancel edit and refresh grid",
    "ToolbarsManager_ToolClick": "Routes toolbar button clicks to ItemAdd, ItemModify, ItemRemove, or ExportGrid",
    "txtBargeNum_Validated": "Updates _FleetPositionHistory.BargeNum",
    "cboTierID_Validated": "Updates _FleetPositionHistory.TierID using InfragisticsHelper.SetObjectProperty()",
    "txtTierX_Validated": "Updates _FleetPositionHistory.TierX",
    "txtTierY_Validated": "Updates _FleetPositionHistory.TierY",
    "dtPositionStartDate_Validated": "Combines with cboPositionStartTime via InfragisticsHelper.SetCombinedDateTimeProp()",
    "cboPositionStartTime_Validated": "Combines with dtPositionStartDate via InfragisticsHelper.SetCombinedDateTimeProp()",
    "chkLeftFleet_CheckedChanged": "Updates _FleetPositionHistory.LeftFleet and calls EnableDisableTierPos()",
    "grdDetailEditList_DoubleClick": "Calls ItemModify() to edit selected record",
    "grdDetailEditList_AfterSelectChange": "Calls SetToolState() to enable/disable toolbar buttons"
  },

  "businessLogicMethods": {
    "Initialize": {
      "signature": "Initialize(selectedFleetID As Int32)",
      "description": "Initializes form with selected Fleet ID and creates new FleetPositionHistory business object",
      "parameters": ["selectedFleetID"]
    },
    "FormatControls": {
      "description": "Populates tier group search combo, time combo. Sets grid identifier and sort order. Sets validation and max lengths.",
      "calls": [
        "PopulateListCombo(Lists.TierGroupSearch.GetList(_SelectedFleetID), cboTierGroupSearch, True, False)",
        "InfragisticsHelper.PopulateTimeCombo(cboPositionStartTime)",
        "SetValidatorExtenderForFleetPositionHistory()",
        "SetMaxLengthsForFleetPositionHistory()",
        "EnableDisableControls(False)"
      ]
    },
    "ResetControls": {
      "description": "Clears search criteria and sets Date to Today",
      "sets": {
        "cboTierGroupSearch": "Empty",
        "dtDateSearch.Value": "Date.Today",
        "txtBargeNumSearch.Text": "Empty"
      }
    },
    "ClearControls": {
      "description": "Clears all detail edit controls",
      "sets": {
        "dtPositionStartDate.Text": "Empty",
        "cboPositionStartTime": "Empty",
        "txtBargeNum.Text": "Empty",
        "chkLeftFleet.Checked": "False",
        "cboTierID": "Empty",
        "txtTierX.Text": "Empty",
        "txtTierY.Text": "Empty"
      }
    },
    "RefreshList": {
      "signature": "RefreshList(selectFirstRow As Boolean)",
      "description": "Refreshes grid with search results. Validates Date and TierGroup are provided.",
      "calls": "Lists.FleetPositionHistorySearch.GetList(_SelectedFleetID.ToString, dtDateSearch.Value.ToString, CStr(cboTierGroupSearch.ValueOrNull), txtBargeNumSearch.Text, chkIncludeBlankTierPos.Checked).List"
    },
    "ItemAdd": {
      "description": "Creates new FleetPositionHistory record with default values. Sets FleetID and PositionStartDateTime.",
      "defaultValues": {
        "FleetID": "_SelectedFleetID",
        "PositionStartDateTime": "dtDateSearch.Text & ' ' & Lists.GlobalSettingList.FleetingDayStartTime"
      },
      "calls": [
        "FleetPositionHistory.NewFleetPositionHistory",
        "PopulateListCombo(Lists.TierList.GetList(CStr(cboTierGroupSearch.ValueOrNull)), cboTierID, True, False)",
        "LoadControlsForFleetPositionHistory()",
        "EnableDisableControls(True)"
      ],
      "focus": "txtBargeNum"
    },
    "ItemModify": {
      "description": "Loads selected record for editing",
      "calls": [
        "FleetPositionHistory.GetFleetPositionHistory(selectedRowID)",
        "PopulateListCombo(Lists.TierList.GetList(CStr(cboTierGroupSearch.ValueOrNull)), cboTierID, True, False, _FleetPositionHistory.TierID)",
        "LoadControlsForFleetPositionHistory()",
        "EnableDisableControls(True)"
      ],
      "focus": "dtPositionStartDate"
    },
    "ItemRemove": {
      "description": "Deletes selected record with confirmation dialog",
      "calls": [
        "Main.ItemRemoveDialog('Barge Position')",
        "FleetPositionHistory.DeleteFleetPositionHistory(selectedRowID)",
        "RefreshList(False)",
        "SetToolState(grdDetailEditList)"
      ]
    },
    "EnableDisableControls": {
      "signature": "EnableDisableControls(isEditing As Boolean)",
      "description": "Enables/disables panels based on edit mode. Calls EnableDisableTierPos() when editing.",
      "logic": {
        "isEditing=True": "grpDetailEditChild enabled, pnlDetailEdit disabled",
        "isEditing=False": "grpDetailEditChild disabled, pnlDetailEdit enabled"
      }
    },
    "EnableDisableTierPos": {
      "description": "Enables/disables tier-related controls based on chkLeftFleet",
      "logic": {
        "chkLeftFleet.Checked=True": "Disables cboTierID, txtTierX, txtTierY and their labels",
        "chkLeftFleet.Checked=False": "Enables cboTierID, txtTierX, txtTierY and their labels"
      }
    },
    "ClearUnusedFields": {
      "description": "Clears tier-related fields when LeftFleet is checked",
      "logic": "If _FleetPositionHistory.LeftFleet Then clear TierID, TierX, TierY"
    },
    "LoadControlsForFleetPositionHistory": {
      "description": "Loads FleetPositionHistory properties into controls",
      "mappings": {
        "txtBargeNum.Text": "_FleetPositionHistory.BargeNum",
        "cboTierID": "_FleetPositionHistory.TierID",
        "txtTierX.Text": "_FleetPositionHistory.TierX",
        "txtTierY.Text": "_FleetPositionHistory.TierY",
        "dtPositionStartDate.Text": "_FleetPositionHistory.PositionStartDateTime",
        "cboPositionStartTime": "_FleetPositionHistory.PositionStartDateTime",
        "chkLeftFleet.Checked": "_FleetPositionHistory.LeftFleet"
      }
    }
  },

  "dataflow": {
    "initialization": "Form initialized with selectedFleetID → Creates new FleetPositionHistory → Populates tier group search",
    "search": "User enters Date and TierGroup → Clicks Find → Validates criteria → Calls FleetPositionHistorySearch.GetList() → Populates grid",
    "add": "User clicks Add → Creates new FleetPositionHistory with defaults → Populates tier combo → Enables detail panel → User enters data → Validates → Saves → Refreshes grid",
    "edit": "User double-clicks grid row OR clicks Modify → Loads FleetPositionHistory → Populates tier combo with current selection → Enables detail panel → User modifies → Validates → Saves → Refreshes grid",
    "delete": "User selects row → Clicks Remove → Confirmation dialog → Calls DeleteFleetPositionHistory → Refreshes grid",
    "conditionalLogic": "When chkLeftFleet is checked → Disables and clears tier fields (TierID, TierX, TierY)"
  },

  "modernizationNotes": {
    "dateTimeControls": "CRITICAL: dtPositionStartDate and cboPositionStartTime must be converted to split date/time inputs with 24-hour time format",
    "gridComponent": "Use DataTables with server-side processing for grdDetailEditList",
    "dropdowns": "Use Select2 for cboTierGroupSearch, cboTierID, cboPositionStartTime",
    "validation": "Convert ValidatorExtender to ASP.NET Core model validation with client-side jQuery validation",
    "toolbar": "Convert UltraToolbarsManager to Bootstrap button toolbar",
    "searchPattern": "Implement as Index view with search form and results grid",
    "detailPattern": "Implement as partial view that loads in detail section below grid",
    "statusBar": "Convert staStatus to toast notifications or validation summary",
    "businessLogic": "FleetPositionHistory business object → FleetPositionHistoryDto with repository pattern",
    "security": "Convert ButtonType security to ASP.NET Core authorization policies",
    "conditionalUI": "chkLeftFleet conditional logic → JavaScript to toggle tier field visibility/enabled state"
  },

  "securityMapping": {
    "buttons": {
      "btnFind": "ButtonType.Action",
      "btnReset": "ButtonType.Action",
      "btnSubmit": "ButtonType.Submit",
      "btnClose": "ButtonType.Cancel",
      "btnCancel": "ButtonType.CancelEdit",
      "Add": "ButtonType.Add",
      "Modify": "ButtonType.Open",
      "Remove": "ButtonType.Remove",
      "Export": "ButtonType.Open"
    },
    "notes": "ControlAuthorization.ToolbarButtonCanBeEnabled() checks security for toolbar buttons"
  },

  "formSettings": {
    "minimizeBox": false,
    "showInTaskbar": false,
    "startPosition": "CenterParent",
    "minimumSize": "608x504",
    "acceptButton": "btnFind",
    "cancelButton": "btnClose"
  }
}
