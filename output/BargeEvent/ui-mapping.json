{
  "entity": "BargeEvent",
  "description": "Complex multi-entity form for managing barge events, tickets, and multiple barges with billing operations",
  "controlMappings": [
    {
      "legacyControl": "UltraTextEditor",
      "modernEquivalent": "Bootstrap Text Input",
      "html": "<input type=\"text\" class=\"form-control\" asp-for=\"PropertyName\" />",
      "examples": [
        "Event number",
        "Ticket number",
        "Reference numbers",
        "Notes fields",
        "Customer name",
        "Contract number"
      ],
      "accessibility": "Use asp-for tag helper for automatic label association and validation",
      "validation": "jquery.validate with asp-validation-for span"
    },
    {
      "legacyControl": "UltraComboEditor",
      "modernEquivalent": "Select2 Dropdown",
      "html": "<select class=\"form-select\" asp-for=\"PropertyName\" asp-items=\"Model.SelectListItems\">\n    <option value=\"\">-- Select --</option>\n</select>",
      "javascript": "$(selector).select2({ placeholder: '-- Select --', allowClear: true });",
      "examples": [
        "Event Type dropdown",
        "Customer dropdown",
        "Vessel/Boat dropdown",
        "Origin facility dropdown",
        "Destination facility dropdown",
        "River dropdown",
        "Barge series dropdown",
        "Draft type dropdown"
      ],
      "accessibility": "Select2 provides keyboard navigation and screen reader support",
      "validation": "Required fields validated with jquery.validate",
      "notes": "Use asp-items for data binding, initialize Select2 in document.ready"
    },
    {
      "legacyControl": "UltraDateTimeEditor",
      "modernEquivalent": "SPLIT Date + Time Inputs (24-hour format)",
      "html": "<div class=\"row\">\n    <div class=\"col-md-6\">\n        <label asp-for=\"EventDateTime\" class=\"form-label\">Event Date</label>\n        <input asp-for=\"EventDateTime\" class=\"form-control\" type=\"date\" id=\"dtEventDate\" />\n    </div>\n    <div class=\"col-md-6\">\n        <label class=\"form-label\">Event Time (24-hour)</label>\n        <input type=\"time\" class=\"form-control\" id=\"dtEventTime\" />\n    </div>\n</div>",
      "javascript": "function splitDateTime(dateTimeValue, dateFieldId, timeFieldId) {\n    if (dateTimeValue) {\n        var date = new Date(dateTimeValue);\n        if (!isNaN(date.getTime())) {\n            $('#' + dateFieldId).val(date.toISOString().split('T')[0]);\n            var hours = ('0' + date.getHours()).slice(-2);\n            var minutes = ('0' + date.getMinutes()).slice(-2);\n            $('#' + timeFieldId).val(hours + ':' + minutes);\n        }\n    }\n}\n\nfunction combineDateTime(dateFieldId, timeFieldId) {\n    var date = $('#' + dateFieldId).val();\n    var time = $('#' + timeFieldId).val();\n    return (date && time) ? date + 'T' + time + ':00' : (date ? date + 'T00:00:00' : '');\n}\n\n$(function() {\n    splitDateTime('@Model.EventDateTime?.ToString(\"o\")', 'dtEventDate', 'dtEventTime');\n    $('form').on('submit', function() {\n        var combined = combineDateTime('dtEventDate', 'dtEventTime');\n        if (combined) $('#dtEventDate').val(combined);\n    });\n});",
      "displayFormat": "MM/dd/yyyy HH:mm (24-hour military time)",
      "displayExample": "02/07/2025 23:52",
      "examples": [
        "Event date/time",
        "C/P (Charter Party) time",
        "Release time",
        "Arrival date/time",
        "Departure date/time",
        "Position updated date/time"
      ],
      "accessibility": "ARIA labels on both date and time inputs",
      "validation": "Validate combined datetime on form submit",
      "criticalNotes": [
        "NEVER use single datetime-local input",
        "ALWAYS use 24-hour format (HH:mm) NOT 12-hour (hh:mm tt)",
        "ALWAYS split on page load and combine on submit",
        "Display format MUST show military time"
      ]
    },
    {
      "legacyControl": "UltraCheckEditor",
      "modernEquivalent": "Bootstrap Checkbox",
      "html": "<div class=\"form-check\">\n    <input asp-for=\"IsActive\" class=\"form-check-input\" type=\"checkbox\" />\n    <label asp-for=\"IsActive\" class=\"form-check-label\"></label>\n</div>",
      "examples": [
        "Is Active",
        "Create onboard order checkbox",
        "Mark for rebill",
        "Include in billing",
        "Void event"
      ],
      "accessibility": "Use form-check-input and form-check-label for proper association",
      "notes": "Inline checkboxes use form-check-inline class"
    },
    {
      "legacyControl": "UltraGrid",
      "modernEquivalent": "DataTables with Server-Side Processing",
      "html": "<div class=\"table-responsive\">\n    <table id=\"bargeEventTable\" class=\"table table-striped table-bordered dt-responsive nowrap\" style=\"width:100%\">\n        <thead>\n            <tr>\n                <th>Actions</th>\n                <th>Event Number</th>\n                <th>Event Type</th>\n                <th>Customer</th>\n                <th>Event Date</th>\n                <th>Barges</th>\n                <th>Origin</th>\n                <th>Destination</th>\n                <th>Vessel</th>\n                <th>Status</th>\n            </tr>\n        </thead>\n        <tbody></tbody>\n    </table>\n</div>",
      "javascript": "$(document).ready(function() {\n    var dataTable = $('#bargeEventTable').DataTable({\n        processing: true,\n        serverSide: true,\n        stateSave: true,\n        responsive: true,\n        autoWidth: false,\n        ajax: {\n            url: '/BargeEventSearch/EventTable',\n            type: 'POST',\n            data: function(d) {\n                d.eventTypeId = $('#EventTypeId').val();\n                d.customerId = $('#CustomerId').val();\n                d.eventDateFrom = combineDateTime('dtEventDateFrom', 'dtEventTimeFrom');\n                d.eventDateTo = combineDateTime('dtEventDateTo', 'dtEventTimeTo');\n                d.ticketNumber = $('#TicketNumber').val();\n                d.bargeNumber = $('#BargeNumber').val();\n                d.vesselId = $('#VesselId').val();\n            }\n        },\n        columns: [\n            {\n                data: null,\n                orderable: false,\n                searchable: false,\n                className: 'text-center',\n                width: '80px',\n                render: function(data, type, row) {\n                    return '<div class=\"btn-group btn-group-sm\" role=\"group\">' +\n                           '<a href=\"/BargeEventDetail/Edit/' + row.ticketEventId + '\" class=\"btn btn-sm btn-primary\" title=\"Edit\">' +\n                           '<i class=\"fas fa-edit\"></i></a>' +\n                           '</div>';\n                }\n            },\n            { data: 'eventNumber', defaultContent: '' },\n            { data: 'eventType', defaultContent: '' },\n            { data: 'customer', defaultContent: '' },\n            {\n                data: 'eventDateTime',\n                render: function(data) {\n                    return data ? new Date(data).toLocaleString('en-US', {\n                        year: 'numeric',\n                        month: '2-digit',\n                        day: '2-digit',\n                        hour: '2-digit',\n                        minute: '2-digit',\n                        hour12: false\n                    }) : '';\n                }\n            },\n            { data: 'bargeCount', defaultContent: '0' },\n            { data: 'origin', defaultContent: '' },\n            { data: 'destination', defaultContent: '' },\n            { data: 'vessel', defaultContent: '' },\n            { data: 'status', defaultContent: '' }\n        ],\n        order: [[4, 'desc']],\n        pageLength: 25,\n        lengthMenu: [[10, 25, 50, 100], [10, 25, 50, 100]]\n    });\n\n    $('#btnSearch').click(function() {\n        dataTable.ajax.reload();\n    });\n});",
      "examples": [
        "Main search grid showing event list",
        "Barge list grid within event detail",
        "Billing detail grids (Freight, Demurrage)",
        "Draft detail grids",
        "Delay list grid"
      ],
      "features": [
        "Server-side processing for large datasets",
        "Column sorting and filtering",
        "Pagination",
        "State saving in localStorage",
        "Responsive design",
        "Custom action buttons"
      ],
      "accessibility": "DataTables provides keyboard navigation and ARIA support",
      "contextMenu": "Right-click context menu for Mark/Unmark for Rebill operations",
      "notes": "Use dt-responsive class for responsive tables, nowrap to prevent text wrapping"
    },
    {
      "legacyControl": "UltraPanel",
      "modernEquivalent": "Bootstrap Card",
      "html": "<div class=\"card mb-3\">\n    <div class=\"card-header\">\n        <h5 class=\"card-title mb-0\">\n            <i class=\"fas fa-icon\"></i> Panel Title\n        </h5>\n    </div>\n    <div class=\"card-body\">\n        <!-- Panel content -->\n    </div>\n</div>",
      "examples": [
        "Search criteria panel",
        "Event details panel",
        "Barge list panel",
        "Billing information panel",
        "Notes panel"
      ],
      "accessibility": "Use semantic HTML with proper heading hierarchy",
      "notes": "mb-3 provides bottom margin, use card-footer if needed"
    },
    {
      "legacyControl": "UltraTabControl",
      "modernEquivalent": "Bootstrap Nav Tabs",
      "html": "<ul class=\"nav nav-tabs\" id=\"eventTabs\" role=\"tablist\">\n    <li class=\"nav-item\" role=\"presentation\">\n        <button class=\"nav-link active\" id=\"details-tab\" data-bs-toggle=\"tab\" data-bs-target=\"#details\" type=\"button\" role=\"tab\">\n            Event Details\n        </button>\n    </li>\n    <li class=\"nav-item\" role=\"presentation\">\n        <button class=\"nav-link\" id=\"barges-tab\" data-bs-toggle=\"tab\" data-bs-target=\"#barges\" type=\"button\" role=\"tab\">\n            Barges\n        </button>\n    </li>\n    <li class=\"nav-item\" role=\"presentation\">\n        <button class=\"nav-link\" id=\"billing-tab\" data-bs-toggle=\"tab\" data-bs-target=\"#billing\" type=\"button\" role=\"tab\">\n            Billing\n        </button>\n    </li>\n</ul>\n<div class=\"tab-content\" id=\"eventTabsContent\">\n    <div class=\"tab-pane fade show active\" id=\"details\" role=\"tabpanel\">\n        <!-- Event details content -->\n    </div>\n    <div class=\"tab-pane fade\" id=\"barges\" role=\"tabpanel\">\n        <!-- Barge list content -->\n    </div>\n    <div class=\"tab-pane fade\" id=\"billing\" role=\"tabpanel\">\n        <!-- Billing content -->\n    </div>\n</div>",
      "javascript": "// Optional: Tab switch event handling\n$('#eventTabs button[data-bs-toggle=\"tab\"]').on('shown.bs.tab', function(e) {\n    var targetTab = $(e.target).attr('data-bs-target');\n    if (targetTab === '#barges') {\n        // Refresh barge grid when switching to barges tab\n        $('#bargeListTable').DataTable().ajax.reload();\n    }\n});",
      "examples": [
        "Event Details / Barge Details / Billing tabs",
        "Freight Billing / Demurrage Billing / Billing Audit tabs",
        "Draft Detail tabs"
      ],
      "accessibility": "Bootstrap tabs include ARIA roles and keyboard navigation",
      "securityNotes": "Use ViewModel properties to conditionally hide billing tabs based on BargeEventBillingView permission",
      "conditionalDisplay": "@if (Model.CanViewBilling) { <!-- Show billing tab --> }",
      "notes": "Use fade class for smooth transitions, active and show on default tab"
    },
    {
      "legacyControl": "UltraButton",
      "modernEquivalent": "Bootstrap Button",
      "html": "<button type=\"submit\" class=\"btn btn-primary\">\n    <i class=\"fas fa-save\"></i> Submit\n</button>\n<button type=\"button\" class=\"btn btn-secondary\">\n    <i class=\"fas fa-times\"></i> Cancel\n</button>",
      "variants": [
        "btn-primary: Primary actions (Submit, Save)",
        "btn-secondary: Secondary actions (Cancel, Reset)",
        "btn-success: Create actions (Add New)",
        "btn-danger: Delete actions (Remove)",
        "btn-warning: Warning actions (Mark for Rebill)",
        "btn-info: Info actions (View Details)",
        "btn-sm: Small buttons for toolbars and grids",
        "btn-group: Group related buttons"
      ],
      "examples": [
        "Submit button (btnSubmit)",
        "Cancel button (btnCancel)",
        "Find button (btnFind)",
        "Reset button (btnReset)",
        "Add To List button (btnAddToList)",
        "Delays button (btnDelays)",
        "Draft Detail button (btnDraftDetail)"
      ],
      "accessibility": "Include aria-label for icon-only buttons",
      "securityNotes": "Use ViewModel properties to conditionally hide buttons based on permissions",
      "conditionalDisplay": "@if (Model.CanModify) { <button>Submit</button> }",
      "notes": "Include Font Awesome icons for visual clarity"
    },
    {
      "legacyControl": "UltraToolbar",
      "modernEquivalent": "Bootstrap Button Toolbar / Button Group",
      "html": "<div class=\"btn-toolbar mb-3\" role=\"toolbar\">\n    <div class=\"btn-group me-2\" role=\"group\">\n        <button type=\"button\" class=\"btn btn-sm btn-primary\" title=\"Add to List\">\n            <i class=\"fas fa-plus\"></i> Add\n        </button>\n        <button type=\"button\" class=\"btn btn-sm btn-warning\" title=\"Modify Details\">\n            <i class=\"fas fa-edit\"></i> Modify\n        </button>\n        <button type=\"button\" class=\"btn btn-sm btn-danger\" title=\"Remove from List\">\n            <i class=\"fas fa-trash\"></i> Remove\n        </button>\n    </div>\n    <div class=\"btn-group me-2\" role=\"group\">\n        <button type=\"button\" class=\"btn btn-sm btn-info\" title=\"Modify Barge\">\n            <i class=\"fas fa-ship\"></i> Barge\n        </button>\n        <button type=\"button\" class=\"btn btn-sm btn-info\" title=\"Barge Positions\">\n            <i class=\"fas fa-map-marker-alt\"></i> Positions\n        </button>\n    </div>\n    <div class=\"btn-group\" role=\"group\">\n        <button type=\"button\" class=\"btn btn-sm btn-success\" title=\"Export\">\n            <i class=\"fas fa-file-excel\"></i> Export\n        </button>\n    </div>\n</div>",
      "examples": [
        "Detail form toolbar with barge operations",
        "Add/Modify/Remove barge buttons",
        "Modify Barge / New Barge / Positions buttons",
        "Enter Tonnages / Manage Boats / Export buttons"
      ],
      "accessibility": "Use role=\"toolbar\" and role=\"group\" for screen readers",
      "securityNotes": "Toolbar buttons require BargeEventModify permission except View/Export operations",
      "notes": "Use btn-sm for compact toolbar buttons, me-2 for spacing between groups"
    },
    {
      "legacyControl": "UltraNumericEditor",
      "modernEquivalent": "Bootstrap Number Input",
      "html": "<input type=\"number\" class=\"form-control\" asp-for=\"Quantity\" step=\"0.01\" min=\"0\" />",
      "examples": [
        "Quantity/Tonnage fields",
        "Draft measurements",
        "Mile marker",
        "Horsepower",
        "Freight rate"
      ],
      "accessibility": "Use aria-label for fields without visible labels",
      "validation": "HTML5 number validation with min/max/step attributes",
      "notes": "Use step=\"0.01\" for decimal values, step=\"1\" for integers"
    },
    {
      "legacyControl": "UltraTextEditor (Multiline)",
      "modernEquivalent": "Bootstrap Textarea",
      "html": "<textarea class=\"form-control\" asp-for=\"Notes\" rows=\"3\" placeholder=\"Enter notes...\"></textarea>",
      "examples": [
        "Event notes",
        "Billing notes",
        "Invoice notes",
        "Comments",
        "Description fields"
      ],
      "accessibility": "Use rows attribute for default height",
      "notes": "Use maxlength attribute to enforce character limits"
    },
    {
      "legacyControl": "UltraLabel (Display-only)",
      "modernEquivalent": "Bootstrap Read-only Input or Plain Text",
      "html": "<input type=\"text\" class=\"form-control\" asp-for=\"EventNumber\" readonly />\n<!-- OR -->\n<div class=\"form-control-plaintext\">@Model.EventNumber</div>",
      "examples": [
        "Auto-generated event numbers",
        "Calculated totals",
        "System timestamps",
        "Audit information"
      ],
      "notes": "Use readonly attribute for inputs, form-control-plaintext for plain display"
    }
  ],
  "formPatterns": {
    "searchForm": {
      "layout": "Bootstrap form with row/col grid system",
      "container": "Bootstrap card with card-header and card-body",
      "structure": "<div class=\"card mb-3\">\n    <div class=\"card-header\">\n        <h5 class=\"card-title mb-0\"><i class=\"fas fa-search\"></i> Search Criteria</h5>\n    </div>\n    <div class=\"card-body\">\n        <form id=\"searchForm\">\n            <div class=\"row mb-3\">\n                <div class=\"col-md-3\"><!-- Input --></div>\n                <div class=\"col-md-3\"><!-- Input --></div>\n            </div>\n        </form>\n    </div>\n</div>",
      "submitButton": "btn btn-primary with <i class=\"fas fa-search\"></i> icon",
      "resetButton": "btn btn-secondary with <i class=\"fas fa-undo\"></i> icon",
      "newButton": "btn btn-success float-end with <i class=\"fas fa-plus\"></i> icon",
      "accessibility": "Use form-label with asp-for for automatic label association",
      "validation": "Search forms typically don't require validation, but can enforce required criteria",
      "notes": "BargeEvent search requires at least one criterion to prevent overly broad queries"
    },
    "detailForm": {
      "layout": "Bootstrap form with tabbed interface for complex multi-section forms",
      "container": "Bootstrap card containing nav-tabs and tab-content",
      "structure": "<form asp-action=\"Edit\" method=\"post\">\n    <div class=\"card\">\n        <div class=\"card-header\">\n            <ul class=\"nav nav-tabs card-header-tabs\" id=\"eventTabs\" role=\"tablist\">\n                <!-- Tabs -->\n            </ul>\n        </div>\n        <div class=\"card-body\">\n            <div class=\"tab-content\" id=\"eventTabsContent\">\n                <!-- Tab panes -->\n            </div>\n        </div>\n        <div class=\"card-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Submit</button>\n            <a asp-action=\"Index\" class=\"btn btn-secondary\">Cancel</a>\n        </div>\n    </div>\n</form>",
      "submitButton": "btn btn-primary in card-footer",
      "cancelButton": "btn btn-secondary (link back to Index)",
      "accessibility": "Use asp-validation-summary for form-level errors",
      "validation": "jquery.validate with unobtrusive validation, asp-validation-for spans",
      "readOnlyMode": "Set readonly attribute on inputs and disabled on buttons when Model.IsReadOnly",
      "permissionControl": "Use @if (Model.CanModify) to conditionally show/enable submit button",
      "notes": "BargeEvent has separate access levels for non-billing and billing tabs"
    },
    "gridPattern": {
      "library": "DataTables",
      "serverSide": true,
      "stateSave": true,
      "responsive": true,
      "initialization": "$(document).ready(function() { $('#tableId').DataTable({...}); });",
      "ajaxUrl": "Controller action returning DataTable-compatible JSON",
      "actionColumn": "First column with Edit/View/Delete buttons, orderable: false, searchable: false",
      "dateTimeRendering": "Custom render function to format ISO dates to MM/dd/yyyy HH:mm (24-hour)",
      "contextMenu": "Custom right-click context menu for bulk operations (Mark/Unmark for Rebill)",
      "export": "Server-side Excel export via controller action",
      "notes": "Use consistent column ordering: Actions first, then data columns"
    },
    "modalPattern": {
      "library": "Bootstrap Modal",
      "structure": "<div class=\"modal fade\" id=\"modalId\" tabindex=\"-1\">\n    <div class=\"modal-dialog\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h5 class=\"modal-title\">Title</h5>\n                <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\"></button>\n            </div>\n            <div class=\"modal-body\">\n                <!-- Content -->\n            </div>\n            <div class=\"modal-footer\">\n                <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Close</button>\n                <button type=\"button\" class=\"btn btn-primary\">Save</button>\n            </div>\n        </div>\n    </div>\n</div>",
      "initialization": "$('#modalId').modal('show');",
      "examples": [
        "Add barge to event modal",
        "Modify barge details modal",
        "Enter tonnages modal",
        "Manage boats modal (frmModalSearch)",
        "Draft detail modal",
        "Delays modal"
      ],
      "accessibility": "Bootstrap modals include ARIA attributes and focus management",
      "notes": "Use modal-lg or modal-xl for larger modals with complex content"
    },
    "validationPattern": {
      "library": "jquery.validate with ASP.NET Core Unobtrusive Validation",
      "clientSide": "Data attributes automatically added by asp-for tag helpers",
      "serverSide": "ModelState.IsValid check in controller actions",
      "displayErrors": "<span asp-validation-for=\"PropertyName\" class=\"text-danger\"></span>",
      "summaryErrors": "<div asp-validation-summary=\"ModelOnly\" class=\"alert alert-danger\"></div>",
      "customValidation": "Custom jQuery validate rules for complex business logic",
      "examples": [
        "Required fields",
        "Date range validation",
        "Numeric range validation",
        "Custom business rules (e.g., at least one barge required)"
      ],
      "notes": "Include jquery.validate and jquery.validate.unobtrusive scripts"
    }
  },
  "styleGuidelines": {
    "framework": "Bootstrap 5",
    "formControls": "All inputs must have form-control class",
    "labels": "Use asp-for tag helper with form-label class",
    "spacing": "Use Bootstrap spacing utilities (mb-3, me-2, etc.)",
    "responsive": "Use Bootstrap grid system (row, col-md-*, col-lg-*)",
    "icons": "Font Awesome 5+ for all icons",
    "colors": "Bootstrap contextual colors (primary, secondary, success, danger, warning, info)",
    "cards": "Use card component for all panel-like containers",
    "tables": "Use table, table-striped, table-bordered classes",
    "buttons": "Include icons for all buttons, use btn-sm for toolbar/grid buttons",
    "accessibility": [
      "Use semantic HTML elements",
      "Include aria-label for icon-only buttons",
      "Use role attributes for complex components",
      "Ensure keyboard navigation works",
      "Maintain proper heading hierarchy (h1-h6)"
    ],
    "noInlineStyles": "NEVER use inline styles, use CSS classes only",
    "consistentNaming": "Use camelCase for JavaScript IDs, PascalCase for C# properties"
  },
  "javascriptPatterns": {
    "dataTablesInit": "Initialize DataTables in $(document).ready()",
    "select2Init": "Initialize Select2 dropdowns in $(document).ready()",
    "dateTimeSplit": "Split datetime values on page load, combine on form submit",
    "formSubmit": "Attach submit event handler to combine datetime fields before posting",
    "ajaxCalls": "Use jQuery.ajax() for async operations, include CSRF token",
    "eventHandlers": "Use .on() for dynamic elements, .click() for static elements",
    "validation": "Use jquery.validate for client-side validation",
    "stateManagement": "Use localStorage for DataTable state, user preferences",
    "errorHandling": "Display user-friendly error messages, log to console for debugging",
    "examples": {
      "splitDateTime": "See UltraDateTimeEditor mapping above for complete example",
      "datatablesSearch": "See UltraGrid mapping above for complete example",
      "select2": "$('#CustomerId').select2({ placeholder: '-- Select Customer --', allowClear: true });"
    }
  },
  "securityPatterns": {
    "authentication": "ASP.NET Core Identity with OIDC (UI) and ApiKey (API)",
    "authorization": "[Authorize] attribute on controllers and actions",
    "permissions": [
      "BargeEventView: View events and search records",
      "BargeEventModify: Create, update, manage events and barges",
      "BargeEventBillingView: View billing information",
      "BargeEventBillingModify: Modify billing information"
    ],
    "viewModelProperties": [
      "CanModify: Controls edit mode and submit button visibility",
      "IsReadOnly: Disables all input fields when lacking modify permission",
      "CanViewBilling: Controls billing tab visibility",
      "CanModifyBilling: Controls billing tab edit capabilities"
    ],
    "conditionalRendering": "@if (Model.CanModify) { <!-- Show edit controls --> }",
    "buttonSecurity": "Hide buttons when user lacks required permission using ViewModel properties",
    "tabSecurity": "Hide billing tabs when user lacks BargeEventBillingView permission",
    "csrfProtection": "Include @Html.AntiForgeryToken() in all forms",
    "notes": [
      "API uses ApiKey authentication, UI uses OIDC",
      "CSG Authorization framework for fine-grained permission control (future)",
      "Toolbar buttons tracked for permission checking",
      "Cross-entity operations require corresponding entity permissions (Barge, Boat)"
    ]
  },
  "specialFeatures": {
    "multiBargeManagement": {
      "description": "Manage multiple barges within a single event",
      "uiComponents": [
        "Barge list DataTable grid",
        "Add to List button/toolbar",
        "Modify Details toolbar button",
        "Remove from List toolbar button",
        "Enter Tonnages toolbar button"
      ],
      "permissions": "Add/Remove/Modify operations require BargeEventModify",
      "notes": "Grid displays all barges associated with the event, supports inline editing"
    },
    "billingTabs": {
      "description": "Separate tab interface for billing operations with distinct access levels",
      "tabs": [
        "Billing: General billing information",
        "Freight Billing: Freight-specific billing (license required)",
        "Demurrage Billing: Demurrage calculations",
        "Billing Audit: Billing change history"
      ],
      "permissions": "BargeEventBillingView to view, BargeEventBillingModify to edit",
      "conditionalDisplay": "Freight Billing tab only visible when Freight license active",
      "notes": "Separate access levels allow read-only operations with editable billing"
    },
    "rebillingOperations": {
      "description": "Mark/Unmark events for rebilling with multi-row selection",
      "uiComponents": [
        "Context menu on search grid (right-click)",
        "Mark for Rebill menu item",
        "Unmark for Rebill menu item"
      ],
      "permissions": "BargeEventModify required for rebilling operations",
      "implementation": "Context menu triggers AJAX call to SetRebill action",
      "notes": "Updates Ticket.UpdateRebillForTicketEvents, works on multiple selected rows"
    },
    "draftManagement": {
      "description": "View and manage draft details for barge drafts",
      "uiComponents": [
        "Draft Detail button (single barge, non-Draft Survey events)",
        "Survey Draft Detail button (Draft Survey events)",
        "Draft detail modal with grid"
      ],
      "permissions": "BargeEventView to view, BargeEventModify to edit",
      "conditionalDisplay": "Draft Detail button only enabled when single barge selected and not Draft Survey event type",
      "notes": "Separate buttons for regular draft vs. survey draft details"
    },
    "crossEntityIntegration": {
      "description": "Integration with Barge, Boat, and Ticket entities",
      "operations": [
        {
          "entity": "Barge",
          "buttons": ["Modify Barge", "New Barge", "Barge Positions"],
          "permissions": "Requires corresponding Barge permissions",
          "notes": "Opens Barge forms in modal or new window"
        },
        {
          "entity": "Boat",
          "buttons": ["Manage Boats"],
          "permissions": "Requires Boat permissions",
          "notes": "Opens Boat Search modal for vessel selection"
        },
        {
          "entity": "Ticket",
          "relationship": "Event is part of Ticket hierarchy",
          "notes": "Update notifications sent to Ticket subsystem on save"
        }
      ]
    },
    "licenseBasedFeatures": {
      "description": "Features conditionally displayed based on active licenses",
      "licenses": [
        {
          "license": "Freight",
          "features": [
            "Freight billing tab",
            "Freight customer search field",
            "Contract number search field",
            "Freight-related grid columns (C/P Time, Release Time, Quantity)",
            "Freight rate modifications"
          ],
          "viewModelProperty": "IsFreightActive"
        },
        {
          "license": "Onboard",
          "features": [
            "Create onboard order checkbox",
            "Onboard order integration dialog"
          ],
          "viewModelProperty": "IsOnboardActive"
        }
      ],
      "conditionalDisplay": "@if (Model.IsFreightActive) { <!-- Show freight features --> }",
      "notes": "License flags checked in ViewModel, passed to views for conditional rendering"
    },
    "voidedRecordDisplay": {
      "description": "Display voided events with strikethrough formatting",
      "implementation": "DataTables rowCallback to add strikethrough CSS class for voided records",
      "javascript": "rowCallback: function(row, data) {\n    if (data.isVoided) {\n        $(row).addClass('text-decoration-line-through');\n    }\n}",
      "notes": "Voided records remain visible but clearly marked as voided"
    },
    "exportFunctionality": {
      "description": "Export grid data to Excel",
      "uiComponents": ["Export toolbar button"],
      "permissions": "BargeEventView",
      "implementation": "Server-side export via controller action using EPPlus or similar library",
      "notes": "Export includes current search filters and all columns"
    }
  },
  "implementationNotes": [
    "BargeEvent is a complex multi-entity form managing tickets, events, and multiple barges",
    "Search requires at least one search criterion to prevent overly broad queries",
    "Detail form uses tabbed interface for organizing complex information",
    "Separate access levels for non-billing (tpgBargeDetails) and billing (tpgBilling) tabs",
    "Special handling for isEditingReadonlyOperationsWithWritableBilling: allows billing modifications even when operations are read-only",
    "Freight license controls visibility of multiple search fields and grid columns",
    "Grid displays voided events with strikethrough formatting",
    "Rebilling operations work on multi-row selections and update Ticket.UpdateRebillForTicketEvents",
    "Export functionality uses server-side generation for Excel files",
    "Draft detail button has conditional logic based on barge count and event type",
    "Update notifications sent to SubSystem.frmTicketSearch, frmBargeSearch, and frmBargeEventSearch on save",
    "DateTime controls MUST use military time (24-hour format) with separate date and time inputs",
    "All datetime fields split on page load and combined on form submit",
    "DataTables server-side processing for large datasets",
    "Select2 for all dropdowns to enhance accessibility and user experience",
    "Bootstrap 5 for all styling, no inline styles",
    "jquery.validate for client-side validation with unobtrusive validation",
    "ViewModel properties control visibility and edit capabilities based on user permissions",
    "CSRF protection on all forms with @Html.AntiForgeryToken()",
    "Context menu for bulk operations on search grid",
    "Modal dialogs for complex child operations (Add Barge, Enter Tonnages, etc.)"
  ],
  "architectureReferences": {
    "viewModels": "src/BargeOps.UI/Models/BargeEventSearchViewModel.cs, BargeEventDetailViewModel.cs",
    "controllers": "src/BargeOps.UI/Controllers/BargeEventSearchController.cs, BargeEventDetailController.cs",
    "views": "src/BargeOps.UI/Views/BargeEventSearch/, BargeEventDetail/",
    "javascript": "src/BargeOps.UI/wwwroot/js/bargeEventSearch.js, bargeEventEdit.js",
    "css": "src/BargeOps.UI/wwwroot/css/bargeEvent.css (if custom styles needed)",
    "namespace": "BargeOpsAdmin.ViewModels, BargeOpsAdmin.Controllers",
    "baseController": "AppController (for UI controllers)",
    "authentication": "IdentityConstants.ApplicationScheme (not 'Cookies')",
    "technologyStack": "ASP.NET Core 8 MVC, Bootstrap 5, DataTables, Select2, jQuery Validate, Font Awesome"
  },
  "criticalReminders": [
    "NEVER use datetime-local input - ALWAYS split into separate date and time inputs",
    "ALWAYS use 24-hour time format (HH:mm) NOT 12-hour (hh:mm tt)",
    "ALWAYS use DataTables for all grids (NOT custom jQuery tables)",
    "ALWAYS use Select2 for all dropdowns",
    "ALWAYS use Bootstrap 5 classes for styling",
    "NEVER use inline styles",
    "ALWAYS use asp-for tag helpers with form-control class",
    "ALWAYS include accessibility attributes (aria-label, aria-required, for)",
    "ALWAYS use ViewModel properties for permission-based conditional rendering",
    "ALWAYS use IdentityConstants.ApplicationScheme (not 'Cookies')"
  ]
}
