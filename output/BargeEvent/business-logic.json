{
  "businessObject": "BargeEvent",
  "baseClass": "BusinessLogicBase",
  "namespace": "BargeOps.Onshore.BusinessLogic",
  "description": "Complex business object managing barge events including loads, unloads, shifts, fleeting, midstream operations, and various other event types. Orchestrates multiple barges, tickets, and ticket events.",
  "properties": [
    {
      "name": "EventTypeEnumVal",
      "type": "Lists.EventTypeList.EventTypes",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "Enum value representing the event type (Load, Unload, Shift, etc.). Set in Load methods."
    },
    {
      "name": "EventTypeID",
      "type": "Int32",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "ID of the event type. Set in Load methods."
    },
    {
      "name": "Status",
      "type": "String",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "String representation of event status. Set in Load methods."
    },
    {
      "name": "StatusEnumVal",
      "type": "Lists.EventTypeList.EventStatus",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "Enum value representing event status (Order, Start, Complete). Set in Load methods."
    },
    {
      "name": "EventTypeOverrideDivisionByBoat",
      "type": "Boolean",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "Indicates if event type overrides division by boat. Set in Load methods."
    },
    {
      "name": "EventTypeOverrideDivisionByPortFacility",
      "type": "Boolean",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "Indicates if event type overrides division by port facility. Set in Load methods."
    },
    {
      "name": "ShowBargesInTowCount",
      "type": "Boolean",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "Determines if BargesInTowCount textbox should be shown on form. Based on event type's CanDivideByBargesInTow or saved DivideByBargesInTow value."
    },
    {
      "name": "IsBillable",
      "type": "Boolean",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "Indicates if event is billable. Set in Load methods."
    },
    {
      "name": "BargeSubsetToEdit",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Comma-delimited list of barge numbers to edit as a subset of all barges. Sets _BargesInEdit collection."
    },
    {
      "name": "Barges",
      "type": "System.Collections.Generic.List(Of Barge)",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "Collection of all barges associated with this event."
    },
    {
      "name": "BargesInEditCount",
      "type": "Int32",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "Count of barges currently being edited."
    },
    {
      "name": "BoatDelays",
      "type": "BoatDelays",
      "access": "ReadOnly",
      "isNullable": true,
      "description": "Child collection for boat delays on Midstream-In and -Out events. Deferred loading."
    },
    {
      "name": "OnboardOrders",
      "type": "System.Collections.Generic.List(Of OnboardOrder)",
      "access": "Friend",
      "isNullable": false,
      "description": "Collection of onboard orders. Separate from Ticket's collection to avoid update conflicts when handling multiple barges."
    },
    {
      "name": "TicketEventForDelays",
      "type": "TicketEvent",
      "access": "ReadOnly",
      "isNullable": true,
      "description": "Ticket event used for delays form. Created new for multiple barges or references first barge's event."
    },
    {
      "name": "TicketIsVoid",
      "type": "Boolean",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "Indicates if ticket is void. Read-only, cannot be set from this form."
    },
    {
      "name": "TicketEventIsVoid",
      "type": "Boolean",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "Indicates if ticket event is void. Read-only, cannot be set from this form."
    },
    {
      "name": "LoadOrUnloadCargoTransferID",
      "type": "String",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "Cargo transfer ID for load/unload events."
    },
    {
      "name": "FleetID",
      "type": "Int32",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "Fleet ID associated with the event."
    },
    {
      "name": "VoidNote",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Note explaining why event was voided."
    },
    {
      "name": "IsOnboardOrderUpdatingAllowed",
      "type": "Boolean",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Prevents circular referencing by controlling if onboard orders can be updated."
    },
    {
      "name": "BargesLocNotMatchingPickupLoc",
      "type": "String",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "Comma-delimited list of barges whose current location doesn't match pickup location."
    },
    {
      "name": "IsFreightDestinationCoveredByContract",
      "type": "Boolean",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "Validates if freight destination is covered by freight contract."
    },
    {
      "name": "HullType",
      "type": "String",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "Hull type of barges in edit."
    },
    {
      "name": "UsedByLoadUnloadCompleteForm",
      "type": "Boolean",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Flag indicating use by LoadUnloadComplete form. Affects field validation behavior."
    },
    {
      "name": "UsedByMultiShiftCompleteForm",
      "type": "Boolean",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Flag indicating use by Multi Shift Complete form from toolbar."
    },
    {
      "name": "BargesPreviouslyLoaded",
      "type": "String",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "Comma-delimited list of barges with existing Load event having LoadStatus='Load'."
    },
    {
      "name": "BargesWithPreviousLoadEvent",
      "type": "String",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "Comma-delimited list of barges with any previous Load event."
    },
    {
      "name": "AllBargesHaveIncompleteLoadEvent",
      "type": "Boolean",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "True if all barges have Load event with no complete date time."
    },
    {
      "name": "NoLoadEvent",
      "type": "String",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "Comma-delimited list of barges without prior Load event."
    },
    {
      "name": "FreightContractID",
      "type": "String",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "Freight contract ID from barges collection."
    },
    {
      "name": "FreightContractIDBargesInEdit",
      "type": "String",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "Freight contract ID from barges in edit."
    },
    {
      "name": "FreightContractIdList",
      "type": "String",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "Comma-delimited list of FreightContractIDs for rate lookup. May contain duplicates and blanks."
    },
    {
      "name": "IsTariffFreightContract",
      "type": "Boolean",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "Indicates if freight contract is tariff-based. Parameter controls using BargesInEdit or all Barges."
    },
    {
      "name": "FreightTariffPercent",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Freight tariff percentage. Parameter controls using BargesInEdit or all Barges."
    },
    {
      "name": "CustomersDifferFromTicketForFreightDivEvent",
      "type": "Boolean",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "True if customers differ from ticket for freight division events."
    },
    {
      "name": "CustomersDifferFromTicketForNonFreightDivEvent",
      "type": "Boolean",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "True if customers differ from ticket for non-freight division events."
    },
    {
      "name": "FreightContractIDExcludingBlanks",
      "type": "String",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "Matching freight contract ID excluding blank values. Used for Multi Load Complete."
    },
    {
      "name": "IsBillableOrIsFreightBillable",
      "type": "Boolean",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "True if event is billable or freight-billable. Controls Customer label bolding."
    },
    {
      "name": "CommodityIDAllBarges",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Commodity ID for all barges in collection (not just BargesInEdit)."
    },
    {
      "name": "WasInvoicedAndOutsideVendor",
      "type": "Boolean",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "True if originally invoiced with Division='Outside vendor'."
    },
    {
      "name": "IsFromAtLeastOneBoat",
      "type": "Boolean",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "True if at least one barge is shifting from a boat location."
    },
    {
      "name": "AutoAddedBargesForCpToUnload",
      "type": "System.Collections.SortedList",
      "access": "ReadWrite",
      "isNullable": true,
      "description": "List of barges that had Unload C/P auto-added during Shift Complete preprocessing."
    },
    {
      "name": "IsMismatchForMultiShiftToLocationID",
      "type": "Boolean",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "True when multi-shift has barges with different ToLocationID values."
    },
    {
      "name": "PurchaseOrderNum",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Purchase order number for the event."
    },
    {
      "name": "HadOneInvoicedOrPendingAuthorization",
      "type": "Boolean",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "True if at least one barge was invoiced or pending authorization."
    },
    {
      "name": "HasMoreThanOneLoadDefaultFacility",
      "type": "Boolean",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "True when multiple barges have different default facilities for Load event."
    },
    {
      "name": "CanRebill",
      "type": "Boolean",
      "access": "ReadOnly",
      "isNullable": false,
      "description": "Indicates if event can be rebilled."
    },
    {
      "name": "FromLocationID",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "From location ID. Has special handling for ScheduleIn, Shift, Tow, Fleeting, DraftSurvey, LockDelay, Standby events."
    },
    {
      "name": "FleetBoatID",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Fleet boat ID for the event."
    },
    {
      "name": "StartDateTime",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Event start date/time. Triggers recalculation of prior fleeting days when changed."
    },
    {
      "name": "CompleteDateTime",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Event completion date/time."
    },
    {
      "name": "SchedStartDateTime",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Scheduled start date/time. Updates BoatArrival.EstimatedDateTime for ScheduleIn/Out events."
    },
    {
      "name": "SchedCompleteDateTime",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Scheduled completion date/time."
    },
    {
      "name": "PickupWhenReady",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Pickup when ready indicator on ticket."
    },
    {
      "name": "PickupWhenEmpty",
      "type": "Boolean",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Pickup when empty flag on ticket."
    },
    {
      "name": "PickupWhenLoaded",
      "type": "Boolean",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Pickup when loaded flag on ticket."
    },
    {
      "name": "CleanType",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Clean type for clean events."
    },
    {
      "name": "AdditionalCleanType",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Additional clean type for clean events."
    },
    {
      "name": "ToLocationID",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "To location ID. Has special handling for ScheduleOut, Shift, Tow, MidstreamOut events."
    },
    {
      "name": "CoverHandlingType",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Cover handling type. Automatically sets CoverConfig when changed for Complete events."
    },
    {
      "name": "PumpType",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Pump type for pump events."
    },
    {
      "name": "RepairType",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Repair type for repair events."
    },
    {
      "name": "AdditionalRepairType",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Additional repair type for repair events."
    },
    {
      "name": "IsClosed",
      "type": "Boolean",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Indicates if ticket is closed."
    },
    {
      "name": "River",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "River for ScheduleIn/Out events. Updates BoatPosition and triggers EstimatedArrivalDateTime recalculation."
    },
    {
      "name": "Mile",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Mile marker for ScheduleIn/Out events. Updates BoatPosition and triggers EstimatedArrivalDateTime recalculation."
    },
    {
      "name": "Direction",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Direction for ScheduleIn/Out events. Updates BoatPosition."
    },
    {
      "name": "MarkedForClose",
      "type": "Boolean",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Indicates if ticket should be closed on event completion."
    },
    {
      "name": "IsReleased",
      "type": "Boolean",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Indicates if event is released."
    },
    {
      "name": "ShipID",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Ship ID for ship-related events."
    },
    {
      "name": "OnOrderTripNumber",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Trip number for onboard orders on ticket."
    },
    {
      "name": "DraftAverage",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Average draft for draft survey events."
    },
    {
      "name": "AdjustmentTons",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Adjustment tons for load/unload events."
    },
    {
      "name": "LoadUnloadTons",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Load or unload tonnage."
    },
    {
      "name": "IsDefaultTons",
      "type": "Boolean",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Indicates if tons value is default. Used to bold field on form when all barges have default value."
    },
    {
      "name": "BargeSeriesID",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Barge series ID."
    },
    {
      "name": "Surveyor",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Surveyor for draft survey events."
    },
    {
      "name": "TrainNum",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Train number for train-related events."
    },
    {
      "name": "FromToRiver",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "River field applying to FromRiver or ToRiver based on event type and location type (boat vs facility)."
    },
    {
      "name": "FromToMile",
      "type": "String",
      "access": "ReadWrite",
      "isNullable": false,
      "description": "Mile field applying to FromMile or ToMile based on event type and location type (boat vs facility)."
    }
  ],
  "businessRules": [
    {
      "ruleName": "BargeDraftInches",
      "property": "BargeDraftInches",
      "condition": "_BargeDraftInches <> String.Empty AndAlso (CInt(_BargeDraftInches) < 0 OrElse CInt(_BargeDraftInches) > 11)",
      "message": "Draft Inches must be between 0 and 11.",
      "severity": "Error",
      "context": "Always"
    },
    {
      "ruleName": "BargeIsActiveForNewEvent",
      "property": "BargeIsActiveForNewEvent",
      "condition": "Me.AtLeastOneTicketEventIsNew AndAlso Me.AtLeastOneBargeIsInactive",
      "message": "A new event cannot be added for an inactive barge.",
      "severity": "Error",
      "context": "When adding new event"
    },
    {
      "ruleName": "LoadedBargeOnLoadComplete",
      "property": "LoadedBargeOnLoadComplete",
      "condition": "(Me.EventTypeEnumVal = Lists.EventTypeList.EventTypes.Load) AndAlso (Me.StatusEnumVal = Lists.EventTypeList.EventStatus.Complete) AndAlso Me.IsCompleting AndAlso (Not String.IsNullOrEmpty(Me.BargesPreviouslyLoaded))",
      "message": "One or more barges have a current load status of \"Load\".",
      "severity": "Error",
      "context": "When Freight license active and completing Load event with barges already having Load status"
    },
    {
      "ruleName": "NoLoadOnUnloadComplete",
      "property": "NoLoadOnUnloadComplete",
      "condition": "(Me.EventTypeEnumVal = Lists.EventTypeList.EventTypes.Unload) AndAlso (Me.StatusEnumVal = Lists.EventTypeList.EventStatus.Complete) AndAlso (Not String.IsNullOrEmpty(Me.NoLoadEvent))",
      "message": "One or more barges do not have a prior Load event.",
      "severity": "Error",
      "context": "When Freight license active and completing Unload event without prior Load"
    }
  ],
  "methods": {
    "factory": [
      {
        "name": "NewBargeEvent",
        "returnType": "BargeEvent",
        "parameters": [
          "evntTypeEnumVal As Lists.EventTypeList.EventTypes",
          "evntStage As Lists.EventTypeList.EventStage",
          "selectedFleetID As Int32",
          "bargeID As Int32",
          "ticketID As Int32",
          "forceNewEvent As Boolean",
          "ignoreOnboardOrderShifts As Boolean"
        ],
        "description": "Creates new BargeEvent for adding ticket event to existing barge's ticket"
      },
      {
        "name": "NewBargeEvent",
        "returnType": "BargeEvent",
        "parameters": [
          "evntTypeEnumVal As Lists.EventTypeList.EventTypes",
          "evntStage As Lists.EventTypeList.EventStage",
          "selectedFleetID As Int32",
          "commaDelimitedBargeNums As String",
          "isUsedByLoadUnloadCompleteForm As Boolean",
          "isUsedByMultiShiftCompleteForm As Boolean",
          "ignoreOnboardOrderShifts As Boolean"
        ],
        "description": "Creates new BargeEvent with list of barges from comma-delimited string"
      },
      {
        "name": "NewBargeEvent (Friend)",
        "returnType": "BargeEvent",
        "parameters": [
          "evntTypeEnumVal As Lists.EventTypeList.EventTypes",
          "evntStage As Lists.EventTypeList.EventStage",
          "selectedFleetID As Int32",
          "commaDelimitedBargeNums As String",
          "isUsedByLoadUnloadCompleteForm As Boolean",
          "isUsedByMultiShiftCompleteForm As Boolean",
          "ignoreOnboardOrderShifts As Boolean",
          "forceNewEvent As Boolean"
        ],
        "description": "Friend method used by CargoTransfer to control new vs matching ticket event creation"
      },
      {
        "name": "GetBargeEvent",
        "returnType": "BargeEvent",
        "parameters": [
          "selectedFleetID As Int32",
          "bargeID As Int32",
          "ticketID As Int32",
          "ticketEventID As Int32",
          "getSingleTicketEventOnly As Boolean = False"
        ],
        "description": "Loads existing BargeEvent for modifying ticket event. Used by TicketDetail and Ready to Invoice forms."
      }
    ],
    "crud": [
      {
        "name": "Save",
        "returnType": "Csg.AppFramework.BusinessBase",
        "description": "Saves BargeEvent with preprocessing and refresh. Calls Preprocessing() before base Save()."
      },
      {
        "name": "SaveNoRefresh",
        "returnType": "void",
        "description": "Saves BargeEvent with preprocessing but no refresh. Calls Preprocessing() before base SaveNoRefresh()."
      },
      {
        "name": "Update",
        "returnType": "void",
        "parameters": [
          "tr As System.Data.SqlClient.SqlTransaction",
          "parent As BusinessLogicBase"
        ],
        "description": "Overridden Update method. Validates Preprocessing() was called, updates child objects, sends damaged barge emails."
      },
      {
        "name": "UpdateChildObjects",
        "returnType": "void",
        "parameters": [
          "tr As System.Data.SqlClient.SqlTransaction"
        ],
        "description": "Updates all child objects: Barges, BoatDelays, BoatPosition, Fleet positions, OnboardOrders."
      }
    ],
    "business": [
      {
        "name": "AddToList",
        "returnType": "String",
        "parameters": [
          "selectedFleetID As Int32",
          "commaDelimitedBargeNums As String",
          "ignoreOnboardOrderShifts As Boolean",
          "isTripPlanner As Boolean = False"
        ],
        "description": "Adds barges to collection from comma-delimited list. Returns list of barges not found."
      },
      {
        "name": "RemoveFromList",
        "returnType": "void",
        "parameters": [
          "commaDelimitedBargeNums As String"
        ],
        "description": "Removes barges from collection. Clones last barge if collection becomes empty."
      },
      {
        "name": "RemoveAndAddModifiedBarge",
        "returnType": "void",
        "parameters": [
          "selectedFleetID As Int32",
          "brgNum As String",
          "ignoreOnboardOrderShifts As Boolean"
        ],
        "description": "Removes and reloads barge after editing on barge detail form. Preserves TicketID and TicketEventID context."
      },
      {
        "name": "SetEventTypeVariables",
        "returnType": "void",
        "parameters": [
          "newEventTypeEnumVal As Lists.EventTypeList.EventTypes",
          "newEventStatusEnumVal As Lists.EventTypeList.EventStatus"
        ],
        "description": "Sets event type and status variables. Used by CargoTransfer and ShoreComm."
      },
      {
        "name": "UpdateTurnTicketEvent",
        "returnType": "TicketEvent",
        "parameters": [
          "inboundStatus As Lists.EventTypeList.EventStatus",
          "strtDateTime As String",
          "cmpltDateTime As String",
          "fromLocID As String",
          "toLocID As String",
          "river As String",
          "mile As String",
          "loadStatus As String",
          "cmmdityID As String",
          "billingCustID As String"
        ],
        "description": "Creates/updates Turn ticket event. Used by ShoreComm for Shift event processing."
      },
      {
        "name": "UpdateTurnTicketEvent (overload)",
        "returnType": "TicketEvent",
        "parameters": [
          "tcktEventID As Int32",
          "inboundStatus As Lists.EventTypeList.EventStatus",
          "strtDateTime As String",
          "cmpltDateTime As String",
          "fromLocID As String",
          "toLocID As String",
          "river As String",
          "mile As String",
          "loadStatus As String",
          "cmmdityID As String",
          "billingCustID As String"
        ],
        "description": "Updates existing Turn ticket event by ID. Only updates when transitioning from Start to Complete."
      },
      {
        "name": "MultiLoadFreightContractMatches",
        "returnType": "Boolean",
        "description": "Validates all barge freight contracts match for Multi Load Complete. Ignores blank values."
      },
      {
        "name": "HasUpdatedFreightContractWithLoad",
        "returnType": "Boolean",
        "parameters": [
          "bargeNums As String (ByRef)"
        ],
        "description": "Checks if freight contract info changed when barges have existing Load/Part-Load events. Returns barge numbers via ByRef."
      },
      {
        "name": "NewOrMatchedTicketEvent (Friend)",
        "returnType": "TicketEvent",
        "parameters": [
          "eventTypeID As Int32",
          "eventTypeEnumVal As Lists.EventTypeList.EventTypes",
          "statusEnumVal As Lists.EventTypeList.EventStatus",
          "ignoreOnboardOrderShifts As Boolean",
          "forceNewEvent As Boolean"
        ],
        "description": "Creates new or matches existing ticket event. Used by CargoTransfer for multiple ticket event creation."
      },
      {
        "name": "Preprocessing (Friend)",
        "returnType": "void",
        "description": "Performs all preprocessing before save: updates delays, barge fields, ticket dates, closed ticket info. Calls event-specific preprocessing based on EventTypeEnumVal."
      },
      {
        "name": "CheckBusinessRules",
        "returnType": "void",
        "parameters": [
          "PropertyName As String"
        ],
        "description": "Validates business rules for barge draft inches, inactive barges, load/unload constraints with freight license."
      }
    ],
    "helper": [
      {
        "name": "BargesInEditBrokenRules",
        "returnType": "BrokenRules",
        "description": "Aggregates broken rules from BargesInEdit collection and internal rules."
      },
      {
        "name": "CompareBargeNum",
        "returnType": "Boolean",
        "description": "Predicate function for finding barges by number in collections."
      },
      {
        "name": "GetPropTicket",
        "returnType": "Object",
        "description": "Gets property value from ticket, validating all barges match or returning default."
      },
      {
        "name": "SetPropTicket",
        "returnType": "void",
        "description": "Sets property value on all barge tickets in collection."
      },
      {
        "name": "GetPropTicketEvent",
        "returnType": "Object",
        "description": "Gets property value from ticket event, validating all barges match or returning default."
      },
      {
        "name": "SetPropTicketEvent",
        "returnType": "void",
        "description": "Sets property value on all barge ticket events in collection."
      },
      {
        "name": "GetPropBarge",
        "returnType": "Object",
        "description": "Gets property value from barge, validating all barges match or returning default."
      },
      {
        "name": "SetPropBarge",
        "returnType": "void",
        "description": "Sets property value on all barges in collection."
      }
    ]
  },
  "relationships": [
    {
      "property": "Barges",
      "relatedEntity": "Barge",
      "type": "OneToMany",
      "cascadeDelete": false,
      "description": "Collection of barges being processed in this event. Each barge has ticket and ticket event."
    },
    {
      "property": "BargesInEdit",
      "relatedEntity": "Barge",
      "type": "OneToMany",
      "cascadeDelete": false,
      "description": "Subset of Barges collection currently being edited on detail panel."
    },
    {
      "property": "BoatDelays",
      "relatedEntity": "BoatDelays",
      "type": "OneToOne",
      "cascadeDelete": false,
      "description": "Child collection for boat delays on Midstream-In/Out events. Deferred loading."
    },
    {
      "property": "BoatTraffic",
      "relatedEntity": "BoatTraffic",
      "type": "OneToOne",
      "cascadeDelete": false,
      "description": "Deferred loading boat traffic data."
    },
    {
      "property": "DeckLogActivity",
      "relatedEntity": "DeckLogActivity",
      "type": "OneToOne",
      "cascadeDelete": false,
      "description": "Deferred loading deck log activity."
    },
    {
      "property": "OnboardOrders",
      "relatedEntity": "OnboardOrder",
      "type": "OneToMany",
      "cascadeDelete": false,
      "description": "Collection of onboard orders maintained separately from Ticket's collection."
    },
    {
      "property": "BoatPosition",
      "relatedEntity": "Location",
      "type": "OneToOne",
      "cascadeDelete": false,
      "description": "Location object for boat position in ScheduleIn/Out events."
    },
    {
      "property": "FleetBoatPositionStart",
      "relatedEntity": "Location",
      "type": "OneToOne",
      "cascadeDelete": false,
      "description": "Fleet boat position at start."
    },
    {
      "property": "FleetBoatPositionEnd",
      "relatedEntity": "Location",
      "type": "OneToOne",
      "cascadeDelete": false,
      "description": "Fleet boat position at end."
    },
    {
      "property": "TicketEventForDelays",
      "relatedEntity": "TicketEvent",
      "type": "OneToOne",
      "cascadeDelete": false,
      "description": "Ticket event reference for delays form. New for multi-barge or first barge's event."
    }
  ],
  "initialization": {
    "method": "LoadBargeEvent (multiple overloads)",
    "defaults": [
      {
        "property": "_CanDivideByBargesInTow",
        "value": "false",
        "description": "Default to not showing barges in tow count"
      },
      {
        "property": "_MarkedForClose",
        "value": "false",
        "description": "Default to not marking ticket for close"
      },
      {
        "property": "_DefaultMarkedForCloseOnMidOutComplete",
        "value": "true",
        "description": "Default behavior for midstream out complete"
      },
      {
        "property": "_IsOnboardOrderUpdatingAllowed",
        "value": "false",
        "description": "Prevent onboard order updates by default to avoid circular refs"
      },
      {
        "property": "_UsedByLoadUnloadCompleteForm",
        "value": "false",
        "description": "Default to not being used by load/unload complete form"
      },
      {
        "property": "_UsedByMultiShiftCompleteForm",
        "value": "false",
        "description": "Default to not being used by multi shift complete form"
      },
      {
        "property": "_HasMoreThanOneLoadDefaultFacility",
        "value": "false",
        "description": "Default to single default facility"
      }
    ]
  },
  "validation": {
    "dataAnnotationsEquivalent": [
      {
        "property": "BargeDraftInches",
        "annotations": [
          "[Range(0, 11, ErrorMessage = \"Draft Inches must be between 0 and 11.\")]"
        ]
      }
    ],
    "fluentValidationEquivalent": [
      {
        "property": "BargeDraftInches",
        "rules": [
          "RuleFor(x => x.BargeDraftInches).InclusiveBetween(0, 11).When(x => !string.IsNullOrEmpty(x.BargeDraftInches)).WithMessage(\"Draft Inches must be between 0 and 11.\")"
        ]
      },
      {
        "property": "BargeIsActiveForNewEvent",
        "rules": [
          "RuleFor(x => x).Must(x => !(x.AtLeastOneTicketEventIsNew && x.AtLeastOneBargeIsInactive)).WithMessage(\"A new event cannot be added for an inactive barge.\")"
        ]
      },
      {
        "property": "LoadedBargeOnLoadComplete",
        "rules": [
          "RuleFor(x => x.BargesPreviouslyLoaded).Empty().When(x => x.IsFreightActive && x.EventTypeEnumVal == EventTypes.Load && x.StatusEnumVal == EventStatus.Complete && x.IsCompleting).WithMessage(\"One or more barges have a current load status of 'Load'.\")"
        ]
      },
      {
        "property": "NoLoadOnUnloadComplete",
        "rules": [
          "RuleFor(x => x.NoLoadEvent).Empty().When(x => x.IsFreightActive && x.EventTypeEnumVal == EventTypes.Unload && x.StatusEnumVal == EventStatus.Complete).WithMessage(\"One or more barges do not have a prior Load event.\")"
        ]
      }
    ]
  },
  "notes": [
    "BargeEvent is a pseudo business object without direct database table mapping",
    "Orchestrates complex multi-barge, multi-ticket, multi-event operations",
    "Uses GetProp*/SetProp* helper methods to aggregate/distribute values across barge collections",
    "Supports multiple usage modes: single event, multi-event, load/unload complete, multi-shift complete",
    "Has extensive preprocessing logic that varies by event type (50+ event type cases)",
    "Properties map to underlying Barge, Ticket, and TicketEvent objects",
    "Uses deferred loading for child collections (BoatDelays, BoatTraffic, DeckLogActivity)",
    "Cloned barge mechanism maintains field values when editing multiple barges sequentially",
    "Special handling for freight contracts, onboard orders, boat positions, and fleeting",
    "Event-specific property setters with side effects (e.g., FromLocationID sets ScheduleInID for ScheduleIn)",
    "Preprocessing() must be called before Update() - enforced via _WasPreprocessingCalled flag",
    "Friend methods exposed for CargoTransfer and BargeExTransactionInbox integration",
    "Complex validation for invoiced events, freight contracts, and load/unload sequencing"
  ],
  "modernizationNotes": [
    "Consider splitting into separate domain models per event type (LoadEvent, ShiftEvent, etc.)",
    "Replace GetProp*/SetProp* pattern with proper collection aggregation in domain services",
    "Extract event-specific logic into strategy pattern or event handler classes",
    "Use FluentValidation for complex conditional validation rules",
    "Implement repository pattern for data access instead of inline SQL in factory methods",
    "Use dependency injection for related services (Rate lookup, Email sending, etc.)",
    "Convert from VB.NET collections to modern C# collections (List<T>, IEnumerable<T>)",
    "Replace string-based property names with expression trees for type safety",
    "Implement CQRS pattern - separate read models from command models",
    "Use domain events for side effects (email sending, audit logging)",
    "Extract preprocessing logic into domain services with single responsibility",
    "Replace nested conditionals in property setters with polymorphism or state pattern"
  ]
}
