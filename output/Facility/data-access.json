{
  "entityName": "FacilityLocation",
  "legacyVbNetInfo": {
    "listClass": "FacilityLocationSearch.vb",
    "businessObjectClass": "FacilityLocation.vb",
    "baseClass": "FacilityLocationBase.vb"
  },
  "modernDto": {
    "file": "BargeOps.Shared/Dto/FacilityDto.cs",
    "mainDto": "FacilityDto",
    "listDto": "FacilityListDto",
    "searchRequest": "FacilitySearchRequest"
  },
  "modernRepository": {
    "interface": "Admin.Infrastructure.Abstractions.IFacilityRepository",
    "implementation": "Admin.Infrastructure.Repositories.FacilityRepository",
    "pattern": "Dapper with stored procedures (Note: Modern repos can use direct SQL queries or stored procedures)"
  },
  "conversionNote": "‚≠ê IMPORTANT: Legacy VB.NET code uses stored procedures. The modern C# architecture supports BOTH stored procedures AND direct SQL queries with Dapper. The FacilityRepository example uses stored procedures, but you can convert to parameterized SQL queries if preferred. All database operations will be implemented using Dapper for data access.",
  "dataAccessOperations": {
    "search": {
      "legacyStoredProcedure": "FacilityLocationSearch",
      "modernStoredProcedure": "sp_FacilityLocationSearch",
      "conversionApproach": "Already implemented in FacilityRepository",
      "description": "Search for facilities with multiple optional criteria",
      "parameters": [
        {
          "name": "@Name",
          "type": "VarChar",
          "direction": "Input",
          "nullable": true,
          "description": "Facility name search filter"
        },
        {
          "name": "@ShortName",
          "type": "VarChar",
          "direction": "Input",
          "nullable": true,
          "description": "Short name search filter"
        },
        {
          "name": "@BargeExCode",
          "type": "VarChar",
          "direction": "Input",
          "nullable": true,
          "description": "BargeEx code search filter"
        },
        {
          "name": "@RiverCode",
          "type": "Char(3)",
          "direction": "Input",
          "nullable": true,
          "modernName": "@RiverID",
          "modernType": "Int",
          "description": "Legacy: River code (3 char). Modern: River ID (int)",
          "conversionNote": "Changed from RiverCode (char) to RiverID (int) in modern schema"
        },
        {
          "name": "@BargeExLocationType",
          "type": "VarChar",
          "direction": "Input",
          "nullable": true,
          "modernName": "@FacilityTypeID",
          "modernType": "Int",
          "description": "Legacy: BargeEx location type string. Modern: FacilityTypeID (int)",
          "conversionNote": "Changed from type description to ID lookup in modern schema"
        },
        {
          "name": "@StartMile",
          "type": "Float",
          "direction": "Input",
          "nullable": true,
          "description": "Starting mile marker for range search"
        },
        {
          "name": "@EndMile",
          "type": "Float",
          "direction": "Input",
          "nullable": true,
          "description": "Ending mile marker for range search"
        },
        {
          "name": "@ActiveOnly",
          "type": "Bit",
          "direction": "Input",
          "nullable": false,
          "defaultValue": true,
          "description": "Filter to active facilities only"
        },
        {
          "name": "@Start",
          "modernOnly": true,
          "type": "Int",
          "description": "Pagination: starting record index"
        },
        {
          "name": "@Length",
          "modernOnly": true,
          "type": "Int",
          "description": "Pagination: number of records to return"
        },
        {
          "name": "@OrderColumn",
          "modernOnly": true,
          "type": "VarChar",
          "description": "Column name for sorting"
        },
        {
          "name": "@OrderDirection",
          "modernOnly": true,
          "type": "VarChar",
          "description": "Sort direction (ASC/DESC)"
        }
      ],
      "resultMapping": {
        "legacy": [
          {
            "column": "LocationID",
            "type": "Int32",
            "description": "Primary key for facility location"
          },
          {
            "column": "Name",
            "type": "String",
            "description": "Facility name"
          },
          {
            "column": "ShortName",
            "type": "String",
            "description": "Facility short name"
          },
          {
            "column": "BargeExCode",
            "type": "String",
            "description": "BargeEx integration code"
          },
          {
            "column": "River",
            "type": "String",
            "description": "River name"
          },
          {
            "column": "Mile",
            "type": "String",
            "formatting": "Decimal with 2 decimal places, empty string for NULL",
            "conversionLogic": "If Not String.IsNullOrEmpty Then Convert.ToDecimal(value).ToString(FmtTwoDecimalPlaces) Else String.Empty",
            "description": "Mile marker position on river"
          },
          {
            "column": "Bank",
            "type": "String",
            "description": "River bank designation"
          },
          {
            "column": "BargeExLocationType",
            "type": "String",
            "modernEquivalent": "FacilityType",
            "description": "Type of facility location"
          },
          {
            "column": "IsActive",
            "type": "Boolean",
            "description": "Active status flag"
          }
        ],
        "modern": [
          {
            "column": "LocationId",
            "type": "int",
            "description": "Primary key"
          },
          {
            "column": "Name",
            "type": "string"
          },
          {
            "column": "ShortName",
            "type": "string"
          },
          {
            "column": "RiverName",
            "type": "string"
          },
          {
            "column": "Mile",
            "type": "decimal?"
          },
          {
            "column": "Bank",
            "type": "string"
          },
          {
            "column": "FacilityType",
            "type": "string"
          },
          {
            "column": "BargeExCode",
            "type": "string"
          },
          {
            "column": "IsActive",
            "type": "bool"
          }
        ]
      }
    },
    "getById": {
      "legacyStoredProcedure": "FacilityLocationSelect",
      "modernStoredProcedure": "sp_FacilityLocation_GetByID",
      "conversionApproach": "Already implemented in FacilityRepository",
      "description": "Retrieve a single facility by LocationID",
      "parameters": [
        {
          "name": "@LocationID",
          "type": "Int",
          "direction": "Input",
          "nullable": false,
          "description": "Primary key of the facility location"
        }
      ],
      "resultMapping": {
        "legacy": {
          "note": "Returns all FacilityLocation fields plus child collections",
          "mainEntity": "FacilityLocationBase properties loaded in LoadProperties method",
          "childCollections": [
            {
              "name": "FacilityBerths",
              "loadedIn": "LoadChildObjects method",
              "description": "Collection of berths for this facility"
            },
            {
              "name": "Alert",
              "loadedIn": "Deferred loading via property getter",
              "description": "Alert property object for this location"
            }
          ]
        },
        "modern": {
          "note": "Returns Facility DTO with all properties",
          "childCollections": [
            "Berths (List<FacilityBerthDto>)",
            "Statuses (List<FacilityStatusDto>)"
          ]
        }
      },
      "fields": [
        {
          "name": "LocationID",
          "type": "Int32",
          "isPrimaryKey": true
        },
        {
          "name": "BargeExCode",
          "type": "String",
          "maxLength": 10,
          "modernMaxLength": 20
        },
        {
          "name": "Bank",
          "type": "String",
          "maxLength": 50,
          "modernMaxLength": 10
        },
        {
          "name": "BargeExLocationType",
          "type": "String",
          "maxLength": 20,
          "modernEquivalent": "FacilityTypeID/FacilityTypeName"
        },
        {
          "name": "NdcName",
          "type": "String",
          "maxLength": 200,
          "description": "National Data Center name"
        },
        {
          "name": "NdcLocationDescription",
          "type": "String",
          "maxLength": 200
        },
        {
          "name": "NdcAddress",
          "type": "String",
          "maxLength": 50
        },
        {
          "name": "NdcCounty",
          "type": "String",
          "maxLength": 30
        },
        {
          "name": "NdcCountyFips",
          "type": "String",
          "maxLength": 3
        },
        {
          "name": "NdcTown",
          "type": "String",
          "maxLength": 30
        },
        {
          "name": "NdcState",
          "type": "String",
          "maxLength": 2
        },
        {
          "name": "NdcWaterway",
          "type": "String",
          "maxLength": 50
        },
        {
          "name": "NdcPort",
          "type": "String",
          "maxLength": 25
        },
        {
          "name": "NdcLatitude",
          "type": "String (Double)",
          "description": "Stored as string, formatted as double"
        },
        {
          "name": "NdcLongitude",
          "type": "String (Double)",
          "description": "Stored as string, formatted as double"
        },
        {
          "name": "NdcOperator",
          "type": "String",
          "maxLength": 150
        },
        {
          "name": "NdcOwner",
          "type": "String",
          "maxLength": 150
        },
        {
          "name": "NdcPurpose",
          "type": "String",
          "maxLength": 255
        },
        {
          "name": "NdcRemark",
          "type": "String",
          "maxLength": 1200
        },
        {
          "name": "ConvFmsLocationMasterID",
          "type": "String (Int32)",
          "description": "Conversion field, stored as string"
        },
        {
          "name": "LockUsaceName",
          "type": "String",
          "maxLength": 50,
          "modernMaxLength": 100,
          "conditionalBusinessRule": "Must be blank if BargeExLocationType is not 'Lock' or 'Gauge Location'"
        },
        {
          "name": "LockFloodStage",
          "type": "String (Decimal)",
          "conditionalBusinessRule": "Must be blank if BargeExLocationType is not 'Lock' or 'Gauge Location'"
        },
        {
          "name": "LockPoolStage",
          "type": "String (Decimal)",
          "conditionalBusinessRule": "Must be blank if BargeExLocationType is not 'Lock' or 'Gauge Location'"
        },
        {
          "name": "LockLowWater",
          "type": "String (Decimal)",
          "conditionalBusinessRule": "Must be blank if BargeExLocationType is not 'Lock' or 'Gauge Location'"
        },
        {
          "name": "LockNormalCurrent",
          "type": "String (Decimal)",
          "conditionalBusinessRule": "Must be blank if BargeExLocationType is not 'Lock' or 'Gauge Location'"
        },
        {
          "name": "LockHighFlow",
          "type": "String (Decimal)",
          "conditionalBusinessRule": "Must be blank if BargeExLocationType is not 'Lock' or 'Gauge Location'"
        },
        {
          "name": "LockHighWater",
          "type": "String (Decimal)",
          "conditionalBusinessRule": "Must be blank if BargeExLocationType is not 'Lock' or 'Gauge Location'"
        },
        {
          "name": "LockCatastrophicLevel",
          "type": "String (Decimal)",
          "conditionalBusinessRule": "Must be blank if BargeExLocationType is not 'Lock' or 'Gauge Location'"
        }
      ]
    },
    "insert": {
      "legacyStoredProcedure": "FacilityLocationInsert",
      "modernStoredProcedure": "sp_FacilityLocation_Insert",
      "conversionApproach": "Already implemented in FacilityRepository",
      "description": "Create a new facility location record",
      "parameters": [
        {
          "name": "@LocationID",
          "type": "Int",
          "direction": "InputOutput",
          "description": "Primary key, returned as output parameter after insert"
        },
        {
          "name": "@FacilityLocationID",
          "modernOnly": true,
          "type": "Int",
          "direction": "Output",
          "description": "Modern schema uses separate FacilityLocation table"
        },
        {
          "name": "@BargeExCode",
          "type": "VarChar"
        },
        {
          "name": "@Bank",
          "type": "VarChar"
        },
        {
          "name": "@BargeExLocationType",
          "type": "VarChar",
          "modernName": "@FacilityTypeID",
          "modernType": "Int"
        },
        {
          "name": "@NdcName",
          "type": "VarChar"
        },
        {
          "name": "@NdcLocationDescription",
          "type": "VarChar"
        },
        {
          "name": "@NdcAddress",
          "type": "VarChar"
        },
        {
          "name": "@NdcCounty",
          "type": "VarChar"
        },
        {
          "name": "@NdcCountyFips",
          "type": "Char(3)"
        },
        {
          "name": "@NdcTown",
          "type": "VarChar"
        },
        {
          "name": "@NdcState",
          "type": "Char(2)"
        },
        {
          "name": "@NdcWaterway",
          "type": "VarChar"
        },
        {
          "name": "@NdcPort",
          "type": "VarChar"
        },
        {
          "name": "@NdcLatitude",
          "type": "Float"
        },
        {
          "name": "@NdcLongitude",
          "type": "Float"
        },
        {
          "name": "@NdcOperator",
          "type": "VarChar"
        },
        {
          "name": "@NdcOwner",
          "type": "VarChar"
        },
        {
          "name": "@NdcPurpose",
          "type": "VarChar"
        },
        {
          "name": "@NdcRemark",
          "type": "VarChar"
        },
        {
          "name": "@LockUsaceName",
          "type": "VarChar"
        },
        {
          "name": "@LockFloodStage",
          "type": "Decimal"
        },
        {
          "name": "@LockPoolStage",
          "type": "Decimal"
        },
        {
          "name": "@LockLowWater",
          "type": "Decimal"
        },
        {
          "name": "@LockNormalCurrent",
          "type": "Decimal"
        },
        {
          "name": "@LockHighFlow",
          "type": "Decimal"
        },
        {
          "name": "@LockHighWater",
          "type": "Decimal"
        },
        {
          "name": "@LockCatastrophicLevel",
          "type": "Decimal"
        },
        {
          "name": "@Name",
          "modernOnly": true,
          "type": "VarChar(100)",
          "description": "Facility name (from parent Location table in modern schema)"
        },
        {
          "name": "@ShortName",
          "modernOnly": true,
          "type": "VarChar(50)"
        },
        {
          "name": "@RiverID",
          "modernOnly": true,
          "type": "Int"
        },
        {
          "name": "@Mile",
          "modernOnly": true,
          "type": "Decimal"
        },
        {
          "name": "@IsActive",
          "modernOnly": true,
          "type": "Bit"
        },
        {
          "name": "@Note",
          "modernOnly": true,
          "type": "VarChar(MAX)"
        },
        {
          "name": "@ModifiedBy",
          "type": "VarChar(50)",
          "description": "User performing the insert (automatically handled by base framework in legacy)"
        }
      ],
      "notes": [
        "Legacy framework automatically handles CreateDateTime, CreateUser, ModifyDateTime, ModifyUser in base class",
        "Modern implementation requires explicit ModifiedBy parameter",
        "Primary key LocationID is returned via output parameter",
        "Modern schema splits data between Location and FacilityLocation tables"
      ]
    },
    "update": {
      "legacyStoredProcedure": "FacilityLocationUpdate",
      "modernStoredProcedure": "sp_FacilityLocation_Update",
      "conversionApproach": "Already implemented in FacilityRepository",
      "description": "Update an existing facility location record",
      "parameters": [
        {
          "name": "@LocationID",
          "type": "Int",
          "direction": "Input",
          "description": "Primary key of the record to update"
        },
        {
          "name": "@FacilityLocationID",
          "modernOnly": true,
          "type": "Int",
          "direction": "Input"
        },
        {
          "note": "All other parameters same as Insert operation"
        }
      ],
      "notes": [
        "Legacy framework automatically updates ModifyDateTime and ModifyUser",
        "Modern implementation requires explicit ModifiedBy parameter",
        "All fields are updated (full entity update pattern)"
      ]
    },
    "delete": {
      "legacyStoredProcedure": "FacilityLocationDelete",
      "modernStoredProcedure": "sp_FacilityLocation_Delete",
      "conversionApproach": "Already implemented in FacilityRepository",
      "description": "Delete a facility location record (likely soft delete with IsActive flag)",
      "parameters": [
        {
          "name": "@LocationID",
          "type": "Int",
          "direction": "Input",
          "description": "Primary key of the record to delete"
        }
      ],
      "businessRule": "Delete should not be called directly on FacilityLocation - use Location.DeleteLocation method instead",
      "implementationNote": "FacilityLocation.DeleteFacilityLocation method throws ApplicationException"
    },
    "childEntities": {
      "facilityBerths": {
        "description": "Berths/docking positions at the facility",
        "operations": {
          "getByParentId": {
            "legacyStoredProcedure": "FacilityBerthsSelect (called from FacilityLocationSelect)",
            "modernStoredProcedure": "sp_FacilityBerth_GetByFacilityID",
            "parameters": [
              {
                "name": "@FacilityLocationID",
                "type": "Int"
              }
            ]
          },
          "insert": {
            "modernStoredProcedure": "sp_FacilityBerth_Insert",
            "parameters": [
              {
                "name": "@FacilityLocationID",
                "type": "Int"
              },
              {
                "name": "@Name",
                "type": "VarChar(50)"
              },
              {
                "name": "@FacilityBerthID",
                "type": "Int",
                "direction": "Output"
              }
            ]
          },
          "update": {
            "modernStoredProcedure": "sp_FacilityBerth_Update",
            "parameters": [
              {
                "name": "@FacilityBerthID",
                "type": "Int"
              },
              {
                "name": "@FacilityLocationID",
                "type": "Int"
              },
              {
                "name": "@Name",
                "type": "VarChar(50)"
              }
            ]
          },
          "delete": {
            "modernStoredProcedure": "sp_FacilityBerth_Delete",
            "parameters": [
              {
                "name": "@FacilityBerthID",
                "type": "Int"
              }
            ]
          }
        }
      },
      "facilityStatuses": {
        "description": "Status history records for the facility",
        "operations": {
          "getByLocationId": {
            "modernStoredProcedure": "sp_FacilityStatus_GetByLocationID",
            "parameters": [
              {
                "name": "@LocationID",
                "type": "Int"
              }
            ]
          },
          "insert": {
            "modernStoredProcedure": "sp_FacilityStatus_Insert",
            "parameters": [
              {
                "name": "@LocationID",
                "type": "Int"
              },
              {
                "name": "@StatusID",
                "type": "Int"
              },
              {
                "name": "@StartDateTime",
                "type": "DateTime"
              },
              {
                "name": "@EndDateTime",
                "type": "DateTime"
              },
              {
                "name": "@Note",
                "type": "VarChar(500)"
              },
              {
                "name": "@CreatedBy",
                "type": "VarChar(50)"
              },
              {
                "name": "@FacilityStatusID",
                "type": "Int",
                "direction": "Output"
              }
            ]
          },
          "update": {
            "modernStoredProcedure": "sp_FacilityStatus_Update",
            "parameters": [
              {
                "name": "@FacilityStatusID",
                "type": "Int"
              },
              {
                "name": "@LocationID",
                "type": "Int"
              },
              {
                "name": "@StatusID",
                "type": "Int"
              },
              {
                "name": "@StartDateTime",
                "type": "DateTime"
              },
              {
                "name": "@EndDateTime",
                "type": "DateTime"
              },
              {
                "name": "@Note",
                "type": "VarChar(500)"
              },
              {
                "name": "@ModifiedBy",
                "type": "VarChar(50)"
              }
            ]
          },
          "delete": {
            "modernStoredProcedure": "sp_FacilityStatus_Delete",
            "parameters": [
              {
                "name": "@FacilityStatusID",
                "type": "Int"
              }
            ]
          }
        }
      },
      "alert": {
        "description": "Alert property object (deferred loading)",
        "note": "Loaded via AlertBase.GetAlert(LocationID) when property is accessed",
        "loadingPattern": "Lazy loaded property - not loaded with main entity"
      }
    }
  },
  "dataFormatting": {
    "mileFormatting": {
      "description": "Mile marker values displayed with 2 decimal places",
      "formatString": "FmtTwoDecimalPlaces",
      "nullHandling": "NULL values displayed as empty string",
      "implementation": "If Not String.IsNullOrEmpty(Mile) Then Convert.ToDecimal(Mile).ToString(FmtTwoDecimalPlaces) Else String.Empty"
    },
    "decimalFields": {
      "fields": [
        "LockFloodStage",
        "LockPoolStage",
        "LockLowWater",
        "LockNormalCurrent",
        "LockHighFlow",
        "LockHighWater",
        "LockCatastrophicLevel"
      ],
      "storage": "Stored as String in legacy VB.NET",
      "conversion": "Use GetDecimalProp and SetDecimalProp methods",
      "modernStorage": "decimal? (nullable decimal) in C#"
    },
    "doubleFields": {
      "fields": [
        "NdcLatitude",
        "NdcLongitude"
      ],
      "storage": "Stored as String in legacy VB.NET",
      "conversion": "Use GetDoubleProp and SetDoubleProp methods",
      "modernStorage": "string in C# (to maintain precision)"
    }
  },
  "auditTracking": {
    "enabled": true,
    "fields": [
      "LocationID",
      "BargeExCode",
      "Bank",
      "BargeExLocationType",
      "NdcName",
      "NdcLocationDescription",
      "NdcAddress",
      "NdcCounty",
      "NdcCountyFips",
      "NdcTown",
      "NdcState",
      "NdcWaterway",
      "NdcPort",
      "NdcLatitude",
      "NdcLongitude",
      "NdcOperator",
      "NdcOwner",
      "NdcPurpose",
      "NdcRemark",
      "LockUsaceName",
      "LockFloodStage",
      "LockPoolStage",
      "LockLowWater",
      "LockNormalCurrent",
      "LockHighFlow",
      "LockHighWater",
      "LockCatastrophicLevel"
    ],
    "implementation": "SaveOriginalAuditValue and FieldAudit methods in base class",
    "modernApproach": "Use CreatedBy, CreatedDate, ModifiedBy, ModifiedDate fields in DTO"
  },
  "businessRules": {
    "conditionalValidation": {
      "description": "Lock/Gauge fields must be blank unless facility type is 'Lock' or 'Gauge Location'",
      "fields": [
        "LockUsaceName",
        "LockFloodStage",
        "LockPoolStage",
        "LockLowWater",
        "LockNormalCurrent",
        "LockHighFlow",
        "LockHighWater",
        "LockCatastrophicLevel"
      ],
      "validationLogic": "These fields must be empty/null if BargeExLocationType is not 'Lock' or 'Gauge Location'",
      "implementation": "FacilityLocation.vb CheckBusinessRules method (lines 86-138)"
    },
    "maxLengthValidation": {
      "description": "String fields validated against database max lengths",
      "implementation": "FacilityLocationBase CheckBusinessRules method",
      "maxLengths": {
        "BargeExCode": 10,
        "Bank": 50,
        "BargeExLocationType": 20,
        "NdcName": 200,
        "NdcLocationDescription": 200,
        "NdcAddress": 50,
        "NdcCounty": 30,
        "NdcCountyFips": 3,
        "NdcTown": 30,
        "NdcState": 2,
        "NdcWaterway": 50,
        "NdcPort": 25,
        "NdcOperator": 150,
        "NdcOwner": 150,
        "NdcPurpose": 255,
        "NdcRemark": 1200,
        "LockUsaceName": 50
      }
    },
    "deleteRestriction": {
      "description": "FacilityLocation cannot be deleted directly",
      "rule": "All deletes must go through Location.DeleteLocation method",
      "implementation": "FacilityLocation.DeleteFacilityLocation throws ApplicationException"
    }
  },
  "modernizationConsiderations": {
    "schemaChanges": [
      "River reference changed from RiverCode (char) to RiverID (int)",
      "BargeExLocationType changed from string to FacilityTypeID (int) with lookup table",
      "Data split between Location and FacilityLocation tables in modern schema",
      "Decimal fields changed from string storage to decimal? (nullable decimal)"
    ],
    "paginationSupport": "Modern search includes @Start, @Length, @OrderColumn, @OrderDirection for server-side paging",
    "dtoPattern": "Separate DTOs for different use cases (FacilityDto, FacilityListDto, FacilitySearchRequest)",
    "asyncPattern": "Modern repository uses async/await with Task-based methods",
    "dependencyInjection": "IDbConnectionFactory injected via constructor",
    "transactionManagement": "Legacy uses SqlTransaction passed to Update methods; Modern can use UnitOfWork pattern",
    "storedProcedureNaming": "Modern stored procedures prefixed with 'sp_' and use consistent naming pattern"
  },
  "extractionMetadata": {
    "sourceFiles": [
      "C:\\Dev\\BargeOps.Admin.Mono\\OnShore\\apps\\Onshore.BusinessLogic\\Lists\\FacilityLocationSearch.vb",
      "C:\\Dev\\BargeOps.Admin.Mono\\OnShore\\apps\\Onshore.BusinessLogic\\Business Objects\\FacilityLocation.vb",
      "C:\\Dev\\BargeOps.Admin.Mono\\OnShore\\apps\\Onshore.BusinessLogic\\Business Objects\\Base Classes\\FacilityLocationBase.vb"
    ],
    "referenceImplementations": [
      "C:\\Dev\\BargeOps.Admin.Mono\\src\\BargeOps.Shared\\BargeOps.Shared\\Dto\\FacilityDto.cs",
      "C:\\Dev\\BargeOps.Admin.Mono\\src\\BargeOps.API\\src\\Admin.Infrastructure\\Abstractions\\IFacilityRepository.cs",
      "C:\\Dev\\BargeOps.Admin.Mono\\src\\BargeOps.API\\src\\Admin.Infrastructure\\Repositories\\FacilityRepository.cs"
    ],
    "extractedDate": "2025-12-11",
    "agent": "Data Access Pattern Analyzer"
  }
}
