{
  "formName": "frmFacilityDetail",
  "subSystem": "frmFacilitySearch",
  "sourceLocation": "C:/Dev/BargeOps.Admin.Mono/OnShore/apps/Onshore/Forms/frmFacilityDetail.vb",
  "initializeBaseCall": {
    "line": 62,
    "code": "MyBase.InitializeBase(businessObject, SubSystem.frmFacilitySearch)"
  },
  "permissions": {
    "read": {
      "permission": "FacilityReadOnly",
      "accessType": "ReadOnly",
      "appliesTo": [
        "btnCancel",
        "View form data",
        "Navigate tabs"
      ]
    },
    "modify": {
      "permission": "FacilityModify",
      "accessType": "Modify",
      "appliesTo": [
        "btnSubmit",
        "btnSetBerth",
        "btnCancelEditBerth",
        "btnSetStatus",
        "btnCancelEditStatus",
        "AddBerth",
        "ModifyBerth",
        "RemoveBerth",
        "AddStatus",
        "ModifyStatus",
        "RemoveStatus",
        "ExportStatus"
      ]
    }
  },
  "buttonTypes": [
    {
      "control": "btnSubmit",
      "type": "Submit",
      "securityLevel": "Modify",
      "line": 72
    },
    {
      "control": "btnCancel",
      "type": "Cancel",
      "securityLevel": "ReadOnly",
      "line": 73
    },
    {
      "control": "btnSetBerth",
      "type": "Submit",
      "securityLevel": "Modify",
      "line": 74,
      "context": "Berth tab"
    },
    {
      "control": "btnCancelEditBerth",
      "type": "CancelEdit",
      "securityLevel": "ReadOnly",
      "line": 75,
      "context": "Berth tab"
    },
    {
      "control": "btnSetStatus",
      "type": "Submit",
      "securityLevel": "Modify",
      "line": 76,
      "context": "Status tab"
    },
    {
      "control": "btnCancelEditStatus",
      "type": "CancelEdit",
      "securityLevel": "ReadOnly",
      "line": 77,
      "context": "Status tab"
    }
  ],
  "toolbarButtons": [
    {
      "toolbar": "BerthToolbarManager",
      "buttons": [
        {
          "key": "AddBerth",
          "type": "Add",
          "securityLevel": "Modify",
          "line": 88,
          "action": "ItemAddBerth()",
          "enabledCondition": "(Not Me.IsEditingChild) AndAlso ControlAuthorization.ToolbarButtonCanBeEnabled"
        },
        {
          "key": "ModifyBerth",
          "type": "Open",
          "securityLevel": "Modify",
          "line": 89,
          "action": "ItemModify(grdBerths)",
          "enabledCondition": "itemIsSelected AndAlso (Not Me.IsEditingChild) AndAlso ControlAuthorization.ToolbarButtonCanBeEnabled"
        },
        {
          "key": "RemoveBerth",
          "type": "Remove",
          "securityLevel": "Modify",
          "line": 90,
          "action": "ItemRemoveBerth()",
          "enabledCondition": "itemIsSelected AndAlso (Not Me.IsEditingChild) AndAlso ControlAuthorization.ToolbarButtonCanBeEnabled"
        }
      ]
    },
    {
      "toolbar": "StatusToolbarsManager",
      "buttons": [
        {
          "key": "AddStatus",
          "type": "Add",
          "securityLevel": "Modify",
          "line": 94,
          "action": "ItemAddStatus()",
          "enabledCondition": "(Not Me.IsEditingChild) AndAlso ControlAuthorization.ToolbarButtonCanBeEnabled"
        },
        {
          "key": "ModifyStatus",
          "type": "Open",
          "securityLevel": "Modify",
          "line": 95,
          "action": "ItemModify(grdFacilityStatus)",
          "enabledCondition": "itemIsSelected AndAlso (Not Me.IsEditingChild) AndAlso ControlAuthorization.ToolbarButtonCanBeEnabled"
        },
        {
          "key": "RemoveStatus",
          "type": "Remove",
          "securityLevel": "Modify",
          "line": 96,
          "action": "ItemRemoveStatus()",
          "enabledCondition": "itemIsSelected AndAlso (Not Me.IsEditingChild) AndAlso ControlAuthorization.ToolbarButtonCanBeEnabled"
        },
        {
          "key": "ExportStatus",
          "type": "Open",
          "securityLevel": "Modify",
          "line": 97,
          "action": "Main.ExportGrid(grdFacilityStatus, staStatus, Me.Text)",
          "enabledCondition": "atLeastOneRow AndAlso (Not Me.IsEditingChild) AndAlso Me.ControlAuthorization.ToolbarButtonCanBeEnabled"
        }
      ]
    }
  ],
  "childEntities": [
    {
      "entity": "FacilityBerth",
      "tab": "Berths",
      "grid": "grdBerths",
      "operations": {
        "add": {
          "method": "ItemAddBerth()",
          "line": 600,
          "permission": "FacilityModify"
        },
        "modify": {
          "method": "ItemModify(grdBerths)",
          "line": 250,
          "permission": "FacilityModify"
        },
        "remove": {
          "method": "ItemRemoveBerth()",
          "line": 626,
          "permission": "FacilityModify",
          "confirmation": "Main.ItemRemoveDialog(\"Berth\")"
        }
      }
    },
    {
      "entity": "FacilityStatus",
      "tab": "Status",
      "grid": "grdFacilityStatus",
      "operations": {
        "add": {
          "method": "ItemAddStatus()",
          "line": 613,
          "permission": "FacilityModify"
        },
        "modify": {
          "method": "ItemModify(grdFacilityStatus)",
          "line": 276,
          "permission": "FacilityModify"
        },
        "remove": {
          "method": "ItemRemoveStatus()",
          "line": 638,
          "permission": "FacilityModify",
          "confirmation": "Main.ItemRemoveDialog(\"Status\")"
        },
        "export": {
          "method": "Main.ExportGrid(grdFacilityStatus, staStatus, Me.Text)",
          "line": 280,
          "permission": "FacilityModify"
        }
      }
    }
  ],
  "authorizationPattern": {
    "library": "Csg.Windows.Forms.Security.ControlAuthorizationBase",
    "implementation": "ControlAuthorization object manages permission enforcement",
    "accessLevels": [
      "None",
      "ReadOnly",
      "Modify"
    ],
    "buttonTypeMapping": {
      "Submit": "Modify - Saves changes to database",
      "Cancel": "ReadOnly - Cancels edit operation",
      "CancelEdit": "ReadOnly - Cancels child entity edit",
      "Add": "Modify - Creates new child record",
      "Open": "Modify - Opens existing record for editing",
      "Remove": "Modify - Deletes existing record"
    },
    "functionalArea": "Me.FunctionalAreaOfForm",
    "securityChecks": [
      {
        "method": "ControlAuthorization.SetButtonType",
        "description": "Maps button controls to security types"
      },
      {
        "method": "ControlAuthorization.ToolbarButtonCanBeEnabled",
        "description": "Checks if toolbar button can be enabled based on user permissions"
      },
      {
        "method": "ControlAuthorization.GetAccessLevelForFunctionalArea",
        "description": "Retrieves user's access level for the functional area",
        "line": 301
      }
    ]
  },
  "modernPermissionMapping": {
    "aspNetCoreAttributes": [
      {
        "permission": "FacilityReadOnly",
        "attribute": "[Authorize(Policy = \"FacilityRead\")]",
        "scope": "Read",
        "actions": [
          "GET /Facility/{id}",
          "GET /Facility/Details/{id}"
        ]
      },
      {
        "permission": "FacilityModify",
        "attribute": "[Authorize(Policy = \"FacilityModify\")]",
        "scope": "Write",
        "actions": [
          "POST /Facility",
          "PUT /Facility/{id}",
          "DELETE /Facility/{id}",
          "POST /FacilityBerth",
          "PUT /FacilityBerth/{id}",
          "DELETE /FacilityBerth/{id}",
          "POST /FacilityStatus",
          "PUT /FacilityStatus/{id}",
          "DELETE /FacilityStatus/{id}"
        ]
      }
    ],
    "policyRequirements": [
      {
        "policy": "FacilityRead",
        "requirement": "User must have read access to Facility subsystem"
      },
      {
        "policy": "FacilityModify",
        "requirement": "User must have modify access to Facility subsystem"
      }
    ]
  },
  "specialBehaviors": [
    {
      "description": "Text editor with security check",
      "control": "txtStatusNote",
      "method": "txtStatusNote_EditorButtonClick",
      "line": 301,
      "securityCheck": "ControlAuthorization.GetAccessLevelForFunctionalArea(Me.FunctionalAreaOfForm)",
      "notes": "Passes access level to modal text editor"
    },
    {
      "description": "Toolbar enabled state depends on tab selection",
      "method": "EnableDisableToolbars",
      "line": 816,
      "logic": "Only the toolbar for the active tab is enabled; others are disabled"
    },
    {
      "description": "Buttons disabled during child entity edit",
      "method": "EnableDisableControls",
      "line": 649,
      "logic": "Main Submit button disabled when editing child entities (Berth or Status)"
    }
  ],
  "implementationNotes": [
    "SubSystem identifier 'frmFacilitySearch' is used as the security context despite this being the detail form",
    "All modify operations require FacilityModify permission",
    "Read-only users can view data and cancel edits but cannot submit changes",
    "ControlAuthorization library automatically disables controls based on user permissions",
    "Toolbar buttons use ToolbarButtonCanBeEnabled method which checks _ToolbarButtonTypes hashtable",
    "Child entity operations (Berth, Status) inherit parent form's security context",
    "Export functionality requires Modify permission (line 529)"
  ]
}
