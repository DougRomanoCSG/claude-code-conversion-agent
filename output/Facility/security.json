{
  "entity": "Facility",
  "subsystem": {
    "identifier": "frmFacilitySearch",
    "description": "Facility search and detail forms subsystem",
    "source": "InitializeBase method"
  },
  "permissions": {
    "readOnly": {
      "name": "FacilityReadOnly",
      "description": "Read-only access to facility data",
      "applicableTo": ["Search", "View", "Detail"],
      "modernAttribute": "[Authorize(Policy = \"FacilityReadOnly\")]",
      "scope": "Read operations on facility entities"
    },
    "modify": {
      "name": "FacilityModify",
      "description": "Full modify access to facility data",
      "applicableTo": ["Create", "Update", "Delete"],
      "modernAttribute": "[Authorize(Policy = \"FacilityModify\")]",
      "scope": "Create, update, and delete operations on facility entities"
    }
  },
  "buttonSecurity": {
    "searchForm": {
      "btnSearch": {
        "buttonType": "Search",
        "requiredPermission": "FacilityReadOnly",
        "controlAuthorizationType": "ReadOnly",
        "modernMapping": "Search button visible with FacilityReadOnly"
      },
      "btnClear": {
        "buttonType": "Clear",
        "requiredPermission": "FacilityReadOnly",
        "controlAuthorizationType": "ReadOnly",
        "modernMapping": "Clear button always visible to authorized users"
      },
      "btnNew": {
        "buttonType": "New",
        "requiredPermission": "FacilityModify",
        "controlAuthorizationType": "Modify",
        "modernMapping": "New button visible only with FacilityModify"
      }
    },
    "detailForm": {
      "btnSave": {
        "buttonType": "Save",
        "requiredPermission": "FacilityModify",
        "controlAuthorizationType": "Modify",
        "modernMapping": "Save button enabled only with FacilityModify"
      },
      "btnDelete": {
        "buttonType": "Delete",
        "requiredPermission": "FacilityModify",
        "controlAuthorizationType": "Modify",
        "modernMapping": "Delete button enabled only with FacilityModify"
      },
      "btnCancel": {
        "buttonType": "Cancel",
        "requiredPermission": "FacilityReadOnly",
        "controlAuthorizationType": "ReadOnly",
        "modernMapping": "Cancel button always visible to authorized users"
      }
    },
    "gridActions": {
      "editRow": {
        "buttonType": "Edit",
        "requiredPermission": "FacilityModify",
        "controlAuthorizationType": "Modify",
        "modernMapping": "Edit action in grid visible only with FacilityModify"
      },
      "viewRow": {
        "buttonType": "View",
        "requiredPermission": "FacilityReadOnly",
        "controlAuthorizationType": "ReadOnly",
        "modernMapping": "View action in grid visible with FacilityReadOnly"
      }
    }
  },
  "controlAuthorization": {
    "setButtonTypeCalls": [
      {
        "control": "btnSearch",
        "buttonType": "Search",
        "permission": "FacilityReadOnly",
        "location": "frmFacilitySearch"
      },
      {
        "control": "btnClear",
        "buttonType": "Clear",
        "permission": "FacilityReadOnly",
        "location": "frmFacilitySearch"
      },
      {
        "control": "btnNew",
        "buttonType": "New",
        "permission": "FacilityModify",
        "location": "frmFacilitySearch"
      },
      {
        "control": "btnSave",
        "buttonType": "Save",
        "permission": "FacilityModify",
        "location": "frmFacilityDetail"
      },
      {
        "control": "btnDelete",
        "buttonType": "Delete",
        "permission": "FacilityModify",
        "location": "frmFacilityDetail"
      },
      {
        "control": "btnCancel",
        "buttonType": "Cancel",
        "permission": "FacilityReadOnly",
        "location": "frmFacilityDetail"
      }
    ]
  },
  "modernAuthorizationMapping": {
    "api": {
      "description": "Authorization attributes for BargeOps.Admin.API controllers",
      "examples": [
        {
          "endpoint": "GET /api/facility",
          "attribute": "[Authorize(Policy = \"FacilityReadOnly\")]",
          "permission": "FacilityReadOnly"
        },
        {
          "endpoint": "GET /api/facility/{id}",
          "attribute": "[Authorize(Policy = \"FacilityReadOnly\")]",
          "permission": "FacilityReadOnly"
        },
        {
          "endpoint": "POST /api/facility",
          "attribute": "[Authorize(Policy = \"FacilityModify\")]",
          "permission": "FacilityModify"
        },
        {
          "endpoint": "PUT /api/facility/{id}",
          "attribute": "[Authorize(Policy = \"FacilityModify\")]",
          "permission": "FacilityModify"
        },
        {
          "endpoint": "DELETE /api/facility/{id}",
          "attribute": "[Authorize(Policy = \"FacilityModify\")]",
          "permission": "FacilityModify"
        }
      ]
    },
    "mvc": {
      "description": "Authorization attributes for BargeOps.Admin.UI MVC controllers",
      "examples": [
        {
          "action": "Index (Search)",
          "attribute": "[Authorize(Policy = \"FacilityReadOnly\")]",
          "permission": "FacilityReadOnly"
        },
        {
          "action": "Search",
          "attribute": "[Authorize(Policy = \"FacilityReadOnly\")]",
          "permission": "FacilityReadOnly"
        },
        {
          "action": "Details",
          "attribute": "[Authorize(Policy = \"FacilityReadOnly\")]",
          "permission": "FacilityReadOnly"
        },
        {
          "action": "Create",
          "attribute": "[Authorize(Policy = \"FacilityModify\")]",
          "permission": "FacilityModify"
        },
        {
          "action": "Edit",
          "attribute": "[Authorize(Policy = \"FacilityModify\")]",
          "permission": "FacilityModify"
        },
        {
          "action": "Delete",
          "attribute": "[Authorize(Policy = \"FacilityModify\")]",
          "permission": "FacilityModify"
        }
      ]
    },
    "razorViews": {
      "description": "UI elements conditional rendering based on permissions",
      "examples": [
        {
          "element": "New Button",
          "condition": "@User.HasClaim(\"Permission\", \"FacilityModify\")",
          "permission": "FacilityModify"
        },
        {
          "element": "Edit Button in Grid",
          "condition": "@User.HasClaim(\"Permission\", \"FacilityModify\")",
          "permission": "FacilityModify"
        },
        {
          "element": "Delete Button",
          "condition": "@User.HasClaim(\"Permission\", \"FacilityModify\")",
          "permission": "FacilityModify"
        },
        {
          "element": "Save Button",
          "condition": "@User.HasClaim(\"Permission\", \"FacilityModify\")",
          "permission": "FacilityModify"
        }
      ]
    }
  },
  "policyConfiguration": {
    "description": "Policy configuration for Startup.cs or Program.cs",
    "policies": [
      {
        "name": "FacilityReadOnly",
        "requirement": "User must have FacilityReadOnly claim",
        "configurationCode": "options.AddPolicy(\"FacilityReadOnly\", policy => policy.RequireClaim(\"Permission\", \"FacilityReadOnly\"));"
      },
      {
        "name": "FacilityModify",
        "requirement": "User must have FacilityModify claim",
        "configurationCode": "options.AddPolicy(\"FacilityModify\", policy => policy.RequireClaim(\"Permission\", \"FacilityModify\"));"
      }
    ]
  },
  "relatedEntitySecurity": {
    "facilityStatus": {
      "inheritsFrom": "Facility",
      "permissions": {
        "read": "FacilityReadOnly",
        "modify": "FacilityModify"
      },
      "notes": "FacilityStatus CRUD operations inherit parent Facility permissions"
    },
    "facilityBerth": {
      "inheritsFrom": "Facility",
      "permissions": {
        "read": "FacilityReadOnly",
        "modify": "FacilityModify"
      },
      "notes": "FacilityBerth CRUD operations inherit parent Facility permissions"
    }
  },
  "notes": [
    "Legacy system uses ControlAuthorization.SetButtonType to control button visibility and enablement",
    "Modern system uses [Authorize] attributes at controller/action level",
    "UI buttons should use @User.HasClaim to conditionally render based on permissions",
    "Both FacilityReadOnly and FacilityModify require authentication",
    "FacilityModify permission implies FacilityReadOnly capabilities",
    "Related entities (FacilityStatus, FacilityBerth) inherit parent security model",
    "Consider implementing hierarchical permission checking where FacilityModify includes FacilityReadOnly"
  ],
  "migrationGuidance": {
    "steps": [
      "1. Define policies in Startup.cs/Program.cs authorization configuration",
      "2. Apply [Authorize(Policy = \"...\")] attributes to API controllers and actions",
      "3. Apply [Authorize(Policy = \"...\")] attributes to MVC controllers and actions",
      "4. Update Razor views to conditionally render buttons based on @User.HasClaim",
      "5. Update JavaScript to show/hide grid action buttons based on user permissions",
      "6. Ensure authentication middleware is properly configured",
      "7. Test permission enforcement at all layers (API, MVC, UI)"
    ],
    "considerations": [
      "Ensure consistent permission naming between legacy and modern systems during migration",
      "Consider caching permission lookups for performance",
      "Log authorization failures for security auditing",
      "Implement proper error handling for unauthorized access attempts",
      "Consider graceful degradation (hide features vs show disabled features)",
      "Plan for permission migration/mapping during user database migration"
    ]
  }
}
