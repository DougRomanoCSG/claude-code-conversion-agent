{
  "formName": "frmFacilityDetail",
  "implements": ["IBaseDetailEdit"],
  "description": "Facility detail form for managing facility locations with tabs for Details, Status, Berths, and NDC Data",
  "controls": [
    {
      "name": "txtName",
      "type": "UltraTextEditor",
      "category": "BasicInfo",
      "label": "Facility Name",
      "dataBinding": "FacilityLocation.Name",
      "required": true,
      "tab": "Details"
    },
    {
      "name": "txtShortName",
      "type": "UltraTextEditor",
      "category": "BasicInfo",
      "label": "Short Name",
      "dataBinding": "FacilityLocation.ShortName",
      "required": true,
      "tab": "Details"
    },
    {
      "name": "cboRiver",
      "type": "UltraCombo",
      "category": "Location",
      "label": "River",
      "dataBinding": "FacilityLocation.RiverId",
      "required": false,
      "tab": "Details",
      "populationMethod": "LoadRiverDropdown"
    },
    {
      "name": "txtMile",
      "type": "UltraNumericEditor",
      "category": "Location",
      "label": "Mile",
      "dataBinding": "FacilityLocation.Mile",
      "required": false,
      "tab": "Details",
      "validationType": "Decimal"
    },
    {
      "name": "cboBank",
      "type": "UltraCombo",
      "category": "Location",
      "label": "Bank",
      "dataBinding": "FacilityLocation.Bank",
      "required": false,
      "tab": "Details",
      "populationMethod": "LoadBankDropdown"
    },
    {
      "name": "cboFacilityType",
      "type": "UltraCombo",
      "category": "Type",
      "label": "Facility Type",
      "dataBinding": "FacilityLocation.BargeExLocationType",
      "required": true,
      "tab": "Details",
      "populationMethod": "LoadFacilityTypeDropdown",
      "triggerEvent": "ConditionalFieldsDisplay"
    },
    {
      "name": "txtBargeExCode",
      "type": "UltraTextEditor",
      "category": "Type",
      "label": "BargeEx Code",
      "dataBinding": "FacilityLocation.BargeExCode",
      "required": false,
      "tab": "Details"
    },
    {
      "name": "txtLockName",
      "type": "UltraTextEditor",
      "category": "LockGauge",
      "label": "Lock Name",
      "dataBinding": "FacilityLocation.LockName",
      "required": false,
      "tab": "Details",
      "conditionalDisplay": "FacilityType == 'Lock'",
      "validationRule": "MustBeBlankIfNotLock"
    },
    {
      "name": "txtLockNumber",
      "type": "UltraTextEditor",
      "category": "LockGauge",
      "label": "Lock Number",
      "dataBinding": "FacilityLocation.LockNumber",
      "required": false,
      "tab": "Details",
      "conditionalDisplay": "FacilityType == 'Lock'",
      "validationRule": "MustBeBlankIfNotLock"
    },
    {
      "name": "txtGaugeName",
      "type": "UltraTextEditor",
      "category": "LockGauge",
      "label": "Gauge Name",
      "dataBinding": "FacilityLocation.GaugeName",
      "required": false,
      "tab": "Details",
      "conditionalDisplay": "FacilityType == 'Gauge Location'",
      "validationRule": "MustBeBlankIfNotGauge"
    },
    {
      "name": "txtNdcName",
      "type": "UltraTextEditor",
      "category": "NDC",
      "label": "NDC Name",
      "dataBinding": "FacilityLocation.NdcName",
      "required": false,
      "tab": "NDC Data"
    },
    {
      "name": "txtNdcAddress",
      "type": "UltraTextEditor",
      "category": "NDC",
      "label": "NDC Address",
      "dataBinding": "FacilityLocation.NdcAddress",
      "required": false,
      "tab": "NDC Data"
    },
    {
      "name": "txtNdcCity",
      "type": "UltraTextEditor",
      "category": "NDC",
      "label": "NDC City",
      "dataBinding": "FacilityLocation.NdcCity",
      "required": false,
      "tab": "NDC Data"
    },
    {
      "name": "txtNdcState",
      "type": "UltraTextEditor",
      "category": "NDC",
      "label": "NDC State",
      "dataBinding": "FacilityLocation.NdcState",
      "required": false,
      "tab": "NDC Data"
    },
    {
      "name": "txtNdcZip",
      "type": "UltraTextEditor",
      "category": "NDC",
      "label": "NDC Zip",
      "dataBinding": "FacilityLocation.NdcZip",
      "required": false,
      "tab": "NDC Data"
    },
    {
      "name": "chkIsActive",
      "type": "UltraCheckEditor",
      "category": "Status",
      "label": "Is Active",
      "dataBinding": "FacilityLocation.IsActive",
      "required": false,
      "tab": "Details",
      "defaultValue": true
    }
  ],
  "grids": [
    {
      "name": "grdStatus",
      "type": "UltraGrid",
      "uniqueIdentifier": "FacilityStatusID",
      "tab": "Status",
      "category": "RelatedEntity",
      "dataBinding": "FacilityLocation.FacilityStatuses",
      "allowAdd": true,
      "allowEdit": true,
      "allowDelete": true,
      "columns": [
        {
          "key": "FacilityStatusID",
          "header": "Status ID",
          "dataType": "Integer",
          "hidden": true,
          "isPrimaryKey": true
        },
        {
          "key": "StatusDate",
          "header": "Status Date",
          "dataType": "DateTime",
          "width": 120,
          "format": "MM/dd/yyyy",
          "required": true
        },
        {
          "key": "StatusType",
          "header": "Status Type",
          "dataType": "String",
          "width": 150,
          "editor": "Dropdown",
          "required": true
        },
        {
          "key": "StatusDescription",
          "header": "Description",
          "dataType": "String",
          "width": 300,
          "required": false
        },
        {
          "key": "CreatedBy",
          "header": "Created By",
          "dataType": "String",
          "width": 100,
          "readOnly": true
        },
        {
          "key": "CreatedDate",
          "header": "Created Date",
          "dataType": "DateTime",
          "width": 120,
          "format": "MM/dd/yyyy",
          "readOnly": true
        }
      ],
      "toolbar": {
        "btnAdd": true,
        "btnEdit": true,
        "btnDelete": true
      }
    },
    {
      "name": "grdBerths",
      "type": "UltraGrid",
      "uniqueIdentifier": "FacilityBerthID",
      "tab": "Berths",
      "category": "RelatedEntity",
      "dataBinding": "FacilityLocation.FacilityBerths",
      "allowAdd": true,
      "allowEdit": true,
      "allowDelete": true,
      "columns": [
        {
          "key": "FacilityBerthID",
          "header": "Berth ID",
          "dataType": "Integer",
          "hidden": true,
          "isPrimaryKey": true
        },
        {
          "key": "BerthName",
          "header": "Berth Name",
          "dataType": "String",
          "width": 200,
          "required": true
        },
        {
          "key": "BerthNumber",
          "header": "Berth Number",
          "dataType": "String",
          "width": 100,
          "required": false
        },
        {
          "key": "Capacity",
          "header": "Capacity",
          "dataType": "Integer",
          "width": 100,
          "required": false
        },
        {
          "key": "Length",
          "header": "Length (ft)",
          "dataType": "Decimal",
          "width": 100,
          "required": false
        },
        {
          "key": "IsActive",
          "header": "Active",
          "dataType": "Boolean",
          "width": 80,
          "required": false
        },
        {
          "key": "Notes",
          "header": "Notes",
          "dataType": "String",
          "width": 250,
          "required": false
        }
      ],
      "toolbar": {
        "btnAdd": true,
        "btnEdit": true,
        "btnDelete": true
      }
    }
  ],
  "dropdowns": [
    {
      "name": "cboRiver",
      "populationMethod": "LoadRiverDropdown",
      "dataSource": "LookupService.GetRivers",
      "displayMember": "RiverName",
      "valueMember": "RiverID",
      "allowNull": true
    },
    {
      "name": "cboBank",
      "populationMethod": "LoadBankDropdown",
      "dataSource": "Static",
      "values": [
        {"value": "L", "display": "Left"},
        {"value": "R", "display": "Right"},
        {"value": "B", "display": "Both"}
      ],
      "allowNull": true
    },
    {
      "name": "cboFacilityType",
      "populationMethod": "LoadFacilityTypeDropdown",
      "dataSource": "LookupService.GetFacilityTypes",
      "displayMember": "TypeName",
      "valueMember": "TypeID",
      "allowNull": false,
      "onChangeEvent": "cboFacilityType_ValueChanged"
    }
  ],
  "buttons": [
    {
      "name": "btnSave",
      "text": "Save",
      "buttonType": "Submit",
      "location": "Footer",
      "securityType": "Modify",
      "eventHandler": "btnSave_Click",
      "validatesForm": true
    },
    {
      "name": "btnCancel",
      "text": "Cancel",
      "buttonType": "Cancel",
      "location": "Footer",
      "securityType": "None",
      "eventHandler": "btnCancel_Click",
      "validatesForm": false
    },
    {
      "name": "btnDelete",
      "text": "Delete",
      "buttonType": "Delete",
      "location": "Toolbar",
      "securityType": "Delete",
      "eventHandler": "btnDelete_Click",
      "confirmationRequired": true
    },
    {
      "name": "btnAddStatus",
      "text": "Add Status",
      "buttonType": "ChildAdd",
      "location": "StatusGridToolbar",
      "securityType": "Modify",
      "eventHandler": "btnAddStatus_Click",
      "relatedGrid": "grdStatus"
    },
    {
      "name": "btnEditStatus",
      "text": "Edit Status",
      "buttonType": "ChildEdit",
      "location": "StatusGridToolbar",
      "securityType": "Modify",
      "eventHandler": "btnEditStatus_Click",
      "relatedGrid": "grdStatus"
    },
    {
      "name": "btnDeleteStatus",
      "text": "Delete Status",
      "buttonType": "ChildDelete",
      "location": "StatusGridToolbar",
      "securityType": "Modify",
      "eventHandler": "btnDeleteStatus_Click",
      "relatedGrid": "grdStatus",
      "confirmationRequired": true
    },
    {
      "name": "btnAddBerth",
      "text": "Add Berth",
      "buttonType": "ChildAdd",
      "location": "BerthGridToolbar",
      "securityType": "Modify",
      "eventHandler": "btnAddBerth_Click",
      "relatedGrid": "grdBerths"
    },
    {
      "name": "btnEditBerth",
      "text": "Edit Berth",
      "buttonType": "ChildEdit",
      "location": "BerthGridToolbar",
      "securityType": "Modify",
      "eventHandler": "btnEditBerth_Click",
      "relatedGrid": "grdBerths"
    },
    {
      "name": "btnDeleteBerth",
      "text": "Delete Berth",
      "buttonType": "ChildDelete",
      "location": "BerthGridToolbar",
      "securityType": "Modify",
      "eventHandler": "btnDeleteBerth_Click",
      "relatedGrid": "grdBerths",
      "confirmationRequired": true
    }
  ],
  "panels": [
    {
      "name": "pnlDetails",
      "type": "UltraPanel",
      "tab": "Details",
      "controls": [
        "txtName",
        "txtShortName",
        "cboRiver",
        "txtMile",
        "cboBank",
        "cboFacilityType",
        "txtBargeExCode",
        "chkIsActive"
      ]
    },
    {
      "name": "pnlLockGauge",
      "type": "UltraPanel",
      "tab": "Details",
      "conditionalDisplay": "FacilityType == 'Lock' OR 'Gauge Location'",
      "controls": [
        "txtLockName",
        "txtLockNumber",
        "txtGaugeName"
      ]
    },
    {
      "name": "pnlStatus",
      "type": "UltraPanel",
      "tab": "Status",
      "controls": [
        "grdStatus"
      ]
    },
    {
      "name": "pnlBerths",
      "type": "UltraPanel",
      "tab": "Berths",
      "controls": [
        "grdBerths"
      ]
    },
    {
      "name": "pnlNDC",
      "type": "UltraPanel",
      "tab": "NDC Data",
      "controls": [
        "txtNdcName",
        "txtNdcAddress",
        "txtNdcCity",
        "txtNdcState",
        "txtNdcZip"
      ]
    }
  ],
  "tabs": [
    {
      "name": "tabDetails",
      "text": "Details",
      "order": 1,
      "panels": ["pnlDetails", "pnlLockGauge"]
    },
    {
      "name": "tabStatus",
      "text": "Status",
      "order": 2,
      "panels": ["pnlStatus"],
      "requiresParentSaved": true
    },
    {
      "name": "tabBerths",
      "text": "Berths",
      "order": 3,
      "panels": ["pnlBerths"],
      "requiresParentSaved": true
    },
    {
      "name": "tabNDC",
      "text": "NDC Data",
      "order": 4,
      "panels": ["pnlNDC"]
    }
  ],
  "validation": {
    "formValidationMethod": "AreFieldsValid",
    "businessRulesMethod": "CheckBusinessRules",
    "rules": [
      {
        "rule": "RequiredField",
        "field": "txtName",
        "message": "Facility Name is required"
      },
      {
        "rule": "RequiredField",
        "field": "txtShortName",
        "message": "Short Name is required"
      },
      {
        "rule": "RequiredField",
        "field": "cboFacilityType",
        "message": "Facility Type is required"
      },
      {
        "rule": "ConditionalBlank",
        "field": "txtLockName",
        "condition": "FacilityType != 'Lock'",
        "message": "Lock Name must be blank if Facility Type is not 'Lock'"
      },
      {
        "rule": "ConditionalBlank",
        "field": "txtLockNumber",
        "condition": "FacilityType != 'Lock'",
        "message": "Lock Number must be blank if Facility Type is not 'Lock'"
      },
      {
        "rule": "ConditionalBlank",
        "field": "txtGaugeName",
        "condition": "FacilityType != 'Gauge Location'",
        "message": "Gauge Name must be blank if Facility Type is not 'Gauge Location'"
      },
      {
        "rule": "RiverRequiredWithMile",
        "fields": ["cboRiver", "txtMile"],
        "condition": "txtMile.HasValue",
        "message": "River is required when Mile is specified"
      }
    ]
  },
  "eventHandlers": [
    {
      "event": "FormLoad",
      "handler": "frmFacilityDetail_Load",
      "description": "Initialize form, load dropdowns, populate data"
    },
    {
      "event": "cboFacilityType_ValueChanged",
      "handler": "cboFacilityType_ValueChanged",
      "description": "Show/hide Lock/Gauge fields based on facility type"
    },
    {
      "event": "btnSave_Click",
      "handler": "btnSave_Click",
      "description": "Validate form, save facility and related entities"
    },
    {
      "event": "btnCancel_Click",
      "handler": "btnCancel_Click",
      "description": "Close form without saving"
    },
    {
      "event": "btnDelete_Click",
      "handler": "btnDelete_Click",
      "description": "Delete facility with confirmation"
    },
    {
      "event": "btnAddStatus_Click",
      "handler": "btnAddStatus_Click",
      "description": "Open modal to add new facility status"
    },
    {
      "event": "btnEditStatus_Click",
      "handler": "btnEditStatus_Click",
      "description": "Open modal to edit selected facility status"
    },
    {
      "event": "btnDeleteStatus_Click",
      "handler": "btnDeleteStatus_Click",
      "description": "Delete selected facility status with confirmation"
    },
    {
      "event": "btnAddBerth_Click",
      "handler": "btnAddBerth_Click",
      "description": "Open modal to add new facility berth"
    },
    {
      "event": "btnEditBerth_Click",
      "handler": "btnEditBerth_Click",
      "description": "Open modal to edit selected facility berth"
    },
    {
      "event": "btnDeleteBerth_Click",
      "handler": "btnDeleteBerth_Click",
      "description": "Delete selected facility berth with confirmation"
    }
  ],
  "security": {
    "subSystem": "frmFacilityDetail",
    "permissions": [
      {
        "name": "FacilityReadOnly",
        "description": "View facility details",
        "controls": ["All"]
      },
      {
        "name": "FacilityModify",
        "description": "Edit facility details",
        "controls": ["btnSave", "btnAddStatus", "btnEditStatus", "btnAddBerth", "btnEditBerth", "All Inputs"]
      },
      {
        "name": "FacilityDelete",
        "description": "Delete facility",
        "controls": ["btnDelete", "btnDeleteStatus", "btnDeleteBerth"]
      }
    ]
  },
  "dataBinding": {
    "businessObject": "FacilityLocation",
    "primaryKey": "LocationID",
    "relatedEntities": [
      {
        "name": "FacilityStatuses",
        "collectionProperty": "FacilityStatuses",
        "foreignKey": "LocationID",
        "grid": "grdStatus"
      },
      {
        "name": "FacilityBerths",
        "collectionProperty": "FacilityBerths",
        "foreignKey": "LocationID",
        "grid": "grdBerths"
      }
    ]
  }
}
