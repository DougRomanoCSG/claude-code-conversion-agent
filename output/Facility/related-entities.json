{
  "entityName": "Facility",
  "parentEntity": "Location",
  "parentKey": "LocationID",
  "description": "Facility is represented through FacilityLocation property on Location entity. Facilities have berths and status tracking.",
  "childCollections": [
    {
      "name": "FacilityBerths",
      "entityName": "FacilityBerth",
      "collectionType": "FacilityBerths",
      "foreignKey": "LocationID",
      "parentKey": "LocationID",
      "primaryKey": "FacilityBerthID",
      "displayName": "Berths",
      "description": "Collection of berths at a facility where ships can dock",
      "gridColumns": [
        {
          "propertyName": "Name",
          "displayName": "Berth Name",
          "width": 200,
          "alignment": "Left"
        },
        {
          "propertyName": "ShipName",
          "displayName": "Current Ship",
          "width": 211,
          "alignment": "Left",
          "isReadOnly": true
        }
      ],
      "properties": [
        {
          "name": "FacilityBerthID",
          "type": "Int32",
          "isPrimaryKey": true,
          "isRequired": true
        },
        {
          "name": "LocationID",
          "type": "Int32",
          "isForeignKey": true,
          "isRequired": true
        },
        {
          "name": "Name",
          "type": "String",
          "maxLength": 50,
          "isRequired": true,
          "displayName": "Berth Name"
        },
        {
          "name": "ShipID",
          "type": "Int32",
          "isRequired": false,
          "description": "Reference to ship currently at berth"
        },
        {
          "name": "ShipName",
          "type": "String",
          "isReadOnly": true,
          "isCalculated": true,
          "description": "Display name of current ship at berth"
        }
      ],
      "crudOperations": {
        "create": {
          "method": "NewFacilityBerth",
          "location": "FacilityBerths collection",
          "description": "Creates new berth instance via collection"
        },
        "read": {
          "method": "GetFacilityBerths",
          "storedProcedure": "FacilityBerthsSelect",
          "parameters": ["@LocationID"]
        },
        "update": {
          "method": "Update",
          "description": "Updates via parent FacilityLocation save"
        },
        "delete": {
          "method": "Remove",
          "location": "FacilityBerths collection",
          "storedProcedure": "FacilityBerthsDelete"
        },
        "addToCollection": {
          "method": "Add",
          "location": "FacilityBerths collection",
          "parameters": ["FacilityBerth", "FacilityLocation"],
          "description": "Adds berth to collection and sets LocationID"
        }
      },
      "uiComponents": {
        "gridName": "grdBerths",
        "detailSection": "grpBerth",
        "tabName": "Berths",
        "toolbarButtons": [
          {
            "key": "AddBerth",
            "displayName": "Add",
            "buttonType": "Add",
            "method": "ItemAddBerth"
          },
          {
            "key": "ModifyBerth",
            "displayName": "Modify",
            "buttonType": "Open",
            "method": "ItemModify"
          },
          {
            "key": "RemoveBerth",
            "displayName": "Remove",
            "buttonType": "Remove",
            "method": "ItemRemoveBerth"
          }
        ],
        "formControls": [
          {
            "controlName": "txtBerthName",
            "propertyName": "Name",
            "controlType": "TextBox"
          },
          {
            "controlName": "txtShipName",
            "propertyName": "ShipName",
            "controlType": "TextBox",
            "isReadOnly": true
          }
        ],
        "editButtons": [
          {
            "name": "btnSetBerth",
            "action": "Save",
            "buttonType": "Submit"
          },
          {
            "name": "btnCancelEditBerth",
            "action": "Cancel",
            "buttonType": "CancelEdit"
          }
        ]
      },
      "businessRules": [],
      "sortOrder": {
        "defaultColumn": "Name",
        "defaultDirection": "Ascending"
      }
    },
    {
      "name": "FacilityStatuses",
      "entityName": "FacilityStatus",
      "collectionType": "FacilityStatuses",
      "foreignKey": "LocationID",
      "parentKey": "LocationID",
      "primaryKey": "FacilityStatusID",
      "displayName": "Status",
      "description": "Collection of status records tracking facility operational status over time",
      "gridColumns": [
        {
          "propertyName": "StartDateTime",
          "displayName": "Start Date/Time",
          "width": 110,
          "alignment": "Left",
          "hasCustomComparer": true
        },
        {
          "propertyName": "EndDateTime",
          "displayName": "End Date/Time",
          "width": 110,
          "alignment": "Left",
          "hasCustomComparer": true
        },
        {
          "propertyName": "Status",
          "displayName": "Status",
          "width": 150,
          "alignment": "Left"
        },
        {
          "propertyName": "Note",
          "displayName": "Note",
          "width": 150,
          "alignment": "Left",
          "autoFitStyle": "ExtendLastColumn"
        }
      ],
      "properties": [
        {
          "name": "FacilityStatusID",
          "type": "Int32",
          "isPrimaryKey": true,
          "isRequired": true
        },
        {
          "name": "LocationID",
          "type": "Int32",
          "isForeignKey": true,
          "isRequired": true
        },
        {
          "name": "StartDateTime",
          "type": "SmartDateTime",
          "isRequired": true,
          "displayName": "Start date/time"
        },
        {
          "name": "EndDateTime",
          "type": "SmartDateTime",
          "isRequired": false,
          "displayName": "End date/time"
        },
        {
          "name": "Status",
          "type": "String",
          "isRequired": true,
          "isValidationList": true,
          "validationListType": "FacilityStatus"
        },
        {
          "name": "Note",
          "type": "String",
          "isRequired": false,
          "maxLength": 1000,
          "hasTextEditor": true
        }
      ],
      "crudOperations": {
        "create": {
          "method": "NewFacilityStatus",
          "location": "FacilityStatuses collection",
          "description": "Creates new status instance via collection"
        },
        "read": {
          "method": "GetFacilityStatuses",
          "storedProcedure": "FacilityStatusesSelect",
          "parameters": ["@LocationID"]
        },
        "update": {
          "method": "Update",
          "description": "Updates via parent Location save"
        },
        "delete": {
          "method": "Remove",
          "location": "FacilityStatuses collection",
          "storedProcedure": "FacilityStatusesDelete"
        },
        "addToCollection": {
          "method": "Add",
          "location": "FacilityStatuses collection",
          "parameters": ["FacilityStatus", "FacilityLocation"],
          "description": "Adds status to collection and sets LocationID"
        }
      },
      "uiComponents": {
        "gridName": "grdFacilityStatus",
        "detailSection": "grpStatus",
        "tabName": "Status",
        "toolbarButtons": [
          {
            "key": "AddStatus",
            "displayName": "Add",
            "buttonType": "Add",
            "method": "ItemAddStatus"
          },
          {
            "key": "ModifyStatus",
            "displayName": "Modify",
            "buttonType": "Open",
            "method": "ItemModify"
          },
          {
            "key": "RemoveStatus",
            "displayName": "Remove",
            "buttonType": "Remove",
            "method": "ItemRemoveStatus"
          },
          {
            "key": "ExportStatus",
            "displayName": "Export",
            "buttonType": "Open",
            "method": "ExportGrid"
          }
        ],
        "formControls": [
          {
            "controlName": "dtStartDate",
            "propertyName": "StartDateTime",
            "controlType": "DatePicker"
          },
          {
            "controlName": "cboStartTime",
            "propertyName": "StartDateTime",
            "controlType": "TimeCombo",
            "description": "Time portion of StartDateTime"
          },
          {
            "controlName": "cboFacilityStatus",
            "propertyName": "Status",
            "controlType": "ComboBox",
            "validationListType": "FacilityStatus"
          },
          {
            "controlName": "txtStatusNote",
            "propertyName": "Note",
            "controlType": "TextBox",
            "hasEditorButton": true,
            "editorMaxLength": 1000
          },
          {
            "controlName": "dtEndDate",
            "propertyName": "EndDateTime",
            "controlType": "DatePicker"
          },
          {
            "controlName": "cboEndTime",
            "propertyName": "EndDateTime",
            "controlType": "TimeCombo",
            "description": "Time portion of EndDateTime"
          }
        ],
        "editButtons": [
          {
            "name": "btnSetStatus",
            "action": "Save",
            "buttonType": "Submit"
          },
          {
            "name": "btnCancelEditStatus",
            "action": "Cancel",
            "buttonType": "CancelEdit"
          }
        ]
      },
      "businessRules": [
        {
          "name": "EndDateAfterStart",
          "description": "End date/time must be greater than or equal to Start date/time",
          "ruleType": "Comparison",
          "properties": ["EndDateTime", "StartDateTime"],
          "errorMessage": "End date/time must be later than or equal to Start date/time."
        }
      ],
      "sortOrder": {
        "defaultColumn": "StartDateTime",
        "defaultDirection": "Descending"
      }
    }
  ],
  "propertyObjects": [
    {
      "name": "FacilityLocation",
      "type": "Property",
      "description": "Core facility-specific properties stored in separate table",
      "foreignKey": "LocationID",
      "parentKey": "LocationID",
      "isPrimaryProperty": true,
      "properties": [
        {
          "name": "LocationID",
          "type": "Int32",
          "isPrimaryKey": true,
          "isRequired": true
        },
        {
          "name": "BargeExCode",
          "type": "String",
          "maxLength": 10,
          "isRequired": false,
          "displayName": "BargeEx Code"
        },
        {
          "name": "Bank",
          "type": "String",
          "maxLength": 50,
          "isRequired": false,
          "isValidationList": true,
          "validationListType": "RiverBank"
        },
        {
          "name": "BargeExLocationType",
          "type": "String",
          "maxLength": 20,
          "isRequired": false,
          "isValidationList": true,
          "validationListType": "BargeExLocationType",
          "displayName": "Facility type"
        },
        {
          "name": "NdcName",
          "type": "String",
          "maxLength": 200,
          "isRequired": false,
          "isReadOnly": true,
          "description": "NDC (National Docking Company) data"
        },
        {
          "name": "NdcLocationDescription",
          "type": "String",
          "maxLength": 200,
          "isRequired": false,
          "isReadOnly": true
        },
        {
          "name": "NdcAddress",
          "type": "String",
          "maxLength": 50,
          "isRequired": false,
          "isReadOnly": true
        },
        {
          "name": "NdcCounty",
          "type": "String",
          "maxLength": 30,
          "isRequired": false,
          "isReadOnly": true
        },
        {
          "name": "NdcCountyFips",
          "type": "String",
          "maxLength": 3,
          "isRequired": false,
          "isReadOnly": true
        },
        {
          "name": "NdcTown",
          "type": "String",
          "maxLength": 30,
          "isRequired": false,
          "isReadOnly": true
        },
        {
          "name": "NdcState",
          "type": "String",
          "maxLength": 2,
          "isRequired": false,
          "isReadOnly": true
        },
        {
          "name": "NdcWaterway",
          "type": "String",
          "maxLength": 50,
          "isRequired": false,
          "isReadOnly": true
        },
        {
          "name": "NdcPort",
          "type": "String",
          "maxLength": 25,
          "isRequired": false,
          "isReadOnly": true
        },
        {
          "name": "NdcLatitude",
          "type": "Double",
          "isRequired": false,
          "isReadOnly": true
        },
        {
          "name": "NdcLongitude",
          "type": "Double",
          "isRequired": false,
          "isReadOnly": true
        },
        {
          "name": "NdcOperator",
          "type": "String",
          "maxLength": 150,
          "isRequired": false,
          "isReadOnly": true
        },
        {
          "name": "NdcOwner",
          "type": "String",
          "maxLength": 150,
          "isRequired": false,
          "isReadOnly": true
        },
        {
          "name": "NdcPurpose",
          "type": "String",
          "maxLength": 255,
          "isRequired": false,
          "isReadOnly": true
        },
        {
          "name": "NdcRemark",
          "type": "String",
          "maxLength": 1200,
          "isRequired": false,
          "isReadOnly": true
        },
        {
          "name": "LockUsaceName",
          "type": "String",
          "maxLength": 50,
          "isRequired": false,
          "displayName": "USACE name",
          "conditionallyEnabled": true,
          "enabledWhen": "BargeExLocationType = 'Lock' OR 'Gauge Location'"
        },
        {
          "name": "LockFloodStage",
          "type": "Decimal",
          "isRequired": false,
          "displayName": "Flood stage",
          "conditionallyEnabled": true,
          "enabledWhen": "BargeExLocationType = 'Lock' OR 'Gauge Location'"
        },
        {
          "name": "LockPoolStage",
          "type": "Decimal",
          "isRequired": false,
          "displayName": "Pool stage",
          "conditionallyEnabled": true,
          "enabledWhen": "BargeExLocationType = 'Lock' OR 'Gauge Location'"
        },
        {
          "name": "LockLowWater",
          "type": "Decimal",
          "isRequired": false,
          "displayName": "Low water",
          "conditionallyEnabled": true,
          "enabledWhen": "BargeExLocationType = 'Lock' OR 'Gauge Location'"
        },
        {
          "name": "LockNormalCurrent",
          "type": "Decimal",
          "isRequired": false,
          "displayName": "Normal current",
          "conditionallyEnabled": true,
          "enabledWhen": "BargeExLocationType = 'Lock' OR 'Gauge Location'"
        },
        {
          "name": "LockHighFlow",
          "type": "Decimal",
          "isRequired": false,
          "displayName": "High flow",
          "conditionallyEnabled": true,
          "enabledWhen": "BargeExLocationType = 'Lock' OR 'Gauge Location'"
        },
        {
          "name": "LockHighWater",
          "type": "Decimal",
          "isRequired": false,
          "displayName": "High water",
          "conditionallyEnabled": true,
          "enabledWhen": "BargeExLocationType = 'Lock' OR 'Gauge Location'"
        },
        {
          "name": "LockCatastrophicLevel",
          "type": "Decimal",
          "isRequired": false,
          "displayName": "Catastrophic level",
          "conditionallyEnabled": true,
          "enabledWhen": "BargeExLocationType = 'Lock' OR 'Gauge Location'"
        }
      ],
      "businessRules": [
        {
          "name": "LockFieldsRequireLockType",
          "description": "Lock-specific fields must be blank if facility type is not 'Lock' or 'Gauge Location'",
          "ruleType": "Conditional",
          "properties": [
            "LockUsaceName",
            "LockFloodStage",
            "LockPoolStage",
            "LockLowWater",
            "LockNormalCurrent",
            "LockHighFlow",
            "LockHighWater",
            "LockCatastrophicLevel"
          ],
          "condition": "BargeExLocationType != 'Lock' AND BargeExLocationType != 'Gauge Location'",
          "errorMessage": "[Field] must be blank if Facility type is not 'Lock' or 'Gauge Location'."
        }
      ],
      "storedProcedures": {
        "select": "FacilityLocationSelect",
        "insert": "FacilityLocationInsert",
        "update": "FacilityLocationUpdate",
        "delete": "FacilityLocationDelete"
      },
      "uiComponents": {
        "tabName": "Details",
        "sections": [
          {
            "name": "Facility Details",
            "controls": [
              "txtBargeExCode",
              "cboBank",
              "cboBargeExLocationType"
            ]
          },
          {
            "name": "Lock/Gauge Information",
            "conditionallyVisible": true,
            "controls": [
              "txtLockUsaceName",
              "txtLockFloodStage",
              "txtLockPoolStage",
              "txtLockLowWater",
              "txtLockNormalCurrent",
              "txtLockHighFlow",
              "txtLockHighWater",
              "txtLockCatastrophicLevel"
            ]
          },
          {
            "name": "NDC Data",
            "tabName": "NDC Data",
            "readOnly": true,
            "controls": [
              "txtNdcName",
              "txtNdcLocationDescription",
              "txtNdcAddress",
              "txtNdcCounty",
              "txtNdcCountyFips",
              "txtNdcTown",
              "txtNdcState",
              "txtNdcWaterway",
              "txtNdcPort",
              "txtNdcLatitude",
              "txtNdcLongitude",
              "txtNdcOperator",
              "txtNdcOwner",
              "txtNdcPurpose",
              "txtNdcRemark"
            ]
          }
        ]
      }
    },
    {
      "name": "Alert",
      "type": "Property",
      "description": "Alert property object for facility notifications",
      "foreignKey": "LocationID",
      "parentKey": "LocationID",
      "loadingDeferred": true,
      "isOptional": true
    }
  ],
  "parentEntityProperties": [
    {
      "name": "LocationID",
      "type": "Int32",
      "isPrimaryKey": true,
      "isRequired": true
    },
    {
      "name": "Name",
      "type": "String",
      "displayName": "Facility Name",
      "isRequired": true,
      "description": "Primary facility name"
    },
    {
      "name": "ShortName",
      "type": "String",
      "isRequired": false
    },
    {
      "name": "Note",
      "type": "String",
      "displayName": "Location Note",
      "isRequired": false
    },
    {
      "name": "IsActive",
      "type": "Boolean",
      "isRequired": true,
      "defaultValue": true
    },
    {
      "name": "River",
      "type": "String",
      "maxLength": 3,
      "isRequired": false,
      "isReferenceData": true
    },
    {
      "name": "Mile",
      "type": "Decimal",
      "isRequired": false,
      "description": "Mile marker on river"
    }
  ],
  "formInformation": {
    "detailForm": "frmFacilityDetail",
    "searchForm": "frmFacilitySearch",
    "parentBusinessObject": "Location",
    "tabs": [
      {
        "key": "Details",
        "displayName": "Details",
        "disabledWhenEditing": true
      },
      {
        "key": "Status",
        "displayName": "Status",
        "enabledWhenEditingStatus": true
      },
      {
        "key": "Berths",
        "displayName": "Berths",
        "enabledWhenEditingBerth": true
      },
      {
        "key": "NdcData",
        "displayName": "NDC Data",
        "disabledWhenEditing": true
      }
    ]
  },
  "dataAccess": {
    "parentTable": "Location",
    "propertyTable": "FacilityLocation",
    "childTables": [
      {
        "name": "FacilityBerth",
        "foreignKey": "LocationID"
      },
      {
        "name": "FacilityStatus",
        "foreignKey": "LocationID"
      }
    ]
  },
  "notes": [
    "Facility is a specialization of Location entity via LocationType discriminator",
    "FacilityLocation is a property object, not accessed directly",
    "FacilityBerths collection is eagerly loaded with parent",
    "FacilityStatuses collection is lazy-loaded (deferred)",
    "Alert property is lazy-loaded and optional",
    "Parent form uses nested editing for child collections with inline detail sections",
    "Lock/Gauge-specific fields are conditionally enabled based on BargeExLocationType",
    "NDC (National Docking Company) data is read-only reference information",
    "Form uses tab-based UI with Details, Status, Berths, and NDC Data tabs",
    "Each child collection has its own toolbar with Add/Modify/Remove/Export buttons",
    "Status collection includes export to grid functionality",
    "Berth ShipName is a calculated/read-only property showing current ship at berth"
  ]
}
