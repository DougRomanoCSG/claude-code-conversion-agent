{
  "formName": "frmBargeTokenMap",
  "implements": ["IBaseDetailEdit"],
  "inheritsFrom": "frmBaseDetailEditList",
  "description": "Maps field values to visual representations (pictures, symbols, or colors) for barge token display. Supports different field types including location-based fields.",
  "businessObject": "BargeTokenMap",
  "initializationParameters": [
    {
      "name": "fieldName",
      "type": "String",
      "description": "Name of field being mapped (e.g., 'Location', 'Consign To', 'On Order To')"
    },
    {
      "name": "displayType",
      "type": "String",
      "description": "Type of visualization: 'picture', 'symbol', or 'color'"
    },
    {
      "name": "fleetID",
      "type": "Integer",
      "description": "Fleet identifier for filtering data"
    }
  ],
  "controls": [
    {
      "name": "txtFieldName",
      "type": "UltraTextEditor",
      "category": "DataEntry",
      "label": "Type",
      "dataBinding": "BargeTokenMap.FieldName",
      "validation": [
        {
          "type": "String",
          "maxLength": "BargeTokenMap.MaxLength.FieldName"
        }
      ],
      "events": ["Validated"],
      "visibility": "Conditional - visible only for non-location fields",
      "state": "Readonly",
      "modernEquivalent": "<input type=\"text\" class=\"form-control\" readonly>"
    },
    {
      "name": "cboFieldName",
      "type": "UltraCombo",
      "category": "DataEntry",
      "label": "Type",
      "dataBinding": "BargeTokenMap.LocationType",
      "populationMethod": "PopulateFieldTypes",
      "dataSource": "Custom DataTable with location types",
      "valueField": "LocationType",
      "displayField": "LocationType",
      "events": ["Validated", "ValueChanged"],
      "visibility": "Conditional - visible only for location fields (Location, Consign To, On Order To)",
      "modernEquivalent": "<select class=\"form-select\">",
      "businessLogic": "On ValueChanged: Enables other controls and refreshes field values. On Validated: Calls PopulateFieldValues to refresh available values"
    },
    {
      "name": "cboFieldValue",
      "type": "UltraCombo",
      "category": "DataEntry",
      "label": "Value",
      "dataBinding": "BargeTokenMap.FieldValue",
      "populationMethod": "PopulateFieldValues",
      "dataSource": "Lists.BargeTokenMapFieldValueList",
      "valueField": "FieldValue",
      "displayField": "FieldValue",
      "events": ["Validated"],
      "state": "Initially readonly, enabled when editing",
      "modernEquivalent": "<select class=\"form-select\">"
    },
    {
      "name": "cboPictureID",
      "type": "UltraCombo",
      "category": "DataEntry",
      "label": "Picture",
      "dataBinding": "BargeTokenMap.PictureID",
      "populationMethod": "PopulateListCombo",
      "dataSource": "Lists.PictureList",
      "valueField": "PictureID",
      "displayField": "Picture",
      "events": ["Validated", "RowSelected"],
      "visibility": "Conditional - visible only when displayType = 'picture'",
      "state": "Hidden initially",
      "specialBehavior": "On RowSelected: Updates appearance.Image to show selected picture",
      "modernEquivalent": "Custom image picker control with preview"
    },
    {
      "name": "txtSymbolValue",
      "type": "UltraTextEditor",
      "category": "DataEntry",
      "label": "Symbol",
      "dataBinding": "BargeTokenMap.SymbolValue",
      "validation": [
        {
          "type": "String",
          "maxLength": "BargeTokenMap.MaxLength.SymbolValue"
        }
      ],
      "events": ["Validated"],
      "visibility": "Conditional - visible only when displayType = 'symbol'",
      "state": "Hidden initially",
      "modernEquivalent": "<input type=\"text\" class=\"form-control\" maxlength=\"X\">"
    },
    {
      "name": "cboColorPairID",
      "type": "UltraCombo",
      "category": "DataEntry",
      "label": "Color",
      "dataBinding": "BargeTokenMap.ColorPairID",
      "populationMethod": "PopulateListCombo",
      "dataSource": "Lists.ColorPairList (filtered by FleetID)",
      "valueField": "ColorPairID",
      "displayField": "Name",
      "events": ["Validated"],
      "visibility": "Conditional - visible only when displayType = 'color'",
      "state": "Hidden initially",
      "modernEquivalent": "<select class=\"form-select\"> with color preview"
    },
    {
      "name": "staStatus",
      "type": "UltraStatusBar",
      "category": "Status",
      "purpose": "Validation message display",
      "modernEquivalent": "Bootstrap alert div for validation messages"
    }
  ],
  "buttons": [
    {
      "name": "btnSubmit",
      "text": "Submit",
      "type": "Submit",
      "location": "Detail group box",
      "enabled": true,
      "visible": true,
      "handler": "btnSubmit_Click",
      "description": "Saves BargeTokenMap record, refreshes list, clears form",
      "security": "ButtonType.Submit"
    },
    {
      "name": "btnCancel",
      "text": "Cancel",
      "type": "CancelEdit",
      "location": "Detail group box",
      "enabled": true,
      "visible": true,
      "causesValidation": false,
      "handler": "btnCancel_Click",
      "description": "Cancels edit, clears form, takes form out of edit mode",
      "security": "ButtonType.CancelEdit"
    },
    {
      "name": "btnClose",
      "text": "Close",
      "type": "Cancel",
      "location": "Close group box",
      "enabled": true,
      "visible": true,
      "causesValidation": false,
      "handler": "btnClose_Click",
      "description": "Closes the form",
      "security": "ButtonType.Cancel"
    }
  ],
  "toolbarButtons": [
    {
      "key": "Add",
      "caption": "Add",
      "icon": "Add",
      "type": "Add",
      "handler": "ItemAdd",
      "description": "Creates new BargeTokenMap entry",
      "security": "ButtonType.Add",
      "enabledCondition": "Not editing and has security access"
    },
    {
      "key": "Modify",
      "caption": "Modify",
      "icon": "Modify",
      "type": "Open",
      "handler": "ItemModify",
      "description": "Edits selected BargeTokenMap entry",
      "security": "ButtonType.Open",
      "enabledCondition": "Row selected and not editing and has security access"
    },
    {
      "key": "Remove",
      "caption": "Remove",
      "icon": "Remove",
      "type": "Remove",
      "handler": "ItemRemove",
      "description": "Deletes selected BargeTokenMap entry after confirmation",
      "security": "ButtonType.Remove",
      "enabledCondition": "Row selected and not editing and has security access"
    },
    {
      "key": "Export",
      "caption": "Export",
      "icon": "ExportResults",
      "type": "Open",
      "handler": "Main.ExportGrid",
      "description": "Exports grid data",
      "security": "ButtonType.Open",
      "enabledCondition": "At least one row exists and not editing and has security access"
    }
  ],
  "grids": [
    {
      "name": "grdBargeTokenMap",
      "type": "UltraGrid",
      "uniqueIdentifier": "BargeTokenMapID",
      "dataSource": "Lists.BargeTokenMapList.GetList(fieldName, displayType, fleetID)",
      "autoFitStyle": "ExtendLastColumn",
      "allowColumnChooser": false,
      "defaultSort": [
        {
          "column": "ID",
          "direction": "Ascending"
        }
      ],
      "columnConfiguration": "Dynamic based on displayType",
      "pictureColumns": [
        {
          "key": "Picture",
          "header": "Picture",
          "dataType": "Image",
          "width": 46,
          "alignment": "Left",
          "sortable": true
        },
        {
          "key": "FieldValue",
          "header": "Value",
          "dataType": "String",
          "width": 100,
          "alignment": "Left",
          "sortable": true
        }
      ],
      "symbolColumns": [
        {
          "key": "FieldValue",
          "header": "Value",
          "dataType": "String",
          "width": 300,
          "alignment": "Left",
          "sortable": true
        },
        {
          "key": "SymbolValue",
          "header": "Symbol",
          "dataType": "String",
          "width": 46,
          "alignment": "Left",
          "sortable": true
        }
      ],
      "colorColumns": [
        {
          "key": "FieldValue",
          "header": "Value",
          "dataType": "String",
          "width": 100,
          "alignment": "Left",
          "sortable": true
        },
        {
          "key": "ColorName",
          "header": "Color Name",
          "dataType": "String",
          "width": 86,
          "alignment": "Left",
          "sortable": true
        },
        {
          "key": "TextColor",
          "header": "Text Color",
          "dataType": "Color",
          "width": 80,
          "alignment": "Left",
          "sortable": true
        },
        {
          "key": "BackColor",
          "header": "Back Color",
          "dataType": "Color",
          "width": 80,
          "alignment": "Left",
          "sortable": true
        }
      ],
      "events": ["DoubleClick (opens ItemModify)", "AfterSelectChange (calls SetToolState)"],
      "modernEquivalent": "DataTables with server-side processing"
    }
  ],
  "panels": [
    {
      "name": "pnlMain",
      "type": "UltraPanel",
      "dockStyle": "Fill",
      "contains": ["grdBargeTokenMap", "grpDetail", "grpClose", "staStatus"],
      "modernEquivalent": "Bootstrap container div"
    },
    {
      "name": "grpDetail",
      "type": "UltraGroupBox",
      "label": "Detail",
      "dockStyle": "Bottom",
      "borderStyle": "Header3D",
      "controls": [
        "cboFieldName",
        "txtFieldName",
        "lblType",
        "cboFieldValue",
        "UltraLabel1",
        "cboPictureID",
        "txtSymbolValue",
        "cboColorPairID",
        "lblMap",
        "btnSubmit",
        "btnCancel"
      ],
      "state": "Disabled when not editing",
      "modernEquivalent": "Bootstrap card or fieldset"
    },
    {
      "name": "grpClose",
      "type": "UltraGroupBox",
      "dockStyle": "Bottom",
      "borderStyle": "Header3D",
      "controls": ["btnClose"],
      "causesValidation": false,
      "modernEquivalent": "Bootstrap card footer"
    }
  ],
  "labels": [
    {
      "name": "lblType",
      "text": "Type:",
      "for": "cboFieldName or txtFieldName"
    },
    {
      "name": "UltraLabel1",
      "text": "Value:",
      "for": "cboFieldValue"
    },
    {
      "name": "lblMap",
      "text": "Dynamic - Picture:/Symbol:/Color:",
      "for": "cboPictureID/txtSymbolValue/cboColorPairID",
      "note": "Label text set dynamically based on displayType parameter"
    }
  ],
  "validation": {
    "method": "Inherited from base form",
    "validatorExtender": "ValidatorExtender",
    "displayControl": "staStatus",
    "rules": [
      {
        "control": "txtSymbolValue",
        "validationType": "String",
        "maxLength": "From BargeTokenMap.MaxLength.SymbolValue"
      },
      {
        "control": "txtFieldName",
        "validationType": "String",
        "maxLength": "From BargeTokenMap.MaxLength.FieldName"
      }
    ]
  },
  "eventHandlers": {
    "frmBargeTokenMap_Load": "Formats controls, refreshes list with initial data",
    "toolbarBargeTokenMap_ToolClick": "Routes toolbar button clicks to appropriate handlers (Add/Modify/Remove/Export)",
    "btnSubmit_Click": "Calls SubmitNoRefreshClick, refreshes list, clears controls, disables edit mode",
    "btnCancel_Click": "Calls CancelClick, clears controls, disables edit mode",
    "btnClose_Click": "Closes form after checking for unsaved changes",
    "cboPictureID_RowSelected": "Updates appearance.Image to display selected picture",
    "cboFieldName_Validated": "Refreshes field values based on selected location type",
    "cboFieldName_ValueChanged": "Enables/disables other controls based on whether location type is selected",
    "cboFieldValue_Validated": "Sets BargeTokenMap.FieldValue from combo selection",
    "txtFieldName_Validated": "Sets BargeTokenMap.FieldName from text",
    "txtSymbolValue_Validated": "Sets BargeTokenMap.SymbolValue from text",
    "cboColorPairID_Validated": "Sets BargeTokenMap.ColorPairID from combo selection",
    "cboPictureID_Validated": "Sets BargeTokenMap.PictureID from combo selection"
  },
  "businessLogic": {
    "newRecord": "BargeTokenMap.NewBargeTokenMap() - FleetID set on submit for new records",
    "getRecord": "BargeTokenMap.GetBargeTokenMap(ID)",
    "deleteRecord": "BargeTokenMap.DeleteBargeTokenMap(ID)",
    "refreshList": "Lists.BargeTokenMapList.GetList(fieldName, displayType, fleetID)",
    "populationMethods": {
      "PopulateFieldTypes": "Builds custom DataTable with location types (Boat, Consign Facility, Facility, Ship) based on fieldName",
      "PopulateFieldValues": "Calls Lists.BargeTokenMapFieldValueList.GetList(fieldValue, fleetID)",
      "PopulatePictures": "Lists.PictureList.GetList()",
      "PopulateColorPairs": "Lists.ColorPairList.GetList(fleetID)"
    },
    "conditionalLogic": {
      "IsLocationMap": "Returns true if fieldName is 'location', 'consign to', or 'on order to'",
      "displayTypeSwitch": "Form dynamically shows/hides controls based on displayType parameter (picture/symbol/color)",
      "fieldTypeSwitch": "Form shows combo or textbox for field name based on whether field is location-based"
    }
  },
  "formState": {
    "editMode": "Controlled by EnableDisableControls(isEditing)",
    "editModeChanges": [
      "Toolbar disabled when editing",
      "grpDetail enabled when editing",
      "Field-specific controls enabled/disabled based on location type selection",
      "IsEditingChild property set",
      "SetToolState called to update toolbar button states"
    ],
    "controlStateLogic": [
      "All detail controls initially hidden except cboFieldValue (readonly)",
      "If IsLocationMap: Show cboFieldName, populate with location types",
      "If not IsLocationMap: Show txtFieldName (readonly), set to fieldName",
      "Based on displayType: Show cboPictureID (picture), txtSymbolValue (symbol), or cboColorPairID (color)",
      "Controls disabled until location type selected (for location fields)"
    ]
  },
  "formProperties": {
    "formBorderStyle": "Fixed3D",
    "maximizeBox": false,
    "minimizeBox": false,
    "startPosition": "CenterParent",
    "defaultTitle": "Status - Map Field Values to Pictures",
    "dynamicTitle": "{fieldName} - Map Field Values to {displayType}s",
    "size": {
      "width": 362,
      "height": 441
    }
  },
  "securityIntegration": {
    "controlAuthorization": "Uses ControlAuthorization from Security DLL",
    "buttonTypes": "Mapped in SetButtonTypes and _ToolbarButtonTypes hashtable",
    "toolbarSecurity": "ToolbarButtonCanBeEnabled checks security for each toolbar button"
  },
  "modernizationNotes": {
    "architecturePattern": "Modal dialog or slide-out panel for add/edit, DataTables grid for list",
    "formTitle": "Should be set dynamically in controller based on parameters",
    "conditionalUI": "Use JavaScript to show/hide controls based on displayType and field type",
    "imageHandling": "cboPictureID requires custom image picker component with preview",
    "colorHandling": "cboColorPairID requires color preview in dropdown",
    "stateManagement": "Complex state management needed for location field conditional logic",
    "validationDisplay": "Use Bootstrap validation classes and inline error messages",
    "toolbarActions": "Convert to button group or action menu in modern UI"
  },
  "relatedEntities": [
    "BargeTokenMap",
    "PictureList",
    "ColorPairList",
    "BargeTokenMapFieldValueList"
  ],
  "specialFeatures": [
    "Dynamic form layout based on initialization parameters (fieldName, displayType)",
    "Conditional control visibility - shows different controls for picture/symbol/color modes",
    "Location field special handling - shows dropdown for location types vs readonly text for other fields",
    "Image preview functionality for picture selection",
    "Dynamic grid columns based on displayType",
    "Master-detail form pattern with inline editing"
  ]
}
