{
  "formName": "frmBargeTokenMap",
  "formType": "DetailEditList",
  "inherits": "frmBaseDetailEditList",
  "implements": ["IBaseDetailEdit"],
  "description": "Map field values to display types (Pictures, Symbols, or Colors) for barge tokens. This is a detail-edit-list form that allows users to manage mappings between field values and visual representations.",
  "initializationParameters": {
    "fieldName": "String - The name of the field being mapped (e.g., 'Location', 'Status')",
    "displayType": "String - Type of mapping: 'picture', 'symbol', or 'color'",
    "fleetID": "Integer - The fleet identifier"
  },
  "businessObject": "BargeTokenMap",
  "uniqueIdentifier": "BargeTokenMapID",
  "controls": [
    {
      "name": "txtFieldName",
      "type": "UltraTextEditor",
      "category": "DetailEdit",
      "label": "Type",
      "dataBinding": "BargeTokenMap.FieldName",
      "validation": [
        {
          "type": "String",
          "maxLength": "BargeTokenMap.MaxLength.FieldName"
        }
      ],
      "visibility": "Conditional - shown when field is NOT a location map",
      "state": "ReadOnly",
      "events": ["Validated"],
      "modernEquivalent": {
        "type": "text",
        "class": "form-control",
        "readonly": true
      }
    },
    {
      "name": "cboFieldName",
      "type": "UltraCombo",
      "category": "DetailEdit",
      "label": "Type",
      "dataBinding": "BargeTokenMap.LocationType",
      "populationMethod": "PopulateFieldTypes",
      "options": [
        "Boat",
        "Consign Facility",
        "Facility",
        "Ship"
      ],
      "optionsNote": "Boat and Consign Facility only shown when fieldName='Location'",
      "visibility": "Conditional - shown when field IS a location map",
      "state": "Enabled when editing",
      "events": ["Validated", "ValueChanged"],
      "valueField": "LocationType",
      "displayField": "LocationType",
      "modernEquivalent": {
        "type": "select",
        "class": "form-select",
        "plugin": "Select2"
      }
    },
    {
      "name": "cboFieldValue",
      "type": "UltraCombo",
      "category": "DetailEdit",
      "label": "Value",
      "dataBinding": "BargeTokenMap.FieldValue",
      "populationMethod": "PopulateFieldValues",
      "dataSource": "Lists.BargeTokenMapFieldValueList.GetList(fieldValue, fleetID).List",
      "valueField": "FieldValue",
      "displayField": "FieldValue",
      "state": "Always visible, enabled when editing and location type is selected",
      "events": ["Validated"],
      "modernEquivalent": {
        "type": "select",
        "class": "form-select",
        "plugin": "Select2"
      }
    },
    {
      "name": "cboPictureID",
      "type": "UltraCombo",
      "category": "DetailEdit",
      "label": "Picture (dynamic)",
      "dataBinding": "BargeTokenMap.PictureID",
      "populationMethod": "PopulateListCombo(Lists.PictureList.GetList().List, cboPictureID, 'Picture', 'PictureID')",
      "dataSource": "Lists.PictureList.GetList().List",
      "valueField": "PictureID",
      "displayField": "Picture",
      "imageList": "ImageList1",
      "visibility": "Conditional - shown only when displayType='picture'",
      "state": "Hidden by default, enabled when displayType='picture' and editing",
      "events": ["Validated", "RowSelected"],
      "specialBehavior": "Displays selected image in combo appearance",
      "modernEquivalent": {
        "type": "select",
        "class": "form-select",
        "plugin": "Select2 with image template",
        "note": "Consider using image preview component"
      }
    },
    {
      "name": "txtSymbolValue",
      "type": "UltraTextEditor",
      "category": "DetailEdit",
      "label": "Symbol (dynamic)",
      "dataBinding": "BargeTokenMap.SymbolValue",
      "validation": [
        {
          "type": "String",
          "maxLength": "BargeTokenMap.MaxLength.SymbolValue"
        }
      ],
      "visibility": "Conditional - shown only when displayType='symbol'",
      "state": "Hidden by default, enabled when displayType='symbol' and editing",
      "events": ["Validated"],
      "modernEquivalent": {
        "type": "text",
        "class": "form-control",
        "maxlength": "from BargeTokenMap.MaxLength.SymbolValue"
      }
    },
    {
      "name": "cboColorPairID",
      "type": "UltraCombo",
      "category": "DetailEdit",
      "label": "Color (dynamic)",
      "dataBinding": "BargeTokenMap.ColorPairID",
      "populationMethod": "PopulateListCombo(Lists.ColorPairList.GetList(fleetID).List, cboColorPairID, 'Name', 'ColorPairID')",
      "dataSource": "Lists.ColorPairList.GetList(fleetID).List",
      "valueField": "ColorPairID",
      "displayField": "Name",
      "visibility": "Conditional - shown only when displayType='color'",
      "state": "Hidden by default, enabled when displayType='color' and editing",
      "events": ["Validated"],
      "modernEquivalent": {
        "type": "select",
        "class": "form-select",
        "plugin": "Select2 with color preview"
      }
    }
  ],
  "buttons": [
    {
      "name": "btnSubmit",
      "text": "Submit",
      "type": "Submit",
      "location": "Detail group - bottom right",
      "enabled": "When editing",
      "visible": true,
      "handler": "btnSubmit_Click",
      "purpose": "Save changes to BargeTokenMap and refresh list",
      "tabIndex": 9,
      "buttonType": "ButtonType.Submit"
    },
    {
      "name": "btnCancel",
      "text": "Cancel",
      "type": "CancelEdit",
      "location": "Detail group - bottom right",
      "enabled": "When editing",
      "visible": true,
      "handler": "btnCancel_Click",
      "purpose": "Cancel changes and clear form",
      "causesValidation": false,
      "tabIndex": 10,
      "buttonType": "ButtonType.CancelEdit"
    },
    {
      "name": "btnClose",
      "text": "Close",
      "type": "Cancel",
      "location": "Close group - bottom",
      "enabled": true,
      "visible": true,
      "handler": "btnClose_Click",
      "purpose": "Close the form",
      "causesValidation": false,
      "buttonType": "ButtonType.Cancel"
    }
  ],
  "toolbarButtons": [
    {
      "key": "Add",
      "caption": "Add",
      "image": "Resources.Add",
      "displayStyle": "ImageAndText",
      "handler": "ItemAdd",
      "enabled": "When not editing child",
      "visible": true,
      "purpose": "Create new BargeTokenMap entry",
      "buttonType": "ButtonType.Add"
    },
    {
      "key": "Modify",
      "caption": "Modify",
      "image": "Resources.Modify",
      "displayStyle": "ImageAndText",
      "handler": "ItemModify",
      "enabled": "When row selected and not editing child",
      "visible": true,
      "purpose": "Edit selected BargeTokenMap entry",
      "buttonType": "ButtonType.Open"
    },
    {
      "key": "Remove",
      "caption": "Remove",
      "image": "Resources.Remove",
      "displayStyle": "ImageAndText",
      "handler": "ItemRemove",
      "enabled": "When row selected and not editing child",
      "visible": true,
      "purpose": "Delete selected BargeTokenMap entry with confirmation",
      "buttonType": "ButtonType.Remove"
    },
    {
      "key": "Export",
      "caption": "Export",
      "image": "Resources.ExportResults",
      "displayStyle": "ImageAndText",
      "handler": "Main.ExportGrid",
      "enabled": "When grid has at least one row and not editing child",
      "visible": true,
      "isFirstInGroup": true,
      "purpose": "Export grid data to file",
      "buttonType": "ButtonType.Open"
    }
  ],
  "grids": [
    {
      "name": "grdBargeTokenMap",
      "type": "UltraGrid",
      "uniqueIdentifier": "BargeTokenMapID",
      "dataSource": "Lists.BargeTokenMapList.GetList(fieldName, displayType, fleetID).List",
      "dock": "Fill",
      "autoFitStyle": "ExtendLastColumn",
      "columnChooserEnabled": false,
      "sortOrder": [
        {
          "column": "ID",
          "direction": "Ascending"
        }
      ],
      "columnsByDisplayType": {
        "picture": [
          {
            "key": "Picture",
            "header": "Picture",
            "dataType": "Image",
            "width": 46,
            "alignment": "Left",
            "sortable": true
          },
          {
            "key": "FieldValue",
            "header": "Value",
            "dataType": "String",
            "width": 100,
            "alignment": "Left",
            "sortable": true
          }
        ],
        "symbol": [
          {
            "key": "FieldValue",
            "header": "Value",
            "dataType": "String",
            "width": 300,
            "alignment": "Left",
            "sortable": true
          },
          {
            "key": "SymbolValue",
            "header": "Symbol",
            "dataType": "String",
            "width": 46,
            "alignment": "Left",
            "sortable": true
          }
        ],
        "color": [
          {
            "key": "FieldValue",
            "header": "Value",
            "dataType": "String",
            "width": 100,
            "alignment": "Left",
            "sortable": true
          },
          {
            "key": "ColorName",
            "header": "Color Name",
            "dataType": "String",
            "width": 86,
            "alignment": "Left",
            "sortable": true
          },
          {
            "key": "TextColor",
            "header": "Text Color",
            "dataType": "String",
            "width": 80,
            "alignment": "Left",
            "sortable": true
          },
          {
            "key": "BackColor",
            "header": "Back Color",
            "dataType": "String",
            "width": 80,
            "alignment": "Left",
            "sortable": true
          }
        ]
      },
      "events": ["DoubleClick", "AfterSelectChange"],
      "modernEquivalent": {
        "type": "DataTables",
        "serverSide": true,
        "responsive": true,
        "note": "Column configuration depends on displayType parameter"
      }
    }
  ],
  "panels": [
    {
      "name": "pnlMain",
      "type": "UltraPanel",
      "dock": "Fill",
      "controls": ["grdBargeTokenMap", "grpDetail", "grpClose", "staStatus"]
    },
    {
      "name": "grpDetail",
      "type": "UltraGroupBox",
      "text": "Detail",
      "dock": "Bottom",
      "borderStyle": "Header3D",
      "size": {
        "width": 362,
        "height": 129
      },
      "controls": [
        "cboFieldName",
        "txtFieldName",
        "lblType",
        "cboPictureID",
        "txtSymbolValue",
        "btnCancel",
        "btnSubmit",
        "cboFieldValue",
        "lblMap",
        "cboColorPairID"
      ],
      "state": "Disabled when not editing, enabled when editing"
    },
    {
      "name": "grpClose",
      "type": "UltraGroupBox",
      "dock": "Bottom",
      "borderStyle": "Header3D",
      "size": {
        "width": 362,
        "height": 34
      },
      "controls": ["btnClose"],
      "causesValidation": false
    }
  ],
  "labels": [
    {
      "name": "lblType",
      "text": "Type:",
      "location": "Detail group",
      "alignment": "Middle",
      "size": {
        "width": 48,
        "height": 20
      }
    },
    {
      "name": "lblMap",
      "text": "Picture: (dynamic)",
      "location": "Detail group",
      "alignment": "Middle",
      "size": {
        "width": 45,
        "height": 20
      },
      "note": "Text set dynamically based on displayType: 'Picture:', 'Symbol:', or 'Color:'"
    },
    {
      "name": "UltraLabel1",
      "text": "Value:",
      "location": "Detail group",
      "alignment": "Middle",
      "size": {
        "width": 40,
        "height": 20
      }
    }
  ],
  "statusBar": {
    "name": "staStatus",
    "dock": "Bottom",
    "purpose": "Display validation messages via ValidatorExtender"
  },
  "validation": {
    "validatorExtender": "ValidatorExtender",
    "displayControl": "staStatus",
    "rules": [
      {
        "control": "txtFieldName",
        "validationType": "String"
      },
      {
        "control": "txtSymbolValue",
        "validationType": "String"
      }
    ],
    "note": "Validation rules are minimal; business logic validates data integrity"
  },
  "eventHandlers": {
    "frmBargeTokenMap_Load": "Initialize form: FormatControls, RefreshList(True)",
    "toolbarBargeTokenMap_ToolClick": "Handle toolbar button clicks (Add, Modify, Remove, Export)",
    "btnSubmit_Click": "Submit changes: SubmitNoRefreshClick, refresh list on success",
    "btnCancel_Click": "Cancel changes: CancelClick, clear controls",
    "btnClose_Click": "Close form: CancelClick",
    "cboPictureID_RowSelected": "Update combo appearance with selected image",
    "cboFieldName_Validated": "Refresh field values list when location type changes",
    "cboFieldName_ValueChanged": "Re-enable controls when location type is selected",
    "cboFieldValue_Validated": "Update BargeTokenMap.FieldValue",
    "txtFieldName_Validated": "Update BargeTokenMap.FieldName",
    "txtSymbolValue_Validated": "Update BargeTokenMap.SymbolValue",
    "cboColorPairID_Validated": "Update BargeTokenMap.ColorPairID",
    "cboPictureID_Validated": "Update BargeTokenMap.PictureID",
    "grdBargeTokenMap_DoubleClick": "Edit selected item (ItemModify)",
    "grdBargeTokenMap_AfterSelectChange": "Update toolbar button states (SetToolState)"
  },
  "businessLogicMethods": {
    "ItemAdd": "Create new BargeTokenMap, begin edit, load controls, enable editing",
    "ItemModify": "Get selected BargeTokenMap, begin edit, load controls, enable editing",
    "ItemRemove": "Delete selected BargeTokenMap with confirmation, refresh list",
    "FormatControls": "Initialize all controls, set states, populate dropdowns",
    "EnableDisableControls": "Toggle control states based on edit mode",
    "RefreshList": "Reload grid with BargeTokenMapList.GetList",
    "ClearControls": "Clear all detail controls",
    "LoadControlsForBargeTokenMap": "Load BargeTokenMap data into controls",
    "PopulateFieldValues": "Load field values based on selected field/location type",
    "PopulateFieldTypes": "Build location type dropdown (Boat, Consign Facility, Facility, Ship)",
    "IsLocationMap": "Check if field is location-based (Location, Consign To, On Order To)",
    "SetValidatorExtenderForBargeTokenMap": "Configure validation rules",
    "SetMaxLengthsForBargeTokenMap": "Set max lengths from business object"
  },
  "formBehavior": {
    "editMode": "In-place detail editing with separate detail panel",
    "editFlow": "Add/Modify -> Edit in detail panel -> Submit/Cancel -> Refresh list",
    "validation": "ValidatorExtender displays messages in status bar",
    "gridSelection": "Single row selection, enables Modify/Remove buttons",
    "toolbarState": "Buttons enabled/disabled based on selection and edit state",
    "closeConfirmation": "Prompts if unsaved changes exist"
  },
  "dynamicBehavior": {
    "titleFormat": "{fieldName} - Map Field Values to {displayType}s",
    "controlVisibility": {
      "locationMap": {
        "condition": "fieldName in ['location', 'consign to', 'on order to']",
        "showControls": ["cboFieldName"],
        "hideControls": ["txtFieldName"]
      },
      "nonLocationMap": {
        "condition": "fieldName NOT in location types",
        "showControls": ["txtFieldName"],
        "hideControls": ["cboFieldName"]
      },
      "pictureMode": {
        "condition": "displayType = 'picture'",
        "showControls": ["cboPictureID"],
        "hideControls": ["txtSymbolValue", "cboColorPairID"],
        "labelText": "Picture:"
      },
      "symbolMode": {
        "condition": "displayType = 'symbol'",
        "showControls": ["txtSymbolValue"],
        "hideControls": ["cboPictureID", "cboColorPairID"],
        "labelText": "Symbol:"
      },
      "colorMode": {
        "condition": "displayType = 'color'",
        "showControls": ["cboColorPairID"],
        "hideControls": ["cboPictureID", "txtSymbolValue"],
        "labelText": "Color:"
      }
    },
    "gridColumns": "Vary based on displayType (see columnsByDisplayType)",
    "fieldValuePopulation": "Depends on selected fieldName/LocationType and fleetID"
  },
  "dependencies": {
    "businessObjects": ["BargeTokenMap"],
    "lists": [
      "BargeTokenMapList",
      "BargeTokenMapFieldValueList",
      "PictureList",
      "ColorPairList"
    ],
    "helpers": ["InfragisticsHelper", "ExceptionManager", "Main"],
    "interfaces": ["IBaseDetailEdit"],
    "baseForms": ["frmBaseDetailEditList"]
  },
  "modernizationNotes": {
    "architecture": "Convert to ASP.NET Core MVC with API backend",
    "viewModel": "BargeTokenMapViewModel with properties for all form inputs and grid data",
    "apiEndpoints": [
      "GET /api/bargetokenmap/list?fieldName={fieldName}&displayType={displayType}&fleetId={fleetId}",
      "GET /api/bargetokenmap/{id}",
      "POST /api/bargetokenmap",
      "PUT /api/bargetokenmap/{id}",
      "DELETE /api/bargetokenmap/{id}",
      "GET /api/bargetokenmap/fieldvalues?fieldValue={fieldValue}&fleetId={fleetId}",
      "GET /api/bargetokenmap/locationtypes?fieldName={fieldName}",
      "GET /api/pictures/list",
      "GET /api/colorpairs/list?fleetId={fleetId}"
    ],
    "frontendPatterns": [
      "Use DataTables for grid with server-side processing",
      "Use Select2 for all dropdowns",
      "Dynamic form sections based on displayType and fieldName",
      "AJAX for Add/Edit/Delete operations",
      "Toast notifications for success/error messages",
      "Modal confirmation for delete operations"
    ],
    "complexities": [
      "Dynamic control visibility based on multiple factors",
      "Three different display modes (picture/symbol/color)",
      "Location vs non-location field handling",
      "Cascading dropdown dependencies (fieldName -> fieldValue)",
      "Image display in dropdown for picture mode",
      "Grid column configuration varies by display type"
    ],
    "recommendedApproach": [
      "Create separate partial views for each display type",
      "Use JavaScript to handle dynamic show/hide logic",
      "Implement cascade dropdown pattern for fieldName -> fieldValue",
      "Use image templates in Select2 for picture dropdown",
      "Consider color picker preview for color mode",
      "Implement inline editing or modal dialog for add/edit"
    ]
  },
  "conversionPriority": "Medium - Utility/Configuration form used for visual token mapping",
  "sourceFiles": [
    "C:/Dev/BargeOps.Admin.Mono/OnShore/apps/Onshore/Forms/frmBargeTokenMap.vb",
    "C:/Dev/BargeOps.Admin.Mono/OnShore/apps/Onshore/Forms/frmBargeTokenMap.Designer.vb"
  ]
}
