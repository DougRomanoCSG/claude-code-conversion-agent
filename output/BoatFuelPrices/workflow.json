{
  "entity": "BoatFuelPrices",
  "formType": "SearchAndDetail",
  "userFlows": {
    "searchFlow": {
      "entryPoint": "frmBoatFuelPricesLocationSearch",
      "description": "User searches for boat fuel price records using various filter criteria",
      "steps": [
        {
          "stepNumber": 1,
          "action": "Form Load",
          "event": "Form_Load",
          "operations": [
            "Initialize filter controls (cboBoat, cboLocation, cboFuelType, cboVendor)",
            "Set default values (chkActiveOnly = true)",
            "Load lookup data for dropdowns",
            "Initialize DataGrid (grdResults)",
            "Set form permissions based on user role",
            "Configure grid columns and formatting"
          ],
          "dataAccess": [
            "sp_Boat_GetAll - Populate boat dropdown",
            "sp_FacilityLocation_GetAll - Populate location dropdown",
            "sp_FuelType_GetAll - Populate fuel type dropdown",
            "sp_Vendor_GetAll - Populate vendor dropdown"
          ],
          "stateChanges": [
            "Form initialized",
            "Controls enabled based on permissions",
            "ActiveOnly filter set to true"
          ]
        },
        {
          "stepNumber": 2,
          "action": "Enter Search Criteria",
          "event": "User input in filter controls",
          "operations": [
            "User selects boat from cboBoat dropdown",
            "User selects location from cboLocation dropdown",
            "User selects fuel type from cboFuelType dropdown",
            "User selects vendor from cboVendor dropdown",
            "User enters date range (dtpStartDate, dtpEndDate)",
            "User enters price range (txtMinPrice, txtMaxPrice)",
            "User toggles ActiveOnly checkbox"
          ],
          "validation": [
            "Validate EndDate >= StartDate",
            "Validate MaxPrice >= MinPrice",
            "Validate numeric inputs for price fields"
          ],
          "stateChanges": [
            "Search criteria populated",
            "Form dirty state = true"
          ]
        },
        {
          "stepNumber": 3,
          "action": "Execute Search",
          "event": "btnSearch_Click",
          "operations": [
            "Validate search criteria",
            "Build parameter collection for stored procedure",
            "Execute sp_BoatFuelPricesLocationSearch",
            "Populate grid with results",
            "Apply column formatting (currency, date)",
            "Enable/disable action buttons based on results"
          ],
          "dataAccess": [
            "sp_BoatFuelPricesLocationSearch with parameters:",
            "  @BoatID, @LocationID, @FuelType, @StartDate, @EndDate",
            "  @MinPrice, @MaxPrice, @VendorID, @ActiveOnly"
          ],
          "stateChanges": [
            "Grid populated with search results",
            "Row count displayed",
            "Action buttons enabled if results exist"
          ]
        },
        {
          "stepNumber": 4,
          "action": "Clear Search",
          "event": "btnClear_Click",
          "operations": [
            "Clear all filter controls",
            "Reset ActiveOnly to default (true)",
            "Clear grid results",
            "Reset form to initial state"
          ],
          "stateChanges": [
            "All filters cleared",
            "Grid cleared",
            "Form reset to initial state"
          ]
        },
        {
          "stepNumber": 5,
          "action": "View Record",
          "event": "Grid double-click or View button",
          "operations": [
            "Get selected BoatFuelPriceID from grid",
            "Open frmBoatFuelPricesLocationDetail in view mode",
            "Pass BoatFuelPriceID to detail form",
            "Detail form loads record data"
          ],
          "dataAccess": [
            "sp_BoatFuelPrices_GetByID with @BoatFuelPriceID"
          ],
          "navigation": "Navigate to frmBoatFuelPricesLocationDetail",
          "stateChanges": [
            "Detail form opened in view mode",
            "Search form remains open in background"
          ]
        },
        {
          "stepNumber": 6,
          "action": "Edit Record",
          "event": "Grid Edit button",
          "permission": "BoatFuelPricesModify",
          "operations": [
            "Verify user has modify permission",
            "Get selected BoatFuelPriceID from grid",
            "Open frmBoatFuelPricesLocationDetail in edit mode",
            "Pass BoatFuelPriceID to detail form"
          ],
          "dataAccess": [
            "sp_BoatFuelPrices_GetByID with @BoatFuelPriceID"
          ],
          "navigation": "Navigate to frmBoatFuelPricesLocationDetail",
          "stateChanges": [
            "Detail form opened in edit mode",
            "Form controls enabled for editing"
          ]
        },
        {
          "stepNumber": 7,
          "action": "Create New Record",
          "event": "btnNew_Click",
          "permission": "BoatFuelPricesModify",
          "operations": [
            "Verify user has modify permission",
            "Open frmBoatFuelPricesLocationDetail in create mode",
            "Initialize new record with defaults"
          ],
          "navigation": "Navigate to frmBoatFuelPricesLocationDetail",
          "stateChanges": [
            "Detail form opened in create mode",
            "New record initialized with defaults (IsActive = true)"
          ]
        },
        {
          "stepNumber": 8,
          "action": "Delete Record",
          "event": "Grid Delete button",
          "permission": "BoatFuelPricesModify",
          "operations": [
            "Verify user has modify permission",
            "Get selected BoatFuelPriceID from grid",
            "Show confirmation dialog",
            "If confirmed, execute soft delete",
            "Refresh grid to reflect changes"
          ],
          "dataAccess": [
            "sp_BoatFuelPrices_Delete with @BoatFuelPriceID, @ModifiedBy"
          ],
          "confirmation": "Are you sure you want to delete this fuel price record?",
          "stateChanges": [
            "Record soft deleted (IsActive = false)",
            "Grid refreshed",
            "Deleted record removed from grid if ActiveOnly = true"
          ]
        },
        {
          "stepNumber": 9,
          "action": "Export Results",
          "event": "btnExport_Click",
          "operations": [
            "Get current grid data",
            "Export to selected format (CSV, Excel, PDF)",
            "Save file to user-selected location"
          ],
          "stateChanges": [
            "Export file generated"
          ]
        },
        {
          "stepNumber": 10,
          "action": "Refresh After Detail Close",
          "event": "Detail form closed",
          "operations": [
            "Check if detail form made changes",
            "If changes were made, refresh search results",
            "Re-execute last search to show updated data"
          ],
          "dataAccess": [
            "sp_BoatFuelPricesLocationSearch with previous parameters"
          ],
          "stateChanges": [
            "Grid refreshed with updated data",
            "Search form regains focus"
          ]
        }
      ]
    },
    "detailFlow": {
      "entryPoint": "frmBoatFuelPricesLocationDetail",
      "description": "User views, creates, or edits boat fuel price records",
      "modes": ["View", "Edit", "Create"],
      "steps": [
        {
          "stepNumber": 1,
          "action": "Form Load",
          "event": "Form_Load",
          "operations": [
            "Determine form mode (View/Edit/Create)",
            "Initialize form controls",
            "Load lookup data for dropdowns",
            "If Edit/View mode, load record data",
            "If Create mode, set default values",
            "Configure control states based on mode and permissions",
            "Initialize tab control or panel sections"
          ],
          "dataAccess": [
            "sp_Boat_GetAll - Populate boat dropdown",
            "sp_FacilityLocation_GetAll - Populate location dropdown",
            "sp_FuelType_GetAll - Populate fuel type dropdown",
            "sp_Vendor_GetAll - Populate vendor dropdown",
            "sp_BoatFuelPrices_GetByID (if Edit/View mode)"
          ],
          "stateChanges": [
            "Form initialized in appropriate mode",
            "Controls populated with data (Edit/View) or defaults (Create)",
            "Save/Delete buttons enabled based on mode and permissions",
            "Controls enabled/disabled based on mode"
          ]
        },
        {
          "stepNumber": 2,
          "action": "Enter/Edit Basic Information",
          "event": "User input in Basic Information section",
          "operations": [
            "User selects boat (cboBoat) - Required",
            "User selects location (cboLocation) - Optional",
            "User selects fuel type (cboFuelType) - Required",
            "User enters price date (dtpPriceDate) - Required"
          ],
          "validation": [
            "Boat is required",
            "Fuel Type is required",
            "Price Date is required",
            "Price Date cannot be in future"
          ],
          "stateChanges": [
            "Form dirty state = true",
            "Required fields validated"
          ]
        },
        {
          "stepNumber": 3,
          "action": "Enter/Edit Price Details",
          "event": "User input in Price Details section",
          "operations": [
            "User enters price per gallon (txtPricePerGallon) - Required",
            "User enters quantity (txtQuantity) - Optional",
            "System calculates total cost (txtTotalCost = txtPricePerGallon * txtQuantity)"
          ],
          "calculation": {
            "field": "TotalCost",
            "formula": "PricePerGallon * Quantity",
            "triggers": [
              "txtPricePerGallon_ValueChanged",
              "txtQuantity_ValueChanged"
            ]
          },
          "validation": [
            "Price Per Gallon is required",
            "Price Per Gallon must be > 0",
            "Quantity must be >= 0",
            "Price Per Gallon must have max 4 decimal places",
            "Quantity must have max 2 decimal places"
          ],
          "stateChanges": [
            "Form dirty state = true",
            "Total cost automatically calculated",
            "Validation indicators updated"
          ]
        },
        {
          "stepNumber": 4,
          "action": "Enter/Edit Invoice Information",
          "event": "User input in Invoice Information section",
          "operations": [
            "User selects vendor (cboVendor) - Optional",
            "User enters invoice number (txtInvoiceNumber) - Optional",
            "User enters invoice date (dtpInvoiceDate) - Optional",
            "User enters purchase order number (txtPurchaseOrderNumber) - Optional"
          ],
          "validation": [
            "Invoice Number max length 50",
            "Purchase Order Number max length 50"
          ],
          "stateChanges": [
            "Form dirty state = true"
          ]
        },
        {
          "stepNumber": 5,
          "action": "Enter/Edit Additional Details",
          "event": "User input in Additional Details section",
          "operations": [
            "User enters notes (txtNotes) - Optional",
            "User toggles active status (chkIsActive)"
          ],
          "validation": [
            "Notes max length 500"
          ],
          "stateChanges": [
            "Form dirty state = true"
          ]
        },
        {
          "stepNumber": 6,
          "action": "View History Tab",
          "event": "User clicks History tab",
          "operations": [
            "Load price history for current boat",
            "Display historical price data in grid or chart",
            "Show price trends over time"
          ],
          "dataAccess": [
            "sp_BoatFuelPrices_GetByBoatID with @BoatID, @StartDate, @EndDate"
          ],
          "stateChanges": [
            "History tab activated",
            "Historical data displayed"
          ]
        },
        {
          "stepNumber": 7,
          "action": "View Analytics Tab",
          "event": "User clicks Analytics tab",
          "operations": [
            "Load price analytics and trends",
            "Display average prices by fuel type",
            "Show price comparison charts"
          ],
          "dataAccess": [
            "sp_BoatFuelPrices_GetAveragePriceByFuelType",
            "sp_BoatFuelPrices_GetPriceTrends"
          ],
          "stateChanges": [
            "Analytics tab activated",
            "Analytics data displayed"
          ]
        },
        {
          "stepNumber": 8,
          "action": "Save Record",
          "event": "btnSave_Click",
          "permission": "BoatFuelPricesModify",
          "operations": [
            "Validate all required fields",
            "Validate business rules",
            "If Create mode, execute Insert stored procedure",
            "If Edit mode, execute Update stored procedure",
            "Get current user for CreatedBy/ModifiedBy",
            "Show success/error message",
            "If successful, close form and refresh parent"
          ],
          "dataAccess": [
            "sp_BoatFuelPrices_Insert (Create mode) - Returns new BoatFuelPriceID",
            "sp_BoatFuelPrices_Update (Edit mode)"
          ],
          "validation": [
            "All required fields must have values",
            "Price Per Gallon must be > 0",
            "Quantity must be >= 0 if provided",
            "Price Date cannot be in future",
            "If Quantity and TotalCost provided, verify calculation matches"
          ],
          "stateChanges": [
            "Record saved to database",
            "Form dirty state = false",
            "Success message displayed",
            "Form closes",
            "Parent search form refreshed"
          ]
        },
        {
          "stepNumber": 9,
          "action": "Delete Record",
          "event": "btnDelete_Click",
          "permission": "BoatFuelPricesModify",
          "mode": "Edit only",
          "operations": [
            "Verify user has modify permission",
            "Show confirmation dialog",
            "If confirmed, execute soft delete",
            "Show success/error message",
            "Close form and refresh parent"
          ],
          "dataAccess": [
            "sp_BoatFuelPrices_Delete with @BoatFuelPriceID, @ModifiedBy"
          ],
          "confirmation": "Are you sure you want to delete this fuel price record?",
          "stateChanges": [
            "Record soft deleted (IsActive = false)",
            "Form closes",
            "Parent search form refreshed"
          ]
        },
        {
          "stepNumber": 10,
          "action": "Cancel",
          "event": "btnCancel_Click",
          "operations": [
            "Check if form has unsaved changes",
            "If dirty, show confirmation dialog",
            "Close form without saving",
            "Return to parent search form"
          ],
          "confirmation": "You have unsaved changes. Are you sure you want to cancel?",
          "stateChanges": [
            "Form closes",
            "Changes discarded",
            "Parent search form regains focus"
          ]
        }
      ]
    }
  },
  "eventHandlerChains": {
    "search": {
      "btnSearch_Click": {
        "handler": "btnSearch_Click",
        "description": "Executes search based on filter criteria",
        "callChain": [
          "ValidateSearchCriteria()",
          "BuildSearchParameters()",
          "ExecuteSearch()",
          "PopulateGrid()",
          "UpdateButtonStates()"
        ],
        "dataAccess": "sp_BoatFuelPricesLocationSearch"
      },
      "btnClear_Click": {
        "handler": "btnClear_Click",
        "description": "Clears all search filters and results",
        "callChain": [
          "ClearFilterControls()",
          "ResetDefaults()",
          "ClearGrid()",
          "UpdateButtonStates()"
        ]
      },
      "btnNew_Click": {
        "handler": "btnNew_Click",
        "description": "Opens detail form for new record",
        "callChain": [
          "CheckPermissions()",
          "CreateDetailForm()",
          "SetFormMode(Create)",
          "ShowDetailForm()"
        ],
        "navigation": "frmBoatFuelPricesLocationDetail"
      },
      "btnExport_Click": {
        "handler": "btnExport_Click",
        "description": "Exports grid data to file",
        "callChain": [
          "GetGridData()",
          "ShowExportDialog()",
          "ExportToFormat()",
          "SaveFile()"
        ]
      },
      "grdResults_DoubleClick": {
        "handler": "grdResults_DoubleClick",
        "description": "Opens selected record in view mode",
        "callChain": [
          "GetSelectedRow()",
          "GetBoatFuelPriceID()",
          "CreateDetailForm()",
          "SetFormMode(View)",
          "LoadRecord()",
          "ShowDetailForm()"
        ],
        "navigation": "frmBoatFuelPricesLocationDetail",
        "dataAccess": "sp_BoatFuelPrices_GetByID"
      },
      "grdResults_EditButton_Click": {
        "handler": "Grid action button click",
        "description": "Opens selected record in edit mode",
        "callChain": [
          "CheckPermissions()",
          "GetSelectedRow()",
          "GetBoatFuelPriceID()",
          "CreateDetailForm()",
          "SetFormMode(Edit)",
          "LoadRecord()",
          "ShowDetailForm()"
        ],
        "permission": "BoatFuelPricesModify",
        "navigation": "frmBoatFuelPricesLocationDetail",
        "dataAccess": "sp_BoatFuelPrices_GetByID"
      },
      "grdResults_DeleteButton_Click": {
        "handler": "Grid action button click",
        "description": "Deletes selected record",
        "callChain": [
          "CheckPermissions()",
          "GetSelectedRow()",
          "GetBoatFuelPriceID()",
          "ShowConfirmationDialog()",
          "ExecuteDelete()",
          "RefreshGrid()"
        ],
        "permission": "BoatFuelPricesModify",
        "dataAccess": "sp_BoatFuelPrices_Delete"
      },
      "FilterControl_ValueChanged": {
        "handler": "ValueChanged event on filter controls",
        "description": "Updates form state when filter values change",
        "callChain": [
          "ValidateControlValue()",
          "UpdateRelatedControls()",
          "EnableSearchButton()"
        ]
      }
    },
    "detail": {
      "Form_Load": {
        "handler": "Form_Load",
        "description": "Initializes detail form",
        "callChain": [
          "DetermineFormMode()",
          "InitializeControls()",
          "LoadLookupData()",
          "LoadRecord() - if Edit/View",
          "SetDefaultValues() - if Create",
          "ConfigureControlStates()",
          "SetupValidation()"
        ],
        "dataAccess": [
          "sp_Boat_GetAll",
          "sp_FacilityLocation_GetAll",
          "sp_FuelType_GetAll",
          "sp_Vendor_GetAll",
          "sp_BoatFuelPrices_GetByID (Edit/View mode)"
        ]
      },
      "txtPricePerGallon_ValueChanged": {
        "handler": "txtPricePerGallon_ValueChanged",
        "description": "Recalculates total cost when price changes",
        "callChain": [
          "ValidatePrice()",
          "CalculateTotalCost()",
          "UpdateTotalCostDisplay()",
          "SetDirtyState()"
        ],
        "calculation": "TotalCost = PricePerGallon * Quantity"
      },
      "txtQuantity_ValueChanged": {
        "handler": "txtQuantity_ValueChanged",
        "description": "Recalculates total cost when quantity changes",
        "callChain": [
          "ValidateQuantity()",
          "CalculateTotalCost()",
          "UpdateTotalCostDisplay()",
          "SetDirtyState()"
        ],
        "calculation": "TotalCost = PricePerGallon * Quantity"
      },
      "btnSave_Click": {
        "handler": "btnSave_Click",
        "description": "Saves record to database",
        "callChain": [
          "ValidateForm()",
          "ValidateBusinessRules()",
          "GetCurrentUser()",
          "BuildParameters()",
          "ExecuteSave() - Insert or Update",
          "ShowSuccessMessage()",
          "SetCleanState()",
          "NotifyParentRefresh()",
          "CloseForm()"
        ],
        "dataAccess": [
          "sp_BoatFuelPrices_Insert (Create mode)",
          "sp_BoatFuelPrices_Update (Edit mode)"
        ],
        "permission": "BoatFuelPricesModify"
      },
      "btnDelete_Click": {
        "handler": "btnDelete_Click",
        "description": "Deletes current record",
        "callChain": [
          "CheckPermissions()",
          "ShowConfirmationDialog()",
          "GetCurrentUser()",
          "ExecuteDelete()",
          "ShowSuccessMessage()",
          "NotifyParentRefresh()",
          "CloseForm()"
        ],
        "dataAccess": "sp_BoatFuelPrices_Delete",
        "permission": "BoatFuelPricesModify"
      },
      "btnCancel_Click": {
        "handler": "btnCancel_Click",
        "description": "Cancels changes and closes form",
        "callChain": [
          "CheckDirtyState()",
          "ShowConfirmationDialog() - if dirty",
          "CloseForm()"
        ]
      },
      "tabControl_SelectedIndexChanged": {
        "handler": "Tab control selection changed",
        "description": "Loads data for selected tab",
        "callChain": [
          "GetSelectedTab()",
          "LoadTabData()",
          "UpdateTabDisplay()"
        ],
        "dataAccess": [
          "sp_BoatFuelPrices_GetByBoatID (History tab)",
          "sp_BoatFuelPrices_GetAveragePriceByFuelType (Analytics tab)",
          "sp_BoatFuelPrices_GetPriceTrends (Analytics tab)"
        ]
      }
    }
  },
  "formLifecycleMethods": {
    "search": {
      "initialization": [
        {
          "method": "Form_Load",
          "description": "Initialize search form on load",
          "operations": [
            "Set form title",
            "Initialize controls",
            "Load lookup data",
            "Set default filter values",
            "Configure grid",
            "Apply permissions"
          ]
        },
        {
          "method": "InitializeComponent",
          "description": "Designer-generated initialization",
          "operations": [
            "Create control instances",
            "Set control properties",
            "Wire up event handlers"
          ]
        }
      ],
      "dataLoading": [
        {
          "method": "LoadLookupData",
          "description": "Load dropdown lookup data",
          "dataAccess": [
            "sp_Boat_GetAll",
            "sp_FacilityLocation_GetAll",
            "sp_FuelType_GetAll",
            "sp_Vendor_GetAll"
          ]
        },
        {
          "method": "LoadSearchResults",
          "description": "Execute search and populate grid",
          "dataAccess": "sp_BoatFuelPricesLocationSearch"
        }
      ],
      "validation": [
        {
          "method": "ValidateSearchCriteria",
          "description": "Validate search filter inputs",
          "validations": [
            "EndDate >= StartDate",
            "MaxPrice >= MinPrice",
            "Numeric format validation"
          ]
        }
      ],
      "cleanup": [
        {
          "method": "Form_Closing",
          "description": "Clean up resources on form close",
          "operations": [
            "Dispose grid datasource",
            "Clear control bindings",
            "Release event handlers"
          ]
        }
      ]
    },
    "detail": {
      "initialization": [
        {
          "method": "Form_Load",
          "description": "Initialize detail form based on mode",
          "operations": [
            "Determine mode (View/Edit/Create)",
            "Initialize controls",
            "Load lookup data",
            "Load record data (Edit/View)",
            "Set default values (Create)",
            "Configure control states",
            "Setup validation"
          ]
        },
        {
          "method": "InitializeComponent",
          "description": "Designer-generated initialization",
          "operations": [
            "Create control instances",
            "Set control properties",
            "Wire up event handlers"
          ]
        }
      ],
      "dataLoading": [
        {
          "method": "LoadLookupData",
          "description": "Load dropdown lookup data",
          "dataAccess": [
            "sp_Boat_GetAll",
            "sp_FacilityLocation_GetAll",
            "sp_FuelType_GetAll",
            "sp_Vendor_GetAll"
          ]
        },
        {
          "method": "LoadRecord",
          "description": "Load existing record data (Edit/View mode)",
          "dataAccess": "sp_BoatFuelPrices_GetByID"
        },
        {
          "method": "LoadHistoryTab",
          "description": "Load price history data",
          "dataAccess": "sp_BoatFuelPrices_GetByBoatID"
        },
        {
          "method": "LoadAnalyticsTab",
          "description": "Load analytics and trends",
          "dataAccess": [
            "sp_BoatFuelPrices_GetAveragePriceByFuelType",
            "sp_BoatFuelPrices_GetPriceTrends"
          ]
        }
      ],
      "validation": [
        {
          "method": "ValidateForm",
          "description": "Validate all form inputs",
          "validations": [
            "Required fields populated",
            "Price Per Gallon > 0",
            "Quantity >= 0",
            "Price Date not in future",
            "Max length validations",
            "Calculation validation (TotalCost)"
          ]
        },
        {
          "method": "ValidateBusinessRules",
          "description": "Validate business logic rules",
          "validations": [
            "Foreign key references valid",
            "TotalCost matches calculation if both fields provided",
            "Date logic validation"
          ]
        }
      ],
      "dataPersistence": [
        {
          "method": "SaveRecord",
          "description": "Insert or update record",
          "dataAccess": [
            "sp_BoatFuelPrices_Insert (Create)",
            "sp_BoatFuelPrices_Update (Edit)"
          ]
        },
        {
          "method": "DeleteRecord",
          "description": "Soft delete record",
          "dataAccess": "sp_BoatFuelPrices_Delete"
        }
      ],
      "stateManagement": [
        {
          "method": "SetFormMode",
          "description": "Configure form for specific mode",
          "modes": ["View", "Edit", "Create"]
        },
        {
          "method": "SetDirtyState",
          "description": "Mark form as having unsaved changes",
          "triggers": "Any control value change"
        },
        {
          "method": "CalculateTotalCost",
          "description": "Auto-calculate total cost",
          "formula": "TotalCost = PricePerGallon * Quantity",
          "triggers": [
            "txtPricePerGallon_ValueChanged",
            "txtQuantity_ValueChanged"
          ]
        }
      ],
      "cleanup": [
        {
          "method": "Form_Closing",
          "description": "Handle form close with dirty check",
          "operations": [
            "Check dirty state",
            "Show confirmation if unsaved changes",
            "Notify parent to refresh",
            "Dispose resources"
          ]
        }
      ]
    }
  },
  "statePersistencePatterns": {
    "searchForm": {
      "filterState": {
        "description": "Search filter values maintained during session",
        "persistedValues": [
          "BoatID",
          "LocationID",
          "FuelType",
          "VendorID",
          "StartDate",
          "EndDate",
          "MinPrice",
          "MaxPrice",
          "ActiveOnly"
        ],
        "persistence": "In-memory during form lifetime",
        "restoration": "Values persist when returning from detail form"
      },
      "gridState": {
        "description": "Grid sorting and column state",
        "persistedValues": [
          "Sort column",
          "Sort direction",
          "Column widths",
          "Column order"
        ],
        "persistence": "User preferences or session state",
        "restoration": "Restored on form reload"
      },
      "lastSearchCriteria": {
        "description": "Last executed search parameters",
        "purpose": "Re-execute search after detail form changes",
        "persistedValues": "All search parameters from last search",
        "persistence": "In-memory variable",
        "restoration": "Used for grid refresh after detail save/delete"
      }
    },
    "detailForm": {
      "formMode": {
        "description": "Current operation mode",
        "values": ["View", "Edit", "Create"],
        "persistence": "Set on form load, maintained throughout form lifetime",
        "impact": "Controls which operations are available"
      },
      "dirtyState": {
        "description": "Tracks unsaved changes",
        "tracking": "Set to true on any control value change",
        "usage": "Prompt user on cancel/close if dirty",
        "reset": "Set to false after successful save"
      },
      "originalValues": {
        "description": "Original record values for dirty detection",
        "persistence": "Loaded on form initialization",
        "usage": "Compare current values to detect changes",
        "scope": "All editable fields"
      },
      "calculatedFields": {
        "description": "Auto-calculated field values",
        "fields": [
          {
            "field": "TotalCost",
            "calculation": "PricePerGallon * Quantity",
            "updateTriggers": [
              "PricePerGallon change",
              "Quantity change"
            ]
          }
        ],
        "persistence": "Recalculated on trigger events",
        "validation": "Validated on save against stored values"
      },
      "currentRecordId": {
        "description": "BoatFuelPriceID of current record",
        "persistence": "Set on form load (Edit/View mode)",
        "usage": "Used for update and delete operations",
        "scope": "Edit and View modes only"
      }
    }
  },
  "modalDialogPatterns": {
    "detailFormAsModal": {
      "parent": "frmBoatFuelPricesLocationSearch",
      "modal": "frmBoatFuelPricesLocationDetail",
      "behavior": "Modal dialog - parent remains open but inactive",
      "dataFlow": {
        "parentToModal": [
          "BoatFuelPriceID (Edit/View mode)",
          "Form mode indicator (View/Edit/Create)"
        ],
        "modalToParent": [
          "Changes made flag",
          "Refresh required flag"
        ]
      },
      "lifecycle": [
        {
          "step": "Parent opens modal",
          "action": "ShowDialog() or Show()"
        },
        {
          "step": "Modal performs operation",
          "action": "View/Edit/Create record"
        },
        {
          "step": "Modal closes",
          "action": "Return result to parent"
        },
        {
          "step": "Parent refreshes",
          "action": "Re-execute search if changes were made"
        }
      ]
    },
    "confirmationDialogs": {
      "deleteConfirmation": {
        "trigger": "Delete button click",
        "message": "Are you sure you want to delete this fuel price record?",
        "buttons": ["Yes", "No"],
        "defaultButton": "No",
        "result": "Proceed with delete if Yes"
      },
      "cancelConfirmation": {
        "trigger": "Cancel button click when form is dirty",
        "message": "You have unsaved changes. Are you sure you want to cancel?",
        "buttons": ["Yes", "No"],
        "defaultButton": "No",
        "result": "Close form without saving if Yes"
      },
      "closeConfirmation": {
        "trigger": "Form close (X button) when form is dirty",
        "message": "You have unsaved changes. Do you want to save before closing?",
        "buttons": ["Yes", "No", "Cancel"],
        "defaultButton": "Yes",
        "result": "Save and close if Yes, close without saving if No, stay open if Cancel"
      }
    },
    "exportDialog": {
      "trigger": "Export button click",
      "type": "File save dialog",
      "options": [
        "CSV format",
        "Excel format",
        "PDF format"
      ],
      "behavior": "User selects format and destination file path"
    }
  },
  "refreshUpdateTriggers": {
    "searchFormRefresh": {
      "triggers": [
        {
          "event": "Detail form closed after save",
          "action": "Re-execute last search",
          "dataAccess": "sp_BoatFuelPricesLocationSearch with last parameters",
          "purpose": "Show newly created/updated records"
        },
        {
          "event": "Detail form closed after delete",
          "action": "Re-execute last search",
          "dataAccess": "sp_BoatFuelPricesLocationSearch with last parameters",
          "purpose": "Remove deleted record from grid"
        },
        {
          "event": "Search button clicked",
          "action": "Execute search with current filters",
          "dataAccess": "sp_BoatFuelPricesLocationSearch",
          "purpose": "Load new search results"
        },
        {
          "event": "ActiveOnly filter changed",
          "action": "Re-execute search if results already loaded",
          "dataAccess": "sp_BoatFuelPricesLocationSearch",
          "purpose": "Show/hide inactive records"
        }
      ],
      "refreshStrategy": "Re-query database to ensure data consistency"
    },
    "detailFormRefresh": {
      "triggers": [
        {
          "event": "Price Per Gallon changed",
          "action": "Recalculate Total Cost",
          "calculation": "TotalCost = PricePerGallon * Quantity",
          "purpose": "Keep calculated field in sync"
        },
        {
          "event": "Quantity changed",
          "action": "Recalculate Total Cost",
          "calculation": "TotalCost = PricePerGallon * Quantity",
          "purpose": "Keep calculated field in sync"
        },
        {
          "event": "History tab selected",
          "action": "Load price history for current boat",
          "dataAccess": "sp_BoatFuelPrices_GetByBoatID",
          "purpose": "Show historical data"
        },
        {
          "event": "Analytics tab selected",
          "action": "Load analytics and trends",
          "dataAccess": [
            "sp_BoatFuelPrices_GetAveragePriceByFuelType",
            "sp_BoatFuelPrices_GetPriceTrends"
          ],
          "purpose": "Show analysis data"
        },
        {
          "event": "Boat selection changed",
          "action": "Clear dependent fields, reload history if visible",
          "dataAccess": "sp_BoatFuelPrices_GetByBoatID (if history tab active)",
          "purpose": "Update related data for new boat"
        }
      ],
      "refreshStrategy": "Reactive updates on value changes"
    },
    "lookupDataRefresh": {
      "strategy": "Load once on form initialization",
      "caching": "In-memory during form lifetime",
      "triggers": [
        {
          "event": "Form load",
          "action": "Load all lookup data",
          "dataAccess": [
            "sp_Boat_GetAll",
            "sp_FacilityLocation_GetAll",
            "sp_FuelType_GetAll",
            "sp_Vendor_GetAll"
          ]
        }
      ],
      "notes": "Lookup data is relatively static, refresh only on form reload"
    }
  },
  "validationWorkflow": {
    "clientSideValidation": {
      "searchForm": [
        {
          "validation": "Date range validation",
          "rule": "EndDate >= StartDate",
          "trigger": "Date field change",
          "errorMessage": "End date must be greater than or equal to start date"
        },
        {
          "validation": "Price range validation",
          "rule": "MaxPrice >= MinPrice",
          "trigger": "Price field change",
          "errorMessage": "Max price must be greater than or equal to min price"
        },
        {
          "validation": "Numeric format",
          "rule": "Price fields must be valid decimal numbers",
          "trigger": "Price field blur",
          "errorMessage": "Please enter a valid price"
        }
      ],
      "detailForm": [
        {
          "validation": "Required field validation",
          "fields": ["Boat", "FuelType", "PriceDate", "PricePerGallon"],
          "trigger": "Field blur or save click",
          "errorMessage": "This field is required"
        },
        {
          "validation": "Positive value validation",
          "field": "PricePerGallon",
          "rule": "PricePerGallon > 0",
          "trigger": "Field blur",
          "errorMessage": "Price per gallon must be greater than 0"
        },
        {
          "validation": "Non-negative validation",
          "field": "Quantity",
          "rule": "Quantity >= 0",
          "trigger": "Field blur",
          "errorMessage": "Quantity cannot be negative"
        },
        {
          "validation": "Future date validation",
          "field": "PriceDate",
          "rule": "PriceDate <= Current Date",
          "trigger": "Field blur",
          "errorMessage": "Price date cannot be in the future"
        },
        {
          "validation": "Max length validation",
          "fields": ["InvoiceNumber", "PurchaseOrderNumber", "Notes"],
          "trigger": "Field input",
          "errorMessage": "Maximum length exceeded"
        },
        {
          "validation": "Decimal precision validation",
          "field": "PricePerGallon",
          "rule": "Max 4 decimal places",
          "trigger": "Field blur",
          "errorMessage": "Price per gallon allows maximum 4 decimal places"
        },
        {
          "validation": "Decimal precision validation",
          "field": "Quantity",
          "rule": "Max 2 decimal places",
          "trigger": "Field blur",
          "errorMessage": "Quantity allows maximum 2 decimal places"
        }
      ]
    },
    "serverSideValidation": {
      "onSave": [
        {
          "validation": "Required fields",
          "checked": "All required fields have values"
        },
        {
          "validation": "Business rules",
          "checked": [
            "PricePerGallon > 0",
            "Quantity >= 0 if provided",
            "TotalCost matches calculation if both provided"
          ]
        },
        {
          "validation": "Foreign key integrity",
          "checked": [
            "BoatID references valid Boat",
            "LocationID references valid Location (if provided)",
            "VendorID references valid Vendor (if provided)"
          ]
        },
        {
          "validation": "Data integrity",
          "checked": [
            "Numeric ranges valid",
            "String lengths within limits",
            "Date values valid"
          ]
        }
      ]
    }
  },
  "modernImplementationNotes": {
    "aspNetMvcMapping": {
      "searchForm": {
        "view": "Views/BoatFuelPricesSearch/Index.cshtml",
        "controller": "BoatFuelPricesSearchController",
        "viewModel": "BoatFuelPricesSearchViewModel",
        "javascript": "wwwroot/js/boatFuelPricesSearch.js",
        "features": [
          "DataTables for grid with server-side processing",
          "Select2 for dropdown controls with AJAX loading",
          "Bootstrap Datepicker for date inputs",
          "jQuery Validation for client-side validation",
          "Toastr for notifications"
        ]
      },
      "detailForm": {
        "view": "Views/BoatFuelPricesDetail/Index.cshtml",
        "controller": "BoatFuelPricesDetailController",
        "viewModel": "BoatFuelPricesDetailViewModel",
        "javascript": "wwwroot/js/boatFuelPricesDetail.js",
        "features": [
          "Bootstrap Cards for section grouping",
          "Bootstrap Nav Tabs for tabbed interface",
          "Auto-calculation using JavaScript",
          "jQuery Validation for client-side validation",
          "AJAX form submission",
          "Toastr for notifications"
        ]
      },
      "api": {
        "controller": "BoatFuelPricesController (API)",
        "endpoints": [
          "GET /api/boatfuelprices/{id} - Get by ID",
          "POST /api/boatfuelprices/search - Search with criteria",
          "POST /api/boatfuelprices - Create new",
          "PUT /api/boatfuelprices/{id} - Update existing",
          "DELETE /api/boatfuelprices/{id} - Soft delete"
        ],
        "service": "IBoatFuelPricesService, BoatFuelPricesService",
        "repository": "IBoatFuelPricesRepository, BoatFuelPricesRepository",
        "dataAccess": "Dapper with stored procedures"
      }
    },
    "stateManagement": {
      "searchState": "Maintained in JavaScript variables, passed to server on search",
      "detailFormState": "Managed by ViewModel and client-side JavaScript",
      "dirtyTracking": "Client-side using beforeunload event and form change tracking",
      "calculatedFields": "Client-side JavaScript calculations with server-side validation"
    },
    "navigationPattern": {
      "searchToDetail": "Controller action navigation with ID parameter",
      "detailToSearch": "RedirectToAction after save/delete, or JavaScript history.back() on cancel",
      "refreshStrategy": "DataTables ajax.reload() after returning from detail operations"
    }
  }
}
