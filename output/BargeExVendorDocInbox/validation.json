{
  "entity": "BargeExVendorDocInbox",
  "description": "Inbox for vendor documents imported from BargeEx EDI transactions. Used for processing BargeStatus and BoatStatus documents.",
  "formValidation": {
    "method": "None - Search and Import forms",
    "notes": "No AreFieldsValid method found. Forms are search/import screens with minimal client validation.",
    "rules": [
      {
        "field": "Search criteria",
        "rule": "Optional",
        "condition": "All search fields are optional",
        "message": "N/A",
        "severity": "Info"
      },
      {
        "field": "IsSelected",
        "rule": "User Selection",
        "condition": "User must select records to import/discard",
        "message": "Implicit - buttons enabled when rows exist",
        "severity": "Info"
      }
    ]
  },
  "businessValidation": {
    "method": "CheckBusinessRules",
    "location": "BargeExVendorDocumentInboxBase.vb:686-813",
    "rules": [
      {
        "ruleName": "ControlNumberRequired",
        "property": "ControlNumber",
        "condition": "String.IsNullOrEmpty(p_ControlNumber)",
        "message": "Control number (Instance identifier) is required",
        "severity": "Error",
        "alwaysApplies": true
      },
      {
        "ruleName": "ControlNumberMaxLength",
        "property": "ControlNumber",
        "condition": "p_ControlNumber.Length > MaxLength.ControlNumber",
        "message": "Control number (Instance identifier) cannot exceed 128 characters",
        "severity": "Error",
        "alwaysApplies": true,
        "maxLength": 128
      },
      {
        "ruleName": "ReceivedDateTimeRequired",
        "property": "ReceivedDateTime",
        "condition": "p_ReceivedDateTime.IsEmpty",
        "message": "Received date/time is required",
        "severity": "Error",
        "alwaysApplies": true
      },
      {
        "ruleName": "SenderTradingPartnerNumberMaxLength",
        "property": "SenderTradingPartnerNumber",
        "condition": "p_SenderTradingPartnerNumber.Length > MaxLength.SenderTradingPartnerNumber",
        "message": "Sender trading partner number cannot exceed 8 characters",
        "severity": "Error",
        "alwaysApplies": true,
        "maxLength": 8
      },
      {
        "ruleName": "BargeUscgNumMaxLength",
        "property": "BargeUscgNum",
        "condition": "p_BargeUscgNum.Length > MaxLength.BargeUscgNum",
        "message": "Barge USCG Number cannot exceed 10 characters",
        "severity": "Error",
        "alwaysApplies": true,
        "maxLength": 10
      },
      {
        "ruleName": "BargeNumMaxLength",
        "property": "BargeNum",
        "condition": "p_BargeNum.Length > MaxLength.BargeNum",
        "message": "Barge number cannot exceed 30 characters",
        "severity": "Error",
        "alwaysApplies": true,
        "maxLength": 30
      },
      {
        "ruleName": "FleetBoatUscgNumMaxLength",
        "property": "FleetBoatUscgNum",
        "condition": "p_FleetBoatUscgNum.Length > MaxLength.FleetBoatUscgNum",
        "message": "Fleet-boat USCG Number cannot exceed 10 characters",
        "severity": "Error",
        "alwaysApplies": true,
        "maxLength": 10
      },
      {
        "ruleName": "FleetBoatNameMaxLength",
        "property": "FleetBoatName",
        "condition": "p_FleetBoatName.Length > MaxLength.FleetBoatName",
        "message": "Fleet-boat name cannot exceed 50 characters",
        "severity": "Error",
        "alwaysApplies": true,
        "maxLength": 50
      },
      {
        "ruleName": "LocationBargeExCodeMaxLength",
        "property": "LocationBargeExCode",
        "condition": "p_LocationBargeExCode.Length > MaxLength.LocationBargeExCode",
        "message": "Location BargeEx code cannot exceed 20 characters",
        "severity": "Error",
        "alwaysApplies": true,
        "maxLength": 20
      },
      {
        "ruleName": "LocationNameMaxLength",
        "property": "LocationName",
        "condition": "p_LocationName.Length > MaxLength.LocationName",
        "message": "Location name cannot exceed 50 characters",
        "severity": "Error",
        "alwaysApplies": true,
        "maxLength": 50
      },
      {
        "ruleName": "EndLocationBargeExCodeMaxLength",
        "property": "EndLocationBargeExCode",
        "condition": "p_EndLocationBargeExCode.Length > MaxLength.EndLocationBargeExCode",
        "message": "End-location BargeEx code cannot exceed 20 characters",
        "severity": "Error",
        "alwaysApplies": true,
        "maxLength": 20
      },
      {
        "ruleName": "EndLocationNameMaxLength",
        "property": "EndLocationName",
        "condition": "p_EndLocationName.Length > MaxLength.EndLocationName",
        "message": "End-location name cannot exceed 50 characters",
        "severity": "Error",
        "alwaysApplies": true,
        "maxLength": 50
      },
      {
        "ruleName": "AssistedBoatUscgNumMaxLength",
        "property": "AssistedBoatUscgNum",
        "condition": "p_AssistedBoatUscgNum.Length > MaxLength.AssistedBoatUscgNum",
        "message": "Assisted-boat USCG Number cannot exceed 10 characters",
        "severity": "Error",
        "alwaysApplies": true,
        "maxLength": 10
      },
      {
        "ruleName": "AssistedBoatNameMaxLength",
        "property": "AssistedBoatName",
        "condition": "p_AssistedBoatName.Length > MaxLength.AssistedBoatName",
        "message": "Assisted-boat name cannot exceed 50 characters",
        "severity": "Error",
        "alwaysApplies": true,
        "maxLength": 50
      },
      {
        "ruleName": "LoadStatusMaxLength",
        "property": "LoadStatus",
        "condition": "p_LoadStatus.Length > MaxLength.LoadStatus",
        "message": "Load status cannot exceed 15 characters",
        "severity": "Error",
        "alwaysApplies": true,
        "maxLength": 15
      },
      {
        "ruleName": "RiverMaxLength",
        "property": "River",
        "condition": "p_River.Length > MaxLength.River",
        "message": "River cannot exceed 3 characters",
        "severity": "Error",
        "alwaysApplies": true,
        "maxLength": 3
      },
      {
        "ruleName": "CleanTypeMaxLength",
        "property": "CleanType",
        "condition": "p_CleanType.Length > MaxLength.CleanType",
        "message": "Clean type cannot exceed 50 characters",
        "severity": "Error",
        "alwaysApplies": true,
        "maxLength": 50
      },
      {
        "ruleName": "PumpTypeMaxLength",
        "property": "PumpType",
        "condition": "p_PumpType.Length > MaxLength.PumpType",
        "message": "Pump type cannot exceed 50 characters",
        "severity": "Error",
        "alwaysApplies": true,
        "maxLength": 50
      },
      {
        "ruleName": "CoverHandlingTypeMaxLength",
        "property": "CoverHandlingType",
        "condition": "p_CoverHandlingType.Length > MaxLength.CoverHandlingType",
        "message": "Cover handling cannot exceed 50 characters",
        "severity": "Error",
        "alwaysApplies": true,
        "maxLength": 50
      },
      {
        "ruleName": "OriginalControlNumberMaxLength",
        "property": "OriginalControlNumber",
        "condition": "p_OriginalControlNumber.Length > MaxLength.OriginalControlNumber",
        "message": "Original control number (Transaction identifier) cannot exceed 128 characters",
        "severity": "Error",
        "alwaysApplies": true,
        "maxLength": 128
      },
      {
        "ruleName": "PrimaryControlNumberMaxLength",
        "property": "PrimaryControlNumber",
        "condition": "p_PrimaryControlNumber.Length > MaxLength.PrimaryControlNumber",
        "message": "PrimaryControlNumber cannot exceed 128 characters",
        "severity": "Error",
        "alwaysApplies": true,
        "maxLength": 128
      }
    ]
  },
  "importValidation": {
    "method": "ProcessRow / ProcessBargeStatus / ProcessBoatStatus",
    "location": "frmBargeExVendorDocInboxImport.vb:320-810",
    "description": "Import process validates vendor documents before creating BargeEvent or PartsServiceBill records",
    "rules": [
      {
        "ruleName": "NoBargeTicketWarning",
        "property": "Import Selection",
        "condition": "Selected BargeStatus records have no open tickets",
        "message": "One or more selected barges do not have open Tickets. Are you sure you want to open new tickets for these barges?",
        "severity": "Warning",
        "alwaysApplies": false,
        "appliesWhen": "User clicks Import and BargeStatus records without open tickets are selected"
      },
      {
        "ruleName": "RevisionWithNoPriorImportWarning",
        "property": "Import Selection",
        "condition": "Selected revision records have no prior imported transaction",
        "message": "One or more selected barges have not had an original transaction imported. Are you sure you want to import revisions for these barges?",
        "severity": "Warning",
        "alwaysApplies": false,
        "appliesWhen": "User clicks Import and revision records without originals are selected"
      },
      {
        "ruleName": "BargeRequired",
        "property": "BargeID",
        "condition": "!Int32.TryParse(row[BargeID], brgID) || brgID <= 0",
        "message": "Transaction could not be imported because barge does not exist in the database.",
        "severity": "Error",
        "alwaysApplies": true,
        "appliesWhen": "Processing BargeStatus import"
      },
      {
        "ruleName": "VendorRequired",
        "property": "VendorID",
        "condition": "!Int32.TryParse(row[VendorID], vendorID) || vendorID <= 0",
        "message": "Transaction could not be imported because no vendor exists in the database associated with this Sender Trading Partner Number",
        "severity": "Error",
        "alwaysApplies": true,
        "appliesWhen": "Processing import"
      },
      {
        "ruleName": "InvalidEventType",
        "property": "EventTypeName",
        "condition": "evntType == Lists.EventTypeList.EventTypes.Invalid",
        "message": "Transaction could not be imported because of invalid event type",
        "severity": "Error",
        "alwaysApplies": true,
        "appliesWhen": "Processing BargeStatus import"
      },
      {
        "ruleName": "InvalidEventStage",
        "property": "EventStage",
        "condition": "evntStage == Lists.EventTypeList.EventStage.None",
        "message": "Transaction could not be imported because the stage of the event could not be determined based on the type of event.",
        "severity": "Error",
        "alwaysApplies": true,
        "appliesWhen": "Processing new BargeStatus import"
      },
      {
        "ruleName": "NoOriginalCleanEvent",
        "property": "PrimaryControlNumber",
        "condition": "Additional Clean event but original Clean event not found",
        "message": "Update transaction could not be imported for the Additional Clean type because no original Clean event could not be found for the primary control number",
        "severity": "Error",
        "alwaysApplies": false,
        "appliesWhen": "Processing Additional Clean update"
      },
      {
        "ruleName": "NoOriginalEvent",
        "property": "OriginalControlNumber",
        "condition": "Update transaction but no original event found",
        "message": "Update transaction could not be imported because no barge event could be found for the original control number",
        "severity": "Error",
        "alwaysApplies": false,
        "appliesWhen": "Processing BargeStatus update"
      },
      {
        "ruleName": "TicketIsVoid",
        "property": "Ticket.IsVoid",
        "condition": "brgEvent.Barges(0).BargeEventTicket.IsVoid == true",
        "message": "Skipping import - cannot add/update barge event on Ticket that has been voided.",
        "severity": "Error",
        "alwaysApplies": false,
        "appliesWhen": "Processing BargeStatus import with voided ticket"
      },
      {
        "ruleName": "TicketEventIsVoid",
        "property": "TicketEvent.IsVoid",
        "condition": "brgEvent.Barges(0).BargeEventTicket.BargeEventTicketEvent.IsVoid == true",
        "message": "Skipping import - cannot update barge event that has been voided.",
        "severity": "Error",
        "alwaysApplies": false,
        "appliesWhen": "Processing BargeStatus update with voided event"
      },
      {
        "ruleName": "FinalBillAdjustment",
        "property": "VendorBillItemStatus",
        "condition": "brgEvent.VendorBillItemStatus == 'F' && (HasDivisionChangedForSameCustomerInvoicedEvent || HasTotalAmountChangedForSameCustomerInvoicedEvent || HasCustomerChangedForSameDivisionInvoicedEvent || HaveDivisionAndCustomerChangedForInvoicedEvent)",
        "message": "Skipping import - this vendor event is in Final Bill status and cannot be adjusted.",
        "severity": "Error",
        "alwaysApplies": false,
        "appliesWhen": "Processing BargeStatus update that would create adjustment"
      },
      {
        "ruleName": "DuplicateFleetingEvent",
        "property": "FleetingEvent",
        "condition": "GlobalSettingList.DiscardDuplicateBargeExVendorDocuments && duplicate Fleeting event found",
        "message": "Transaction skipped because it is a duplicate Fleeting event.",
        "severity": "Info",
        "alwaysApplies": false,
        "appliesWhen": "Processing new Fleeting BargeStatus with duplicate"
      },
      {
        "ruleName": "NoOriginalPartsServiceBillItem",
        "property": "OriginalControlNumber",
        "condition": "Update transaction but no original bill item found",
        "message": "Update transaction could not be imported because no Parts & Service Bill Item could be found for the original control number",
        "severity": "Error",
        "alwaysApplies": false,
        "appliesWhen": "Processing BoatStatus update"
      },
      {
        "ruleName": "UnsupportedDocumentType",
        "property": "DocType",
        "condition": "DocType not in ('BargeStatus', 'BoatStatus')",
        "message": "Unsupported document type - cannot process this row.",
        "severity": "Error",
        "alwaysApplies": false,
        "appliesWhen": "Processing import with unsupported document type"
      }
    ]
  },
  "modernValidationMapping": {
    "dataAnnotations": {
      "description": "Simple field-level validations using Data Annotations",
      "examples": [
        {
          "property": "ControlNumber",
          "attributes": [
            "[Required(ErrorMessage = \"Control number (Instance identifier) is required\")]",
            "[StringLength(128, ErrorMessage = \"Control number cannot exceed 128 characters\")]"
          ]
        },
        {
          "property": "ReceivedDateTime",
          "attributes": [
            "[Required(ErrorMessage = \"Received date/time is required\")]"
          ]
        },
        {
          "property": "SenderTradingPartnerNumber",
          "attributes": [
            "[StringLength(8, ErrorMessage = \"Sender trading partner number cannot exceed 8 characters\")]"
          ]
        },
        {
          "property": "BargeNum",
          "attributes": [
            "[StringLength(30, ErrorMessage = \"Barge number cannot exceed 30 characters\")]"
          ]
        },
        {
          "property": "River",
          "attributes": [
            "[StringLength(3, ErrorMessage = \"River cannot exceed 3 characters\")]"
          ]
        }
      ]
    },
    "fluentValidation": {
      "description": "Complex business rules and import validations using FluentValidation",
      "examples": [
        {
          "validator": "BargeExVendorDocInboxValidator",
          "rules": [
            "RuleFor(x => x.ControlNumber).NotEmpty().WithMessage(\"Control number (Instance identifier) is required\").MaximumLength(128);",
            "RuleFor(x => x.ReceivedDateTime).NotEmpty().WithMessage(\"Received date/time is required\");",
            "RuleFor(x => x.SenderTradingPartnerNumber).MaximumLength(8);",
            "RuleFor(x => x.BargeNum).MaximumLength(30);",
            "RuleFor(x => x.River).MaximumLength(3);"
          ]
        },
        {
          "validator": "BargeExVendorDocInboxImportValidator",
          "description": "Validates import-specific business rules",
          "rules": [
            "RuleFor(x => x.BargeID).GreaterThan(0).WithMessage(\"Transaction could not be imported because barge does not exist in the database.\");",
            "RuleFor(x => x.VendorID).GreaterThan(0).WithMessage(\"Transaction could not be imported because no vendor exists in the database associated with this Sender Trading Partner Number\");",
            "RuleFor(x => x).Must(NotBeVoidedTicket).WithMessage(\"Skipping import - cannot add/update barge event on Ticket that has been voided.\");",
            "RuleFor(x => x).Must(NotBeFinalBillAdjustment).WithMessage(\"Skipping import - this vendor event is in Final Bill status and cannot be adjusted.\");"
          ]
        }
      ]
    },
    "clientSideValidation": {
      "description": "Minimal client-side validation - forms are search/import screens",
      "jqueryValidate": {
        "note": "This entity has minimal client-side validation as it's an automated import process",
        "examples": []
      }
    }
  },
  "validationTriggers": {
    "description": "Events that trigger validation",
    "triggers": [
      {
        "event": "Property Change",
        "location": "Property setters in BargeExVendorDocumentInboxBase.vb",
        "validation": "CheckBusinessRules called on each property setter",
        "scope": "Field-level validation"
      },
      {
        "event": "Save/Update",
        "location": "BusinessLogicBase.IsValid",
        "validation": "All business rules checked before save",
        "scope": "Full object validation"
      },
      {
        "event": "Import Start",
        "location": "frmBargeExVendorDocInboxImport.btnStart_Click:121",
        "validation": "Pre-import warnings for no tickets and no prior imports",
        "scope": "Batch import validation"
      },
      {
        "event": "Import Process Row",
        "location": "frmBargeExVendorDocInboxImport.ProcessRow:320",
        "validation": "Per-row import validation including entity existence, void status, final bill status",
        "scope": "Individual record import validation"
      }
    ]
  },
  "notes": [
    "This entity is primarily used for EDI document import processing from BargeEx vendor system",
    "No traditional form validation (AreFieldsValid) - validation occurs during import process",
    "Import process has extensive business rule validation including entity lookups, void checks, and status checks",
    "Import validation creates BargeEvent records for BargeStatus documents and PartsServiceBill records for BoatStatus documents",
    "Conditional validation based on document type (BargeStatus vs BoatStatus) and transaction type (new vs update/revision)",
    "Validation includes referential integrity checks (barge exists, vendor exists, original transaction exists for revisions)",
    "Special handling for Additional Clean events and duplicate Fleeting events",
    "Final Bill status prevents adjustments to vendor events"
  ]
}
