{
  "parentEntity": "BargeExVendorDocInbox",
  "entityPurpose": "Staging/inbox table for incoming BargeEx vendor EDI documents. Acts as temporary holding area for documents before import into operational TicketEvent or PartsServiceBillItem records. Successfully imported records are immediately deleted.",
  "relationships": [
    {
      "relatedEntity": "Alert",
      "relationshipType": "OneToOne",
      "parentProperty": "Alert",
      "childProperty": null,
      "foreignKey": null,
      "cascadeDelete": false,
      "isOptional": true,
      "loadStrategy": "Deferred",
      "modernPattern": "NOT stored as navigation property - loaded separately via service layer",
      "gridName": null,
      "gridColumns": [],
      "operations": {
        "add": null,
        "edit": null,
        "delete": null
      },
      "notes": "Alert is a child object for notifications. Always creates new instance when accessed. Loaded via deferred pattern. In modern architecture, this would NOT be a navigation property - alerts loaded via separate service."
    }
  ],
  "lookupRelationships": [
    {
      "property": "BargeExDocumentTypeID",
      "lookupEntity": "BargeExDocumentType",
      "displayProperty": "DocumentTypeName",
      "required": false,
      "possibleValues": ["BargeStatus", "BoatStatus"],
      "description": "References BargeEx document type - determines if document creates TicketEvent (BargeStatus) or PartsServiceBillItem (BoatStatus)",
      "modernPattern": "Simple foreign key - NO navigation property"
    },
    {
      "property": "BargeExDocumentSubTypeID",
      "lookupEntity": "BargeExDocumentSubType",
      "displayProperty": "DocumentSubTypeName",
      "required": false,
      "possibleValues": [
        "BreakTow",
        "Clean",
        "CoverHandling",
        "Fleeting",
        "MakeTow",
        "MidstreamIn",
        "MidstreamOut",
        "Pump",
        "Shift",
        "Assist"
      ],
      "description": "References BargeEx document sub-type - specific operation type within BargeStatus or BoatStatus categories",
      "modernPattern": "Simple foreign key - NO navigation property"
    }
  ],
  "referenceDataFields": [
    {
      "property": "BargeUscgNum",
      "referencesEntity": "Barge",
      "matchField": "UscgNum",
      "description": "USCG number from BargeEx - used to lookup Barge during import. NOT a true foreign key relationship.",
      "importLogic": "Search for matching Barge by USCG number. If not found, user can create new Barge from BargeEx data.",
      "modernPattern": "String field only - NO foreign key constraint"
    },
    {
      "property": "BargeNum",
      "referencesEntity": "Barge",
      "matchField": "BargeNum",
      "description": "Barge number from BargeEx - alternative lookup field for Barge matching",
      "importLogic": "Used if USCG match fails - search by barge number",
      "modernPattern": "String field only - NO foreign key constraint"
    },
    {
      "property": "FleetBoatUscgNum",
      "referencesEntity": "Boat",
      "matchField": "UscgNum",
      "description": "Fleet boat USCG from BargeEx - servicing boat performing the work",
      "importLogic": "Lookup servicing Boat by USCG number during import",
      "modernPattern": "String field only - NO foreign key constraint"
    },
    {
      "property": "FleetBoatName",
      "referencesEntity": "Boat",
      "matchField": "BoatName",
      "description": "Fleet boat name from BargeEx - alternative lookup for servicing boat",
      "modernPattern": "String field only - NO foreign key constraint"
    },
    {
      "property": "AssistedBoatUscgNum",
      "referencesEntity": "Boat",
      "matchField": "UscgNum",
      "description": "Assisted boat USCG from BargeEx - boat receiving assist service (BoatStatus transactions)",
      "importLogic": "Lookup assisted Boat by USCG number for Assist operations",
      "modernPattern": "String field only - NO foreign key constraint"
    },
    {
      "property": "AssistedBoatName",
      "referencesEntity": "Boat",
      "matchField": "BoatName",
      "description": "Assisted boat name from BargeEx - alternative lookup for assisted boat",
      "modernPattern": "String field only - NO foreign key constraint"
    },
    {
      "property": "LocationBargeExCode",
      "referencesEntity": "FacilityLocation",
      "matchField": "BargeExCode",
      "description": "Start location BargeEx code - used to lookup FacilityLocation during import",
      "importLogic": "Match to FacilityLocation.BargeExCode. If not found, user can create new facility.",
      "modernPattern": "String field only - NO foreign key constraint"
    },
    {
      "property": "LocationName",
      "referencesEntity": "FacilityLocation",
      "matchField": "LocationName",
      "description": "Start location name from BargeEx - alternative lookup field",
      "modernPattern": "String field only - NO foreign key constraint"
    },
    {
      "property": "EndLocationBargeExCode",
      "referencesEntity": "FacilityLocation",
      "matchField": "BargeExCode",
      "description": "End location BargeEx code - destination facility for Shift/movement operations",
      "importLogic": "Match to FacilityLocation.BargeExCode for destination",
      "modernPattern": "String field only - NO foreign key constraint"
    },
    {
      "property": "EndLocationName",
      "referencesEntity": "FacilityLocation",
      "matchField": "LocationName",
      "description": "End location name from BargeEx - alternative lookup for destination",
      "modernPattern": "String field only - NO foreign key constraint"
    }
  ],
  "revisionTrackingRelationships": [
    {
      "property": "ControlNumber",
      "description": "Instance identifier - unique per transaction instance/revision. Each revision gets new ControlNumber.",
      "modernPattern": "String field - part of revision tracking pattern"
    },
    {
      "property": "OriginalControlNumber",
      "description": "Transaction identifier - same across all revisions. Links revisions back to original transaction.",
      "importLogic": "If ControlNumber differs from OriginalControlNumber, treat as revision/update to existing TicketEvent or PartsServiceBillItem",
      "modernPattern": "String field - part of revision tracking pattern"
    },
    {
      "property": "PrimaryControlNumber",
      "description": "For Additional Clean transactions, points to original Clean event ControlNumber",
      "importLogic": "Used to link additional cleaning charges to primary cleaning event",
      "modernPattern": "String field - specialized linking pattern for Clean event chains"
    },
    {
      "property": "RevisionNumber",
      "description": "Numeric revision counter for tracking document version",
      "modernPattern": "Integer field - display-only revision tracking"
    }
  ],
  "importTargetRelationships": [
    {
      "description": "BargeStatus documents create TicketEvent records",
      "sourceDocType": "BargeStatus",
      "targetEntity": "TicketEvent",
      "parentEntity": "Ticket",
      "foreignKeyCreated": "TicketID",
      "importLogic": "For BargeStatus documents, create or update TicketEvent on active Ticket for the barge",
      "revisionLookup": "Search for existing TicketEvent by BargeExVendorControlNumber using BargeExVendorTicketEventSearch stored procedure"
    },
    {
      "description": "BoatStatus documents create PartsServiceBillItem records",
      "sourceDocType": "BoatStatus",
      "targetEntity": "PartsServiceBillItem",
      "parentEntity": "PartsServiceBill",
      "foreignKeyCreated": "PartsServiceBillID",
      "importLogic": "For BoatStatus (Assist) documents, create or update PartsServiceBillItem on PartsServiceBill",
      "revisionLookup": "Search for existing PartsServiceBillItem by BargeExVendorControlNumber using BargeExVendorPSBillItemSearch stored procedure"
    }
  ],
  "childCollections": [],
  "noChildGrids": true,
  "notes": [
    "This is a STAGING TABLE, not a core business entity",
    "Records are TRANSIENT - successfully imported documents are immediately deleted via MultiDelete",
    "NO traditional parent-child relationships exist",
    "NO child entity grids on detail form",
    "Foreign keys reference lookup tables (BargeExDocumentType, BargeExDocumentSubType)",
    "Reference fields (BargeUscgNum, LocationBargeExCode, etc.) are STRING FIELDS used for matching during import - they are NOT foreign key constraints",
    "Import workflow transforms data into TicketEvent or PartsServiceBillItem depending on DocType",
    "Alert is deferred-load child object for notifications only",
    "Revision tracking uses ControlNumber/OriginalControlNumber pattern, not true relationships",
    "Search stored procedure (BargeExVendorDocumentInboxSearch) performs complex joins to resolve BargeEx data to system entity IDs"
  ],
  "modernDapperPattern": {
    "entityClass": {
      "name": "BargeExVendorDocInbox",
      "noNavigationProperties": true,
      "description": "Entity class contains ONLY scalar properties - NO child collections, NO navigation properties",
      "childDataLoading": "NOT APPLICABLE - this is a staging table with no child entities"
    },
    "repositoryMethods": {
      "note": "Standard CRUD methods only - no child entity loading methods needed",
      "methods": [
        "Task<BargeExVendorDocInboxDto> GetByIdAsync(int id)",
        "Task<IEnumerable<BargeExVendorDocInboxSearchDto>> SearchAsync(int fleetId, int? vendorId, int? documentSubTypeId, string controlNumber)",
        "Task<int> InsertAsync(BargeExVendorDocInboxDto entity)",
        "Task UpdateAsync(BargeExVendorDocInboxDto entity)",
        "Task DeleteAsync(int id)",
        "Task<int> MultiDeleteAsync(string commaDelimitedIds)"
      ]
    },
    "serviceLayer": {
      "note": "Import service handles transformation to TicketEvent or PartsServiceBillItem",
      "methods": [
        "Task<ImportResult> ImportDocumentsAsync(int[] documentIds)",
        "Task<EntityMatchResult> MatchBargeAsync(string uscgNum, string bargeNum)",
        "Task<EntityMatchResult> MatchLocationAsync(string bargeExCode, string locationName)",
        "Task<EntityMatchResult> MatchBoatAsync(string uscgNum, string boatName)",
        "Task<TicketEvent> FindExistingTicketEventAsync(string controlNumber)",
        "Task<PartsServiceBillItem> FindExistingPartsServiceBillItemAsync(string controlNumber)"
      ]
    },
    "dtoComposition": {
      "note": "Search DTO includes resolved entity IDs and names from join queries",
      "searchDto": "BargeExVendorDocInboxSearchDto - includes BargeID, LocationID, VendorID, etc. resolved via stored procedure joins"
    }
  },
  "criticalImplementationNotes": [
    "⚠️ This entity has NO child entity collections - do NOT attempt to load child data",
    "⚠️ Alert is NOT a child collection - it's a special deferred-load notification object",
    "⚠️ Reference fields (BargeUscgNum, LocationBargeExCode, etc.) are for MATCHING during import - NOT foreign key relationships",
    "⚠️ Modern implementation should NOT include navigation properties to Barge, Boat, or FacilityLocation",
    "⚠️ Import logic belongs in dedicated ImportService, not in repository layer",
    "⚠️ Search stored procedure handles complex entity resolution - use SearchDto with resolved IDs",
    "⚠️ Successfully imported records are deleted - this is expected behavior, not an error"
  ]
}
